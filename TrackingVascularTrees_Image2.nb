(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    832810,      19431]
NotebookOptionsPosition[    717394,      17378]
NotebookOutlinePosition[    802893,      19012]
CellTagsIndexPosition[    802850,      19009]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["This notebook contains the tracking results of \
\[OpenCurlyDoubleQuote]Image 2\[CloseCurlyDoubleQuote].", "Text",
 CellChangeTimes->{{3.87169977068983*^9, 3.871699782776741*^9}, 
   3.871700288992798*^9},ExpressionUUID->"f815ee99-a808-4bc1-bc72-\
ad0001787017"],

Cell["\<\
If the tracking in Python is not initialized correctly (see Functions -> Fast \
Marching -> Fast Marching Functions), uncomment the first line in this \
section.\
\>", "Text",
 CellChangeTimes->{{3.8718355682729983`*^9, 3.871835613015779*^9}, {
  3.871835677513686*^9, 
  3.8718356792404366`*^9}},ExpressionUUID->"044befc1-140a-44bf-9e5f-\
d181e324ddf8"],

Cell[CellGroupData[{

Cell["Tracking of Vascular Trees", "Title",
 CellChangeTimes->{{3.87137097019827*^9, 
  3.871370974653438*^9}},ExpressionUUID->"bf16e1cd-3294-4579-91a4-\
beface3ed856"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.635672260738264*^9, 3.635672265820571*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"4cfe7640-a5d7-45e6-9453-27c7c8298885"],

Cell[CellGroupData[{

Cell["Functions", "Chapter",
 CellChangeTimes->{{3.8713709852049437`*^9, 
  3.871370987926225*^9}},ExpressionUUID->"c465fde3-a85b-449b-9eb6-\
bd112a140ca8"],

Cell[CellGroupData[{

Cell["General functions", "Section",
 CellChangeTimes->{{3.8713711461793976`*^9, 
  3.871371148540756*^9}},ExpressionUUID->"0a1c7059-b552-4019-9d65-\
ae4adbf3de2b"],

Cell[CellGroupData[{

Cell["Coordinate Conversion", "Subsection",
 CellChangeTimes->{{3.665124935814988*^9, 
  3.6651249390832376`*^9}},ExpressionUUID->"f2ea63ee-73af-4dbd-9b85-\
e05e736cd15a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Converts", " ", "graphics", " ", "coordinates", " ", "to", " ", "image", 
    " ", "coordinates", " ", "using", " ", "image", " ", "dimensions"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"graphicsToImageCoordinates", "[", 
     RowBox[{"imOrImDim_", ",", "coordinates_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ydim", ",", "xdim"}], "}"}], ",", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Depth", "[", "imOrImDim", "]"}], "\[Equal]", "2"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", "imOrImDim", "]"}], "\[Equal]", "2"}]}], 
         ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ydim", ",", "xdim"}], "}"}], "=", "imOrImDim"}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ydim", ",", "xdim"}], "}"}], "=", 
          RowBox[{"Dimensions", "[", "imOrImDim", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ydim", "-", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "+", 
           RowBox[{"1", "/", "2"}]}], "&"}], ",", "coordinates", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Depth", "[", "coordinates", "]"}], "-", "2"}], "}"}]}], 
        "]"}]}]}], "]"}]}], "\n", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Converts", " ", "image", " ", "coordinates", " ", "to", " ", "graphics", 
     " ", "coordinates", " ", "using", " ", "image", " ", "dimensions"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imageToGraphicsCoordinates", "[", 
     RowBox[{"imOrImDim_", ",", "coordinates_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ydim", ",", "xdim"}], "}"}], ",", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Depth", "[", "imOrImDim", "]"}], "\[Equal]", "2"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", "imOrImDim", "]"}], "\[Equal]", "2"}]}], 
         ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ydim", ",", "xdim"}], "}"}], "=", "imOrImDim"}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ydim", ",", "xdim"}], "}"}], "=", 
          RowBox[{"Dimensions", "[", "imOrImDim", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"ydim", "+", "1", "-", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], "-", 
           RowBox[{"1", "/", "2"}]}], "&"}], ",", "coordinates", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Depth", "[", "coordinates", "]"}], "-", "2"}], "}"}]}], 
        "]"}]}]}], "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"PointImageCoordinates", "[", 
     RowBox[{"imOrImDim_", ",", "coordinates_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ydim", ",", "xdim"}], "}"}], ",", "\n", 
      RowBox[{"Point", "[", 
       RowBox[{"imageToGraphicsCoordinates", "[", 
        RowBox[{"imOrImDim", ",", "coordinates"}], "]"}], "]"}]}], "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"LineImageCoordinates", "[", 
     RowBox[{"imOrImDim_", ",", "coordinates_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ydim", ",", "xdim"}], "}"}], ",", "\n", 
      RowBox[{"Line", "[", 
       RowBox[{"imageToGraphicsCoordinates", "[", 
        RowBox[{"imOrImDim", ",", "coordinates"}], "]"}], "]"}]}], "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"ArrowImageCoordinates", "[", 
     RowBox[{"imOrImDim_", ",", "coordinates_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ydim", ",", "xdim"}], "}"}], ",", "\n", 
      RowBox[{"Map", "[", 
       RowBox[{"Arrow", ",", 
        RowBox[{"imageToGraphicsCoordinates", "[", 
         RowBox[{"imOrImDim", ",", "coordinates"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Depth", "[", "coordinates", "]"}], "-", "3"}], "}"}]}], 
       "]"}]}], "]"}]}]}]}]], "Code",
 CellChangeTimes->{{3.665124939880169*^9, 3.665124939895767*^9}, {
   3.6651279049928255`*^9, 3.665127911816661*^9}, {3.665127948462348*^9, 
   3.6651280186162367`*^9}, {3.6651281213424406`*^9, 3.665128130117424*^9}, 
   3.665128584550886*^9, {3.665128867302336*^9, 3.6651289344292917`*^9}, {
   3.665128964644614*^9, 3.665129023836845*^9}, {3.6651323236384478`*^9, 
   3.66513232860851*^9}, {3.6651329851615205`*^9, 3.6651329854115896`*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"a527a9f2-fb71-49a0-a516-f714ef4d337c"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Calculate Ground Truth Cost Function", "Section",
 CellChangeTimes->{{3.871371156101874*^9, 
  3.8713711667090683`*^9}},ExpressionUUID->"50c37578-7cef-4225-9b4d-\
cec48d99fdf0"],

Cell[CellGroupData[{

Cell["Finite Differences", "Subsection",
 CellChangeTimes->{{3.6352445524383373`*^9, 
  3.6352445558602257`*^9}},ExpressionUUID->"34807886-6b9d-441c-9aac-\
1822a882e7f6"],

Cell["\<\
These functions are taken and modified from OrientationScores`\
\>", "Text",
 CellChangeTimes->{{3.628320952924638*^9, 3.6283209671286917`*^9}, {
  3.635244559719612*^9, 
  3.635244569407154*^9}},ExpressionUUID->"38d3033f-86dc-4a18-82e6-\
7bee684f6c75"],

Cell[CellGroupData[{

Cell["\<\
All functions gathered (SE2FiniteDifferences is the main function)\
\>", "Subsubsection",
 CellChangeTimes->{{3.628322643173681*^9, 3.628322654596307*^9}, 
   3.63523949072867*^9},ExpressionUUID->"c6df6f72-55d4-402e-81a8-\
33ca350133bb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SE2FiniteDifferences", "::", "usage"}], "=", 
    "\"\<SE2FiniteDifferenceDerivative[os, order] calculates the \
left-invariant finite \ndifference derivative of the orientation score. The \
order of the derivative is \ndefined by \\\"order\\\". \\\"order\\\" is a \
string input containing the characters \\\"\[Xi]\\\", \n\\\"\[Eta]\\\" or \
\\\"\[Theta]\\\". For example, with order = \\\"\[Eta]\[Eta]\\\" the second \
order derivative in \n\[Eta]-direction is calculated.\>\""}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "******************************************************)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**", "Begin"}], " ", "Private"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "*********************************)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "**", "Derivative"}], " ", 
    "kernels"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "*********************************)"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**"}], "*", "Function", " ", "for",
     " ", "interpolation", " ", "kernel"}], "*)"}], "\n", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "InterpolationKernel", "]"}], "=", 
   RowBox[{"Options", "[", "ListInterpolation", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"InterpolationKernel", "[", 
     RowBox[{"vector_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "emptyKernel", ",", "kernelFinal", ",", "kernelOneElement", ",", 
        "kernelOneElementInt", ",", "center"}], "}"}], ",", 
      RowBox[{
       RowBox[{"center", "=", 
        RowBox[{
         RowBox[{"OptionValue", "[", "InterpolationOrder", "]"}], "+", 
         "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"emptyKernel", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"2", "*", "center"}], "-", "1"}], ",", 
            RowBox[{
             RowBox[{"2", "*", "center"}], "-", "1"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"kernelFinal", "=", "emptyKernel"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"kernelOneElement", "=", "emptyKernel"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"kernelOneElement", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", "1"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"kernelOneElementInt", "=", 
           RowBox[{"ListInterpolation", "[", 
            RowBox[{"kernelOneElement", ",", 
             RowBox[{"Method", "\[Rule]", 
              RowBox[{"OptionValue", "[", "Method", "]"}]}], ",", 
             RowBox[{"InterpolationOrder", "\[Rule]", 
              RowBox[{"OptionValue", "[", "InterpolationOrder", "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"kernelFinal", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{"kernelOneElementInt", "[", 
            RowBox[{
             RowBox[{"center", "+", 
              RowBox[{"vector", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"center", "+", 
              RowBox[{"vector", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{
            RowBox[{"2", "*", "center"}], "-", "1"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{
            RowBox[{"2", "*", "center"}], "-", "1"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "This", " ", "result", " ", "is", " ", "a", " ", "correlation", " ", 
          "kernel"}], ",", 
         RowBox[{
         "we", " ", "want", " ", "a", " ", "convolution", " ", "kernel", " ", 
          "so", " ", "we", " ", "mirror", " ", "the", " ", 
          RowBox[{"result", ":"}]}]}], "*)"}], 
       RowBox[{"kernelFinal", "=", 
        RowBox[{"Reverse", "[", 
         RowBox[{"kernelFinal", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "kernelFinal", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**"}], "*", "Eta"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**"}], "*", "Central"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D\[Eta]KernelCentral", "[", "\[Theta]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"D\[Eta]KernelCentral", "[", "\[Theta]", "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kernelPlus", ",", "kernelMin", ",", "kernel", ",", "e\[Eta]"}],
       "}"}], ",", 
     RowBox[{
      RowBox[{"e\[Eta]", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
         RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelPlus", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{"e\[Eta]", ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelMin", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"-", "e\[Eta]"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernel", "=", 
       RowBox[{"0.5", " ", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", "kernelMin"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"D\[Eta]\[Eta]KernelCentral", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"D\[Eta]\[Eta]KernelCentral", "[", "\[Theta]", "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kernelPlus", ",", "kernelCenter", ",", "kernelMin", ",", "kernel", 
        ",", "e\[Eta]"}], "}"}], ",", 
      RowBox[{
       RowBox[{"e\[Eta]", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelPlus", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{"e\[Eta]", ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelCenter", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelMin", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"-", "e\[Eta]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernel", "=", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", 
          RowBox[{"2", "*", "kernelCenter"}], "+", "kernelMin"}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**"}], "*", "Forward"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D\[Eta]KernelForward", "[", "\[Theta]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"D\[Eta]KernelForward", "[", "\[Theta]", "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kernelPlus", ",", "kernelMin", ",", "kernel", ",", "e\[Eta]"}],
       "}"}], ",", 
     RowBox[{
      RowBox[{"e\[Eta]", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
         RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelPlus", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{"e\[Eta]", ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelMin", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernel", "=", 
       RowBox[{"(", 
        RowBox[{"kernelPlus", "-", "kernelMin"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"D\[Eta]\[Eta]KernelForward", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"D\[Eta]\[Eta]KernelForward", "[", "\[Theta]", "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kernelPlus", ",", "kernelCenter", ",", "kernelMin", ",", "kernel", 
        ",", "e\[Eta]"}], "}"}], ",", 
      RowBox[{
       RowBox[{"e\[Eta]", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelPlus", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"2", "*", "e\[Eta]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelCenter", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{"e\[Eta]", ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelMin", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernel", "=", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", 
          RowBox[{"2", "*", "kernelCenter"}], "+", "kernelMin"}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**"}], "*", "Backward"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D\[Eta]KernelBackward", "[", "\[Theta]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"D\[Eta]KernelBackward", "[", "\[Theta]", "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kernelPlus", ",", "kernelMin", ",", "kernel", ",", "e\[Eta]"}],
       "}"}], ",", 
     RowBox[{
      RowBox[{"e\[Eta]", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
         RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelPlus", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelMin", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"-", "e\[Eta]"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernel", "=", 
       RowBox[{"(", 
        RowBox[{"kernelPlus", "-", "kernelMin"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"D\[Eta]\[Eta]KernelBackward", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"D\[Eta]\[Eta]KernelBackward", "[", "\[Theta]", "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kernelPlus", ",", "kernelCenter", ",", "kernelMin", ",", "kernel", 
        ",", "e\[Eta]"}], "}"}], ",", 
      RowBox[{
       RowBox[{"e\[Eta]", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelPlus", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelCenter", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"-", "e\[Eta]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelMin", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "2"}], "*", "e\[Eta]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernel", "=", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", 
          RowBox[{"2", "*", "kernelCenter"}], "+", "kernelMin"}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**"}], "*", "Xi"}], "*)"}], 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**"}], "*", "Central"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D\[Xi]KernelCentral", "[", "\[Theta]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"D\[Xi]KernelCentral", "[", "\[Theta]", "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kernelPlus", ",", "kernelMin", ",", "kernel", ",", "e\[Xi]"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"e\[Xi]", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelPlus", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{"e\[Xi]", ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelMin", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"-", "e\[Xi]"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernel", "=", 
       RowBox[{"0.5", " ", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", "kernelMin"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"D\[Xi]\[Xi]KernelCentral", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"D\[Xi]\[Xi]KernelCentral", "[", "\[Theta]", "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kernelPlus", ",", "kernelMin", ",", "kernelCenter", ",", "kernel", 
        ",", "e\[Xi]"}], "}"}], ",", 
      RowBox[{
       RowBox[{"e\[Xi]", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelPlus", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{"e\[Xi]", ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelCenter", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelMin", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"-", "e\[Xi]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernel", "=", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", 
          RowBox[{"2", "*", "kernelCenter"}], "+", "kernelMin"}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**"}], "*", "Forward"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D\[Xi]KernelForward", "[", "\[Theta]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"D\[Xi]KernelForward", "[", "\[Theta]", "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kernelPlus", ",", "kernelMin", ",", "kernel", ",", "e\[Xi]"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"e\[Xi]", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelPlus", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{"e\[Xi]", ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelMin", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernel", "=", 
       RowBox[{"(", 
        RowBox[{"kernelPlus", "-", "kernelMin"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"D\[Xi]\[Xi]KernelForward", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"D\[Xi]\[Xi]KernelForward", "[", "\[Theta]", "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kernelPlus", ",", "kernelMin", ",", "kernelCenter", ",", "kernel", 
        ",", "e\[Xi]"}], "}"}], ",", 
      RowBox[{
       RowBox[{"e\[Xi]", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelPlus", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"2", "*", "e\[Xi]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelCenter", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{"e\[Xi]", ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelMin", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernel", "=", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", 
          RowBox[{"2", "*", "kernelCenter"}], "+", "kernelMin"}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**"}], "*", "Backward"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"D\[Xi]KernelBackward", "[", "\[Theta]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"D\[Xi]KernelBackward", "[", "\[Theta]", "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kernelPlus", ",", "kernelMin", ",", "kernel", ",", "e\[Xi]"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"e\[Xi]", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelPlus", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernelMin", "=", 
       RowBox[{"InterpolationKernel", "[", 
        RowBox[{
         RowBox[{"-", "e\[Xi]"}], ",", 
         RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kernel", "=", 
       RowBox[{"(", 
        RowBox[{"kernelPlus", "-", "kernelMin"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"D\[Xi]\[Xi]KernelBackward", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"D\[Xi]\[Xi]KernelBackward", "[", "\[Theta]", "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kernelPlus", ",", "kernelMin", ",", "kernelCenter", ",", "kernel", 
        ",", "e\[Xi]"}], "}"}], ",", 
      RowBox[{
       RowBox[{"e\[Xi]", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelPlus", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelCenter", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{"-", "e\[Xi]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernelMin", "=", 
        RowBox[{"InterpolationKernel", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "2"}], "*", "e\[Xi]"}], ",", 
          RowBox[{"Method", "\[Rule]", "\"\<Spline\>\""}], ",", 
          RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kernel", "=", 
        RowBox[{"(", 
         RowBox[{"kernelPlus", "-", 
          RowBox[{"2", "*", "kernelCenter"}], "+", "kernelMin"}], ")"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "kernel", "]"}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", "*********************************)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "Derivative"}], " ", 
    "functions"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "*********************************)"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**"}], "*", "Eta"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeftInvariantDerivativeD\[Eta]", "[", 
    RowBox[{"os_", ",", 
     RowBox[{"periodicity_", ":", " ", "\[Pi]"}], ",", 
     RowBox[{"coordinates_", ":", " ", "\"\<Matrix\>\""}], ",", 
     RowBox[{"method_", ":", "\"\<Central\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"s\[CurlyPhi]", ",", "kernel", ",", "osOut"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"s\[CurlyPhi]", "=", 
       RowBox[{"periodicity", "/", 
        RowBox[{"Length", "[", "os", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Switch", "[", 
          RowBox[{"method", ",", "\"\<Central\>\"", ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Eta]KernelCentral", "[", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
              ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Eta]KernelCentral", "[", 
                 RowBox[{
                  RowBox[{"\[Pi]", "/", "2"}], "-", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
               ";"}]}], "]"}], ";"}], ",", "\"\<Forward\>\"", ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Eta]KernelForward", "[", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
              ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Eta]KernelForward", "[", 
                 RowBox[{
                  RowBox[{"\[Pi]", "/", "2"}], "-", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
               ";"}]}], "]"}], ";"}], ",", "\"\<Backward\>\"", ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Eta]KernelBackward", "[", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
              ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Eta]KernelBackward", "[", 
                 RowBox[{
                  RowBox[{"\[Pi]", "/", "2"}], "-", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
               ";"}]}], "]"}], ";"}], ",", "_", ",", 
           RowBox[{"(*", 
            RowBox[{
            "If", " ", "incorrectly", " ", "specified", " ", "then", " ", 
             "central"}], "*)"}], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
             RowBox[{
              RowBox[{"kernel", "=", 
               RowBox[{"D\[Eta]KernelCentral", "[", 
                RowBox[{"s\[CurlyPhi]", "*", 
                 RowBox[{"(", 
                  RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
             ",", 
             RowBox[{
              RowBox[{"kernel", "=", 
               RowBox[{"D\[Eta]KernelCentral", "[", 
                RowBox[{
                 RowBox[{"\[Pi]", "/", "2"}], "-", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
              ";"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"ListConvolve", "[", 
          RowBox[{"kernel", ",", 
           RowBox[{"os", "[", 
            RowBox[{"[", "\[Theta]i", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Ceiling", "[", 
               RowBox[{
                RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
               "]"}]}], ",", 
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
              "]"}]}], "}"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]i", ",", "1", ",", 
          RowBox[{"Length", "[", "os", "]"}], ",", "1"}], "}"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LeftInvariantDerivativeD\[Eta]\[Eta]", "[", 
     RowBox[{"os_", ",", 
      RowBox[{"periodicity_", ":", " ", "\[Pi]"}], ",", 
      RowBox[{"coordinates_", ":", " ", "\"\<Matrix\>\""}], ",", 
      RowBox[{"method_", ":", "\"\<Central\>\""}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s\[CurlyPhi]", ",", "kernel", ",", "osOut"}], "}"}], ",", 
      RowBox[{
       RowBox[{"s\[CurlyPhi]", "=", 
        RowBox[{"periodicity", "/", 
         RowBox[{"Length", "[", "os", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"osOut", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{"method", ",", "\"\<Central\>\"", ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Eta]\[Eta]KernelCentral", "[", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
                ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Eta]\[Eta]KernelCentral", "[", 
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                 ";"}]}], "]"}], ";"}], ",", "\"\<Forward\>\"", ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Eta]\[Eta]KernelForward", "[", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
                ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Eta]\[Eta]KernelForward", "[", 
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                 ";"}]}], "]"}], ";"}], ",", "\"\<Backward\>\"", ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Eta]\[Eta]KernelBackward", "[", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
                ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Eta]\[Eta]KernelBackward", "[", 
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                 ";"}]}], "]"}], ";"}], ",", "_", ",", 
             RowBox[{"(*", 
              RowBox[{
              "If", " ", "incorrectly", " ", "specified", " ", "then", " ", 
               "central"}], "*)"}], 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
               RowBox[{
                RowBox[{"kernel", "=", 
                 RowBox[{"D\[Eta]\[Eta]KernelCentral", "[", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
               ",", 
               RowBox[{
                RowBox[{"kernel", "=", 
                 RowBox[{"D\[Eta]\[Eta]KernelCentral", "[", 
                  RowBox[{
                   RowBox[{"\[Pi]", "/", "2"}], "-", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                ";"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"ListConvolve", "[", 
            RowBox[{"kernel", ",", 
             RowBox[{"os", "[", 
              RowBox[{"[", "\[Theta]i", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Ceiling", "[", 
                 RowBox[{
                  RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
                 "]"}]}], ",", 
               RowBox[{"Ceiling", "[", 
                RowBox[{
                 RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
                "]"}]}], "}"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"\[Theta]i", ",", "1", ",", 
            RowBox[{"Length", "[", "os", "]"}], ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "osOut", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**"}], "*", "Xi"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeftInvariantDerivativeD\[Xi]", "[", 
    RowBox[{"os_", ",", 
     RowBox[{"periodicity_", ":", " ", "\[Pi]"}], ",", 
     RowBox[{"coordinates_", ":", "\"\<Matrix\>\""}], ",", 
     RowBox[{"method_", ":", "\"\<Central\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"s\[CurlyPhi]", ",", "kernel", ",", "osOut"}], "}"}], ",", 
     RowBox[{
      RowBox[{"s\[CurlyPhi]", "=", 
       RowBox[{"periodicity", "/", 
        RowBox[{"Length", "[", "os", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Switch", "[", 
          RowBox[{"method", ",", "\"\<Central\>\"", ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Xi]KernelCentral", "[", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
              ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Xi]KernelCentral", "[", 
                 RowBox[{
                  RowBox[{"\[Pi]", "/", "2"}], "-", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
               ";"}]}], "]"}], ";"}], ",", "\"\<Forward\>\"", ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Xi]KernelForward", "[", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
              ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Xi]KernelForward", "[", 
                 RowBox[{
                  RowBox[{"\[Pi]", "/", "2"}], "-", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
               ";"}]}], "]"}], ";"}], ",", "\"\<Backward\>\"", ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Xi]KernelBackward", "[", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
              ",", 
              RowBox[{
               RowBox[{"kernel", "=", 
                RowBox[{"D\[Xi]KernelBackward", "[", 
                 RowBox[{
                  RowBox[{"\[Pi]", "/", "2"}], "-", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
               ";"}]}], "]"}], ";"}], ",", "_", ",", 
           RowBox[{"(*", 
            RowBox[{
            "If", " ", "incorrectly", " ", "specified", " ", "then", " ", 
             "central"}], "*)"}], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
             RowBox[{
              RowBox[{"kernel", "=", 
               RowBox[{"D\[Xi]KernelCentral", "[", 
                RowBox[{"s\[CurlyPhi]", "*", 
                 RowBox[{"(", 
                  RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
             ",", 
             RowBox[{
              RowBox[{"kernel", "=", 
               RowBox[{"D\[Xi]KernelCentral", "[", 
                RowBox[{
                 RowBox[{"\[Pi]", "/", "2"}], "-", 
                 RowBox[{"s\[CurlyPhi]", "*", 
                  RowBox[{"(", 
                   RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
              ";"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"ListConvolve", "[", 
          RowBox[{"kernel", ",", 
           RowBox[{"os", "[", 
            RowBox[{"[", "\[Theta]i", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Ceiling", "[", 
               RowBox[{
                RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
               "]"}]}], ",", 
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
              "]"}]}], "}"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]i", ",", "1", ",", 
          RowBox[{"Length", "[", "os", "]"}], ",", "1"}], "}"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LeftInvariantDerivativeD\[Xi]\[Xi]", "[", 
     RowBox[{"os_", ",", 
      RowBox[{"periodicity_", ":", " ", "\[Pi]"}], ",", 
      RowBox[{"coordinates_", ":", "\"\<Matrix\>\""}], ",", 
      RowBox[{"method_", ":", "\"\<Central\>\""}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s\[CurlyPhi]", ",", "kernel", ",", "osOut"}], "}"}], ",", 
      RowBox[{
       RowBox[{"s\[CurlyPhi]", "=", 
        RowBox[{"periodicity", "/", 
         RowBox[{"Length", "[", "os", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"osOut", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{"method", ",", "\"\<Central\>\"", ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Xi]\[Xi]KernelCentral", "[", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
                ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Xi]\[Xi]KernelCentral", "[", 
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                 ";"}]}], "]"}], ";"}], ",", "\"\<Forward\>\"", ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Xi]\[Xi]KernelForward", "[", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
                ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Xi]\[Xi]KernelForward", "[", 
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                 ";"}]}], "]"}], ";"}], ",", "\"\<Backward\>\"", ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Xi]\[Xi]KernelBackward", "[", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
                ",", 
                RowBox[{
                 RowBox[{"kernel", "=", 
                  RowBox[{"D\[Xi]\[Xi]KernelBackward", "[", 
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                 ";"}]}], "]"}], ";"}], ",", "_", ",", 
             RowBox[{"(*", 
              RowBox[{
              "If", " ", "incorrectly", " ", "specified", " ", "then", " ", 
               "central"}], "*)"}], 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
               RowBox[{
                RowBox[{"kernel", "=", 
                 RowBox[{"D\[Xi]\[Xi]KernelCentral", "[", 
                  RowBox[{"s\[CurlyPhi]", "*", 
                   RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}], "]"}]}], ";"}], 
               ",", 
               RowBox[{
                RowBox[{"kernel", "=", 
                 RowBox[{"D\[Xi]\[Xi]KernelCentral", "[", 
                  RowBox[{
                   RowBox[{"\[Pi]", "/", "2"}], "-", 
                   RowBox[{"s\[CurlyPhi]", "*", 
                    RowBox[{"(", 
                    RowBox[{"\[Theta]i", "-", "1"}], ")"}]}]}], "]"}]}], 
                ";"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"ListConvolve", "[", 
            RowBox[{"kernel", ",", 
             RowBox[{"os", "[", 
              RowBox[{"[", "\[Theta]i", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Ceiling", "[", 
                 RowBox[{
                  RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
                 "]"}]}], ",", 
               RowBox[{"Ceiling", "[", 
                RowBox[{
                 RowBox[{"Dimensions", "[", "kernel", "]"}], "/", "2"}], 
                "]"}]}], "}"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"\[Theta]i", ",", "1", ",", 
            RowBox[{"Length", "[", "os", "]"}], ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "osOut", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**"}], "*", "Theta"}], "*)"}], 
  "\[IndentingNewLine]", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeftInvariantDerivativeD\[Theta]", "[", 
    RowBox[{"os_", ",", 
     RowBox[{"periodicity_", ":", " ", "\[Pi]"}], ",", 
     RowBox[{"coordinates_", ":", "\"\<Matrix\>\""}], ",", 
     RowBox[{"method_", ":", "\"\<Central\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "s\[CurlyPhi]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"s\[CurlyPhi]", "=", 
       RowBox[{"periodicity", "/", 
        RowBox[{"Length", "[", "os", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Switch", "[", 
       RowBox[{
       "method", ",", "\[IndentingNewLine]", "\"\<Central\>\"", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
          RowBox[{
           RowBox[{"1", "/", 
            RowBox[{"(", "2", ")"}]}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", "1"}], "]"}], "-", 
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ",", 
          RowBox[{
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{"2", " ", "s\[CurlyPhi]"}], ")"}]}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"RotateLeft", "[", 
               RowBox[{"os", ",", "1"}], "]"}]}], "+", 
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ")"}]}]}], "]"}], 
        "\[IndentingNewLine]", ",", "\"\<Forward\>\"", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"os", ",", "1"}], "]"}], "-", 
            RowBox[{"RotateLeft", "[", 
             RowBox[{"os", ",", "0"}], "]"}]}], ")"}], ",", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", "0"}], "]"}]}], "+", 
            RowBox[{"RotateLeft", "[", 
             RowBox[{"os", ",", 
              RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], "]"}], 
        "\[IndentingNewLine]", ",", "\"\<Backward\>\"", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"os", ",", "0"}], "]"}], "-", 
            RowBox[{"RotateLeft", "[", 
             RowBox[{"os", ",", 
              RowBox[{"-", "1"}]}], "]"}]}], ")"}], ",", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", "1"}], "]"}]}], "+", 
            RowBox[{"RotateLeft", "[", 
             RowBox[{"os", ",", "0"}], "]"}]}], ")"}]}], "]"}], 
        "\[IndentingNewLine]", ",", "_", ",", 
        RowBox[{"(*", 
         RowBox[{
         "If", " ", "incorrectly", " ", "specified", " ", "then", " ", 
          "central"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"coordinates", "\[Equal]", "\"\<Matrix\>\""}], ",", 
          RowBox[{
           RowBox[{"1", "/", 
            RowBox[{"(", "2", ")"}]}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", "1"}], "]"}], "-", 
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ",", 
          RowBox[{
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{"2", " ", "s\[CurlyPhi]"}], ")"}]}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"RotateLeft", "[", 
               RowBox[{"os", ",", "1"}], "]"}]}], "+", 
             RowBox[{"RotateLeft", "[", 
              RowBox[{"os", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ")"}]}]}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LeftInvariantDerivativeD\[Theta]\[Theta]", "[", 
     RowBox[{"os_", ",", 
      RowBox[{"periodicity_", ":", " ", "\[Pi]"}], ",", 
      RowBox[{"coordinate_", ":", "\"\<Matrix\>\""}], ",", 
      RowBox[{"method_", ":", "\"\<Central\>\""}]}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s\[CurlyPhi]", ",", "osOut"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"s\[CurlyPhi]", "=", 
        RowBox[{"periodicity", "/", 
         RowBox[{"Length", "[", "os", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
        "method", "\[IndentingNewLine]", ",", "\"\<Central\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"coordinate", "\[Equal]", "\"\<Matrix\>\""}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", "1"}], "]"}], "-", 
                RowBox[{"2", "*", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "0"}], "]"}]}], "+", 
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", 
                  RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ";"}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{
               RowBox[{"1", "/", 
                RowBox[{"(", 
                 RowBox[{"s\[CurlyPhi]", "^", "2"}], ")"}]}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "1"}], "]"}], "-", 
                 RowBox[{"2", "*", 
                  RowBox[{"RotateLeft", "[", 
                   RowBox[{"os", ",", "0"}], "]"}]}], "+", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], ")"}]}]}], ";"}]}], "]"}], 
          ";"}], "\[IndentingNewLine]", ",", "\"\<Forward\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"coordinate", "\[Equal]", "\"\<Matrix\>\""}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", "0"}], "]"}], "-", 
                RowBox[{"2", "*", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "1"}], "]"}]}], "+", 
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", "2"}], "]"}]}], ")"}]}], ";"}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{
               RowBox[{"1", "/", 
                RowBox[{"(", 
                 RowBox[{"s\[CurlyPhi]", "^", "2"}], ")"}]}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "0"}], "]"}], "-", 
                 RowBox[{"2", "*", 
                  RowBox[{"RotateLeft", "[", 
                   RowBox[{"os", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "+", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", 
                   RowBox[{"-", "2"}]}], "]"}]}], ")"}]}]}], ";"}]}], "]"}], 
          ";"}], "\[IndentingNewLine]", ",", "\"\<Backward\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"coordinate", "\[Equal]", "\"\<Matrix\>\""}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", 
                  RowBox[{"-", "2"}]}], "]"}], "-", 
                RowBox[{"2", "*", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], "+", 
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", "0"}], "]"}]}], ")"}]}], ";"}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{
               RowBox[{"1", "/", 
                RowBox[{"(", 
                 RowBox[{"s\[CurlyPhi]", "^", "2"}], ")"}]}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "2"}], "]"}], "-", 
                 RowBox[{"2", "*", 
                  RowBox[{"RotateLeft", "[", 
                   RowBox[{"os", ",", "1"}], "]"}]}], "+", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "0"}], "]"}]}], ")"}]}]}], ";"}]}], 
           "]"}], ";"}], "\[IndentingNewLine]", ",", "_", ",", 
         RowBox[{"(*", 
          RowBox[{
          "If", " ", "incorrectly", " ", "specified", " ", "then", " ", 
           "central"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"coordinate", "\[Equal]", "\"\<Matrix\>\""}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", "1"}], "]"}], "-", 
                RowBox[{"2", "*", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "0"}], "]"}]}], "+", 
                RowBox[{"RotateLeft", "[", 
                 RowBox[{"os", ",", 
                  RowBox[{"-", "1"}]}], "]"}]}], ")"}]}], ";"}], ",", 
            RowBox[{
             RowBox[{"osOut", "=", 
              RowBox[{
               RowBox[{"1", "/", 
                RowBox[{"(", 
                 RowBox[{"s\[CurlyPhi]", "^", "2"}], ")"}]}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", "1"}], "]"}], "-", 
                 RowBox[{"2", "*", 
                  RowBox[{"RotateLeft", "[", 
                   RowBox[{"os", ",", "0"}], "]"}]}], "+", 
                 RowBox[{"RotateLeft", "[", 
                  RowBox[{"os", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], ")"}]}]}], ";"}]}], "]"}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "osOut", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "*********************************)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "**", "**", "**", "Final"}], 
    " ", "function"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "*********************************)"}], "\n", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "SE2FiniteDifferences", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Periodicity\>\"", "\[Rule]", "\[Pi]"}], ",", 
     RowBox[{"\"\<CoordinateSystem\>\"", "\[Rule]", "\"\<Matrix\>\""}], ",", 
     RowBox[{"\"\<Method\>\"", "\[Rule]", "\"\<Central\>\""}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SE2FiniteDifferences", "[", 
     RowBox[{"os_", ",", "order_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "osOut", "}"}], ",", 
      RowBox[{"Switch", "[", 
       RowBox[{"order", ",", "\"\<\[Xi]\>\"", ",", 
        RowBox[{"LeftInvariantDerivativeD\[Xi]", "[", 
         RowBox[{"os", ",", 
          RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], "]"}], ",", 
        "\"\<\[Xi]\[Xi]\>\"", ",", 
        RowBox[{"LeftInvariantDerivativeD\[Xi]\[Xi]", "[", 
         RowBox[{"os", ",", 
          RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], "]"}], ",", 
        "\"\<\[Eta]\>\"", ",", 
        RowBox[{"LeftInvariantDerivativeD\[Eta]", "[", 
         RowBox[{"os", ",", 
          RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], "]"}], ",", 
        "\"\<\[Eta]\[Eta]\>\"", ",", 
        RowBox[{"LeftInvariantDerivativeD\[Eta]\[Eta]", "[", 
         RowBox[{"os", ",", 
          RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], "]"}], ",", 
        "\"\<\[Theta]\>\"", ",", 
        RowBox[{"LeftInvariantDerivativeD\[Theta]", "[", 
         RowBox[{"os", ",", 
          RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], "]"}], ",", 
        "\"\<\[Theta]\[Theta]\>\"", ",", 
        RowBox[{"LeftInvariantDerivativeD\[Theta]\[Theta]", "[", 
         RowBox[{"os", ",", 
          RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
          RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], "]"}], ",", 
        "_String", ",", 
        RowBox[{
         RowBox[{"osOut", "=", "os"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Switch", "[", 
             RowBox[{
              RowBox[{"StringTake", "[", 
               RowBox[{"order", ",", 
                RowBox[{"{", "i", "}"}]}], "]"}], ",", "\"\<\[Xi]\>\"", ",", 
              RowBox[{"osOut", "=", 
               RowBox[{"LeftInvariantDerivativeD\[Xi]", "[", 
                RowBox[{"osOut", ",", 
                 RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], 
                 ",", 
                 RowBox[{
                 "OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
                 RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], 
                "]"}]}], ",", "\"\<\[Eta]\>\"", ",", 
              RowBox[{"osOut", "=", 
               RowBox[{"LeftInvariantDerivativeD\[Eta]", "[", 
                RowBox[{"osOut", ",", 
                 RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], 
                 ",", 
                 RowBox[{
                 "OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
                 RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], 
                "]"}]}], ",", "\"\<\[Theta]\>\"", ",", 
              RowBox[{"osOut", "=", 
               RowBox[{"LeftInvariantDerivativeD\[Theta]", "[", 
                RowBox[{"osOut", ",", 
                 RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}], 
                 ",", 
                 RowBox[{
                 "OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], ",", 
                 RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], 
                "]"}]}], ",", "_", ",", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Warning!: character \\\"\>\"", "<>", 
                RowBox[{"StringTake", "[", 
                 RowBox[{"order", ",", 
                  RowBox[{"{", "i", "}"}]}], "]"}], "<>", 
                "\"\<\\\" unknown. Charracters should be \\\"\[Xi]\\\", \\\"\
\[Eta]\\\" or \\\"\[Theta]\\\". Derivative skipped.\>\""}], "]"}]}], "]"}], 
            ";"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"StringLength", "[", "order", "]"}], ",", "1"}], "}"}]}],
           "]"}], ";", "\[IndentingNewLine]", "osOut"}], ",", "_", ",", 
        RowBox[{
        "Print", "[", 
         "\"\<Abort!: order should be specified as a string.\>\"", "]"}]}], 
       "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.6283210042982597`*^9, 3.6283210333939433`*^9}, {
  3.6351460221085663`*^9, 3.6351460257218037`*^9}, {3.635146118165888*^9, 
  3.6351461481555834`*^9}, {3.635146273366803*^9, 3.635146305873378*^9}, {
  3.6351464060309763`*^9, 3.6351465184329824`*^9}, {3.635146595402541*^9, 
  3.6351466044091887`*^9}, {3.6352394907599497`*^9, 3.635239490791171*^9}, {
  3.6352480053843927`*^9, 3.63524806379169*^9}, {3.6354860036396503`*^9, 
  3.6354860159420424`*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"55188bb1-410d-4742-ae70-aa2ae9ff3373"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Orientation score transform", "Subsection",
 CellChangeTimes->{{3.6283308046688805`*^9, 3.6283308128694572`*^9}, {
  3.871371205564873*^9, 
  3.871371207179783*^9}},ExpressionUUID->"f9ac294d-59bd-49e8-8096-\
2b96ac94a351"],

Cell[CellGroupData[{

Cell["\<\
All functions directly copied (OrientationScoreTransform is the main function \
of interest)\
\>", "Subsubsection",
 CellChangeTimes->{{3.6283308355729156`*^9, 
  3.6283308660777903`*^9}},ExpressionUUID->"0885da6d-d0be-429c-8d66-\
bc5c5eb39816"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CakeWaveletStack", "::", "usage"}], "=", 
    "\"\<CakeWaveletStack[size,s\[CurlyPhi]] returns the set \n\tof rotated \
wavelets with standard paramters (see Options[CakeWaveletStack]).\n\tThe \
kernel stack has dimensions No x size x size, where No = \
\\!\\(\\*FractionBox[\\(s\[CurlyPhi]\\), \\(periodicity\\)]\\). \n\tBy \
default periodicity = \[Pi], meaning that the wavelets are constructed \n\t\
from 0 to \[Pi]. Parameter s\[CurlyPhi] specifies the angular resolution: \n\t\
the number of kernels per \[Pi] radians. \n\nOther parameters can be adjusted \
through the options or by calling the function \n\tas follows:\n \n\
CakeWaveletStack[size,s\[CurlyPhi],kSpline,q,periodicity,\[Rho]Inflection,kMn,\
\[Sigma]s,matrixCoordinatesQ].\>\""}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GaborWaveletStack", "::", "usage"}], "=", 
    "\"\<GaborWaveletStack[a,s\[CurlyPhi]] returns the set \n\tof rotated \
Gabor wavelets at scale a, with standard paramters (see \
Options[GaborWaveletStack]).\n\tThe kernel stack has dimensions No x size x \
size, where No = \\!\\(\\*FractionBox[\\(s\[CurlyPhi]\\), \
\\(periodicity\\)]\\),\n\tand where size = 8*a*Sqrt[\[Epsilon]]. By default \
periodicity = \[Pi], meaning that \n\tthe wavelets are constructed from 0 to \
\[Pi]. Parameter s\[CurlyPhi] specifies \n\tthe angular resolution: the \
number of kernels per \[Pi] radians.\>\""}], ";"}], "\n", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"WaveletTransform2D", "::", "usage"}], "=", 
    "\"\<WaveletTransform2D[kernelStack,im] correlates each \n\tkernel with \
the image. If the kernel dimensions and image dimensions \n\tcoincide, \
correlation is done using (conjugate) Fourier multiplication, else\n\t it is \
done using correlation.\>\""}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrientationScoreTransform", "::", "usage"}], "=", 
    "\"\<OrientationScoreTransform[image, s\[CurlyPhi]] \n\tconstructs an \
orientation score from the image using cake wavelets with \n\tdefault \
paramters (see Options[OrientationScoreTransform] and \n\t?CakeWaveletStack). \
By default this is done through Fourier domain \n\tmultiplication, unless it \
is specified (by using the options) otherwise.\>\""}], ";"}], "\n", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "**********************************)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "**", "**"}], "*", 
    "CakeWaveletStack", " ", "Private", " ", "Functions"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "PolarCoordinateGridRadial", " ", "returns", " ", "a", " ", "matrix", " ", 
    "in", " ", "which", " ", "each", " ", "element", " ", "gives", " ", "the",
     " ", "corresponding", " ", "radial", " ", "coordinate", " ", 
    RowBox[{"(", 
     RowBox[{
     "with", " ", "the", " ", "origin", " ", "in", " ", "the", " ", "center", 
      " ", "of", " ", "the", " ", "matrix"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PolarCoordinateGridRadial", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"size", ",", "_Integer"}], "}"}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"x", "^", "2"}], "+", 
          RowBox[{"y", "^", "2"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "PolarCoordinateGridRadial", " ", "returns", " ", "a", " ", "matrix", " ", 
    "in", " ", "which", " ", "each", " ", "element", " ", "gives", " ", "the",
     " ", "corresponding", " ", "radial", " ", "coordinate", " ", 
    RowBox[{"(", 
     RowBox[{
     "with", " ", "the", " ", "origin", " ", "in", " ", "the", " ", "center", 
      " ", "of", " ", "the", " ", "matrix"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PolarCoordinateGridAngular", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"size", ",", "_Integer"}], "}"}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Arg", "[", 
         RowBox[{"x", "+", 
          RowBox[{"I", " ", "y"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "MnWindow", " ", "gives", " ", "the", " ", "radial", " ", "windowing", " ",
     "matrix", " ", "for", " ", "sampling", " ", "the", " ", "fourier", " ", 
    "domain"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MnWindow", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"size", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Rho]inflection", ",", "_Real"}], "}"}]}], "}"}], ",", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "\[Rho]Matrix", "}"}], ",", 
        RowBox[{
         RowBox[{"\[Rho]Matrix", "=", 
          RowBox[{"$MachineEpsilon", "+", 
           RowBox[{
            RowBox[{"1", "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"2", "*", 
                 RowBox[{"\[Rho]inflection", "^", "2"}]}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 RowBox[{"2", " ", "n"}]}], ")"}]}], "]"}]}], " ", 
            RowBox[{"PolarCoordinateGridRadial", "[", "size", "]"}]}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Total", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"E", "^", 
              RowBox[{"-", 
               RowBox[{"\[Rho]Matrix", "^", "2"}]}]}], "*", 
             RowBox[{
              RowBox[{"\[Rho]Matrix", "^", 
               RowBox[{"(", 
                RowBox[{"2", "k"}], ")"}]}], "/", 
              RowBox[{"k", "!"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}], "]"}]}]}], 
       "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"k", "!"}], ",", "_Real"}], "}"}], "}"}]}], "]"}]}], ";"}], 
  "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "BSplineScalarFunc", " ", "is", " ", "a", " ", "compile", " ", "spline", 
     " ", "basis", " ", "function", " ", "of", " ", "arbitrary", " ", 
     RowBox[{"order", ".", "The"}], " ", "function", " ", "is", " ", 
     "defined", " ", "for", " ", "scalars"}], ",", 
    RowBox[{
    "list", " ", "and", " ", "2", "D", " ", "matrix", " ", "objects"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BSplineScalarFunc", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "_Real"}], "}"}]}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"function", ",", "intervalCheck"}], "}"}], ",", 
       RowBox[{"Total", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"function", "=", 
            RowBox[{
             RowBox[{"1", "/", 
              RowBox[{"(", 
               RowBox[{"2", " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"n", "+", "1", "-", "1"}], ")"}], "!"}]}], ")"}]}], 
             " ", 
             RowBox[{"Total", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Binomial", "[", 
                  RowBox[{
                   RowBox[{"n", "+", "1"}], ",", "k"}], "]"}], 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"n", "+", "1"}], ")"}], "/", "2"}], "-", "k"}], 
                   ")"}], "^", 
                  RowBox[{"(", 
                   RowBox[{"n", "+", "1", "-", "1"}], ")"}]}], " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"-", "1"}], ")"}], "^", "k"}], " ", 
                 RowBox[{"Sign", "[", 
                  RowBox[{"i", "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"n", "+", "1"}], ")"}], "/", "2"}], "-", "k"}], 
                  "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "0", ",", 
                  RowBox[{"n", "+", "1"}]}], "}"}]}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"intervalCheck", "=", 
            RowBox[{"Round", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"i", "<", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"n", "+", "1", "-", "1"}], ")"}], "/", "2"}]}], ",", 
               RowBox[{
                RowBox[{"UnitStep", "[", 
                 RowBox[{"x", "-", 
                  RowBox[{"(", 
                   RowBox[{"i", "-", 
                    RowBox[{"1", "/", "2"}], "+", "$MachineEpsilon"}], 
                   ")"}]}], "]"}], "*", 
                RowBox[{"UnitStep", "[", 
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"x", "-", 
                    RowBox[{"(", 
                    RowBox[{"i", "+", 
                    RowBox[{"1", "/", "2"}]}], ")"}]}], ")"}]}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"UnitStep", "[", 
                 RowBox[{"x", "-", 
                  RowBox[{"(", 
                   RowBox[{"i", "-", 
                    RowBox[{"1", "/", "2"}], "+", "$MachineEpsilon"}], 
                   ")"}]}], "]"}], "*", 
                RowBox[{"UnitStep", "[", 
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"x", "-", 
                    RowBox[{"(", 
                    RowBox[{"i", "+", 
                    RowBox[{"1", "/", "2"}], "-", "$MachineEpsilon"}], 
                    ")"}]}], ")"}]}], "]"}]}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"function", "*", "intervalCheck"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", "n", "-", "1"}], ")"}], "/", "2"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"n", "-", "1", "+", "1"}], ")"}], "/", "2"}]}], "}"}]}],
          "]"}], "]"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"BSplineListFunc", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"function", ",", "intervalCheck"}], "}"}], ",", 
       RowBox[{"Total", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"function", "=", 
            RowBox[{
             RowBox[{"1", "/", 
              RowBox[{"(", 
               RowBox[{"2", " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"n", "+", "1", "-", "1"}], ")"}], "!"}]}], ")"}]}], 
             " ", 
             RowBox[{"Total", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Binomial", "[", 
                  RowBox[{
                   RowBox[{"n", "+", "1"}], ",", "k"}], "]"}], 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"n", "+", "1"}], ")"}], "/", "2"}], "-", "k"}], 
                   ")"}], "^", 
                  RowBox[{"(", 
                   RowBox[{"n", "+", "1", "-", "1"}], ")"}]}], " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"-", "1"}], ")"}], "^", "k"}], " ", 
                 RowBox[{"Sign", "[", 
                  RowBox[{"i", "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"n", "+", "1"}], ")"}], "/", "2"}], "-", "k"}], 
                  "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "0", ",", 
                  RowBox[{"n", "+", "1"}]}], "}"}]}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"intervalCheck", "=", 
            RowBox[{"Round", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"i", "<", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"n", "+", "1", "-", "1"}], ")"}], "/", "2"}]}], ",", 
               RowBox[{
                RowBox[{"UnitStep", "[", 
                 RowBox[{"x", "-", 
                  RowBox[{"(", 
                   RowBox[{"i", "-", 
                    RowBox[{"1", "/", "2"}], "+", "$MachineEpsilon"}], 
                   ")"}]}], "]"}], "*", 
                RowBox[{"UnitStep", "[", 
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"x", "-", 
                    RowBox[{"(", 
                    RowBox[{"i", "+", 
                    RowBox[{"1", "/", "2"}]}], ")"}]}], ")"}]}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"UnitStep", "[", 
                 RowBox[{"x", "-", 
                  RowBox[{"(", 
                   RowBox[{"i", "-", 
                    RowBox[{"1", "/", "2"}], "+", "$MachineEpsilon"}], 
                   ")"}]}], "]"}], "*", 
                RowBox[{"UnitStep", "[", 
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"x", "-", 
                    RowBox[{"(", 
                    RowBox[{"i", "+", 
                    RowBox[{"1", "/", "2"}], "-", "$MachineEpsilon"}], 
                    ")"}]}], ")"}]}], "]"}]}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"function", "*", "intervalCheck"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", "n", "-", "1"}], ")"}], "/", "2"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"n", "-", "1", "+", "1"}], ")"}], "/", "2"}]}], "}"}]}],
          "]"}], "]"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BSplineMatrixFunc", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"function", ",", "intervalCheck"}], "}"}], ",", 
        RowBox[{"Total", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"function", "=", 
             RowBox[{
              RowBox[{"1", "/", 
               RowBox[{"(", 
                RowBox[{"2", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"n", "+", "1", "-", "1"}], ")"}], "!"}]}], ")"}]}],
               " ", 
              RowBox[{"Total", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Binomial", "[", 
                   RowBox[{
                    RowBox[{"n", "+", "1"}], ",", "k"}], "]"}], 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"n", "+", "1"}], ")"}], "/", "2"}], "-", "k"}], 
                    ")"}], "^", 
                   RowBox[{"(", 
                    RowBox[{"n", "+", "1", "-", "1"}], ")"}]}], " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "k"}], " ", 
                  RowBox[{"Sign", "[", 
                   RowBox[{"i", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"n", "+", "1"}], ")"}], "/", "2"}], "-", "k"}], 
                   "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"k", ",", "0", ",", 
                   RowBox[{"n", "+", "1"}]}], "}"}]}], "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"intervalCheck", "=", 
             RowBox[{"Round", "[", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"i", "<", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"n", "+", "1", "-", "1"}], ")"}], "/", "2"}]}], 
                ",", 
                RowBox[{
                 RowBox[{"UnitStep", "[", 
                  RowBox[{"x", "-", 
                   RowBox[{"(", 
                    RowBox[{"i", "-", 
                    RowBox[{"1", "/", "2"}], "+", "$MachineEpsilon"}], 
                    ")"}]}], "]"}], "*", 
                 RowBox[{"UnitStep", "[", 
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"x", "-", 
                    RowBox[{"(", 
                    RowBox[{"i", "+", 
                    RowBox[{"1", "/", "2"}]}], ")"}]}], ")"}]}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"UnitStep", "[", 
                  RowBox[{"x", "-", 
                   RowBox[{"(", 
                    RowBox[{"i", "-", 
                    RowBox[{"1", "/", "2"}], "+", "$MachineEpsilon"}], 
                    ")"}]}], "]"}], "*", 
                 RowBox[{"UnitStep", "[", 
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"x", "-", 
                    RowBox[{"(", 
                    RowBox[{"i", "+", 
                    RowBox[{"1", "/", "2"}], "-", "$MachineEpsilon"}], 
                    ")"}]}], ")"}]}], "]"}]}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"function", "*", "intervalCheck"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", "n", "-", "1"}], ")"}], "/", "2"}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"n", "-", "1", "+", "1"}], ")"}], "/", "2"}]}], 
            "}"}]}], "]"}], "]"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "WindowGauss", " ", "retuns", " ", "the", " ", "spatial", " ", "Gauss", 
    " ", "envelope"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WindowGauss", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"size", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Sigma]s", ",", "_Real"}], "}"}]}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"E", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"x", "^", "2"}], "/", 
              RowBox[{"(", 
               RowBox[{"2", 
                RowBox[{"\[Sigma]s", "^", "2"}]}], ")"}]}], ")"}]}], "-", 
           RowBox[{
            RowBox[{"y", "^", "2"}], "/", 
            RowBox[{"(", 
             RowBox[{"2", 
              RowBox[{"\[Sigma]s", "^", "2"}]}], ")"}]}]}], ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
            "]"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "CakeWaveletStackFourier", " ", "constructs", " ", "the", " ", "cake", " ",
     "wavelets", " ", "in", " ", "the", " ", "Fourier", " ", "domain", " ", 
    RowBox[{"(", 
     RowBox[{
     "note", " ", "that", " ", "windowing", " ", "in", " ", "the", " ", 
      "spatial", " ", "domain", " ", "is", " ", "still", " ", "required", " ",
       "after", " ", "this"}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CakeWaveletStackFourier", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"size", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"s\[CurlyPhi]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"kspline", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Rho]Inflection", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"kMn", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"matrixCoordinatesQ", ",", 
          RowBox[{"True", "|", "False"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"mnWindow", ",", "angleGrid"}], "}"}], ",", 
        RowBox[{
         RowBox[{"mnWindow", "=", 
          RowBox[{"MnWindow", "[", 
           RowBox[{"size", ",", "kMn", ",", "\[Rho]Inflection"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"angleGrid", "=", 
          RowBox[{"PolarCoordinateGridAngular", "[", "size", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"mnWindow", "*", 
            RowBox[{"BSplineMatrixFunc", "[", 
             RowBox[{"kspline", ",", 
              RowBox[{"If", "[", 
               RowBox[{"matrixCoordinatesQ", ",", 
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"angleGrid", "-", "\[Theta]", "-", 
                    RowBox[{"\[Pi]", "/", "2"}]}], ",", 
                   RowBox[{"2", "\[Pi]"}], ",", 
                   RowBox[{"-", "\[Pi]"}]}], "]"}], "/", "s\[CurlyPhi]"}], 
                ",", 
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"angleGrid", "+", "\[Theta]", "+", "\[Pi]"}], ",", 
                   RowBox[{"2", "\[Pi]"}], ",", 
                   RowBox[{"-", "\[Pi]"}]}], "]"}], "/", "s\[CurlyPhi]"}]}], 
               "]"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "\[Pi]", ",", 
             RowBox[{
              RowBox[{"2", "\[Pi]"}], "-", 
              RowBox[{"s\[CurlyPhi]", "/", "q"}]}], ",", 
             RowBox[{"(", 
              RowBox[{"s\[CurlyPhi]", "/", "q"}], ")"}]}], "}"}]}], "]"}]}]}],
        "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "ErfSet", " ", "retuns", " ", "a", " ", "set", " ", "of", " ", "2", "D", 
    " ", "error", " ", 
    RowBox[{"functions", ".", "This"}], " ", "function", " ", "is", " ", 
    "used", " ", "to", " ", "cut", " ", "the", " ", "wavelets", " ", "in", 
    " ", "two", " ", 
    RowBox[{"(", 
     RowBox[{"in", " ", "the", " ", "spatial", " ", "domain"}], ")"}]}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ErfSet", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"size", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"No", ",", "_Integer"}], "}"}]}], "}"}], ",", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "d\[Theta]", "}"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "/", "2"}], " ", 
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{"Erf", "[", 
                RowBox[{
                 RowBox[{"x", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"2", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "1"}], "+", "i"}], ")"}], " ", "\[Pi]"}], 
                    ")"}], "/", "No"}], "]"}]}], "+", 
                 RowBox[{"y", " ", 
                  RowBox[{"Sin", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"2", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "1"}], "+", "i"}], ")"}], " ", "\[Pi]"}], 
                    ")"}], "/", "No"}], "]"}]}]}], "]"}]}], ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], 
               "-", 
               RowBox[{"Mod", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
                "]"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
               RowBox[{"Mod", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
                "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y", ",", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ")"}]}], 
               "-", 
               RowBox[{"Mod", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
                "]"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "-", 
               RowBox[{"Mod", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], ",", "1"}], 
                "]"}]}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "No"}], "}"}]}], "]"}]}], "]"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "**********************************)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "**", "**"}], "*", 
    "CakeWaveletStack"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "CakeWaveletStack", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<SplineOrder\>\"", "\[Rule]", "3"}], ",", 
      RowBox[{"\"\<AngularSubSampleRate\>\"", "\[Rule]", "1"}], ",", 
      RowBox[{"\"\<Periodicity\>\"", "\[Rule]", "\[Pi]"}], ",", 
      RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "\"\<Automatic\>\""}], 
      ",", 
      RowBox[{"\"\<MnOrder\>\"", "\[Rule]", "8"}], ",", 
      RowBox[{"\"\<GaussianWindowSigma\>\"", "\[Rule]", "\"\<Automatic\>\""}],
       ",", 
      RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "\"\<Automatic\>\""}], 
      ",", 
      RowBox[{"\"\<CoordinateSystem\>\"", "\[Rule]", "\"\<Matrix\>\""}], ",", 
      RowBox[{"\"\<SingleVsDoubleSided\>\"", "\[Rule]", "\"\<Double\>\""}]}], 
     "}"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Function", " ", "definition", " ", "for", " ", "direct", " ", "options", 
    " ", "input"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CakeWaveletStack", "[", 
     RowBox[{
     "size_", ",", "s\[CurlyPhi]_", ",", "kSpline_", ",", "q_", ",", 
      "periodicity_", ",", "\[Rho]Inflection_", ",", "kMn_", ",", 
      "\[Sigma]s_", ",", "matrixCoordinatesQ_", ",", "singleOrDouble_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cakeF", ",", "cakeIF", ",", "window", ",", "cake"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cakeF", "=", 
        RowBox[{"CakeWaveletStackFourier", "[", 
         RowBox[{
         "size", ",", "s\[CurlyPhi]", ",", "kSpline", ",", "q", ",", 
          "\[Rho]Inflection", ",", "kMn", ",", "matrixCoordinatesQ"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"cakeF", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"Ceiling", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "]"}], "+", 
              "2"}], ",", 
             RowBox[{
              RowBox[{"Ceiling", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "]"}], "+", 
              "2"}]}], "]"}], "]"}], "=", 
          RowBox[{"0", "*", 
           RowBox[{"s\[CurlyPhi]", "/", "periodicity"}]}]}], ";"}], 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "The", " ", "central", " ", "frequency", " ", "overlaps", " ", 
           "with", " ", "all", " ", "rotated", " ", "kernels"}], ",", 
          RowBox[{
          "it", " ", "should", " ", "still", " ", "ad", " ", "up", " ", "to", 
           " ", "1"}]}], "*)"}], "*)"}], 
       RowBox[{"s", "=", "2"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"cakeF", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "]"}], "+", 
             "1", "-", "s"}], ";;", 
            RowBox[{
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "]"}], "+", 
             "1", "+", "s"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "]"}], "+", 
             "1", "-", "s"}], ";;", 
            RowBox[{
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], "]"}], "+", 
             "1", "+", "s"}]}]}], "]"}], "]"}], "=", 
        RowBox[{"s\[CurlyPhi]", "/", "periodicity"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "The", " ", "central", " ", "frequency", " ", "overlaps", " ", 
          "with", " ", "all", " ", "rotated", " ", "kernels"}], ",", 
         RowBox[{
         "it", " ", "should", " ", "still", " ", "ad", " ", "up", " ", "to", 
          " ", "1"}]}], "*)"}], 
       RowBox[{"cakeIF", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"RotateRight", "[", 
           RowBox[{
            RowBox[{"InverseFourier", "[", 
             RowBox[{"RotateLeft", "[", 
              RowBox[{"#", ",", 
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"size", ",", "size"}], "}"}], "/", "2"}], "]"}]}], 
              "]"}], "]"}], ",", 
            RowBox[{"Floor", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"size", ",", "size"}], "}"}], "/", "2"}], "]"}]}], 
           "]"}], "&"}], "/@", "cakeF"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"window", "=", 
        RowBox[{"WindowGauss", "[", 
         RowBox[{"size", ",", "\[Sigma]s"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cake", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"window", "*", "#"}], "&"}], "/@", "cakeIF"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"periodicity", "\[Equal]", 
          RowBox[{"2", "\[Pi]"}]}], ",", 
         RowBox[{
          RowBox[{"cake", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"cake", ",", 
               RowBox[{"Conjugate", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Reverse", "[", 
                   RowBox[{"Reverse", "[", "#", "]"}], "]"}], "&"}], "/@", 
                 "cake"}], "]"}]}], "}"}], ",", "1"}], "]"}]}], ";"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"singleOrDouble", "\[Equal]", "\"\<Single\>\""}], ",", 
         RowBox[{
          RowBox[{"cake", "=", 
           RowBox[{"cake", "*", 
            RowBox[{"ErfSet", "[", 
             RowBox[{"size", ",", 
              RowBox[{"q", "*", 
               RowBox[{"periodicity", "/", "s\[CurlyPhi]"}]}]}], "]"}]}]}], 
          ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "cake", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Function", " ", "definition", " ", "that", " ", "uses", " ", "the", " ", 
    "OptionsPattern"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CakeWaveletStack", "[", 
     RowBox[{"size_", ",", "s\[CurlyPhi]_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kSpline", ",", "q", ",", "periodicity", ",", "\[Rho]Inflection", ",", 
        "kMn", ",", "\[Sigma]s", ",", "matrixCoordinatesQ", ",", "cakeStack", 
        ",", "singleOrDouble"}], "}"}], ",", 
      RowBox[{"(*", "***************************)"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"**", "**", "**", "**", "**", "Check"}], " ", "Parameters"}], 
       "*)"}], 
      RowBox[{
       RowBox[{"kSpline", "=", 
        RowBox[{"OptionValue", "[", "\"\<SplineOrder\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"q", "=", 
        RowBox[{"OptionValue", "[", "\"\<AngularSubSampleRate\>\"", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"periodicity", "=", 
        RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<InflectionPoint\>\"", "]"}], ",", 
         "\"\<Automatic\>\"", ",", 
         RowBox[{
          RowBox[{"\[Rho]Inflection", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], " ", "0.8"}]}], 
          ";"}], ",", "_", ",", 
         RowBox[{"\[Rho]Inflection", "=", 
          RowBox[{"OptionValue", "[", "\"\<InflectionPoint\>\"", "]"}]}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"kMn", "=", 
        RowBox[{"OptionValue", "[", "\"\<MnOrder\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<GaussianWindowSigma\>\"", "]"}], 
         ",", "\"\<Automatic\>\"", ",", 
         RowBox[{
          RowBox[{"\[Sigma]s", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "4"}]}], ";"}], ",", "_",
          ",", 
         RowBox[{"\[Sigma]s", "=", 
          RowBox[{
          "OptionValue", "[", "\"\<GaussianWindowSigma\>\"", "]"}]}]}], "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], 
          "\[Equal]", "\"\<Matrix\>\""}], ",", 
         RowBox[{"matrixCoordinatesQ", "=", "True"}], ",", 
         RowBox[{"matrixCoordinatesQ", "=", "False"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"singleOrDouble", "=", 
        RowBox[{"OptionValue", "[", "\"\<SingleVsDoubleSided\>\"", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"(*", "**************************)"}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"**", "**", "**", "**", "**", "Construct"}], " ", "Stack"}], 
        "*)"}], 
       RowBox[{"cakeStack", "=", 
        RowBox[{"CakeWaveletStack", "[", 
         RowBox[{
         "size", ",", "s\[CurlyPhi]", ",", "kSpline", ",", "q", ",", 
          "periodicity", ",", "\[Rho]Inflection", ",", "kMn", ",", 
          "\[Sigma]s", ",", "matrixCoordinatesQ", ",", "singleOrDouble"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "cakeStack", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "**********************************)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "**", "**"}], "*", 
    "GaborWaveletStack"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "GaborWaveletStack", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<\[Epsilon]\>\"", "\[Rule]", "4"}], ",", 
     RowBox[{"\"\<KernelSize\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     RowBox[{"\"\<k0\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "3"}], "}"}]}], ",", 
     RowBox[{"\"\<Periodicity\>\"", "\[Rule]", "\[Pi]"}], ",", 
     RowBox[{"\"\<SingleVsDoubleSided\>\"", "\[Rule]", "\"\<Double\>\""}], 
     ",", 
     RowBox[{"\"\<CoordinateSystem\>\"", "\[Rule]", "\"\<Matrix\>\""}]}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GaborWaveletStack", "[", 
    RowBox[{"a_", ",", "s\[CurlyPhi]_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Epsilon]", ",", "A", ",", "k0", ",", "size", ",", "periodicity", ",",
        "stack", ",", "singleOrDouble", ",", "matrixCoordinatesQ"}], "}"}], 
     ",", 
     RowBox[{"(*", 
      RowBox[{"Parameters", ":"}], "*)"}], 
     RowBox[{
      RowBox[{"\[Epsilon]", "=", 
       RowBox[{"OptionValue", "[", "\"\<\[Epsilon]\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"A", "=", 
       RowBox[{"(", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\[Epsilon]", "^", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "1"}], "/", "2"}], ")"}]}], ",", "0"}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "}"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"k0", "=", 
       RowBox[{"OptionValue", "[", "\"\<k0\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Switch", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<KernelSize\>\"", "]"}], ",", 
        "\"\<Automatic\>\"", ",", 
        RowBox[{"size", "=", 
         RowBox[{"Floor", "[", 
          RowBox[{"8", "*", 
           RowBox[{"Sqrt", "[", "\[Epsilon]", "]"}], "*", "a"}], "]"}]}], ",",
         "_Integer", ",", 
        RowBox[{"size", "=", 
         RowBox[{"OptionValue", "[", "\"\<KernelSize\>\"", "]"}]}], ",", "_", 
        ",", 
        RowBox[{"size", "=", 
         RowBox[{"Floor", "[", 
          RowBox[{"8", "*", 
           RowBox[{"Sqrt", "[", "\[Epsilon]", "]"}], "*", "a"}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"EvenQ", "[", "size", "]"}], ",", 
        RowBox[{"size", "=", 
         RowBox[{"size", "+", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"periodicity", "=", 
       RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"singleOrDouble", "=", 
       RowBox[{"OptionValue", "[", "\"\<SingleVsDoubleSided\>\"", "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"matrixCoordinatesQ", "=", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], 
        "\[Equal]", "\"\<Matrix\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"The", " ", 
        RowBox[{"stack", ":"}]}], "*)"}], 
      RowBox[{"stack", "=", 
       RowBox[{"GenerateKernelSetGabor", "[", 
        RowBox[{"A", ",", "k0", ",", "a", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"\[Pi]", "/", "s\[CurlyPhi]"}], "]"}], ",", "size", ",", 
         "matrixCoordinatesQ"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"periodicity", "\[Equal]", 
         RowBox[{"2", " ", "\[Pi]"}]}], ",", 
        RowBox[{
         RowBox[{"stack", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"stack", ",", 
              RowBox[{"Conjugate", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Reverse", "[", 
                  RowBox[{"Reverse", "[", "#", "]"}], "]"}], "&"}], "/@", 
                "stack"}], "]"}]}], "}"}], ",", "1"}], "]"}]}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"singleOrDouble", "\[Equal]", "\"\<Single\>\""}], ",", 
        RowBox[{
         RowBox[{"stack", "=", 
          RowBox[{"stack", "*", 
           RowBox[{"ErfSet", "[", 
            RowBox[{"size", ",", 
             RowBox[{"periodicity", "/", "s\[CurlyPhi]"}]}], "]"}]}]}], 
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "stack", "]"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateKernelSetGabor", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"A", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k0", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n\[Theta]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"matQ", ",", 
          RowBox[{"True", "|", "False"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "d\[Theta]", "}"}], ",", 
        RowBox[{
         RowBox[{"d\[Theta]", "=", 
          RowBox[{
           RowBox[{"(", "\[Pi]", ")"}], "/", "n\[Theta]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"0.00000000001", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"4", " ", "a", " ", "\[Pi]"}], ")"}], "/", 
               RowBox[{"E", "^", 
                RowBox[{"(", 
                 RowBox[{"9", "/", "2"}], ")"}]}]}], ")"}]}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "/", "a"}], ")"}], "*", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"With", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"xx", "=", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"-", "\[Theta]"}], "+", 
                    RowBox[{"\[Pi]", "/", "2"}]}], "]"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"-", "\[Theta]"}], "+", 
                    RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}]}], "}"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "y"}], "}"}]}]}], ",", 
                   RowBox[{"yy", "=", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"-", "\[Theta]"}], "+", 
                    RowBox[{"\[Pi]", "/", "2"}]}], "]"}], ",", 
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"-", "\[Theta]"}], "+", 
                    RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], "}"}], ".", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "y"}], "}"}]}]}]}], "}"}], ",", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{"I", " ", 
                    RowBox[{"(", 
                    RowBox[{"k0", ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"yy", ",", "xx"}], "}"}], "/", "a"}], ")"}]}], 
                    ")"}]}], "]"}], 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"1", "/", "2"}], ")"}]}], " ", 
                    RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{"(", 
                    RowBox[{"A", ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"yy", ",", "xx"}], "}"}], "/", "a"}], ")"}]}], 
                    ")"}], "]"}], "^", "2"}]}], "]"}]}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", 
                 RowBox[{"-", 
                  RowBox[{"Floor", "[", 
                   RowBox[{"dim", "/", "2"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"Floor", "[", 
                   RowBox[{"dim", "/", "2"}], "]"}], "-", 
                  RowBox[{"(", 
                   RowBox[{"1", "-", 
                    RowBox[{"2", "*", 
                    RowBox[{"Mod", "[", 
                    RowBox[{
                    RowBox[{"dim", "/", "2"}], ",", "1"}], "]"}]}]}], 
                   ")"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"y", ",", 
                 RowBox[{"-", 
                  RowBox[{"Floor", "[", 
                   RowBox[{"dim", "/", "2"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"Floor", "[", 
                   RowBox[{"dim", "/", "2"}], "]"}], "-", 
                  RowBox[{"(", 
                   RowBox[{"1", "-", 
                    RowBox[{"2", "*", 
                    RowBox[{"Mod", "[", 
                    RowBox[{
                    RowBox[{"dim", "/", "2"}], ",", "1"}], "]"}]}]}], 
                   ")"}]}]}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Theta]", ",", 
               RowBox[{"If", "[", 
                RowBox[{"matQ", ",", "\[Pi]", ",", 
                 RowBox[{"\[Pi]", "+", 
                  RowBox[{"\[Pi]", "/", "2"}]}]}], "]"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{"matQ", ",", 
                 RowBox[{
                  RowBox[{"2", "*", "\[Pi]"}], "-", "d\[Theta]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"+", "\[Pi]"}], "/", "2"}], "+", "d\[Theta]"}]}], 
                "]"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{"matQ", ",", "d\[Theta]", ",", 
                 RowBox[{"-", "d\[Theta]"}]}], "]"}]}], "}"}]}], 
            "]"}]}]}]}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "**********************************)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "**"}], "*", 
    "WaveletTransform2D"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"WaveletTransform2D", "[", 
     RowBox[{"kernels_", ",", "im_", ",", 
      RowBox[{"fourierQ_", ":", "1"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "imF", ",", "kernelsF", ",", "os", ",", "dimkernelx1", ",", 
        "dimkernely1", ",", "dimkernelx2", ",", "dimkernely2"}], "}"}], ",", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Dimensions", "[", "kernels", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"-", "2"}], ";;", 
              RowBox[{"-", "1"}]}], "]"}], "]"}], "\[Equal]", 
           RowBox[{"Dimensions", "[", "im", "]"}]}], "&&", 
          RowBox[{"fourierQ", "\[Equal]", "1"}]}], ",", 
         RowBox[{"(*", 
          RowBox[{"Using", " ", "the", " ", "Fourier", " ", "transform"}], 
          "*)"}], 
         RowBox[{
          RowBox[{"imF", "=", 
           RowBox[{"Fourier", "[", "im", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"kernelsF", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Fourier", "[", 
              RowBox[{"Reverse", "[", 
               RowBox[{"#", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}], "&"}], "/@", 
            "kernels"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"os", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"RotateRight", "[", 
              RowBox[{
               RowBox[{"InverseFourier", "[", 
                RowBox[{"#", "*", "imF"}], "]"}], ",", 
               RowBox[{"Ceiling", "[", 
                RowBox[{"0.1", "+", 
                 RowBox[{
                  RowBox[{"Dimensions", "[", "im", "]"}], "/", "2"}]}], 
                "]"}]}], "]"}], "&"}], "/@", "kernelsF"}]}], ";"}], ",", 
         RowBox[{"(*", 
          RowBox[{"Using", " ", "Correlation"}], "*)"}], 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dimkernelx1", ",", "dimkernely1"}], "}"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Dimensions", "[", 
              RowBox[{"kernels", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], "//", 
            "Ceiling"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dimkernelx2", ",", "dimkernely2"}], "}"}], "=", 
           RowBox[{"Dimensions", "[", 
            RowBox[{"kernels", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"EvenQ", "[", "dimkernelx2", "]"}], ",", 
            RowBox[{"dimkernelx2", "=", 
             RowBox[{
              RowBox[{"dimkernelx2", "/", "2"}], "+", "1"}]}], ",", 
            RowBox[{"dimkernelx2", "=", 
             RowBox[{
              RowBox[{"dimkernelx2", "/", "2"}], "//", "Ceiling"}]}]}], "]"}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"EvenQ", "[", "dimkernely2", "]"}], ",", 
            RowBox[{"dimkernely2", "=", 
             RowBox[{
              RowBox[{"dimkernely2", "/", "2"}], "+", "1"}]}], ",", 
            RowBox[{"dimkernely2", "=", 
             RowBox[{
              RowBox[{"dimkernely2", "/", "2"}], "//", "Ceiling"}]}]}], "]"}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"os", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ListCorrelate", "[", 
              RowBox[{
               RowBox[{"kernels", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "im", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "dimkernelx1"}], ",", 
                   RowBox[{"-", "dimkernely1"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"dimkernelx2", ",", "dimkernely2"}], "}"}]}], 
                "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "kernels", "]"}], ",", "1"}], "}"}]}], 
            "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "os", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "**********************************)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "**", "**", "**", "**", "**", "**"}], "*", 
    "WaveletTransform2D"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "OrientationScoreTransform", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<WaveletSize\>\"", "\[Rule]", "151"}], ",", 
      RowBox[{"\"\<SplineOrder\>\"", "\[Rule]", "3"}], ",", 
      RowBox[{"\"\<AngularSubSampleRate\>\"", "\[Rule]", "1"}], ",", 
      RowBox[{"\"\<Periodicity\>\"", "\[Rule]", "\[Pi]"}], ",", 
      RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "\"\<Automatic\>\""}], 
      ",", 
      RowBox[{"\"\<MnOrder\>\"", "\[Rule]", "8"}], ",", 
      RowBox[{"\"\<GaussianWindowSigma\>\"", "\[Rule]", "\"\<Automatic\>\""}],
       ",", 
      RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "\"\<Automatic\>\""}], 
      ",", 
      RowBox[{"\"\<CoordinateSystem\>\"", "\[Rule]", "\"\<Matrix\>\""}], ",", 
      RowBox[{"\"\<SingleVsDoubleSided\>\"", "\[Rule]", "\"\<Double\>\""}], 
      ",", 
      RowBox[{"\"\<Method\>\"", "\[Rule]", "\"\<SpatialConvolution\>\""}]}], 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OrientationScoreTransform", "::", "dim"}], "=", 
   "\"\<Warning! Method \\\"Fourier\\\" can not be used if the image \
dimensions are not equal. Convolution based method with kernel size `1`x`1` \
used instead.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrientationScoreTransform", "::", "size"}], "=", 
    "\"\<Warning! Wavelet size can not be specified with method \\\"Fourier\\\
\", size is set equal to the image size.\>\""}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrientationScoreTransform", "[", 
     RowBox[{"im_", ",", "s\[CurlyPhi]_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "dimx", ",", "dimy", ",", "size", ",", "kSpline", ",", "q", ",", 
        "periodicity", ",", "\[Rho]Inflection", ",", "kMn", ",", "\[Sigma]s", 
        ",", "matrixCoordinatesQ", ",", "cakeStack", ",", "os", ",", 
        "singleOrDouble"}], "}"}], ",", 
      RowBox[{"(*", "***************************)"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"**", "**", "**", "**", "**", "Check"}], " ", "Parameters"}], 
       "*)"}], 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"dimx", ",", "dimy"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "im", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}], "\[Equal]", 
          "\"\<Fourier\>\""}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"dimx", "\[NotEqual]", "dimy"}], ",", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{
              RowBox[{"OrientationScoreTransform", "::", "dim"}], ",", 
              RowBox[{"OptionValue", "[", "\"\<WaveletSize\>\"", "]"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"size", "=", 
             RowBox[{"OptionValue", "[", "\"\<WaveletSize\>\"", "]"}]}], 
            ";"}], ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"OptionValue", "[", "\"\<WaveletSize\>\"", "]"}], 
               "\[NotEqual]", 
               RowBox[{
                RowBox[{"Options", "[", 
                 RowBox[{
                 "OrientationScoreTransform", ",", "\"\<WaveletSize\>\""}], 
                 "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{"OrientationScoreTransform", "::", "size"}], "]"}], 
               ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"size", "=", "dimx"}], ";"}]}], "]"}], ",", 
         RowBox[{"size", "=", 
          RowBox[{"OptionValue", "[", "\"\<WaveletSize\>\"", "]"}]}]}], "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"kSpline", "=", 
        RowBox[{"OptionValue", "[", "\"\<SplineOrder\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"q", "=", 
        RowBox[{"OptionValue", "[", "\"\<AngularSubSampleRate\>\"", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"periodicity", "=", 
        RowBox[{"OptionValue", "[", "\"\<Periodicity\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<InflectionPoint\>\"", "]"}], ",", 
         "\"\<Automatic\>\"", ",", 
         RowBox[{
          RowBox[{"\[Rho]Inflection", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"size", "-", "1"}], ")"}], "/", "2"}], " ", "0.8"}]}], 
          ";"}], ",", "_", ",", 
         RowBox[{"\[Rho]Inflection", "=", 
          RowBox[{"OptionValue", "[", "\"\<InflectionPoint\>\"", "]"}]}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"kMn", "=", 
        RowBox[{"OptionValue", "[", "\"\<MnOrder\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<GaussianWindowSigma\>\"", "]"}], 
         ",", "\"\<Automatic\>\"", ",", 
         RowBox[{
          RowBox[{"\[Sigma]s", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"size", "-", "1"}], ")"}], "/", "4"}]}], ";"}], ",", "_",
          ",", 
         RowBox[{"\[Sigma]s", "=", 
          RowBox[{
          "OptionValue", "[", "\"\<GaussianWindowSigma\>\"", "]"}]}]}], "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<CoordinateSystem\>\"", "]"}], 
          "\[Equal]", "\"\<Matrix\>\""}], ",", 
         RowBox[{"matrixCoordinatesQ", "=", "True"}], ",", 
         RowBox[{"matrixCoordinatesQ", "=", "False"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"singleOrDouble", "=", 
        RowBox[{"OptionValue", "[", "\"\<SingleVsDoubleSided\>\"", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"(*", "**************************)"}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"**", "**", "**", "**", "**", "Construct"}], " ", "Stack"}], 
        "*)"}], 
       RowBox[{"cakeStack", "=", 
        RowBox[{"CakeWaveletStack", "[", 
         RowBox[{
         "size", ",", "s\[CurlyPhi]", ",", "kSpline", ",", "q", ",", 
          "periodicity", ",", "\[Rho]Inflection", ",", "kMn", ",", 
          "\[Sigma]s", ",", "matrixCoordinatesQ", ",", "singleOrDouble"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"os", "=", 
        RowBox[{"WaveletTransform2D", "[", 
         RowBox[{"cakeStack", ",", "im", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}], "\[Equal]", 
             "\"\<Fourier\>\""}], ",", "1", ",", "0"}], "]"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "os", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6283308413389482`*^9, 3.6283308429780636`*^9}, {
   3.6361849439838905`*^9, 3.636184981626449*^9}, {3.6361977951105614`*^9, 
   3.636197800991724*^9}, 3.638091605120901*^9, {3.6380939495648823`*^9, 
   3.638093969863186*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"33e1e9a2-1e33-4ff0-a33a-844e71e457f6"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["ITKFM method", "Subsection",
 CellChangeTimes->{{3.635480695512498*^9, 
  3.63548069834063*^9}},ExpressionUUID->"d68546fc-53c0-40d5-ad9b-\
b9361948d8c1"],

Cell[BoxData[
 RowBox[{"<<", "NIfTIParser`"}]], "Input",
 CellLabel->"In[56]:=",ExpressionUUID->"ea4ca654-f4d8-4f0e-bc33-0dd5413e935f"],

Cell[CellGroupData[{

Cell["Construct metric", "Subsubsection",
 CellChangeTimes->{{3.6354807081387396`*^9, 
  3.6354807102168727`*^9}},ExpressionUUID->"165a3bf5-0b48-4227-84af-\
b18187f0a5ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SE2ConstructMetric", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"No", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nx", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Ny", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"s\[Theta]", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Mu]", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Epsilon]", ",", "_Real"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Transpose", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Theta]", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], "*", "s\[Theta]"}]}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  SuperscriptBox["\[Mu]", "2"], " ", 
                  SuperscriptBox[
                   RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}], "+", 
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", "2"], " ", 
                  SuperscriptBox["\[Mu]", "2"], " ", 
                  SuperscriptBox[
                   RowBox[{"Sin", "[", "\[Theta]", "]"}], "2"]}]}], ",", 
                RowBox[{
                 RowBox[{
                  SuperscriptBox["\[Mu]", "2"], " ", 
                  RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
                  RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
                 RowBox[{"1.`", " ", 
                  SuperscriptBox["\[Epsilon]", "2"], " ", 
                  SuperscriptBox["\[Mu]", "2"], " ", 
                  RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
                  RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", "2"], " ", 
                  SuperscriptBox["\[Mu]", "2"], " ", 
                  SuperscriptBox[
                   RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}], "+", 
                 RowBox[{
                  SuperscriptBox["\[Mu]", "2"], " ", 
                  SuperscriptBox[
                   RowBox[{"Sin", "[", "\[Theta]", "]"}], "2"]}]}], ",", 
                "0.`", ",", "0.`", ",", 
                RowBox[{"1.`", " ", 
                 SuperscriptBox["s\[Theta]", "2"]}]}], "}"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "No", ",", "1"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "2", ",", "4", ",", "5"}], "}"}]}], 
      "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6354768751217904`*^9, 3.635477128406194*^9}, {
  3.6354772600531826`*^9, 3.6354772941519885`*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"f13044c5-f86f-44c6-a07b-c31710c9803c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fast marching", "Subsubsection",
 CellChangeTimes->{{3.6354807176856422`*^9, 
  3.6354807210762715`*^9}},ExpressionUUID->"034a39d2-c339-41a0-8076-\
b2e3c7856a45"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SRWaveFrontPropagationITKFM", "[", 
    RowBox[{
    "cost_", ",", "g0dIn_", ",", "g1dIn_", ",", "\[Mu]_", ",", "\[Epsilon]_", 
     ",", "sTheta_", ",", "sx_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "No", ",", "Nx", ",", "Ny", ",", "\[IndentingNewLine]", "metric", ",", 
       "\[IndentingNewLine]", "g0d", ",", "g1d", ",", "exportList", ",", 
       "\[IndentingNewLine]", "header", ",", "\[IndentingNewLine]", "hed", 
       ",", "W", ",", "itkfmPath", ",", "\[IndentingNewLine]", 
       "geodesicPath"}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"No", ",", "Nx", ",", "Ny"}], "}"}], "=", 
       RowBox[{"Dimensions", "[", "cost", "]"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"**", "**", "**", "**", "**", "**", "**", "Construct"}], " ", 
        "metric"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"metric", "=", 
       RowBox[{"SE2ConstructMetric", "[", 
        RowBox[{
        "No", ",", "Nx", ",", "Ny", ",", "sTheta", ",", "\[Mu]", ",", 
         "\[Epsilon]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"metric", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{
          SuperscriptBox["cost", "2"], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], "*", 
        "metric"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Pad", " ", "metric", " ", 
        RowBox[{"(", 
         RowBox[{
         "cyclic", " ", "boundary", " ", "conditions", " ", "theta", " ", 
          "direction"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"metric", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", "#", ",", "#"}], "}"}], ",", "1"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2", ",", "4", ",", "5"}], "}"}]}], 
          "]"}], "&"}], "@", 
        RowBox[{"Transpose", "[", 
         RowBox[{"metric", ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3", ",", "1", ",", "4", ",", "5"}], "}"}]}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"**", "**", "**", "**", "**", "**", "**", "Input"}], " ", 
         "check"}], " ", "-", " ", 
        RowBox[{"Source", " ", "and", " ", "sink", " ", "point"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Source", " ", "point", 
        RowBox[{"(", "s", ")"}], " ", "check", " ", 
        RowBox[{"(", 
         RowBox[{
         "always", " ", "work", " ", "with", " ", "a", " ", "list", " ", "of",
           " ", "seed", " ", "points"}], ")"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"(*", 
        RowBox[{
        "If", " ", "only", " ", "one", " ", "seed", " ", "point", " ", "is", 
         " ", "provided"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Dimensions", "[", "g0dIn", "]"}], "\[Equal]", 
         RowBox[{"{", "3", "}"}]}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"g0d", "=", 
         RowBox[{"{", "g0dIn", "}"}]}], "\[IndentingNewLine]", ",", 
        RowBox[{"(*", 
         RowBox[{"if", " ", "a", " ", "list", " ", "is", " ", 
          RowBox[{"provided", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"g0d", "=", "g0dIn"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Sink", " ", "point", 
        RowBox[{"(", "s", ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"(*", 
        RowBox[{
        "If", " ", "sink", " ", "point", " ", "is", " ", "not", " ", 
         "specified", " ", 
         RowBox[{"(", "0", ")"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "g1dIn", "]"}], "]"}], "\[Equal]", 
         RowBox[{"ToString", "[", "0.", "]"}]}], "\[IndentingNewLine]", ",", 
        RowBox[{"(*", 
         RowBox[{
         "Then", " ", "place", " ", "sink", " ", "at", " ", "the", " ", 
          "corner", " ", "of", " ", "the", " ", "image"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"g1d", "=", 
         RowBox[{"Dimensions", "[", "cost", "]"}]}], "\[IndentingNewLine]", 
        ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Check", " ", "for", " ", "list", " ", "of", " ", "seed", " ", 
          "points"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{"(*", 
           RowBox[{
           "If", " ", "only", " ", "one", " ", "sink", " ", "point", " ", 
            "is", " ", "specified"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Dimensions", "[", "g1dIn", "]"}], "\[Equal]", 
            RowBox[{"{", "3", "}"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"(*", 
            RowBox[{
            "Then", " ", "make", " ", "a", " ", "list", " ", "of", " ", 
             "sink", " ", "points", " ", "out", " ", "of", " ", "it"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"g1d", "=", 
            RowBox[{"{", "g1dIn", "}"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"(*", 
            RowBox[{
            "Otherwise", " ", "copy", " ", "the", " ", "list", " ", "of", " ",
              "sink", " ", "points"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"g1d", "=", "g1dIn"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"g0d", "=", 
         RowBox[{"Union", "[", "g0d", "]"}]}], ";"}], 
       RowBox[{"(*", 
        RowBox[{"Remove", " ", "duplicates"}], "*)"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"g1d", "=", 
         RowBox[{"Union", "[", "g1d", "]"}]}], ";"}], 
       RowBox[{"(*", 
        RowBox[{"Remove", " ", "duplicates"}], "*)"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"**", "**", "**", "**", "**", "**", "**", "Export"}], " ", 
        "seed", " ", "point"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"(*", 
        RowBox[{
        "only", " ", "1", " ", "sink", " ", "point", " ", "is", " ", 
         "provided"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "g1d", "]"}], "==", "1"}], ",", 
        RowBox[{"(*", 
         RowBox[{
         "Then", " ", "only", " ", "one", " ", "end", " ", "point", " ", "is",
           " ", "provided"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"exportList", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"g0d", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{"g0d", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{
               RowBox[{"g0d", "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
               "No"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"g1d", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{"g1d", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{
               RowBox[{"g1d", "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
               "No"}]}], "}"}]}], "}"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "Prepend", " ", "the", " ", "first", " ", "seed", " ", "point"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Export", "[", 
          RowBox[{"\"\<_tmp_sourcesink.txt\>\"", ",", 
           RowBox[{"exportList", "-", "1"}], ",", "\"\<Table\>\"", ",", 
           RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\< \>\""}]}], 
          "]"}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"exportList", "=", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"g0d", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"g0d", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{"g0d", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
              "No"}]}], "}"}], "}"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "Prepend", " ", "the", " ", "first", " ", "seed", " ", "point"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"exportList", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"g1d", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"g1d", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{
                RowBox[{"g1d", "\[LeftDoubleBracket]", 
                 RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
                "No"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "g1d", "]"}], ",", "1"}], "}"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Export", "[", 
          RowBox[{"\"\<_tmp_sourcesink.txt\>\"", ",", 
           RowBox[{"exportList", "-", "1"}], ",", "\"\<Table\>\"", ",", 
           RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\< \>\""}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"(*", 
        RowBox[{
        "More", " ", "then", " ", "one", " ", "source", " ", "point", " ", 
         "is", " ", "provided"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "g0d", "]"}], "\[NotEqual]", "1"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"(*", 
         RowBox[{
         "Than", " ", "Export", " ", "additional", " ", "seed", " ", "point", 
          " ", "file"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"exportList", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"g0d", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{"g0d", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{
               RowBox[{"g0d", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
               "No"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "g0d", "]"}], ",", "1"}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Export", "[", 
          RowBox[{"\"\<_tmp_extraseeds.txt\>\"", ",", 
           RowBox[{"exportList", "-", "1"}], ",", "\"\<Table\>\"", ",", 
           RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\< \>\""}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"**", "**", "**", "**", "**", "**", "**", "Export"}], " ", 
        "volume"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"header", "=", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
         "348", ",", "\"\<\>\"", ",", "\"\<\>\"", ",", "0", ",", "0", ",", 
          "\"\<r\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
           "5", ",", "11", ",", "11", ",", "11", ",", "1", ",", "6", ",", "0",
             ",", "0"}], "}"}], ",", "0.", ",", "0.", ",", "0.", ",", "1005", 
          ",", "16", ",", "32", ",", "0", ",", 
          RowBox[{"{", 
           RowBox[{
           "0.", ",", "1.", ",", "1.", ",", "1.", ",", "1.", ",", "1.", ",", 
            "0.", ",", "0."}], "}"}], ",", "352.", ",", "0.", ",", "0.", ",", 
          "0", ",", "0", ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "8"}], "}"}], ",", "0.", ",", "0.", ",", "0.", 
          ",", "0.", ",", "0", ",", "0", ",", "\"\<\>\"", ",", "\"\<\>\"", 
          ",", "0", ",", "0", ",", "0.", ",", "0.", ",", "0.", ",", "0.", ",",
           "0.", ",", "0.", ",", 
          RowBox[{"{", 
           RowBox[{"1.", ",", "0.", ",", "0.", ",", "0."}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "1.", ",", "0.", ",", "0."}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "0.", ",", "1.", ",", "0."}], "}"}], ",", 
          "\"\<\>\"", ",", "\"\<n+1\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], "}"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"header", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "8", ",", 
         RowBox[{"2", ";;", "6"}]}], "\[RightDoubleBracket]"}], "=", 
       RowBox[{"(", 
        RowBox[{"metric", "//", "Dimensions"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"header", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "16", ",", "2"}], "\[RightDoubleBracket]"}], "=", 
       "1."}], ";", 
      RowBox[{"(*", 
       RowBox[{"scaling", " ", "x", " ", "dimension"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"header", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "16", ",", "3"}], "\[RightDoubleBracket]"}], "=", 
       "1."}], ";", 
      RowBox[{"(*", 
       RowBox[{"scaling", " ", "y", " ", "dimension"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"header", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "16", ",", "4"}], "\[RightDoubleBracket]"}], "=", 
       "1."}], ";", 
      RowBox[{"(*", 
       RowBox[{"scaling", " ", "theta", " ", "dimension"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Export", " ", "volume"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ExportNIfTI", "[", 
       RowBox[{"\"\<_tmp_metric.nii\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"header", ",", "metric"}], "}"}], ",", 
        RowBox[{"AutoOverwrite", "\[Rule]", "True"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"**", "**", "**", "**", "**", "**"}], "*", "Solve", " ", 
         "Eikonal", " ", "equation"}], ",", " ", 
        RowBox[{"by", " ", "running", " ", 
         RowBox[{"ITKFM", ".", "exe"}], " ", "from", " ", "command", " ", 
         "propmpt", " ", 
         RowBox[{"(", "$SystemSHell", ")"}]}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"itkfmPath", "=", 
         RowBox[{"\"\<\\\"\>\"", "<>", 
          RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
          "\"\<ITKFM_win64\\\\ITKFM\\\"\>\""}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"itkfmPath", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"NotebookDirectory", "[", "]"}], ",", 
          RowBox[{"\"\<ITKFM_\>\"", "<>", "$SystemID"}], ",", 
          "\"\<ITKFM\>\""}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"(*", 
        RowBox[{
        "Only", " ", "one", " ", "seed", " ", "point", " ", "is", " ", 
         "provided"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "g0d", "]"}], "\[Equal]", "1"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"(*", "Then", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"itkfmlog", "=", 
          RowBox[{"RunProcess", "[", 
           RowBox[{"$SystemShell", ",", "All", ",", 
            RowBox[{
            "itkfmPath", "<>", 
             "\"\< _tmp_metric.nii _tmp_sourcesink.txt _tmp_path.txt \
_tmp_W.nii\nexit\n\>\""}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"(*", "Otherwise", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"itkfmlog", "=", 
          RowBox[{"RunProcess", "[", 
           RowBox[{"$SystemShell", ",", "All", ",", 
            RowBox[{
            "itkfmPath", "<>", 
             "\"\< _tmp_metric.nii _tmp_sourcesink.txt _tmp_path.txt \
_tmp_W.nii _tmp_extraseeds.txt\nexit\n\>\""}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"**", "**", "**", "**", "**", "**", "Read"}], " ", "in", " ", 
        "results"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"hed", ",", "W"}], "}"}], "=", 
       RowBox[{"ImportNIfTI", "[", "\"\<_tmp_W.nii\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"W", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Min", "[", 
           RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"W", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "All", ",", 
             RowBox[{"1", ";;", "No"}]}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{"W", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "All", ",", 
             RowBox[{
              RowBox[{"No", "+", "1"}], ";;", 
              RowBox[{"2", "*", "No"}]}]}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{"W", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "All", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"2", "*", "No"}], "+", "1"}], ";;", 
              RowBox[{"3", "*", "No"}]}]}], "\[RightDoubleBracket]"}]}], 
          "}"}], ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"W", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"W", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "g1d", "]"}], "==", "1"}], ",", 
        RowBox[{"(*", 
         RowBox[{
         "Then", " ", "only", " ", "one", " ", "end", " ", "point", " ", "is",
           " ", "provided"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"geodesicPath", "=", 
          RowBox[{
           RowBox[{"Import", "[", 
            RowBox[{"\"\<_tmp_path.txt\>\"", ",", "\"\<Data\>\""}], "]"}], 
           "+", "1"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"geodesicPath", "=", 
          RowBox[{"{", 
           RowBox[{"Reverse", "@", 
            RowBox[{"geodesicPath", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", 
              RowBox[{"{", 
               RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], 
             "\[RightDoubleBracket]"}]}], "}"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"geodesicPath", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"geodesicPath", "=", 
              RowBox[{
               RowBox[{"Import", "[", 
                RowBox[{
                 RowBox[{"\"\<_tmp_path_\>\"", "<>", 
                  RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<.txt\>\""}],
                  ",", "\"\<Data\>\""}], "]"}], "+", "1"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"DeleteFile", "[", 
              RowBox[{"\"\<_tmp_path_\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<.txt\>\""}], 
              "]"}], ";", 
             RowBox[{"(*", 
              RowBox[{
              "Delete", " ", "file", " ", "after", " ", "reading", " ", "in", 
               " ", "the", " ", "data"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Reverse", "@", 
              RowBox[{"geodesicPath", "\[LeftDoubleBracket]", 
               RowBox[{"All", ",", 
                RowBox[{"{", 
                 RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], 
               "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "g1d", "]"}], ",", "1"}], "}"}]}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"geodesicPath", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], "=", 
       RowBox[{
        RowBox[{"geodesicPath", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
        "-", "No"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"**", "**", "**", "**", "**"}], "*", "Clean", " ", "working", 
        " ", "directory"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"DeleteFile", "[", "\"\<_tmp_sourcesink.txt\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"DeleteFile", "[", "\"\<_tmp_metric.nii\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"DeleteFile", "[", "\"\<_tmp_path.txt\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Quiet", "[", 
       RowBox[{
        RowBox[{"DeleteFile", "[", 
         RowBox[{"\"\<_tmp_path_\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{
            RowBox[{"Length", "[", "g1d", "]"}], "+", "1"}], "]"}], "<>", 
          "\"\<.txt\>\""}], "]"}], ";"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"DeleteFile", "[", "\"\<_tmp_W.nii\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "g0d", "]"}], "\[NotEqual]", "1"}], ",", 
        RowBox[{"DeleteFile", "[", "\"\<_tmp_extraseeds.txt\>\"", "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Return", " ", "output"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"W", ",", "geodesicPath"}], "}"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6254015859757676`*^9, 3.625401662913123*^9}, {
   3.6254018550849447`*^9, 3.625401946554697*^9}, 3.6254021343813033`*^9, {
   3.6254021695086603`*^9, 3.625402240342103*^9}, {3.6254022716096535`*^9, 
   3.625402284188553*^9}, {3.625402326863082*^9, 3.625402382976281*^9}, {
   3.625402437042107*^9, 3.6254025393609114`*^9}, {3.6254032300788364`*^9, 
   3.6254033179446597`*^9}, {3.6254033872145505`*^9, 
   3.6254035714765854`*^9}, {3.62540367355636*^9, 3.6254037326537743`*^9}, {
   3.6254037674840174`*^9, 3.6254038270040236`*^9}, {3.6254038687826395`*^9, 
   3.6254038897995586`*^9}, {3.6254625605087595`*^9, 3.625462587604228*^9}, 
   3.625463212496772*^9, {3.6254693077527337`*^9, 3.625469334488636*^9}, {
   3.625469443166931*^9, 3.625469480012498*^9}, {3.6254695844248714`*^9, 
   3.625469592878422*^9}, {3.6254785074863405`*^9, 3.625478510642744*^9}, {
   3.6254787301245747`*^9, 3.625478731859036*^9}, {3.62548986174436*^9, 
   3.625489886573708*^9}, {3.625490014350504*^9, 3.6254900313042974`*^9}, {
   3.625490197417068*^9, 3.62549019766706*^9}, {3.6255478765881777`*^9, 
   3.625547882000074*^9}, {3.625553324608653*^9, 3.625553344169656*^9}, {
   3.625553497461797*^9, 3.625553577861079*^9}, {3.6255536089317884`*^9, 
   3.6255536487712154`*^9}, {3.6255536812037735`*^9, 3.625553684379964*^9}, {
   3.6255537354673843`*^9, 3.6255537754699745`*^9}, {3.6255538461219378`*^9, 
   3.6255538795091305`*^9}, {3.6255539182593827`*^9, 3.625553920854107*^9}, {
   3.625555249549548*^9, 3.625555262550149*^9}, {3.6255553109273057`*^9, 
   3.6255553260473557`*^9}, 3.625555452373971*^9, {3.6255557929487934`*^9, 
   3.6255558110668354`*^9}, {3.6255571620932064`*^9, 3.6255571728623676`*^9}, 
   3.6255640866656013`*^9, {3.625567061138159*^9, 3.625567093960616*^9}, {
   3.625567200140194*^9, 3.625567206866665*^9}, {3.6270170033778734`*^9, 
   3.6270170129248734`*^9}, {3.628321740503623*^9, 3.6283217868798695`*^9}, {
   3.634569080208783*^9, 3.6345691588752375`*^9}, {3.6351372664051156`*^9, 
   3.6351373377400165`*^9}, {3.6351427772460785`*^9, 
   3.6351427874277477`*^9}, {3.6351428811569004`*^9, 3.635142939356787*^9}, {
   3.635143018084956*^9, 3.635143107025955*^9}, {3.635143163589668*^9, 
   3.635143175060424*^9}, {3.6351432404812365`*^9, 3.635143241126277*^9}, {
   3.6351433601580963`*^9, 3.6351433861998034`*^9}, {3.635143442022165*^9, 
   3.63514347940162*^9}, {3.635143561327998*^9, 3.635143563930168*^9}, {
   3.635143610682164*^9, 3.6351436135303526`*^9}, {3.6351436649177256`*^9, 
   3.6351437138189325`*^9}, {3.635143770113636*^9, 3.6351437785016356`*^9}, {
   3.635143860059982*^9, 3.635143863343196*^9}, {3.6351439377090807`*^9, 
   3.6351439413883247`*^9}, {3.635143981917761*^9, 3.6351439900422792`*^9}, {
   3.63514420652503*^9, 3.635144208730177*^9}, {3.6351442666999817`*^9, 
   3.6351443666942225`*^9}, {3.6351444227949066`*^9, 3.635144432931572*^9}, {
   3.635144581562451*^9, 3.6351445850797267`*^9}, {3.635240178041892*^9, 
   3.635240181691904*^9}, {3.6352402322983522`*^9, 3.635240233579607*^9}, {
   3.6352402675329237`*^9, 3.635240298455984*^9}, {3.6352403340029926`*^9, 
   3.635240369128133*^9}, {3.635240403440774*^9, 3.6352404138783035`*^9}, {
   3.635240460441811*^9, 3.6352404774976263`*^9}, {3.6352409317146196`*^9, 
   3.6352410622632256`*^9}, {3.6352411197478704`*^9, 3.635241128779174*^9}, {
   3.635241254858575*^9, 3.635241304186882*^9}, {3.635241345608907*^9, 
   3.6352413495933743`*^9}, {3.6352414575946007`*^9, 3.6352414985478935`*^9}, 
   3.635241534704281*^9, 3.635241707493802*^9, {3.635241911319708*^9, 
   3.6352419216635084`*^9}, {3.635242553321824*^9, 3.6352426193690186`*^9}, {
   3.635248255350795*^9, 3.635248258803955*^9}, {3.635476752906899*^9, 
   3.635476826097633*^9}, {3.635477312524107*^9, 3.635477402990573*^9}, {
   3.6354774935533233`*^9, 3.63547785181271*^9}, {3.6354779023930435`*^9, 
   3.6354779898812795`*^9}, {3.635478027596754*^9, 3.6354780583179646`*^9}, {
   3.6354781004291754`*^9, 3.6354782793146505`*^9}, {3.635478342724944*^9, 
   3.635478415442563*^9}, {3.635478653313657*^9, 3.6354786656115875`*^9}, {
   3.635478708404621*^9, 3.635478709435783*^9}, {3.635478861978058*^9, 
   3.6354788646186943`*^9}, {3.6354789320602856`*^9, 
   3.6354789333102884`*^9}, {3.6354789673268833`*^9, 3.635478984968216*^9}, {
   3.635479173798135*^9, 3.635479248168956*^9}, {3.635479644819728*^9, 
   3.6354796631891813`*^9}, {3.6354797048572598`*^9, 3.635479706154137*^9}, {
   3.6354802774519825`*^9, 3.6354802775301127`*^9}, {3.6354804439623213`*^9, 
   3.6354804479935827`*^9}, {3.6356717331680136`*^9, 3.63567174277184*^9}, {
   3.635672756167233*^9, 3.6356727900625954`*^9}, {3.635672853423746*^9, 
   3.635672883168704*^9}, 3.635673030584532*^9, {3.635673067455221*^9, 
   3.635673068412274*^9}, {3.6356732523018217`*^9, 3.6356732601822824`*^9}, {
   3.635673296510676*^9, 3.635673304267996*^9}, {3.6356733443004203`*^9, 
   3.63567334877289*^9}, {3.6356735801074038`*^9, 3.6356736619403257`*^9}, {
   3.6356737767787905`*^9, 3.6356737768428345`*^9}, {3.6361815699958477`*^9, 
   3.636181570775833*^9}, {3.636181713108988*^9, 3.6361817137797832`*^9}, {
   3.636181994625411*^9, 3.636182047150611*^9}, {3.636182080612611*^9, 
   3.636182099457411*^9}, {3.6361821408442106`*^9, 3.6361821500950108`*^9}, {
   3.6361832693820515`*^9, 3.6361833000810804`*^9}, 3.6361833765020885`*^9, {
   3.636363688877215*^9, 3.636363698877189*^9}, {3.6363717679752483`*^9, 
   3.6363717712565746`*^9}, {3.6364360798834157`*^9, 
   3.6364362733973846`*^9}, {3.6364366369499063`*^9, 3.636436713301941*^9}, {
   3.636436766548253*^9, 3.636436786860526*^9}, 3.6364368771623163`*^9, {
   3.6364371470540743`*^9, 3.6364371471080875`*^9}, {3.637057474714529*^9, 
   3.6370577616473813`*^9}, {3.6370578051651473`*^9, 
   3.6370578557959023`*^9}, {3.637057888113798*^9, 3.637058306076048*^9}, {
   3.6370589393802633`*^9, 3.6370589471607213`*^9}, {3.6370590046990757`*^9, 
   3.6370590109434385`*^9}, {3.6370590723156433`*^9, 3.6370590752558146`*^9}, 
   3.637059288333676*^9, 3.637059602802436*^9, {3.6370597037673264`*^9, 
   3.637059705183391*^9}, {3.637059748933959*^9, 3.6370597504310455`*^9}, {
   3.637059783503975*^9, 3.6370597852560797`*^9}, {3.6370603193835464`*^9, 
   3.637060326357951*^9}, {3.6370604689982543`*^9, 3.637060477513566*^9}, {
   3.637061219992486*^9, 3.637061223693689*^9}, {3.6370615208952494`*^9, 
   3.637061521069267*^9}, {3.6370616511490955`*^9, 3.6370616513020887`*^9}, {
   3.6370619296119404`*^9, 3.637061929789977*^9}, {3.637062113221298*^9, 
   3.637062113577323*^9}, {3.637062303711963*^9, 3.637062307908209*^9}, {
   3.637062572203862*^9, 3.637062578359236*^9}, 3.637062666704213*^9, {
   3.637062735654233*^9, 3.637062737681351*^9}, {3.637062784925108*^9, 
   3.6370627872822447`*^9}, {3.637062882470414*^9, 3.637062936730579*^9}, {
   3.6370629727286777`*^9, 3.63706298885662*^9}, {3.637063022128745*^9, 
   3.6370630276380653`*^9}, {3.637063105298597*^9, 3.637063120606488*^9}, {
   3.637064103051389*^9, 3.63706410581955*^9}, 3.637064804100154*^9, {
   3.637064964206467*^9, 3.637064964372475*^9}, 3.637065103682083*^9, {
   3.637065653355357*^9, 3.6370656566995525`*^9}, {3.6370657324930487`*^9, 
   3.637065734974185*^9}, {3.6370663754894867`*^9, 3.6370663788856773`*^9}, {
   3.637066446158819*^9, 3.637066449319004*^9}, {3.637066699821535*^9, 
   3.6370667038317657`*^9}, {3.637066853668561*^9, 3.6370668599199266`*^9}, {
   3.637066914175089*^9, 3.6370669253837433`*^9}, {3.637067001170947*^9, 
   3.637067008090353*^9}, {3.637476487887816*^9, 3.6374764900879664`*^9}, {
   3.637988735697832*^9, 3.637988743557478*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"9d68d873-e397-4e95-ad20-4c2ce10e1ebf"]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Data-Driven Frame (Gauge Frame)", "Section",
 CellChangeTimes->{{3.8713713002995553`*^9, 3.871371302308343*^9}, {
  3.871374519757787*^9, 
  3.871374527908655*^9}},ExpressionUUID->"877accb1-4f24-495b-b19f-\
d125fb0df411"],

Cell["Gauge frames are expressed w.r.t. the left invariant frame.", "Text",
 CellChangeTimes->{{3.8047663179941163`*^9, 
  3.8047664022344513`*^9}},ExpressionUUID->"593057d7-c88b-4ce0-97f8-\
c231bc1957be"],

Cell[CellGroupData[{

Cell["Lie Analysis Package", "Subsection",
 CellChangeTimes->{{3.7955929798303227`*^9, 3.795592983779815*^9}, {
  3.8242161879060216`*^9, 
  3.8242161896394587`*^9}},ExpressionUUID->"13e946b3-0a93-4e3a-b591-\
0bac9aff4459"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$HistoryLength", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", " ", "LieAnalysis`"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7528222349194837`*^9, 3.7528222379231224`*^9}, {
  3.7528281542879972`*^9, 3.752828156156088*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"3dc7f536-aa46-4f5d-bc0d-19d4e0f62854"],

Cell[CellGroupData[{

Cell["General subroutines", "Subsubsection",
 CellChangeTimes->{{3.7981975496898785`*^9, 
  3.798197552641507*^9}},ExpressionUUID->"bdef1218-72ba-4ae0-b601-\
6f4497dda134"],

Cell["\<\
Transform Hessian matrix from left invariant frame to a gauge frame.\
\>", "Text",
 CellChangeTimes->{{3.804766264675982*^9, 
  3.8047663100809283`*^9}},ExpressionUUID->"72632742-c319-4b5a-b264-\
76345a5a714a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HessianToGaugeFrame", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tensor", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"gaugeFrame", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"gaugeFrame", "\[Transpose]"}], ".", "tensor", ".", 
      "gaugeFrame"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.797747996341299*^9, 3.7977479988778353`*^9}, {
  3.81036134950132*^9, 3.810361350810033*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"63262d70-c79c-437b-b659-a0a543640956"]
}, Closed]],

Cell[CellGroupData[{

Cell["Gauge Frame", "Subsubsection",
 CellChangeTimes->{{3.7981975584821453`*^9, 3.798197560986161*^9}, {
  3.815297353754456*^9, 
  3.815297355927987*^9}},ExpressionUUID->"8f9a189c-f498-498e-9688-\
9fe2dd5ba539"],

Cell["\<\
Returns a matrix field gf that contains the coefficients of the gauge frame \
s.t. \
\>", "Text",
 CellChangeTimes->{{3.8047664659601326`*^9, 3.804766501943779*^9}, {
  3.8047665655836535`*^9, 
  3.804766611596015*^9}},ExpressionUUID->"46ee4a71-018b-43cb-864d-\
3a1c53badeec"],

Cell[TextData[Cell[BoxData[
 FormBox[GridBox[{
    {
     RowBox[{GridBox[{
        {
         RowBox[{
          SubscriptBox["\[ScriptCapitalB]", "i"], "=", 
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"j", "=", "1"}], "3"], 
           RowBox[{
            RowBox[{"gf", "\[LeftDoubleBracket]", 
             RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], 
            SubscriptBox["\[ScriptCapitalA]", "j"]}]}]}]}
       },
       GridBoxAlignment->{"Columns" -> {{"Center"}}}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"j", "=", 
        RowBox[{"1", "  ", "spatial"}]}], ",", " ", 
       RowBox[{"j", "=", 
        RowBox[{"2", " ", "orthogonal", " ", "spatial"}]}], ",", " ", 
       RowBox[{"j", "=", 
        RowBox[{"3", " ", "angular"}]}]}], "\[IndentingNewLine]", 
      RowBox[{
      "gf", " ", "is", " ", "a", "  ", "list", " ", "that", " ", "is", " ", 
       "output", " ", "of", " ", "the", " ", "function", " ", "below"}], " ", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "Output", " ", "is", " ", "an", " ", "array", " ", "with", " ", 
        "entries", " ", "Nx"}], ",", "Ny", ",", "N\[Theta]", ",", " ", "3", 
       ",", "3"}]}]}
   },
   GridBoxItemSize->{"Columns" -> {{
        Scaled[0.96]}}}], 
  TraditionalForm]],ExpressionUUID->"c20b1e48-0da1-49e7-a7ca-18da03762277"]], \
"Text",
 CellChangeTimes->{{3.8047666205768347`*^9, 3.804766714435834*^9}, {
  3.8049112336080775`*^9, 3.8049113705671015`*^9}, {3.804911444995697*^9, 
  3.8049114519119434`*^9}},ExpressionUUID->"2d6bc4f6-7d59-4133-8595-\
a907bfd5ea03"],

Cell["Function to calculate other version of gauge frame.", "Text",
 CellChangeTimes->{{3.8713794674819937`*^9, 
  3.871379491840554*^9}},ExpressionUUID->"d5172bf2-f786-472e-9909-\
f56070acd2b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CalcGaugeFrame", "[", 
   RowBox[{
   "os_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]sHess_", ",", 
    "\[Sigma]aHess_", ",", 
    RowBox[{"\[Sigma]sExt_", ":", "0"}], ",", 
    RowBox[{"\[Sigma]aExt_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "M", ",", "A", ",", "B1", ",", "\[Chi]", ",", "\[Nu]", ",", 
      "B2", ",", "B3"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"os", "=", 
       RowBox[{"ObjPositionOrientationData", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Data\>\"", "\[Rule]", "osData"}], ",", 
          RowBox[{"\"\<Symmetry\>\"", "\[Rule]", "\[Pi]"}], ",", " ", 
          RowBox[{"\"\<Wavelets\>\"", "\[Rule]", " ", "None"}], ",", " ", 
          RowBox[{"\"\<InputData\>\"", "\[Rule]", " ", "None"}], ",", " ", 
          RowBox[{"\"\<DcFilteredImage\>\"", "\[Rule]", "0"}]}], "}"}], 
        "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"obtain", " ", "the", " ", "Hessian", " ", "field"}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"OrientationScoreTensor", "[", 
        RowBox[{"os", ",", 
         RowBox[{"{", 
          RowBox[{"\[Sigma]sHess", ",", "\[Sigma]aHess"}], "}"}], ",", 
         "\"\<Hessian\>\""}], "]"}], "[", "\"\<Data\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{"H", "/", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "H", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"blur", " ", "the", " ", "Hessian", " ", "field"}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}], " ", "=!=", 
        " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"H", " ", "=", " ", 
         RowBox[{"LieAnalysis`Common`ExternalRegularization", "[", 
          RowBox[{"H", ",", " ", 
           RowBox[{"os", "[", "\"\<FullOrientationList\>\"", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}]}], "]"}]}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"define", " ", "M"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"M", " ", "=", " ", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"{", 
        RowBox[{
         FractionBox["1", "\[Xi]"], ",", 
         FractionBox["\[Zeta]", "\[Xi]"], ",", "1"}], "}"}], "]"}]}], ";", 
     "  ", 
     RowBox[{"(*", 
      RowBox[{
      "Bekijken", " ", "wat", " ", "verschil", " ", "is", " ", "met", " ", 
       "\[Zeta]", " ", "en", " ", "1"}], "*)"}], 
     RowBox[{"(*", 
      RowBox[{
      "M", " ", "is", " ", "already", " ", "inversed", " ", "compared", " ", 
       "to", " ", "theory"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"solve", " ", "the", " ", "optimization", " ", "problem", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"i", ".", "e", ".", " ", "fit"}], " ", "B1"}], ")"}]}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          SuperscriptBox["M", "2"], ".", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "\[Transpose]"}], ".", 
            RowBox[{"(", 
             SuperscriptBox["M", "2"], ")"}], ".", "#"}], ")"}]}], "&"}], ",",
         "H", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"B1", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Eigenvectors", "[", 
            RowBox[{"#", ",", 
             RowBox[{"Method", "->", "\"\<Direct\>\""}]}], "]"}], 
           "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ")"}], 
         "&"}], ",", "A", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "multiply", " ", "B1", " ", "by", " ", "the", " ", "sign", " ", "of", 
       " ", 
       SubscriptBox[
        RowBox[{"(", "B1", ")"}], "1"], " ", 
       RowBox[{"s", ".", "t", ".", " ", "it"}], " ", "points", " ", "in", " ",
        "the", " ", "same", " ", "direction", " ", "as", " ", "A1"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"B1", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Sign", "[", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "]"}],
           "*", "#"}], "&"}], ",", "B1", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "obtain", " ", "angles", " ", "representing", " ", "deviation", " ", 
       "of", " ", "horizontality", " ", "and", " ", "curvature"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"B1", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "\[Equal]", "0"}], "&&", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "\[Equal]", "0"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", "#"}], "]"}], 
         "&"}], ",", "B1", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "When", " ", "the", " ", "direction", " ", "of", " ", "B1", " ", "is", 
        " ", "purely", " ", "angular"}], ",", " ", 
       RowBox[{
       "it", " ", "is", " ", "replaced", " ", "by", " ", "the", " ", "Left", 
        " ", "Invariant", " ", "Frame"}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Chi]", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          "]"}], "&"}], ",", "B1", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"arctan", 
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["B1", "1"], "/", 
         SubscriptBox["B1", "2"]}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Nu]", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ArcTan", "[", 
          RowBox[{
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               ")"}], "2"]}]], ",", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
          "]"}], "&"}], ",", "B1", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"MinMax", "[", 
       RowBox[{"Cos", "[", "\[Nu]", "]"}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "normalize", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"B1", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", "/", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Xi]", " ", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               FractionBox["\[Xi]", "\[Zeta]"], 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
              ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ")"}], "2"]}]]}], "&"}], ",", "B1", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"calculate", " ", "B2"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"B2", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"Sin", "[", "#1", "]"}]}], ",", 
           RowBox[{"Cos", "[", "#1", "]"}], ",", "0"}], "}"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Chi]", ",", "\[Nu]"}], "}"}], ",", "3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"B2", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", "/", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Xi]", " ", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               FractionBox["\[Xi]", "\[Zeta]"], 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
              ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ")"}], "2"]}]]}], "&"}], ",", "B2", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", " ", 
     RowBox[{"(*", " ", "normalize", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"calculate", " ", "B3"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"B3", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"Cos", "[", "#1", "]"}]}], 
            RowBox[{"Sin", "[", "#2", "]"}]}], ",", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"Sin", "[", "#1", "]"}]}], 
            RowBox[{"Sin", "[", "#2", "]"}]}], ",", 
           RowBox[{"Cos", "[", "#2", "]"}]}], "}"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Chi]", ",", "\[Nu]"}], "}"}], ",", "3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"B3", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", "/", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Xi]", " ", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               FractionBox["\[Xi]", "\[Zeta]"], 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
              ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ")"}], "2"]}]]}], "&"}], ",", "B3", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", " ", 
     RowBox[{"(*", " ", "normalize", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"B1", ",", "B2", ",", "B3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"4", ",", "1", ",", "2", ",", "3", ",", "5"}], "}"}]}], 
       "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.795594079825184*^9, 3.7955940902756176`*^9}, {
   3.7967129709998336`*^9, 3.7967130096306877`*^9}, {3.796713048745922*^9, 
   3.796713110551585*^9}, {3.796721179626305*^9, 3.7967212058095355`*^9}, {
   3.796722814218359*^9, 3.796722824618686*^9}, {3.796726199180425*^9, 
   3.7967262607875443`*^9}, {3.7978542712659044`*^9, 3.797854325865594*^9}, {
   3.7978544749928875`*^9, 3.797854483020919*^9}, {3.7978545349574394`*^9, 
   3.797854537757592*^9}, {3.798525988556734*^9, 3.7985259936128693`*^9}, {
   3.7985260440268364`*^9, 3.7985260492642975`*^9}, {3.7985263482566237`*^9, 
   3.798526585787815*^9}, {3.7985266469529696`*^9, 3.7985267433994265`*^9}, {
   3.7985275215507636`*^9, 3.79852755364509*^9}, {3.798534764278058*^9, 
   3.7985347769904194`*^9}, {3.8047664440342765`*^9, 
   3.8047664597522063`*^9}, {3.8047665040522976`*^9, 3.8047665051093416`*^9}, 
   3.810359730808375*^9, {3.810360349954708*^9, 3.8103604450480375`*^9}, {
   3.810360481045204*^9, 3.8103604881798058`*^9}, {3.8103605707800603`*^9, 
   3.810360607244115*^9}, {3.8103622708140125`*^9, 3.8103622892819376`*^9}, 
   3.810365174859542*^9, {3.8117572325627327`*^9, 3.811757239936776*^9}, 
   3.811759623952338*^9, 3.8152072083391733`*^9, {3.8243949735530567`*^9, 
   3.8243949737268944`*^9}, {3.824395117767079*^9, 3.824395121622464*^9}, {
   3.824395328529643*^9, 3.8243953296796913`*^9}, {3.8244652432610264`*^9, 
   3.824465273409086*^9}, {3.824467745634363*^9, 3.824467750049348*^9}, {
   3.8244677940657597`*^9, 3.8244678238471117`*^9}, {3.8244680290410366`*^9, 
   3.824468031526551*^9}, {3.8244681697162514`*^9, 3.8244681846520653`*^9}, {
   3.8244690052379274`*^9, 3.8244690076552887`*^9}, {3.824469334798501*^9, 
   3.824469353718541*^9}, {3.8244700945263996`*^9, 3.824470106551138*^9}, {
   3.824470288590431*^9, 3.824470297070013*^9}, {3.824470393452575*^9, 
   3.824470398613288*^9}, {3.82447060276697*^9, 3.824470605445738*^9}, {
   3.824471684866904*^9, 3.8244716940127306`*^9}, {3.8305748356116047`*^9, 
   3.8305748498761215`*^9}, {3.830587298092366*^9, 3.8305873758603983`*^9}, {
   3.830587565544037*^9, 3.8305876052333646`*^9}, 3.8305905373589993`*^9},
 CellLabel->"In[62]:=",ExpressionUUID->"fa2afe95-f37e-4197-ac88-81871a0d1f19"],

Cell["Function to calculate data-driven term (Hessian)", "Text",
 CellChangeTimes->{{3.871379498536255*^9, 
  3.8713795142497807`*^9}},ExpressionUUID->"82c2edb4-d90c-4ed5-931f-\
d79b1809e642"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CalcGaugeFrameNew2", "[", 
   RowBox[{
   "os_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]sHess_", ",", 
    "\[Sigma]aHess_", ",", 
    RowBox[{"\[Sigma]sExt_", ":", "0"}], ",", 
    RowBox[{"\[Sigma]aExt_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "M", ",", "A", ",", "B1", ",", "\[Chi]", ",", "\[Nu]", ",", 
      "B2", ",", "B3"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"obtain", " ", "the", " ", "Hessian", " ", "field"}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"OrientationScoreTensor", "[", 
        RowBox[{"os", ",", 
         RowBox[{"{", 
          RowBox[{"\[Sigma]sHess", ",", "\[Sigma]aHess"}], "}"}], ",", 
         "\"\<Hessian\>\""}], "]"}], "[", "\"\<Data\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{"H", "/", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "H", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"blur", " ", "the", " ", "Hessian", " ", "field"}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}], " ", "=!=", 
        " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"H", " ", "=", " ", 
         RowBox[{"LieAnalysis`Common`ExternalRegularization", "[", 
          RowBox[{"H", ",", " ", 
           RowBox[{"os", "[", "\"\<FullOrientationList\>\"", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}]}], "]"}]}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "H", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8491814230048704`*^9, 3.8491814591008077`*^9}, {
   3.8491818422529297`*^9, 3.8491818481129208`*^9}, {3.8491818926205397`*^9, 
   3.849181905954278*^9}, {3.849181948436373*^9, 3.8491819596984415`*^9}, {
   3.849182018104129*^9, 3.8491821035225725`*^9}, {3.8491821734602957`*^9, 
   3.8491822370489483`*^9}, {3.849182271164497*^9, 3.8491823115907297`*^9}, 
   3.8491824035191636`*^9, {3.8491825147614946`*^9, 3.849182516632842*^9}, {
   3.8491829411658163`*^9, 3.849182956102683*^9}, {3.849182995576559*^9, 
   3.849182997319205*^9}, {3.851660146489938*^9, 3.8516601704889083`*^9}, {
   3.851664390605429*^9, 3.8516644152154837`*^9}, {3.851664471412835*^9, 
   3.851664494312326*^9}, {3.8713764547258987`*^9, 3.8713764601945815`*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"2fae6d52-1365-4c4d-aa17-59b49f9ee672"],

Cell["Function to calculate data - driven term (Structure tensor)", "Text",
 CellChangeTimes->{{3.871379516907662*^9, 3.87137951690961*^9}, {
  3.871379565636858*^9, 
  3.8713795710832396`*^9}},ExpressionUUID->"63758721-bcd6-44c8-91b9-\
cc669a65c8e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CalcGaugeFrameNewStructureTensor", "[", 
   RowBox[{
   "os_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]sHess_", ",", 
    "\[Sigma]aHess_", ",", 
    RowBox[{"\[Sigma]sExt_", ":", "0"}], ",", 
    RowBox[{"\[Sigma]aExt_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "H", ",", "M", ",", "A", ",", "B1", ",", "\[Chi]", ",", "\[Nu]", ",", 
      "B2", ",", "B3"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "obtain", " ", "the", " ", "structure", " ", "tensor", " ", "field"}], 
     " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"OrientationScoreTensor", "[", 
        RowBox[{"os", ",", 
         RowBox[{"{", 
          RowBox[{"\[Sigma]sHess", ",", "\[Sigma]aHess"}], "}"}], ",", 
         "\"\<StructureTensor\>\""}], "]"}], "[", "\"\<Data\>\"", "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{"H", "/", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "H", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"blur", " ", "the", " ", "Hessian", " ", "field"}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}], " ", "=!=", 
        " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"H", " ", "=", " ", 
         RowBox[{"LieAnalysis`Common`ExternalRegularization", "[", 
          RowBox[{"H", ",", " ", 
           RowBox[{"os", "[", "\"\<FullOrientationList\>\"", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}]}], "]"}]}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "H", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8491814230048704`*^9, 3.8491814591008077`*^9}, {
   3.8491818422529297`*^9, 3.8491818481129208`*^9}, {3.8491818926205397`*^9, 
   3.849181905954278*^9}, {3.849181948436373*^9, 3.8491819596984415`*^9}, {
   3.849182018104129*^9, 3.8491821035225725`*^9}, {3.8491821734602957`*^9, 
   3.8491822370489483`*^9}, {3.849182271164497*^9, 3.8491823115907297`*^9}, 
   3.8491824035191636`*^9, {3.8491825147614946`*^9, 3.849182516632842*^9}, {
   3.8491829411658163`*^9, 3.849182956102683*^9}, {3.849182995576559*^9, 
   3.849182997319205*^9}, {3.851660146489938*^9, 3.8516601704889083`*^9}, {
   3.851664390605429*^9, 3.8516644152154837`*^9}, {3.851664471412835*^9, 
   3.851664494312326*^9}, {3.8618768085113535`*^9, 3.8618768147956448`*^9}, 
   3.861936853291791*^9, 3.8619369067760024`*^9, {3.8713764641557055`*^9, 
   3.871376480648612*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"f9dfc857-30c9-42f4-90c6-240a1c1b3624"]
}, Closed]],

Cell[CellGroupData[{

Cell["Iterated stabilization", "Subsubsection",
 CellChangeTimes->{{3.7981975822749453`*^9, 
  3.7981975905938983`*^9}},ExpressionUUID->"35188349-23bb-451b-8f9e-\
81fe4513a9b8"],

Cell["\<\
Iteratively fits gauge frames to (the data of) an orientation score. Returns \
the final gauge frame and corresponding orientation confidence.\
\>", "Text",
 CellChangeTimes->{{3.804766777968708*^9, 
  3.804766879301859*^9}},ExpressionUUID->"16cdcc47-0509-4ca7-a654-\
c7c9c87900e2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"StabilizeGFandOC", "[", 
   RowBox[{
   "U_", ",", "iterations_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", 
    "\[Sigma]s_", ",", "\[Sigma]a_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "obj", ",", "gf", ",", "hess", ",", "hessLIFscaled", ",", "hessGf", ",", 
      "oc", ",", "i", ",", "M"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"oc", "=", "U"}], ";", "\[IndentingNewLine]", 
     RowBox[{"M", " ", "=", " ", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"{", 
        RowBox[{
         FractionBox["1", "\[Xi]"], ",", 
         FractionBox["\[Zeta]", "\[Xi]"], ",", "1"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "0"}], ",", 
       RowBox[{"i", "<", "iterations"}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"obj", "=", 
         RowBox[{"ObjPositionOrientationData", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<Data\>\"", "\[Rule]", "oc"}], ",", 
            RowBox[{"\"\<Symmetry\>\"", "\[Rule]", 
             RowBox[{"2", "\[Pi]"}]}], ",", " ", 
            RowBox[{"\"\<Wavelets\>\"", "\[Rule]", " ", "None"}], ",", " ", 
            RowBox[{"\"\<InputData\>\"", "\[Rule]", " ", "None"}], ",", " ", 
            RowBox[{"\"\<DcFilteredImage\>\"", "\[Rule]", "0"}]}], "}"}], 
          "]"}]}], ";", " ", 
        RowBox[{"(*", 
         RowBox[{
         "Important", " ", "for", " ", "subsequent", " ", "functions", " ", 
          "we", " ", "need", " ", "object", " ", "structure", " ", 
          "\"\<Obl....Data\>\"", " ", "not", " ", "just", " ", "an", " ", 
          "array"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"gf", "=", 
         RowBox[{"CalcGaugeFrame", "[", 
          RowBox[{
          "obj", ",", "\[Xi]", ",", "\[Zeta]", ",", "\[Sigma]s", ",", 
           "\[Sigma]a"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"hess", " ", "=", " ", 
         RowBox[{
          RowBox[{"OrientationScoreTensor", "[", 
           RowBox[{"obj", ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[Sigma]s", ",", "\[Sigma]a"}], "}"}], ",", " ", 
            "\"\<Hessian\>\""}], "]"}], "[", "\"\<Data\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"hessLIFscaled", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"M", ".", "#", ".", "M"}], "&"}], ",", "hess", ",", 
           RowBox[{"{", "3", "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", 
         RowBox[{
         "converting", " ", "the", " ", "Hessian", " ", "to", " ", "the", " ",
           "new", " ", "LIF", " ", "frame"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"hessGf", " ", "=", " ", 
         RowBox[{"HessianToGaugeFrame", "[", 
          RowBox[{"hessLIFscaled", ",", " ", "gf"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"oc", " ", "=", 
         RowBox[{"-", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"hessGf", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "All", ",", "All", ",", "2", ",", "2"}], 
             "\[RightDoubleBracket]"}], "+", 
            RowBox[{"hessGf", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "All", ",", "All", ",", "3", ",", "3"}], 
             "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", " ", 
        RowBox[{"(*", 
         RowBox[{"B22", "+", "B33"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"oc", "=", 
         RowBox[{"Clip", "[", 
          RowBox[{"oc", ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"oc", "=", 
         RowBox[{"oc", "/", 
          RowBox[{"Max", "[", "oc", "]"}]}]}], ";"}]}], "\[IndentingNewLine]",
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"gf", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           FractionBox["#", 
            SqrtBox[
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                ")"}], "2"], "+", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                ")"}], "2"], "+", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
                ")"}], "2"]}]]], "&"}], ",", "gf", ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], 
      RowBox[{"(*", "normalize", "*)"}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"gf", ",", "oc"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.79819759173936*^9, 3.798197592897605*^9}, 
   3.7981981452287536`*^9, {3.798273385511506*^9, 3.798273387925391*^9}, {
   3.8047667920152693`*^9, 3.804766796629775*^9}, {3.8049119151574125`*^9, 
   3.8049119797522926`*^9}, {3.8103651333461733`*^9, 
   3.8103651417281766`*^9}, {3.810365194304583*^9, 3.8103651954501257`*^9}, {
   3.810365449844298*^9, 3.8103654935449944`*^9}, {3.810365558728485*^9, 
   3.8103656737436714`*^9}, {3.8103660255606594`*^9, 3.810366027254305*^9}, {
   3.810366236495502*^9, 3.810366240708493*^9}, {3.8103664330589113`*^9, 
   3.8103664535473022`*^9}, {3.8103669187158637`*^9, 3.8103669231243*^9}, {
   3.810373226766035*^9, 3.810373227303585*^9}, {3.8116516509879165`*^9, 
   3.8116516527033954`*^9}, {3.811668931557144*^9, 3.811668936868536*^9}, 
   3.811679351400089*^9, {3.811736680426016*^9, 3.8117366867918253`*^9}, {
   3.8117370383554773`*^9, 3.8117370473176394`*^9}, {3.8117371260120964`*^9, 
   3.811737127366505*^9}, 3.811737229386094*^9, 3.811838838978099*^9, {
   3.815206234559731*^9, 3.815206242765772*^9}, {3.8152063289141006`*^9, 
   3.8152063301486955`*^9}, {3.815219502794548*^9, 3.8152195029371667`*^9}, {
   3.815219851496524*^9, 3.81521985499916*^9}, {3.8152198891733646`*^9, 
   3.815219900558913*^9}, {3.8152199998806734`*^9, 3.8152200607484045`*^9}, {
   3.8152201321949205`*^9, 3.8152201655575905`*^9}, {3.815220283312336*^9, 
   3.8152202869549766`*^9}, 3.815220342644933*^9, {3.815285575450711*^9, 
   3.8152855957802005`*^9}, {3.815286049507428*^9, 3.815286052480757*^9}, {
   3.8197149214370995`*^9, 3.819714924043038*^9}, 3.8197149726943855`*^9, {
   3.819715021284363*^9, 3.8197150328262944`*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"1aff8f63-aa6c-4a5f-bee0-915e556a78b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Visualization of Gauge Frame", "Subsubsection",
 CellChangeTimes->{{3.797831652092016*^9, 3.7978316549403505`*^9}, {
  3.824216302843145*^9, 
  3.8242163046948338`*^9}},ExpressionUUID->"3da3c669-bd53-4fd8-8a7a-\
8d2e6c85bddb"],

Cell[TextData[{
 "Exponential curve through a point (x,y,\[Theta]) (at t = 0) with speed \
expressed by coordinate vector ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{
     SubscriptBox["c", "1"], ",", 
     SubscriptBox["c", "2"], ",", 
     SubscriptBox["c", "3"]}]}], TraditionalForm]],ExpressionUUID->
  "f8d6b5de-d278-4836-b47b-5ee6fe2d0b01"],
 ") in the left invariant frame. "
}], "Text",
 CellChangeTimes->{{3.804766907263937*^9, 3.804766996811564*^9}, {
  3.804767029445799*^9, 
  3.8047670419237986`*^9}},ExpressionUUID->"c6a6b34d-9a3d-4479-a77d-\
6ddc3bb48625"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expCurve", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "\[Theta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"c1_", ",", "c2_", ",", "c3_"}], "}"}], ",", "t_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"c3", "\[Equal]", "0.0"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "+", 
       RowBox[{
        RowBox[{"Cos", "[", "\[Theta]", "]"}], "c1", " ", "t"}], "-", 
       RowBox[{
        RowBox[{"Sin", "[", "\[Theta]", "]"}], "c2", " ", "t"}]}], ",", 
      RowBox[{"y", "+", 
       RowBox[{
        RowBox[{"Sin", "[", "\[Theta]", "]"}], "c1", " ", "t"}], "+", 
       RowBox[{
        RowBox[{"Cos", "[", "\[Theta]", "]"}], "c2", " ", "t"}]}], ",", 
      "\[Theta]"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "+", 
       RowBox[{
        FractionBox["1", "c3"], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Cos", "[", "\[Theta]", "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"c1", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"c3", " ", "t"}], "]"}]}], "+", 
             RowBox[{"c2", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Cos", "[", 
                 RowBox[{"c3", " ", "t"}], "]"}], "-", "1"}], ")"}]}]}], 
            ")"}]}], "-", 
          RowBox[{
           RowBox[{"Sin", "[", "\[Theta]", "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"c1", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Cos", "[", 
                 RowBox[{"c3", " ", "t"}], "]"}]}], ")"}]}], "+", 
             RowBox[{"c2", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"c3", " ", "t"}], "]"}]}]}], ")"}]}]}], ")"}]}]}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"y", "+", 
       RowBox[{
        FractionBox["1", "c3"], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Sin", "[", "\[Theta]", "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"c1", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"c3", " ", "t"}], "]"}]}], "+", 
             RowBox[{"c2", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Cos", "[", 
                 RowBox[{"c3", " ", "t"}], "]"}], "-", "1"}], ")"}]}]}], 
            ")"}]}], "+", 
          RowBox[{
           RowBox[{"Cos", "[", "\[Theta]", "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"c1", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Cos", "[", 
                 RowBox[{"c3", " ", "t"}], "]"}]}], ")"}]}], "+", 
             RowBox[{"c2", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"c3", " ", "t"}], "]"}]}]}], ")"}]}]}], ")"}]}]}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", "+", 
       RowBox[{"c3", " ", "t"}]}]}], "}"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.796452884111987*^9, 3.7964528869533653`*^9}, {
  3.7964529228746195`*^9, 3.7964530046677647`*^9}, {3.796453035110244*^9, 
  3.796453040400176*^9}, {3.7964532398594265`*^9, 3.796453272186737*^9}, {
  3.7964533022541046`*^9, 3.7964535426420226`*^9}, {3.7964537102359443`*^9, 
  3.7964537136174855`*^9}, {3.7964537667393336`*^9, 3.796453767203065*^9}, {
  3.796453823051646*^9, 3.7964538433096123`*^9}, {3.79645390327275*^9, 
  3.796453970811256*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"6d88419d-4c5d-4996-ab8f-78032fa0fea0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"expCurveA", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_", ",", "\[Theta]_"}], "}"}], ",", "t_"}], "]"}], 
   ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x", "+", 
      RowBox[{"t", "*", 
       RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ",", 
     RowBox[{"y", "+", 
      RowBox[{"t", "*", 
       RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ",", "\[Theta]"}], "}"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.796452884111987*^9, 3.7964528869533653`*^9}, {
  3.7964529228746195`*^9, 3.7964530046677647`*^9}, {3.796453035110244*^9, 
  3.796453040400176*^9}, {3.7964532398594265`*^9, 3.796453272186737*^9}, {
  3.7964533022541046`*^9, 3.7964535426420226`*^9}, {3.7964537102359443`*^9, 
  3.7964537136174855`*^9}, {3.7964537667393336`*^9, 3.796453767203065*^9}, {
  3.796453823051646*^9, 3.7964538433096123`*^9}, {3.79645390327275*^9, 
  3.796453970811256*^9}, {3.824396634804904*^9, 3.824396650133373*^9}, {
  3.8243967815578437`*^9, 3.824396798485736*^9}, {3.8243972013733144`*^9, 
  3.8243972052686224`*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"b0271e31-b37c-4ad1-89d6-849720b203d1"],

Cell["Reference: Lecture Notes DGIP Part I: Remark 9, Definition 4", "Text",
 CellChangeTimes->{{3.8079423245941625`*^9, 
  3.8079423949098215`*^9}},ExpressionUUID->"7146d85b-e15d-4291-90f8-\
7c6bbccbb5a2"],

Cell["\<\
Shows projections of  exponential curves with velocity given by  the first \
gauge vector at several random positions.
Points are selected in the xy-plane, for \[Theta] the coordinate with maximum \
orientation confidence is selected.\
\>", "Text",
 CellChangeTimes->{{3.8047670553626223`*^9, 3.8047671615575867`*^9}, {
  3.804767199642004*^9, 
  3.804767434910578*^9}},ExpressionUUID->"acf71d07-b335-4b22-998b-\
6a3fb951b6f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotGaugeFrameFGThinLines", "[", 
   RowBox[{
   "oc_", ",", "gf_", ",", "positions_", ",", "numSamples_", ",", "length_", 
    ",", "baseImage_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "xyList", ",", "\[Theta]dList", ",", "\[Theta]List", ",", "cList", ",", 
      "gdList", ",", "gList", ",", "Nx", ",", "Ny", ",", "N\[Theta]", ",", 
      "s\[Theta]"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Nx", ",", "Ny", ",", "N\[Theta]"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", "oc", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"s\[Theta]", "=", 
      RowBox[{"2", 
       FractionBox["\[Pi]", "N\[Theta]"]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"xyList", "=", 
      RowBox[{"RandomSample", "[", 
       RowBox[{"positions", ",", "numSamples"}], "]"}]}], ";", "  ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "selection", " ", "of", " ", "a", " ", "number", " ", "of", " ", 
        "samples"}], ",", " ", 
       RowBox[{
       "now", " ", "Random", " ", "later", " ", "adapt", " ", "if", " ", 
        "needed"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Theta]dList", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Ordering", "[", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"oc", "\[LeftDoubleBracket]", 
             RowBox[{"Sequence", "@@", "#"}], "\[RightDoubleBracket]"}], 
            "]"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}], "&"}], "/@", "xyList"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Select", " ", "\[Theta]"}], "-", 
        RowBox[{
        "component", " ", "with", " ", "maximum", " ", "abs", " ", "value", 
         " ", "in", " ", "orientation", " ", "confidence"}]}], ",", " ", 
       RowBox[{
        RowBox[{"label", " ", "d"}], "=", " ", "\"\<discrete\>\""}]}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"gdList", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Transpose", "[", "xyList", "]"}], ",", 
           RowBox[{"{", "\[Theta]dList", "}"}]}], "}"}], ",", "1"}], "]"}], 
       "]"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Put", " ", "everything", " ", "together", " ", "x"}], "-", 
       "y", "-", "\[Theta]", "-", "coord"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Theta]List", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"\[Theta]dList", "-", "1"}], ")"}], "s\[Theta]"}]}], ";", 
     "                                        ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "convert", " ", "to", " ", "continuous", " ", "coordinates", " ", "so", 
       " ", "that", " ", "exponential", " ", "curve", " ", "formulas", " ", 
       "can", " ", "be", " ", "used"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"gList", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Transpose", "[", "xyList", "]"}], ",", 
           RowBox[{"{", "\[Theta]List", "}"}]}], "}"}], ",", "1"}], "]"}], 
       "]"}]}], ";", "  ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Put", " ", "everything", " ", "together", " ", "in", " ", 
        "continuous", " ", "x"}], "-", "y", "-", "\[Theta]", "-", "coord"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"cList", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"gf", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"Sequence", "@@", "#"}], ",", "1"}], 
         "\[RightDoubleBracket]"}], "&"}], "/@", "gdList"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Pul", " ", "first", " ", "row", " ", "from", " ", "the", " ", "gf", 
       " ", "list", " ", "so", " ", "this", " ", "gives", " ", "the", " ", 
       "first", " ", "gauge", " ", "vector", " ", "field", " ", "in", " ", 
       "discrete", " ", "coordinates"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{"baseImage", ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Convert", " ", "coordinates", " ", "to", " ", "image", " ", 
          "coordinates", " ", "x", " ", "and", " ", "y", " ", "axes", " ", 
          "are", " ", "flipped"}], ",", " ", 
         RowBox[{
         "this", " ", "causes", " ", "rotation", " ", "direction", " ", "to", 
          " ", "reverse"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ParametricPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "-", "0.5"}], ",", 
               RowBox[{"Nx", "-", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", "0.5"}]}], "}"}], "&"}], "@", 
            RowBox[{"expCurve", "[", 
             RowBox[{
              RowBox[{
              "gList", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
               ",", 
              RowBox[{
              "cList", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
               ",", "t"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", 
             RowBox[{
              RowBox[{"-", "length"}], "/", "2"}], ",", 
             RowBox[{"length", "/", "2"}]}], "}"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thickness", "[", "0.004", "]"}], ",", "Orange"}], 
             "}"}]}]}], "]"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "gList", "]"}], ",", "1"}], "}"}]}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7977513630325637`*^9, 3.797751411706707*^9}, {
   3.797751480251086*^9, 3.797751551609975*^9}, {3.7977515825636168`*^9, 
   3.7977515834843903`*^9}, {3.7977517099040036`*^9, 3.797751800786234*^9}, {
   3.797751923725185*^9, 3.7977520622065196`*^9}, {3.7977521637000594`*^9, 
   3.797752276292592*^9}, {3.7977523175393844`*^9, 3.797752490557062*^9}, {
   3.797752574547472*^9, 3.797752862270906*^9}, 3.797752917528504*^9, {
   3.7977531059781322`*^9, 3.7977531402233887`*^9}, {3.7977531786557655`*^9, 
   3.797753266053121*^9}, {3.797757528467003*^9, 3.797757543808408*^9}, {
   3.797763743319216*^9, 3.797763810799045*^9}, {3.8047673531428843`*^9, 
   3.8047673626679277`*^9}, {3.804912061192582*^9, 3.804912354786599*^9}, {
   3.804912396185414*^9, 3.804912475929165*^9}, 3.810372268262021*^9, {
   3.8118366270003057`*^9, 3.8118366471048317`*^9}, {3.811840371789135*^9, 
   3.8118403777397127`*^9}, {3.8244725510754166`*^9, 3.824472552299489*^9}, {
   3.8307694531674285`*^9, 3.830769458780657*^9}, {3.8307695939745674`*^9, 
   3.8307695941747065`*^9}, {3.8307700921214113`*^9, 3.8307700923578086`*^9}, 
   3.830833888323448*^9},
 CellLabel->"In[68]:=",ExpressionUUID->"57bf132f-4b58-4f2e-8360-71c76e153b1a"],

Cell["\<\
Explanation input variables: in above routine: oc = orientation confidence, \
gf = gaugeframe (discrete) coordinatelist, positions = list of spatial \
coordinates where you want to have the plot, numsamples = number of arcs to \
be visualized, length = tmax in continuous coordinates.
Outcome = Show of Graphics object.\
\>", "Text",
 CellChangeTimes->{{3.8049125663890142`*^9, 3.8049127402948303`*^9}, {
  3.804912778738985*^9, 
  3.8049128881139383`*^9}},ExpressionUUID->"711d5c2d-0f31-451a-9e24-\
dd11403e7afa"]
}, Closed]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Cost Function", "Section",
 CellChangeTimes->{{3.871371313477089*^9, 3.8713713230924745`*^9}, 
   3.8713744994680367`*^9},ExpressionUUID->"ca2dfdb5-aaaa-4c20-b003-\
c4fddd38f38b"],

Cell[CellGroupData[{

Cell["Single Scale Vesselness Filter", "Subsection",
 CellChangeTimes->{{3.8316344807809677`*^9, 3.831634483141035*^9}, {
  3.8713757292638564`*^9, 3.871375737736952*^9}, {3.8713757708660736`*^9, 
  3.8713757848739877`*^9}},ExpressionUUID->"538fb8fb-eab6-4179-a735-\
488278e5e49a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CostFunctionVesselnessFiltering", "[", 
   RowBox[{
   "U_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]s_", ",", "method_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "cost", ",", "H", ",", "Q", ",", "S", ",", "R", ",", "B11", ",", "B22", 
      ",", "obj", ",", "oc", ",", 
      RowBox[{"\[Sigma]1", "=", "0.5"}], ",", "\[Sigma]2", ",", "Qgreater0", 
      ",", "M", ",", "\[Lambda]1", ",", "\[Lambda]2", ",", "\[Lambda]3", ",", 
      "c", ",", 
      RowBox[{"\[Beta]", "=", 
       RowBox[{"0.75", "/", "\[Sigma]s"}]}], ",", "Hess"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"calculate", " ", "the", " ", "Hessian"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"obj", "=", 
      RowBox[{"ObjPositionOrientationData", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<Data\>\"", "\[Rule]", "U"}], ",", 
         RowBox[{"\"\<Symmetry\>\"", "\[Rule]", 
          RowBox[{"2", "\[Pi]"}]}], ",", " ", 
         RowBox[{"\"\<Wavelets\>\"", "\[Rule]", " ", "None"}], ",", " ", 
         RowBox[{"\"\<InputData\>\"", "\[Rule]", " ", "None"}], ",", " ", 
         RowBox[{"\"\<DcFilteredImage\>\"", "\[Rule]", "0"}]}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"OrientationScoreTensor", "[", 
        RowBox[{"obj", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"0.5", "*", 
            SuperscriptBox["\[Sigma]s", "2"]}], ",", 
           RowBox[{"0.5", "*", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Beta]", "*", "\[Sigma]s"}], ")"}], "2"]}]}], "}"}], 
         ",", "\"\<Hessian\>\""}], "]"}], "[", "\"\<Data\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"define", " ", "M"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"M", " ", "=", " ", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"{", 
        RowBox[{
         FractionBox["1", "\[Xi]"], ",", 
         FractionBox["\[Zeta]", "\[Xi]"], ",", "1"}], "}"}], "]"}]}], ";", 
     "  ", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"obtain", " ", "the", " ", "Hessian", " ", "field"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Hess", "=", 
      RowBox[{
       RowBox[{"ConstantArray", "[", 
        RowBox[{
         RowBox[{"M", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "}"}], ".", "M"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}]}], "]"}], "*", "H"}]}], 
     ";", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Hess", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"M", ".", "#", ".", "M"}], "&"}], ",", "H", ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Determine", " ", "variables", " ", "depending", " ", "on", " ", "the", 
       " ", "method", " ", "that", " ", "is", " ", "considered"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"method", "==", "\"\<LIF\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Lambda]1", "=", 
         RowBox[{"Hess", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "All", ",", "All", ",", "1", ",", "1"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{"Hess", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "All", ",", "All", ",", "2", ",", "2"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Q", "=", "c"}], ";"}], " ", 
       RowBox[{"(*", 
        RowBox[{"convexity", " ", "criterion"}], "*)"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Lambda]3", ",", "\[Lambda]2", ",", "\[Lambda]1"}], "}"}],
          "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigenvalues", "[", 
               RowBox[{"M", ".", "M", ".", 
                RowBox[{"Transpose", "[", "#", "]"}], ".", "M", ".", "M", ".",
                 "#"}], "]"}], "&"}], ",", "H", ",", 
             RowBox[{"{", "3", "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3", ",", "4", ",", "1"}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{"0.5", "*", 
          RowBox[{"(", 
           RowBox[{"\[Lambda]2", "+", "\[Lambda]3"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Q", "=", 
         RowBox[{"Hess", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "All", ",", "All", ",", "2", ",", "2"}], 
          "\[RightDoubleBracket]"}]}]}]}], " ", 
      RowBox[{"(*", 
       RowBox[{"convexity", " ", "criterion"}], "*)"}], "\[IndentingNewLine]",
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Determine", " ", "measures", " ", "that", " ", "are", " ", "used", " ",
        "when", " ", "calculating", " ", "the", " ", "vesselness"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"S", "=", 
      RowBox[{
       SuperscriptBox["\[Lambda]1", "2"], "+", 
       SuperscriptBox["c", "2"]}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{"structure", " ", "measure"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"R", "=", 
      RowBox[{"\[Lambda]1", "/", "c"}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{"anisotropy", " ", "measure"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Sigma]2", "=", 
      RowBox[{"0.2", "*", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "S", "]"}], "]"}]}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "S", "]"}], "]"}], " ", "ensures", " ", "that", 
       " ", "the", " ", "method", " ", "is", " ", "scaling", " ", 
       "invariant"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Calculate", " ", "the", " ", "vesselness", " ", "at", " ", "ALL", " ", 
       "locations", " ", "and", " ", "orientations"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", 
          SuperscriptBox["R", "2"]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", 
           SuperscriptBox["\[Sigma]1", "2"]}], ")"}]}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "S"}], "/", 
           RowBox[{"(", 
            RowBox[{"2", "*", "\[Sigma]2"}], ")"}]}], "]"}]}], ")"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Selection", " ", "criterion", " ", "on", " ", "convexity"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Qgreater0", "=", 
      RowBox[{"1", "-", 
       RowBox[{"UnitStep", "[", 
        RowBox[{"-", "Q"}], "]"}]}]}], 
     RowBox[{"(*", 
      RowBox[{"Boole", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ">", "0"}], "&"}], ",", "Q", ",", 
         RowBox[{"{", "3", "}"}]}], "]"}], "]"}], "*)"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Vesselness", " ", "at", " ", "locations", " ", "that", " ", "meet", 
       " ", "the", " ", "convexity", " ", "criterion"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{"cost", "*", "Qgreater0"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "cost", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.831700621055113*^9, 3.83170071527347*^9}, {
   3.831700747539089*^9, 3.8317007766656637`*^9}, {3.8317008204573913`*^9, 
   3.831700862001667*^9}, {3.831700892710336*^9, 3.831700970456744*^9}, {
   3.8317010154423776`*^9, 3.831701059479223*^9}, {3.8317013033704925`*^9, 
   3.8317013312815733`*^9}, {3.831701406870053*^9, 3.831701479619607*^9}, 
   3.831702376776008*^9, {3.831702481275221*^9, 3.831702483945857*^9}, {
   3.8317025887621565`*^9, 3.8317025903591995`*^9}, {3.8317027497648787`*^9, 
   3.831702800763775*^9}, {3.8317033970662265`*^9, 3.831703398700817*^9}, {
   3.8317035132347107`*^9, 3.8317035667713284`*^9}, 3.831703623390505*^9, {
   3.831703687980508*^9, 3.831703755108315*^9}, 3.8317040310380526`*^9, {
   3.831704503596468*^9, 3.8317045060547113`*^9}, {3.8317091510973673`*^9, 
   3.831709151348405*^9}, {3.831709700050008*^9, 3.8317097006454115`*^9}, {
   3.831709769465223*^9, 3.831709778053362*^9}, {3.8317155312170706`*^9, 
   3.8317155333119874`*^9}, {3.8317161114464207`*^9, 3.831716113460864*^9}, {
   3.8317165663062634`*^9, 3.831716601884225*^9}, {3.8317166341631827`*^9, 
   3.8317166662136497`*^9}, {3.831716698452117*^9, 3.8317168843813276`*^9}, {
   3.8317170307114677`*^9, 3.8317170337875433`*^9}, {3.8317171661180487`*^9, 
   3.8317171824213257`*^9}, 3.8317196038493547`*^9, {3.8317198439178524`*^9, 
   3.831719846461735*^9}, {3.831720090946414*^9, 3.831720107271838*^9}, {
   3.83180597103368*^9, 3.831805975131879*^9}, 3.8318066757759495`*^9, 
   3.831807160890427*^9, {3.831807535208869*^9, 3.83180753950561*^9}, 
   3.831816444761509*^9, {3.8318769075046463`*^9, 3.831876924351859*^9}, {
   3.8318769679894247`*^9, 3.831876969530199*^9}, 3.8318770753873186`*^9, {
   3.831877380489173*^9, 3.831877416462142*^9}, 3.8318776429750586`*^9, {
   3.831877724862707*^9, 3.831877724981058*^9}, 3.831877863831921*^9, {
   3.831877987522004*^9, 3.831877987771125*^9}, 3.8318780977397194`*^9, 
   3.831878680963387*^9, {3.831878755740961*^9, 3.831878755799967*^9}, 
   3.8318792938839674`*^9, {3.8318798792499523`*^9, 3.831879879727828*^9}, 
   3.8318918349459953`*^9, 3.831892122586246*^9, {3.8318924298905687`*^9, 
   3.831892429990985*^9}, 3.831893137371763*^9, {3.831893508108944*^9, 
   3.8318935086064987`*^9}, {3.8318977629378843`*^9, 3.831897763043951*^9}, 
   3.8319619837836237`*^9, {3.831962015095559*^9, 3.8319620211980247`*^9}, {
   3.832039708432623*^9, 3.832039771838543*^9}, {3.8320399649595394`*^9, 
   3.832039967207567*^9}, {3.8320400626702003`*^9, 3.832040090979965*^9}, {
   3.832040147331139*^9, 3.83204021589231*^9}, {3.8320404626864543`*^9, 
   3.83204047811031*^9}, {3.8320405304053903`*^9, 3.832040532371476*^9}, {
   3.8320406329553537`*^9, 3.832040639388233*^9}, {3.8320406794126854`*^9, 
   3.8320406815172057`*^9}, {3.8320415723932037`*^9, 
   3.8320417365714226`*^9}, {3.8320418581849036`*^9, 3.832041858268427*^9}, {
   3.8320419615836406`*^9, 3.83204197356218*^9}, {3.8320422023049603`*^9, 
   3.8320422244985046`*^9}, 3.832043217729306*^9, 3.832043405912733*^9, {
   3.83204354210608*^9, 3.832043544501052*^9}, {3.8320501159262037`*^9, 
   3.83205011599699*^9}, {3.8320877489160194`*^9, 3.8320877502980633`*^9}, 
   3.8320893687909594`*^9, {3.832089922644105*^9, 3.832089923021311*^9}, {
   3.8320920918539553`*^9, 3.832092092656397*^9}, {3.832147657024498*^9, 
   3.8321476779655695`*^9}, {3.832147862083398*^9, 3.83214786842303*^9}, {
   3.8322997317459273`*^9, 3.8322997436680493`*^9}, {3.8466754167767963`*^9, 
   3.8466754214888153`*^9}, 3.8466755327969456`*^9, 3.8466757923554125`*^9, {
   3.8467384136211014`*^9, 3.846738663916294*^9}, {3.8467553051584396`*^9, 
   3.8467553078065615`*^9}, {3.8472525489043355`*^9, 
   3.8472525532853584`*^9}, {3.8472525955539646`*^9, 
   3.8472526036202583`*^9}, {3.8472532930518665`*^9, 
   3.8472532993081465`*^9}, {3.847253682235481*^9, 3.847253690273202*^9}, {
   3.84726643518459*^9, 3.847266452966767*^9}, {3.847270444672587*^9, 
   3.847270446233013*^9}, 3.8472736558816433`*^9, {3.847276058842713*^9, 
   3.8472761159053526`*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"95eaf7d7-2094-4411-bcf1-504da56bafd9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Cost", "[", 
   RowBox[{"oc_", ",", "\[Lambda]_", ",", "p_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "cost", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cost", "=", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"\[Lambda]", "*", 
          SuperscriptBox["oc", "p"]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"ImageAdjust", "[", 
        RowBox[{"Image", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"Min", ",", 
           RowBox[{"Rescale", "[", "cost", "]"}], ",", 
           RowBox[{"{", "2", "}"}]}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8319618117031293`*^9, 3.8319618838348403`*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"ae6b4b75-aa80-44ac-87c1-03538bb2d490"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CostFunction", "[", 
   RowBox[{"oc_", ",", "\[Lambda]_", ",", "p_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "cost", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cost", "=", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"\[Lambda]", "*", 
          SuperscriptBox["oc", "p"]}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "cost", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8319618117031293`*^9, 3.8319618838348403`*^9}, {
  3.831998121571029*^9, 3.831998129082103*^9}, {3.831998168905656*^9, 
  3.831998169657459*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"6e61aee2-0da7-410e-957e-1d7e116e3ea8"]
}, Closed]],

Cell[CellGroupData[{

Cell["Multiscale Vesselness Filter", "Subsection",
 CellChangeTimes->{{3.8467368047953024`*^9, 
  3.8467368118756647`*^9}},ExpressionUUID->"f48c70ef-7719-4e6a-a0bf-\
4521ff254613"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MultiScaleVesselness", "[", 
   RowBox[{
   "U_", ",", "Uboarder_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]s_", 
    ",", "method_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "vesselness", ",", "vesselnessBoarder", ",", "vesselnessfilterNoBoarder",
       ",", "vesselnessfilterNoBoarderErosion", ",", 
      "vesselnessfilterNoBoarderErosion2", ",", "liftElevators", ",", 
      "newvesselnessfilter", ",", 
      RowBox[{"vesselnessfilter", "=", 
       RowBox[{"{", "}"}]}], ",", "k", ",", "i"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "<=", 
        RowBox[{"Length", "[", "\[Sigma]s", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "the", " ", "spatial", " ", "scale", " ", "for", " ", 
         "the", " ", "specific", " ", "iteration"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{"\[Sigma]s", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "of", " ", "the", 
          " ", "full", " ", "image"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselness", "=", 
         RowBox[{"CostFunctionVesselnessFiltering", "[", 
          RowBox[{
          "U", ",", "\[Xi]", ",", "\[Zeta]", ",", "k", ",", "method"}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "of", " ", "the", 
          " ", "boarder", " ", "of", " ", "the", " ", "image"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"vesselnessBoarder", "=", 
         RowBox[{"CostFunctionVesselnessFiltering", "[", 
          RowBox[{
          "Uboarder", ",", "\[Xi]", ",", "\[Zeta]", ",", "k", ",", "method"}],
           "]"}]}], ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "without", " ", 
          "the", " ", "boarder"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselnessfilterNoBoarder", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"UnitStep", "[", 
             RowBox[{"vesselnessBoarder", "-", "0.0001"}], "]"}]}], ")"}], 
          "*", "vesselness"}]}], 
        RowBox[{"(*", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Boole", "[", 
             RowBox[{"#", "<", "0.0001"}], "]"}], "&"}], ",", 
           "vesselnessBoarder", ",", 
           RowBox[{"{", "3", "}"}]}], "]"}], "*)"}], ";", " ", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Add", " ", "erosion", " ", "to", " ", "the", " ", "cost", " ", 
           "function"}], " ", "\[Rule]", " ", 
          RowBox[{
          "erosion", " ", "of", " ", "broad", " ", "angular", " ", 
           "boundaries"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselnessfilterNoBoarderErosion", "=", 
         RowBox[{"Erosion", "[", 
          RowBox[{"vesselnessfilterNoBoarder", ",", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"1", ",", "1", ",", "1"}], "}"}], "}"}], "}"}], ",", 
           RowBox[{"Padding", "\[Rule]", "\"\<Periodic\>\""}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Erosion", "[", 
              RowBox[{"#", ",", "0.5", ",", 
               RowBox[{"Padding", "\[Rule]", "\"\<Periodic\>\""}]}], "]"}], 
             "&"}], ",", "vesselnessfilterNoBoarder", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}], ";"}], "*)"}], " ", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Cut", " ", "off", " ", "the", " ", "upper", " ", "boarder", " ", 
          "which", " ", "influences", " ", "the", " ", "vesselness"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{
        "vesselnessfilterNoBoarderErosion2", "=", 
         "vesselnessfilterNoBoarderErosion"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vesselnessfilterNoBoarderErosion2", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", "5"}], "]"}], "]"}], "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "Ny", ",", "No"}], "}"}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Boole", "[", 
               RowBox[{
                RowBox[{
                "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[GreaterEqual]", "6"}], "]"}], "*", "#1"}], "&"}], ",", 
            "vesselnessfilterNoBoarderErosion", ",", 
            RowBox[{"{", "3", "}"}]}], "]"}], ";"}], "*)"}], 
        RowBox[{"(*", 
         RowBox[{"Cut", " ", "off", " ", "upper", " ", "boarder"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"(*", 
          RowBox[{
          "Create", " ", "mobility", " ", "function", " ", "only", " ", 
           "containing", " ", "lifts", " ", "at", " ", "bifurcations"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"liftElevators", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"No", ",", "Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"liftElevators", "\[LeftDoubleBracket]", 
                 RowBox[{"All", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"(", 
                    RowBox[{"#", "-", 
                    RowBox[{"{", 
                    RowBox[{"ySelect", ",", "0"}], "}"}]}], ")"}]}]}], 
                 "\[RightDoubleBracket]"}], "=", "1"}], ";"}], "&"}], ",", 
             "seedsIndex"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"liftElevators", "=", 
            RowBox[{"GaussianFilter", "[", 
             RowBox[{"liftElevators", ",", "1.5"}], "]"}]}], ";"}], "*)"}], 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Combine", " ", "both", " ", "mobility", " ", "functions"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
            RowBox[{"Transpose", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"4", "*", 
                 RowBox[{
                 "Rescale", "[", "vesselnessfilterNoBoarderErosion2", "]"}]}],
                 ",", 
                RowBox[{"Transpose", "[", 
                 RowBox[{
                  RowBox[{"Rescale", "[", "liftElevators", "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], "}"}],
               ",", 
              RowBox[{"{", 
               RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", "3", "}"}]}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Add", " ", "new", " ", "vesselness", " ", "to", " ", "the", " ", 
          "array", " ", "containing", " ", "vesselness", " ", "filters", " ", 
          "for", " ", "all", " ", "different", " ", "values", " ", "of", " ", 
          "\[Sigma]s"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
        "newvesselnessfilter", "=", "vesselnessfilterNoBoarderErosion2"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"vesselnessfilter", ",", "newvesselnessfilter"}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"vesselnessfilter", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"vesselnessfilter", ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "vesselnessfilter", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.846069290478445*^9, 3.846069320848277*^9}, {
  3.846069388578823*^9, 3.8460694136426706`*^9}, {3.8460698943625517`*^9, 
  3.8460699961806927`*^9}, {3.8460700607895765`*^9, 3.846070370519379*^9}, {
  3.8460704370347395`*^9, 3.846070455399172*^9}, {3.8460705633723164`*^9, 
  3.846070607320956*^9}, {3.8461357617580004`*^9, 3.84613576321036*^9}, {
  3.8461371780315437`*^9, 3.8461371794824996`*^9}, {3.8467383924445486`*^9, 
  3.8467384051500874`*^9}, {3.8472527956174803`*^9, 3.847252804776075*^9}, {
  3.847254715962023*^9, 3.84725477265746*^9}, {3.8472550730271826`*^9, 
  3.8472550948254304`*^9}, {3.8472645825577707`*^9, 3.8472645902415514`*^9}, {
  3.8472648673212476`*^9, 3.8472649626651025`*^9}, {3.8472650190287113`*^9, 
  3.8472650286441393`*^9}, {3.8472761287663803`*^9, 3.8472762743068795`*^9}, {
  3.8479437503598204`*^9, 3.8479437633810444`*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"e7c181c2-e953-46ff-8585-1ac5b1ec300b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MultiScaleVesselnessFilter", "[", "vesselnessfilters_", "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "sum1", ",", "\[Mu]\[Infinity]", ",", "sum2", ",", "\[Mu]l\[Infinity]", 
      ",", "cost"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Calculate", " ", "vesselness", " ", "per", " ", "location", " ", "and", 
      " ", "orientation", " ", "by", " ", "taking", " ", "sum", " ", "over", 
      " ", "all", " ", "spatial", " ", "scales"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sum1", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"vesselnessfilters", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Dimensions", "[", "vesselnessfilters", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], 
     RowBox[{"(*", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Total", "[", 
          RowBox[{"weights", ".", "#"}], "]"}], "&"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"vesselnessfilters", ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", "3", "}"}]}], "]"}], "*)"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Calculate", " ", "maximum", " ", "value", " ", "in", " ", "sum1"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Mu]\[Infinity]", "=", 
      RowBox[{"Max", "[", "sum1", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Rescale", " ", "the", " ", "sum1", " ", "by", " ", "dividing", " ", 
       "with", " ", "its", " ", "maximum", " ", "to", " ", "find", " ", "the",
        " ", "cost", " ", "function"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{
       SuperscriptBox["\[Mu]\[Infinity]", 
        RowBox[{"-", "1"}]], "*", "sum1"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cost", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"cost", ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Calculate", " ", "vesselness", " ", "per", " ", "location", " ", 
         "by", " ", "taking", " ", "sum", " ", "over", " ", "all", " ", 
         "orientations"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"sum2", "=", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{"cost", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{
             RowBox[{"Dimensions", "[", "cost", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Calculate", " ", "maximum", " ", "value", " ", "in", " ", "sum2"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Mu]l\[Infinity]", "=", 
        RowBox[{"Max", "[", "sum2", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"cost", "=", 
        RowBox[{
         SuperscriptBox["\[Mu]l\[Infinity]", 
          RowBox[{"-", "1"}]], "*", "sum2"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "cost", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8461351164748793`*^9, 3.846135301233615*^9}, {
  3.8461353918983126`*^9, 3.8461354296469297`*^9}, {3.8461354708019032`*^9, 
  3.84613550183355*^9}, {3.846135565954836*^9, 3.846135585502041*^9}, {
  3.8461356206333733`*^9, 3.846135625324848*^9}, {3.8461365925473847`*^9, 
  3.8461366255417967`*^9}, {3.8461366613125324`*^9, 3.8461366681133223`*^9}, {
  3.8461380233321896`*^9, 3.8461380346543207`*^9}, {3.84658043492728*^9, 
  3.8465804362968216`*^9}, {3.846761981543815*^9, 3.8467619923206415`*^9}, {
  3.846762380572624*^9, 3.8467624741657667`*^9}, {3.84676257915926*^9, 
  3.8467625894172935`*^9}, {3.846762774042492*^9, 3.8467627925348787`*^9}, {
  3.8472751267320757`*^9, 3.847275212905927*^9}, {3.847276618866034*^9, 
  3.847276871448764*^9}, {3.847276925336969*^9, 3.847276930574594*^9}, {
  3.847277021172058*^9, 3.847277055403304*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"028d5b49-dddc-410d-acf8-db8aa4f80a4b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MultiScaleVesselnessFilter2D", "[", "vesselnessfilters_", "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "sum1", ",", "\[Mu]\[Infinity]", ",", "sum2", ",", "\[Mu]l\[Infinity]", 
      ",", "cost"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Calculate", " ", "vesselness", " ", "per", " ", "location", " ", "and", 
      " ", "orientation", " ", "by", " ", "taking", " ", "sum", " ", "over", 
      " ", "all", " ", "spatial", " ", "scales"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sum1", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"vesselnessfilters", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Dimensions", "[", "vesselnessfilters", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], 
     RowBox[{"(*", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Total", "[", 
          RowBox[{"weights", ".", "#"}], "]"}], "&"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"vesselnessfilters", ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", "3", "}"}]}], "]"}], "*)"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Calculate", " ", "maximum", " ", "value", " ", "in", " ", "sum1"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Mu]\[Infinity]", "=", 
      RowBox[{"Max", "[", "sum1", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Rescale", " ", "the", " ", "sum1", " ", "by", " ", "dividing", " ", 
       "with", " ", "its", " ", "maximum", " ", "to", " ", "find", " ", "the",
        " ", "cost", " ", "function"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{
       SuperscriptBox["\[Mu]\[Infinity]", 
        RowBox[{"-", "1"}]], "*", "sum1"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Putting", " ", "cost", " ", "function", " ", "in", " ", "right", " ", 
       "dimensions"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"cost", ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Calculate", " ", "vesselness", " ", "per", " ", "location", " ", "by", 
       " ", "taking", " ", "sum", " ", "over", " ", "all", " ", 
       "orientations"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"sum2", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"cost", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Dimensions", "[", "cost", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Calculate", " ", "maximum", " ", "value", " ", "in", " ", "sum2"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Mu]l\[Infinity]", "=", 
      RowBox[{"Max", "[", "sum2", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{
       SuperscriptBox["\[Mu]l\[Infinity]", 
        RowBox[{"-", "1"}]], "*", "sum2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "cost", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8461351164748793`*^9, 3.846135301233615*^9}, {
  3.8461353918983126`*^9, 3.8461354296469297`*^9}, {3.8461354708019032`*^9, 
  3.84613550183355*^9}, {3.846135565954836*^9, 3.846135585502041*^9}, {
  3.8461356206333733`*^9, 3.846135625324848*^9}, {3.8461365925473847`*^9, 
  3.8461366255417967`*^9}, {3.8461366613125324`*^9, 3.8461366681133223`*^9}, {
  3.8461380233321896`*^9, 3.8461380346543207`*^9}, {3.84658043492728*^9, 
  3.8465804362968216`*^9}, {3.846761981543815*^9, 3.8467619923206415`*^9}, {
  3.846762380572624*^9, 3.8467624741657667`*^9}, {3.84676257915926*^9, 
  3.8467625894172935`*^9}, {3.846762774042492*^9, 3.8467627925348787`*^9}, {
  3.8472751267320757`*^9, 3.847275212905927*^9}, {3.847276618866034*^9, 
  3.847276871448764*^9}, {3.847276925336969*^9, 3.847276930574594*^9}, {
  3.847277021172058*^9, 3.847277055403304*^9}, {3.8472784934463716`*^9, 
  3.84727851900611*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"3ab7a8f3-74c7-4ef2-8d65-fce8d2b41685"]
}, Closed]],

Cell[CellGroupData[{

Cell["External Regularization", "Subsection",
 CellChangeTimes->{{3.846736828118457*^9, 
  3.8467368336747875`*^9}},ExpressionUUID->"1cd08cf6-9592-4965-a42f-\
c3c192857dab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CostFunctionVesselnessFilteringExtReg", "[", 
   RowBox[{
   "U_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]s_", ",", "method_", 
    ",", 
    RowBox[{"\[Sigma]sExt_", ":", "0"}], ",", 
    RowBox[{"\[Sigma]aExt_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "cost", ",", "H", ",", "Q", ",", "S", ",", "R", ",", "B11", ",", "B22", 
      ",", "obj", ",", "oc", ",", 
      RowBox[{"\[Sigma]1", "=", "0.5"}], ",", "\[Sigma]2", ",", "Qgreater0", 
      ",", "M", ",", "\[Lambda]1", ",", "\[Lambda]2", ",", "\[Lambda]3", ",", 
      "c", ",", 
      RowBox[{"\[Beta]", "=", 
       RowBox[{"0.75", "/", "\[Sigma]s"}]}], ",", "Hess"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"calculate", " ", "the", " ", "Hessian"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"obj", "=", 
      RowBox[{"ObjPositionOrientationData", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<Data\>\"", "\[Rule]", "U"}], ",", 
         RowBox[{"\"\<Symmetry\>\"", "\[Rule]", 
          RowBox[{"2", "\[Pi]"}]}], ",", " ", 
         RowBox[{"\"\<Wavelets\>\"", "\[Rule]", " ", "None"}], ",", " ", 
         RowBox[{"\"\<InputData\>\"", "\[Rule]", " ", "None"}], ",", " ", 
         RowBox[{"\"\<DcFilteredImage\>\"", "\[Rule]", "0"}]}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"OrientationScoreTensor", "[", 
        RowBox[{"obj", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"0.5", "*", 
            SuperscriptBox["\[Sigma]s", "2"]}], ",", 
           RowBox[{"0.5", "*", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Beta]", "*", "\[Sigma]s"}], ")"}], "2"]}]}], "}"}], 
         ",", "\"\<Hessian\>\""}], "]"}], "[", "\"\<Data\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"define", " ", "M"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"M", " ", "=", " ", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1", "/", "\[Xi]"}], ",", 
         RowBox[{"\[Zeta]", "/", "\[Xi]"}], ",", "1"}], "}"}], "]"}]}], ";", 
     "  ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}], " ", "=!=", 
        " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}]}], ",", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}], " ", 
           "proportional", " ", "with", " ", 
           RowBox[{"{", 
            RowBox[{"\[Sigma]s", ",", "\[Sigma]a"}]}]}], ")"}], "?"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"H", "=", " ", 
         RowBox[{"LieAnalysis`Common`ExternalRegularization", "[", 
          RowBox[{"H", ",", " ", 
           RowBox[{"obj", "[", "\"\<FullOrientationList\>\"", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Sigma]sExt", ",", "\[Sigma]aExt"}], "}"}]}], "]"}]}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"obtain", " ", "the", " ", "Hessian", " ", "field"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Hess", "=", 
      RowBox[{
       RowBox[{"ConstantArray", "[", 
        RowBox[{
         RowBox[{"M", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "}"}], ".", "M"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}]}], "]"}], "*", "H"}]}], 
     RowBox[{"(*", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"M", ".", "#", ".", "M"}], "&"}], ",", "H", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}], "*)"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Determine", " ", "variables", " ", "depending", " ", "on", " ", "the", 
       " ", "method", " ", "that", " ", "is", " ", "considered"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"method", "==", "\"\<LIF\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Lambda]1", "=", 
         RowBox[{"Hess", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "All", ",", "All", ",", "1", ",", "1"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{"Hess", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "All", ",", "All", ",", "2", ",", "2"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Q", "=", "c"}], ";"}], " ", 
       RowBox[{"(*", 
        RowBox[{"convexity", " ", "criterion"}], "*)"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Lambda]3", ",", "\[Lambda]2", ",", "\[Lambda]1"}], "}"}],
          "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigenvalues", "[", 
               RowBox[{"M", ".", "M", ".", 
                RowBox[{"Transpose", "[", "#", "]"}], ".", "M", ".", "M", ".",
                 "#"}], "]"}], "&"}], ",", "H", ",", 
             RowBox[{"{", "3", "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3", ",", "4", ",", "1"}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{"0.5", "*", 
          RowBox[{"(", 
           RowBox[{"\[Lambda]2", "+", "\[Lambda]3"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Q", "=", 
         RowBox[{"Hess", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "All", ",", "All", ",", "2", ",", "2"}], 
          "\[RightDoubleBracket]"}]}]}]}], " ", 
      RowBox[{"(*", 
       RowBox[{"convexity", " ", "criterion"}], "*)"}], "\[IndentingNewLine]",
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Determine", " ", "measures", " ", "that", " ", "are", " ", "used", " ",
        "when", " ", "calculating", " ", "the", " ", "vesselness"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"S", "=", 
      RowBox[{
       SuperscriptBox["\[Lambda]1", "2"], "+", 
       SuperscriptBox["c", "2"]}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{"structure", " ", "measure"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"R", "=", 
      RowBox[{"\[Lambda]1", "/", "c"}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{"anisotropy", " ", "measure"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Sigma]2", "=", 
      RowBox[{"0.2", "*", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "S", "]"}], "]"}]}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "S", "]"}], "]"}], " ", "ensures", " ", "that", 
       " ", "the", " ", "method", " ", "is", " ", "scaling", " ", 
       "invariant"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Calculate", " ", "the", " ", "vesselness", " ", "at", " ", "ALL", " ", 
       "locations", " ", "and", " ", "orientations"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", 
          SuperscriptBox["R", "2"]}], "/", 
         RowBox[{"(", 
          RowBox[{"2", 
           SuperscriptBox["\[Sigma]1", "2"]}], ")"}]}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "S"}], "/", 
           RowBox[{"(", 
            RowBox[{"2", "*", "\[Sigma]2"}], ")"}]}], "]"}]}], ")"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Selection", " ", "criterion", " ", "on", " ", "convexity"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Qgreater0", "=", 
      RowBox[{"1", "-", 
       RowBox[{"UnitStep", "[", 
        RowBox[{"-", "Q"}], "]"}]}]}], 
     RowBox[{"(*", 
      RowBox[{"Boole", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ">", "0"}], "&"}], ",", "Q", ",", 
         RowBox[{"{", "3", "}"}]}], "]"}], "]"}], "*)"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Vesselness", " ", "at", " ", "locations", " ", "that", " ", "meet", 
       " ", "the", " ", "convexity", " ", "criterion"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{"cost", "*", "Qgreater0"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "cost", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.831700621055113*^9, 3.83170071527347*^9}, {
   3.831700747539089*^9, 3.8317007766656637`*^9}, {3.8317008204573913`*^9, 
   3.831700862001667*^9}, {3.831700892710336*^9, 3.831700970456744*^9}, {
   3.8317010154423776`*^9, 3.831701059479223*^9}, {3.8317013033704925`*^9, 
   3.8317013312815733`*^9}, {3.831701406870053*^9, 3.831701479619607*^9}, 
   3.831702376776008*^9, {3.831702481275221*^9, 3.831702483945857*^9}, {
   3.8317025887621565`*^9, 3.8317025903591995`*^9}, {3.8317027497648787`*^9, 
   3.831702800763775*^9}, {3.8317033970662265`*^9, 3.831703398700817*^9}, {
   3.8317035132347107`*^9, 3.8317035667713284`*^9}, 3.831703623390505*^9, {
   3.831703687980508*^9, 3.831703755108315*^9}, 3.8317040310380526`*^9, {
   3.831704503596468*^9, 3.8317045060547113`*^9}, {3.8317091510973673`*^9, 
   3.831709151348405*^9}, {3.831709700050008*^9, 3.8317097006454115`*^9}, {
   3.831709769465223*^9, 3.831709778053362*^9}, {3.8317155312170706`*^9, 
   3.8317155333119874`*^9}, {3.8317161114464207`*^9, 3.831716113460864*^9}, {
   3.8317165663062634`*^9, 3.831716601884225*^9}, {3.8317166341631827`*^9, 
   3.8317166662136497`*^9}, {3.831716698452117*^9, 3.8317168843813276`*^9}, {
   3.8317170307114677`*^9, 3.8317170337875433`*^9}, {3.8317171661180487`*^9, 
   3.8317171824213257`*^9}, 3.8317196038493547`*^9, {3.8317198439178524`*^9, 
   3.831719846461735*^9}, {3.831720090946414*^9, 3.831720107271838*^9}, {
   3.83180597103368*^9, 3.831805975131879*^9}, 3.8318066757759495`*^9, 
   3.831807160890427*^9, {3.831807535208869*^9, 3.83180753950561*^9}, 
   3.831816444761509*^9, {3.8318769075046463`*^9, 3.831876924351859*^9}, {
   3.8318769679894247`*^9, 3.831876969530199*^9}, 3.8318770753873186`*^9, {
   3.831877380489173*^9, 3.831877416462142*^9}, 3.8318776429750586`*^9, {
   3.831877724862707*^9, 3.831877724981058*^9}, 3.831877863831921*^9, {
   3.831877987522004*^9, 3.831877987771125*^9}, 3.8318780977397194`*^9, 
   3.831878680963387*^9, {3.831878755740961*^9, 3.831878755799967*^9}, 
   3.8318792938839674`*^9, {3.8318798792499523`*^9, 3.831879879727828*^9}, 
   3.8318918349459953`*^9, 3.831892122586246*^9, {3.8318924298905687`*^9, 
   3.831892429990985*^9}, 3.831893137371763*^9, {3.831893508108944*^9, 
   3.8318935086064987`*^9}, {3.8318977629378843`*^9, 3.831897763043951*^9}, 
   3.8319619837836237`*^9, {3.831962015095559*^9, 3.8319620211980247`*^9}, {
   3.832039708432623*^9, 3.832039771838543*^9}, {3.8320399649595394`*^9, 
   3.832039967207567*^9}, {3.8320400626702003`*^9, 3.832040090979965*^9}, {
   3.832040147331139*^9, 3.83204021589231*^9}, {3.8320404626864543`*^9, 
   3.83204047811031*^9}, {3.8320405304053903`*^9, 3.832040532371476*^9}, {
   3.8320406329553537`*^9, 3.832040639388233*^9}, {3.8320406794126854`*^9, 
   3.8320406815172057`*^9}, {3.8320415723932037`*^9, 
   3.8320417365714226`*^9}, {3.8320418581849036`*^9, 3.832041858268427*^9}, {
   3.8320419615836406`*^9, 3.83204197356218*^9}, {3.8320422023049603`*^9, 
   3.8320422244985046`*^9}, 3.832043217729306*^9, 3.832043405912733*^9, {
   3.83204354210608*^9, 3.832043544501052*^9}, {3.8320501159262037`*^9, 
   3.83205011599699*^9}, {3.8320877489160194`*^9, 3.8320877502980633`*^9}, 
   3.8320893687909594`*^9, {3.832089922644105*^9, 3.832089923021311*^9}, {
   3.8320920918539553`*^9, 3.832092092656397*^9}, {3.832147657024498*^9, 
   3.8321476779655695`*^9}, {3.832147862083398*^9, 3.83214786842303*^9}, {
   3.8322997317459273`*^9, 3.8322997436680493`*^9}, {3.8465775928712397`*^9, 
   3.846577745083552*^9}, {3.8465778557171717`*^9, 3.8465778577551675`*^9}, {
   3.8465786742558002`*^9, 3.84657868367164*^9}, {3.8465788410951853`*^9, 
   3.846578857194363*^9}, {3.846579500498774*^9, 3.846579534540459*^9}, {
   3.8465796324902325`*^9, 3.8465796355829167`*^9}, 3.8465797857096863`*^9, {
   3.8465846164448853`*^9, 3.846584616720894*^9}, {3.846590246345928*^9, 
   3.846590319449998*^9}, 3.846592329832641*^9, {3.84666532669689*^9, 
   3.846665336334193*^9}, {3.8467368598810167`*^9, 3.846736864703286*^9}, {
   3.846736905911895*^9, 3.8467370029116135`*^9}, {3.8467370345126*^9, 
   3.846737077193122*^9}, {3.8467371253042583`*^9, 3.8467371294255247`*^9}, {
   3.8467552673380394`*^9, 3.8467552736122336`*^9}, {3.8467553158993297`*^9, 
   3.84675535142774*^9}, {3.846755429772394*^9, 3.8467554331364737`*^9}, {
   3.84727712879815*^9, 3.8472772027147455`*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"a7deb68b-f211-490e-b8a8-82f5088fc45c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MultiScaleVesselnessExtReg", "[", 
   RowBox[{
   "U_", ",", "Uboarder_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]s_", 
    ",", "method_", ",", 
    RowBox[{"\[Sigma]sExt_", ":", "0"}], ",", 
    RowBox[{"\[Sigma]aExt_", ":", "0"}], ",", 
    RowBox[{"erosion_", ":", "1"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "vesselness", ",", "vesselnessBoarder", ",", "vesselnessfilterNoBoarder",
       ",", "vesselnessfilterNoBoarderErosion", ",", "newvesselnessfilter", 
      ",", 
      RowBox[{"vesselnessfilter", "=", 
       RowBox[{"{", "}"}]}], ",", "k", ",", "i"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "<=", 
        RowBox[{"Length", "[", "\[Sigma]s", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "the", " ", "spatial", " ", "scale", " ", "for", " ", 
         "the", " ", "specific", " ", "iteration"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{"\[Sigma]s", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "of", " ", "the", 
          " ", "full", " ", "image"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselness", "=", 
         RowBox[{"CostFunctionVesselnessFilteringExtReg", "[", 
          RowBox[{
          "U", ",", "\[Xi]", ",", "\[Zeta]", ",", "k", ",", "method", ",", 
           "k", ",", "\[Sigma]aExt"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "of", " ", "the", 
          " ", "boarder", " ", "of", " ", "the", " ", "image"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"vesselnessBoarder", "=", 
         RowBox[{"CostFunctionVesselnessFilteringExtReg", "[", 
          RowBox[{
          "Uboarder", ",", "\[Xi]", ",", "\[Zeta]", ",", "k", ",", "method", 
           ",", "k", ",", "\[Sigma]aExt"}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "without", " ", 
          "the", " ", "boarder"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselnessfilterNoBoarder", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"UnitStep", "[", 
             RowBox[{"vesselnessBoarder", "-", "0.0001"}], "]"}]}], ")"}], 
          "*", "vesselness"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Boole", "[", 
               RowBox[{"#", "<", "0.0001"}], "]"}], "&"}], ",", 
             "vesselnessBoarder", ",", 
             RowBox[{"{", "3", "}"}]}], "]"}], "*", "vesselness"}], ";"}], 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Add", " ", "erosion", " ", "to", " ", "the", " ", "cost", " ", 
           "function"}], " ", "\[Rule]", " ", 
          RowBox[{
          "erosion", " ", "of", " ", "broad", " ", "angular", " ", 
           "boundaries"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselnessfilterNoBoarderErosion", "=", 
         RowBox[{"Erosion", "[", 
          RowBox[{"vesselnessfilterNoBoarder", ",", 
           RowBox[{"erosion", "*", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"1", ",", "1", ",", "1"}], "}"}], "}"}], "}"}]}], ",", 
           RowBox[{"Padding", "\[Rule]", "\"\<Periodic\>\""}]}], "]"}]}], ";",
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Cut", " ", "off", " ", "the", " ", "upper", " ", "boarder", " ", 
          "which", " ", "influences", " ", "the", " ", "vesselness"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vesselnessfilterNoBoarderErosion", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", "5"}], "]"}], "]"}], "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "Ny", ",", "No"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Cut", " ", "off", " ", "the", " ", "lower", " ", "boarder", " ", 
          "which", " ", "influences", " ", "the", " ", "vesselness"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vesselnessfilterNoBoarderErosion", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"-", "5"}], ";;"}], "]"}], "]"}], "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "Ny", ",", "No"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"vesselnessfilterNoBoarderErosion2", "=", 
           RowBox[{"MapIndexed", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Boole", "[", 
                RowBox[{
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "\[GreaterEqual]", "6"}], "]"}], "*", "#1"}], "&"}], ",", 
             "vesselnessfilterNoBoarderErosion", ",", 
             RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], 
         RowBox[{"(*", 
          RowBox[{"Cut", " ", "off", " ", "upper", " ", "boarder"}], "*)"}], 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"(*", 
          RowBox[{
          "Create", " ", "mobility", " ", "function", " ", "only", " ", 
           "containing", " ", "lifts", " ", "at", " ", "bifurcations"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"liftElevators", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"No", ",", "Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"liftElevators", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"#", "-", 
                    RowBox[{"{", 
                    RowBox[{"ySelect", ",", "0"}], "}"}]}], ")"}]}]}], 
                  "\[RightDoubleBracket]"}], "=", "1"}], ";"}], "&"}], ",", 
              "seedsIndex"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"liftElevators", "=", 
             RowBox[{"GaussianFilter", "[", 
              RowBox[{"liftElevators", ",", "1.5"}], "]"}]}], ";"}], "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Combine", " ", "both", " ", "mobility", " ", "functions"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"newvesselnessfilter", "=", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"Transpose", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"4", "*", 
                  RowBox[{
                  "Rescale", "[", "vesselnessfilterNoBoarderErosion2", 
                   "]"}]}], ",", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{
                   RowBox[{"Rescale", "[", "liftElevators", "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Add", " ", "new", " ", "vesselness", " ", "to", " ", "the", " ", 
          "array", " ", "containing", " ", "vesselness", " ", "filters", " ", 
          "for", " ", "all", " ", "different", " ", "values", " ", "of", " ", 
          "\[Sigma]s"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
        "newvesselnessfilter", "=", "vesselnessfilterNoBoarderErosion"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"vesselnessfilter", ",", "newvesselnessfilter"}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"vesselnessfilter", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"vesselnessfilter", ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "vesselnessfilter", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.846069290478445*^9, 3.846069320848277*^9}, {
   3.846069388578823*^9, 3.8460694136426706`*^9}, {3.8460698943625517`*^9, 
   3.8460699961806927`*^9}, {3.8460700607895765`*^9, 3.846070370519379*^9}, {
   3.8460704370347395`*^9, 3.846070455399172*^9}, {3.8460705633723164`*^9, 
   3.846070607320956*^9}, {3.8461357617580004`*^9, 3.84613576321036*^9}, {
   3.8461371780315437`*^9, 3.8461371794824996`*^9}, {3.846578893545618*^9, 
   3.8465789371578035`*^9}, {3.846579069704646*^9, 3.8465790701274323`*^9}, {
   3.846737145534981*^9, 3.846737164629548*^9}, {3.846755598107308*^9, 
   3.8467556087354326`*^9}, {3.846759888042096*^9, 3.846759896286005*^9}, {
   3.8467599385553436`*^9, 3.8467599421542425`*^9}, {3.8467604834169755`*^9, 
   3.8467604851386766`*^9}, {3.8467609263246174`*^9, 3.846760926478567*^9}, {
   3.846761476147117*^9, 3.8467614789751863`*^9}, {3.8468387665957375`*^9, 
   3.8468387816980734`*^9}, {3.8468427788829308`*^9, 
   3.8468427790168743`*^9}, {3.847277220387966*^9, 3.8472773673148804`*^9}, {
   3.8477898596589794`*^9, 3.847789876833465*^9}, {3.8478563017751393`*^9, 
   3.8478563188662643`*^9}, {3.8479662286057787`*^9, 3.847966240197607*^9}, {
   3.8479664567407155`*^9, 3.847966457909107*^9}, {3.847967542490487*^9, 
   3.8479675639557314`*^9}, {3.848039855485445*^9, 3.848039859594449*^9}, 
   3.848120190541051*^9},
 CellLabel->"In[76]:=",ExpressionUUID->"d23e8177-7e5e-49af-8c8b-ce7adc2ff1c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MultiScaleVesselnessExtRegErosion0", "[", 
   RowBox[{
   "U_", ",", "Uboarder_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]s_", 
    ",", "method_", ",", 
    RowBox[{"\[Sigma]sExt_", ":", "0"}], ",", 
    RowBox[{"\[Sigma]aExt_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "vesselness", ",", "vesselnessBoarder", ",", "vesselnessfilterNoBoarder",
       ",", "vesselnessfilterNoBoarderErosion", ",", "newvesselnessfilter", 
      ",", 
      RowBox[{"vesselnessfilter", "=", 
       RowBox[{"{", "}"}]}], ",", "k", ",", "i"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "<=", 
        RowBox[{"Length", "[", "\[Sigma]s", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "the", " ", "spatial", " ", "scale", " ", "for", " ", 
         "the", " ", "specific", " ", "iteration"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{"\[Sigma]s", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "of", " ", "the", 
          " ", "full", " ", "image"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselness", "=", 
         RowBox[{"CostFunctionVesselnessFilteringExtReg", "[", 
          RowBox[{
          "U", ",", "\[Xi]", ",", "\[Zeta]", ",", "k", ",", "method", ",", 
           "k", ",", "\[Sigma]aExt"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "of", " ", "the", 
          " ", "boarder", " ", "of", " ", "the", " ", "image"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"vesselnessBoarder", "=", 
         RowBox[{"CostFunctionVesselnessFilteringExtReg", "[", 
          RowBox[{
          "Uboarder", ",", "\[Xi]", ",", "\[Zeta]", ",", "k", ",", "method", 
           ",", "\[Sigma]sExt", ",", "\[Sigma]aExt"}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "without", " ", 
          "the", " ", "boarder"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselnessfilterNoBoarder", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"UnitStep", "[", 
             RowBox[{"vesselnessBoarder", "-", "0.0001"}], "]"}]}], ")"}], 
          "*", "vesselness"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Boole", "[", 
               RowBox[{"#", "<", "0.0001"}], "]"}], "&"}], ",", 
             "vesselnessBoarder", ",", 
             RowBox[{"{", "3", "}"}]}], "]"}], "*", "vesselness"}], ";"}], 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Add", " ", "erosion", " ", "to", " ", "the", " ", "cost", " ", 
           "function"}], " ", "\[Rule]", " ", 
          RowBox[{
          "erosion", " ", "of", " ", "broad", " ", "angular", " ", 
           "boundaries"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
        "vesselnessfilterNoBoarderErosion", "=", 
         "vesselnessfilterNoBoarder"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Cut", " ", "off", " ", "the", " ", "upper", " ", "boarder", " ", 
          "which", " ", "influences", " ", "the", " ", "vesselness"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vesselnessfilterNoBoarderErosion", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", "5"}], "]"}], "]"}], "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "Ny", ",", "No"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Cut", " ", "off", " ", "the", " ", "lower", " ", "boarder", " ", 
          "which", " ", "influences", " ", "the", " ", "vesselness"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vesselnessfilterNoBoarderErosion", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"-", "5"}], ";;"}], "]"}], "]"}], "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "Ny", ",", "No"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"vesselnessfilterNoBoarderErosion2", "=", 
           RowBox[{"MapIndexed", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Boole", "[", 
                RowBox[{
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "\[GreaterEqual]", "6"}], "]"}], "*", "#1"}], "&"}], ",", 
             "vesselnessfilterNoBoarderErosion", ",", 
             RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], 
         RowBox[{"(*", 
          RowBox[{"Cut", " ", "off", " ", "upper", " ", "boarder"}], "*)"}], 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"(*", 
          RowBox[{
          "Create", " ", "mobility", " ", "function", " ", "only", " ", 
           "containing", " ", "lifts", " ", "at", " ", "bifurcations"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"liftElevators", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"No", ",", "Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"liftElevators", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"#", "-", 
                    RowBox[{"{", 
                    RowBox[{"ySelect", ",", "0"}], "}"}]}], ")"}]}]}], 
                  "\[RightDoubleBracket]"}], "=", "1"}], ";"}], "&"}], ",", 
              "seedsIndex"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"liftElevators", "=", 
             RowBox[{"GaussianFilter", "[", 
              RowBox[{"liftElevators", ",", "1.5"}], "]"}]}], ";"}], "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Combine", " ", "both", " ", "mobility", " ", "functions"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"newvesselnessfilter", "=", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"Transpose", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"4", "*", 
                  RowBox[{
                  "Rescale", "[", "vesselnessfilterNoBoarderErosion2", 
                   "]"}]}], ",", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{
                   RowBox[{"Rescale", "[", "liftElevators", "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Add", " ", "new", " ", "vesselness", " ", "to", " ", "the", " ", 
          "array", " ", "containing", " ", "vesselness", " ", "filters", " ", 
          "for", " ", "all", " ", "different", " ", "values", " ", "of", " ", 
          "\[Sigma]s"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
        "newvesselnessfilter", "=", "vesselnessfilterNoBoarderErosion"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"vesselnessfilter", ",", "newvesselnessfilter"}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"vesselnessfilter", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"vesselnessfilter", ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "vesselnessfilter", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdxTtIQlEYAGATEQqHzPKSWRBl0BSRhJBSpzTaNIkeIiRGomZcFxvDIaHE
wsqCHAxReuhUmogOld0k0jBoM8SlGuxGCA3R1PnP8PF1m2n9MpfD4Ugw2KHV
egqnLBLLOrbgtGdvF875kwGYHyw8w8oHTwUeVh+9w7chnaCIP5SGW2FenhWT
ayu98KSm1g97keLvE6/JWshWLoqz+IiTJiddFwvMGYsyAtkivOZL0fCXiCH7
uwaPhecsGpcFwrCQvgtL8LFNKgKX5xsyUvxPX2MWNt1P38A73wy5MrfK68Q3
OaNk9dLjCOzQlcgDVxtuOCOvkqeaX1QT+NBsahT+HTMOafBKr4mssPtm2mMs
cotqFtgodkVFcRZdx4MncP0p3SbHO9OvFOw17+ds+KKez8D1BFWFrZSK3HJZ
stjxhoN1GxzsySe28W+GjyT8D7uY3Fk=
  "],
 CellLabel->"In[77]:=",ExpressionUUID->"d664ec53-a646-4554-bd14-5a2a03452f0b"]
}, Closed]],

Cell[CellGroupData[{

Cell["External Regularization - No boarder", "Subsection",
 CellChangeTimes->{{3.846736828118457*^9, 3.8467368336747875`*^9}, {
  3.847354136324772*^9, 
  3.847354138393787*^9}},ExpressionUUID->"f269d539-d929-4f90-a40d-\
42e6bccf6ba8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MultiScaleVesselnessExtRegNoBoarder", "[", 
   RowBox[{
   "U_", ",", "\[Xi]_", ",", "\[Zeta]_", ",", "\[Sigma]s_", ",", "method_", 
    ",", 
    RowBox[{"\[Sigma]sExt_", ":", "0"}], ",", 
    RowBox[{"\[Sigma]aExt_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "vesselness", ",", "vesselnessBoarder", ",", "vesselnessfilterNoBoarder",
       ",", "vesselnessfilterNoBoarderErosion", ",", "newvesselnessfilter", 
      ",", 
      RowBox[{"vesselnessfilter", "=", 
       RowBox[{"{", "}"}]}], ",", "k", ",", "i"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "<=", 
        RowBox[{"Length", "[", "\[Sigma]s", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "the", " ", "spatial", " ", "scale", " ", "for", " ", 
         "the", " ", "specific", " ", "iteration"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{"\[Sigma]s", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Calculate", " ", "the", " ", "vesselness", " ", "of", " ", "the", 
          " ", "full", " ", "image"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselness", "=", 
         RowBox[{"CostFunctionVesselnessFilteringExtReg", "[", 
          RowBox[{
          "U", ",", "\[Xi]", ",", "\[Zeta]", ",", "k", ",", "method", ",", 
           "k", ",", "\[Sigma]aExt"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Add", " ", "erosion", " ", "to", " ", "the", " ", "cost", " ", 
           "function"}], " ", "\[Rule]", " ", 
          RowBox[{
          "erosion", " ", "of", " ", "broad", " ", "angular", " ", 
           "boundaries"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vesselness", "=", 
         RowBox[{"Erosion", "[", 
          RowBox[{"vesselness", ",", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"1", ",", "1", ",", "1"}], "}"}], "}"}], "}"}], ",", 
           RowBox[{"Padding", "\[Rule]", "\"\<Periodic\>\""}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Erosion", "[", 
              RowBox[{"#", ",", 
               RowBox[{"(*", "0.5", "*)"}], "1", ",", 
               RowBox[{"Padding", "\[Rule]", "\"\<Periodic\>\""}]}], "]"}], 
             "&"}], ",", "vesselnessfilterNoBoarder", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}], ";"}], "*)"}], " ", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"(*", 
          RowBox[{
          "Create", " ", "mobility", " ", "function", " ", "only", " ", 
           "containing", " ", "lifts", " ", "at", " ", "bifurcations"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"liftElevators", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"No", ",", "Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"liftElevators", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"#", "-", 
                    RowBox[{"{", 
                    RowBox[{"ySelect", ",", "0"}], "}"}]}], ")"}]}]}], 
                  "\[RightDoubleBracket]"}], "=", "1"}], ";"}], "&"}], ",", 
              "seedsIndex"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"liftElevators", "=", 
             RowBox[{"GaussianFilter", "[", 
              RowBox[{"liftElevators", ",", "1.5"}], "]"}]}], ";"}], "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Combine", " ", "both", " ", "mobility", " ", "functions"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"newvesselnessfilter", "=", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"Transpose", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"4", "*", 
                  RowBox[{
                  "Rescale", "[", "vesselnessfilterNoBoarderErosion2", 
                   "]"}]}], ",", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{
                   RowBox[{"Rescale", "[", "liftElevators", "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Add", " ", "new", " ", "vesselness", " ", "to", " ", "the", " ", 
          "array", " ", "containing", " ", "vesselness", " ", "filters", " ", 
          "for", " ", "all", " ", "different", " ", "values", " ", "of", " ", 
          "\[Sigma]s"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"newvesselnessfilter", "=", "vesselness"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"vesselnessfilter", ",", "newvesselnessfilter"}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"vesselnessfilter", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"vesselnessfilter", ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "vesselnessfilter", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.846069290478445*^9, 3.846069320848277*^9}, {
   3.846069388578823*^9, 3.8460694136426706`*^9}, {3.8460698943625517`*^9, 
   3.8460699961806927`*^9}, {3.8460700607895765`*^9, 3.846070370519379*^9}, {
   3.8460704370347395`*^9, 3.846070455399172*^9}, {3.8460705633723164`*^9, 
   3.846070607320956*^9}, {3.8461357617580004`*^9, 3.84613576321036*^9}, {
   3.8461371780315437`*^9, 3.8461371794824996`*^9}, {3.846578893545618*^9, 
   3.8465789371578035`*^9}, {3.846579069704646*^9, 3.8465790701274323`*^9}, {
   3.846737145534981*^9, 3.846737164629548*^9}, {3.846755598107308*^9, 
   3.8467556087354326`*^9}, {3.846759888042096*^9, 3.846759896286005*^9}, {
   3.8467599385553436`*^9, 3.8467599421542425`*^9}, {3.8467604834169755`*^9, 
   3.8467604851386766`*^9}, {3.8467609263246174`*^9, 3.846760926478567*^9}, {
   3.846761476147117*^9, 3.8467614789751863`*^9}, {3.8468387665957375`*^9, 
   3.8468387816980734`*^9}, {3.8468427788829308`*^9, 
   3.8468427790168743`*^9}, {3.847277220387966*^9, 3.8472773673148804`*^9}, {
   3.8473541629695444`*^9, 3.847354195249935*^9}, 3.848040834461649*^9},
 CellLabel->"In[78]:=",ExpressionUUID->"6958abe9-c445-4be2-af42-5493da85f62c"]
}, Closed]],

Cell[CellGroupData[{

Cell["Add lifts to cost function", "Subsection",
 CellChangeTimes->{{3.8468394957920785`*^9, 3.846839497832074*^9}, {
  3.8713756985233936`*^9, 
  3.8713757007370853`*^9}},ExpressionUUID->"7fc7ff29-dad2-4615-bc07-\
08181efa5fbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AddLifts", "[", 
   RowBox[{"vesselness_", ",", "seedsIndex_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"liftElevators", ",", "newvesselnessfilter"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"liftElevators", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"No", ",", "Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"liftElevators", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"(", "#", ")"}]}]}], "\[RightDoubleBracket]"}], "=", 
          "1"}], ";"}], "&"}], ",", "seedsIndex"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"liftElevators", "=", 
      RowBox[{"GaussianFilter", "[", 
       RowBox[{"liftElevators", ",", "1.5"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Combine", " ", "both", " ", "mobility", " ", "functions"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"newvesselnessfilter", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Max", "[", "#", "]"}], "&"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"4", "*", 
             RowBox[{"Rescale", "[", "vesselness", "]"}]}], ",", 
            RowBox[{"Transpose", "[", 
             RowBox[{
              RowBox[{"Rescale", "[", "liftElevators", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newvesselnessfilter", "=", 
      RowBox[{"newvesselnessfilter", "/", 
       RowBox[{"Max", "[", "newvesselnessfilter", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "newvesselnessfilter", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8468394992372694`*^9, 3.8468396468033724`*^9}, 
   3.846841208450967*^9, {3.8468420895555043`*^9, 3.846842089834281*^9}, 
   3.8468423468577747`*^9},
 CellLabel->"In[79]:=",ExpressionUUID->"0fdd28dc-e267-47f2-a7fe-0c2607c717f0"]
}, Closed]],

Cell[CellGroupData[{

Cell["Rescaling cost function", "Subsection",
 CellChangeTimes->{{3.8479447175456133`*^9, 
  3.8479447288831964`*^9}},ExpressionUUID->"2184192a-1ef0-4561-bc28-\
988e9ababdfe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CostFunction2", "[", 
   RowBox[{"oc_", ",", 
    RowBox[{"{", 
     RowBox[{"g0_", ",", "g1_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cost", ",", "ocg0", ",", "ocg1", ",", "ocg"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ocg0", "=", 
      RowBox[{"oc", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"g0", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{"g0", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{
        "g0", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
       "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ocg1", "=", 
      RowBox[{"oc", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"g1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{"g1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{
        "g1", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
       "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ocg", "=", 
      RowBox[{"Min", "[", 
       RowBox[{"ocg1", ",", "ocg0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ocg", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"ocg0", "+", "ocg1"}], ")"}], "/", "2"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{"Exp", "[", 
       RowBox[{"-", 
        RowBox[{"Ramp", "[", 
         RowBox[{"oc", "-", "ocg"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "cost", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellLabel->"In[80]:=",ExpressionUUID->"283cb884-27a5-4c4d-bb73-e01092093d5c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ToContinuousAngle", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "\[Theta]d_"}], "}"}], ",", "s\[Theta]_"}],
    "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"x", ",", "y", ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"\[Theta]d", "-", "1"}], ")"}], "s\[Theta]"}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ToDiscreteAngle", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "\[Theta]c_"}], "}"}], ",", "s\[Theta]_"}],
    "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"x", ",", "y", ",", 
    RowBox[{
     RowBox[{"\[Theta]c", "/", "s\[Theta]"}], "+", "1"}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.797068872444806*^9, 3.7970689682551284`*^9}, {
  3.8477709300985203`*^9, 3.847770931063661*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"e99c8b65-6a5a-4a4e-97e7-e03cac5b3c60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AddObstaclesCrossings", "[", 
   RowBox[{
   "cost_", ",", "obstacleCenter_", ",", "obstacleWidth_", ",", 
    "obstacleHeight_", ",", "Nx_", ",", 
    RowBox[{"scaling_", ":", "10"}], ",", 
    RowBox[{"grayValueCriteria_", ":", ".8"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "newcost", ",", "xmin", ",", "xmax", ",", "ymin", ",", "ymax", ",", 
      "i"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newcost", "=", "cost"}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "<=", 
        RowBox[{"Length", "[", "obstacleCenter", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xmin", "=", 
         RowBox[{"Round", "[", 
          RowBox[{"Nx", "-", 
           RowBox[{"obstacleCenter", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", 
           RowBox[{"obstacleHeight", "/", "2"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xmax", "=", 
         RowBox[{"Round", "[", 
          RowBox[{"Nx", "-", 
           RowBox[{"obstacleCenter", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "2"}], "]"}], "]"}], "+", 
           RowBox[{"obstacleHeight", "/", "2"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ymin", "=", 
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"obstacleCenter", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "-", 
           RowBox[{"obstacleWidth", "/", "2"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ymax", "=", 
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"obstacleCenter", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "+", 
           RowBox[{"obstacleWidth", "/", "2"}]}], "]"}]}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"{", 
            RowBox[{"xmin", ",", "xmax", ",", "ymin", ",", "ymax"}], "}"}], 
           "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"newcost", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"xmin", ";;", "xmax"}], ",", 
            RowBox[{"ymin", ";;", "ymax"}]}], "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Clip", "[", 
             RowBox[{
              RowBox[{"cost", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"xmin", ";;", "xmax"}], ",", 
                 RowBox[{"ymin", ";;", "ymax"}]}], "]"}], "]"}], "/", 
              "grayValueCriteria"}], "]"}], "/.", 
            RowBox[{
             RowBox[{"x_", "/;", 
              RowBox[{"x", "==", "1"}]}], "\[Rule]", "scaling"}]}], ")"}], 
          "*", "grayValueCriteria"}]}], ";"}]}], "\[IndentingNewLine]", "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "newcost", "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8582335225335665`*^9, 3.8582336216298285`*^9}, {
   3.8582336542935967`*^9, 3.858233744879365*^9}, {3.858233940013635*^9, 
   3.8582340294253044`*^9}, {3.8582341334636493`*^9, 3.858234139214013*^9}, {
   3.85823429485408*^9, 3.8582343147253714`*^9}, {3.8582343796541233`*^9, 
   3.8582344290743575`*^9}, 3.8582350510146756`*^9, {3.858235273535246*^9, 
   3.858235286184969*^9}, {3.8582356842557554`*^9, 3.8582356860655136`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"7f296da0-07d1-432a-9fea-dd417db4fbad"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Fast Marching", "Section",
 CellChangeTimes->{{3.8713713078455677`*^9, 
  3.871371310838002*^9}},ExpressionUUID->"d91aa170-bb59-4512-ab12-\
5fbea15a427e"],

Cell[CellGroupData[{

Cell["Functions Fast Marching", "Subsection",
 CellChangeTimes->{{3.822110303531454*^9, 3.8221103065235343`*^9}, {
   3.8223827579517393`*^9, 3.8223827615982943`*^9}, 3.826164735597618*^9, {
   3.8261647810722127`*^9, 3.8261647879930415`*^9}, {3.849162773878948*^9, 
   3.849162774776081*^9}},ExpressionUUID->"fc9580d2-ebdf-404f-86e9-\
aa67a0d9a15e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "If", " ", "Mathematica", " ", "does", " ", "not", " ", "automatically", 
     " ", "find", " ", "the", " ", "correct", " ", "Python", " ", 
     "executable"}], ",", " ", 
    RowBox[{
    "uncomment", " ", "the", " ", "following", " ", "and", " ", "enter", " ", 
     "the", " ", "path", " ", "to", " ", "the", " ", "correct", " ", 
     RowBox[{"executable", "."}]}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"RegisterExternalEvaluator", "[", 
     RowBox[{
     "\"\<Python\>\"", ",", " ", 
      "\"\<C:\\\\Users\\\\s149687\\\\.conda\\\\envs\\\\adg-hfm\\\\python.exe\>\
\""}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Start", " ", "a", " ", "Python", " ", "session"}], ",", " ", 
    RowBox[{
    "make", " ", "sure", " ", "it", " ", "is", " ", "in", " ", "the", " ", 
     "correct", " ", "environment"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"python", " ", "=", " ", 
   RowBox[{"StartExternalSession", "[", "\"\<Python\>\"", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.820125321256993*^9, 3.8201254545001125`*^9}, {
  3.8201271395596027`*^9, 3.820127142132042*^9}, {3.8201271743780355`*^9, 
  3.8201272507333117`*^9}, {3.8201273527663746`*^9, 3.8201274033529153`*^9}, {
  3.8201274475762434`*^9, 3.8201275339970007`*^9}, {3.820127614739856*^9, 
  3.820127662492446*^9}, {3.8201277091113687`*^9, 3.820127773912282*^9}, {
  3.8202233666834836`*^9, 3.8202233680350533`*^9}, {3.82022341786358*^9, 
  3.8202234367848043`*^9}, {3.8491763459991865`*^9, 3.8491763503410206`*^9}, {
  3.84923714878611*^9, 3.8492371603271275`*^9}, {3.851410053656026*^9, 
  3.8514100562162437`*^9}, {3.851410152931374*^9, 3.8514101533855853`*^9}, {
  3.8718355475579567`*^9, 
  3.871835554833029*^9}},ExpressionUUID->"6e6a4f6d-6126-4aa0-a991-\
f3b3bcde9287"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Import", " ", "AGD", " ", "package"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"ExternalEvaluate", "[", 
   RowBox[{
   "python", ",", " ", 
    "\"\<\nfrom agd import Eikonal\nfrom agd.Metrics import AsymQuad,Riemann \
# Riemannian metric and Asymmetric Quadratic Models\nfrom agd import \
AutomaticDifferentiation as ad\nfrom agd import LinearParallel as lp\nfrom \
agd import FiniteDifferences as fd\n\nfrom agd.LinearParallel import \
outer_self as Outer # outer product v v^T of a vector with itself\nnorm = \
ad.Optimization.norm\nimport numpy as np; xp=np\n\>\""}], "]"}]}]], "Input",
 CellChangeTimes->{{3.820125321256993*^9, 3.8201254545001125`*^9}, {
  3.8201271395596027`*^9, 3.820127142132042*^9}, {3.8201271743780355`*^9, 
  3.8201272507333117`*^9}, {3.8201273527663746`*^9, 3.8201274033529153`*^9}, {
  3.8201274475762434`*^9, 3.8201275339970007`*^9}, {3.8201275643401017`*^9, 
  3.8201275647252617`*^9}, {3.820127885690318*^9, 3.820127897058759*^9}, {
  3.8201279685886774`*^9, 3.8201279688230104`*^9}, {3.820129081257738*^9, 
  3.820129120027542*^9}, {3.820928814003272*^9, 3.8209288172876716`*^9}, {
  3.849239939911605*^9, 3.8492399437492023`*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"eae8b7a0-58d5-4d0d-a1b6-a073a2bb4ef6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "Define", " ", "the", " ", "Python", " ", "function", " ", "that", " ", 
     "we", " ", "will", " ", "call", " ", "from", " ", "Mathematica"}], ",", 
    " ", 
    RowBox[{"take", " ", "care", " ", "of", " ", 
     RowBox[{"indentation", ".", "\[IndentingNewLine]", "We"}], " ", "use", 
     " ", 
     RowBox[{"Mathematica", "'"}], "s", " ", "automatic", " ", "conversion", 
     " ", "of", " ", "NumPy", " ", "arrays", " ", "to", " ", "do", " ", "the",
      " ", "heavy", " ", "lifting", " ", "of", " ", "converting", " ", "the", 
     " ", 
     RowBox[{"data", ".", "\[IndentingNewLine]", "Note"}], " ", "that", " ", 
     "this", " ", "function", " ", "returns", " ", "a", " ", "list", " ", 
     "of", " ", "Numeric", " ", "arrays"}], ",", " ", 
    RowBox[{
    "they", " ", "can", " ", "be", " ", "converted", " ", "to", " ", 
     "conventional", " ", "lists", " ", "using", " ", 
     RowBox[{
      RowBox[{"Normal", "[", "]"}], "."}]}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "function", " ", "is", " ", "used", " ", "for", " ", "the", 
    " ", "symmetric", " ", 
    RowBox[{"tracking", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"runReedsSheppGFHeightGeos", "=", 
    RowBox[{"ExternalFunction", "[", 
     RowBox[{
     "python", ",", 
      "\"\<\ndef runReedsSheppHeightGeos(sides, dims, seeds, tips, metric):\n\
\tmetric = Riemann(xp.array(metric))\n\thfmIn = Eikonal.dictIn({\n\t\t'model' \
: 'Riemann3_Periodic',\n        'exportValues':1,\n\t\t'seeds' : seeds,\n\t\t\
'arrayOrdering' : 'RowMajor',\n\t\t'tips' : tips,\n\t\t'metric' : metric,\n\t\
})\n\thfmIn.SetRect(sides = sides, dims = dims)\n\tif hfmIn.mode=='gpu': \
hfmIn.update({'model':'Riemann3','periodic':(False,False,True)})\n\thfmOut = \
hfmIn.Run()\n\tgeos = [g.T for g in hfmOut['geodesics']]\n\theight = \
hfmOut['values']\n\tprint('Done.')\n\treturn height,geos\n  \>\""}], "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.8201304232231817`*^9, 3.820130569968113*^9}, {
   3.8201306124147415`*^9, 3.820130613991995*^9}, {3.820130700684152*^9, 
   3.820130737748852*^9}, {3.820130805555653*^9, 3.820130864321076*^9}, {
   3.8201309615625486`*^9, 3.8201309797471185`*^9}, {3.820131035638226*^9, 
   3.8201310473103657`*^9}, {3.820131079917287*^9, 3.8201311115355825`*^9}, {
   3.820131186079157*^9, 3.8201311974343433`*^9}, {3.8201312699670553`*^9, 
   3.82013139257452*^9}, {3.8201314908224688`*^9, 3.8201315365019693`*^9}, {
   3.8201315799561415`*^9, 3.8201316534249067`*^9}, {3.820131870248514*^9, 
   3.8201318746764193`*^9}, {3.8201319074944673`*^9, 3.820132030797908*^9}, {
   3.8201351026338606`*^9, 3.8201351213449125`*^9}, {3.820135302549767*^9, 
   3.8201353474741726`*^9}, {3.8201353945097885`*^9, 
   3.8201354974298277`*^9}, {3.820135551344601*^9, 3.820135577026862*^9}, {
   3.82013564777822*^9, 3.8201356497250175`*^9}, {3.820135865533763*^9, 
   3.8201358697464256`*^9}, {3.820135926119074*^9, 3.8201359292849417`*^9}, {
   3.820135981914107*^9, 3.8201359889499083`*^9}, {3.8201360609318676`*^9, 
   3.8201360751585073`*^9}, {3.8201361241784925`*^9, 3.820136131451902*^9}, {
   3.820136268861762*^9, 3.8201362875226264`*^9}, {3.8201363998906994`*^9, 
   3.8201364122017074`*^9}, {3.8201364449866743`*^9, 3.820136446785804*^9}, {
   3.820136634146022*^9, 3.82013663563336*^9}, {3.820136703774701*^9, 
   3.8201367871729517`*^9}, {3.8201368200480833`*^9, 
   3.8201368268024244`*^9}, {3.820137087102256*^9, 3.820137087474943*^9}, {
   3.8201373689328556`*^9, 3.8201374880788665`*^9}, {3.820224152460229*^9, 
   3.820224154328909*^9}, {3.8203109585396037`*^9, 3.8203109820245237`*^9}, {
   3.8203142278014083`*^9, 3.8203142343818607`*^9}, {3.822110946097468*^9, 
   3.8221109651412354`*^9}, 3.8221111091603217`*^9, {3.8241839691163025`*^9, 
   3.8241839711444426`*^9}, 3.824184010160927*^9, {3.827567319382126*^9, 
   3.8275673202332983`*^9}, {3.827567360037774*^9, 3.827567360205397*^9}, {
   3.8275708004454603`*^9, 3.8275708050995817`*^9}, {3.8469133181080637`*^9, 
   3.84691335071708*^9}, {3.8469163619821596`*^9, 3.846916362857004*^9}, {
   3.8469166786396465`*^9, 3.84691668018594*^9}, {3.846916917205605*^9, 
   3.8469169202622066`*^9}, {3.8469172694166856`*^9, 
   3.8469172771979465`*^9}, {3.8469175088929543`*^9, 
   3.8469175131000185`*^9}, {3.8469177449967785`*^9, 3.846917745154958*^9}, {
   3.8486732388598843`*^9, 3.8486732525090632`*^9}, 
   3.8718355133033147`*^9},ExpressionUUID->"f8e72336-8c3b-4ebb-821b-\
21b7237b423b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "Define", " ", "the", " ", "Python", " ", "function", " ", "that", " ", 
     "we", " ", "will", " ", "call", " ", "from", " ", "Mathematica"}], ",", 
    " ", 
    RowBox[{"take", " ", "care", " ", "of", " ", 
     RowBox[{"indentation", ".", "\[IndentingNewLine]", "We"}], " ", "use", 
     " ", 
     RowBox[{"Mathematica", "'"}], "s", " ", "automatic", " ", "conversion", 
     " ", "of", " ", "NumPy", " ", "arrays", " ", "to", " ", "do", " ", "the",
      " ", "heavy", " ", "lifting", " ", "of", " ", "converting", " ", "the", 
     " ", 
     RowBox[{"data", ".", "\[IndentingNewLine]", "Note"}], " ", "that", " ", 
     "this", " ", "function", " ", "returns", " ", "a", " ", "list", " ", 
     "of", " ", "Numeric", " ", "arrays"}], ",", " ", 
    RowBox[{
    "they", " ", "can", " ", "be", " ", "converted", " ", "to", " ", 
     "conventional", " ", "lists", " ", "using", " ", 
     RowBox[{
      RowBox[{"Normal", "[", "]"}], ".", "\[IndentingNewLine]", "This"}], " ",
      "function", " ", "models", " ", "the", " ", "forward", " ", "gear", " ",
      "variant", " ", "of", " ", "the", " ", "Reeds", " ", "Shepp", " ", 
     "Model", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
        "both", " ", "using", " ", "the", " ", "gauge", " ", "frame", " ", 
         "and", " ", "left", " ", "invariant", " ", "frame"}], ",", " ", 
        RowBox[{
        "depending", " ", "on", " ", "the", " ", "metric", " ", "that", " ", 
         "is", " ", "entered"}]}], ")"}], "."}]}]}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"used", " ", 
     RowBox[{"variables", ":", " ", "cost"}]}], ",", " ", "tips", ",", " ", 
    "D", ",", " ", "w", ",", " ", "seeds", ",", " ", "sides", ",", " ", "n"}],
    " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "function", " ", "is", " ", "used", " ", "for", " ", "the", 
    " ", "asymmetric", " ", 
    RowBox[{"(", 
     RowBox[{"forward", " ", "gear"}], ")"}], " ", 
    RowBox[{"tracking", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "=", 
    RowBox[{"ExternalFunction", "[", 
     RowBox[{
     "python", ",", 
      "\"\<\ndef \
runReedsSheppForwardGFMultipleGeos(dimsSingle,metricSingle,wSingle,\
sidesSingle,seedsSingle,tipsSingle,eps,mult):\n\ttipsSingle = \
xp.array(tipsSingle)\n\tseedsSingle = xp.array(seedsSingle)\n\tsidesSingle = \
xp.array(sidesSingle)\n\tmetricSingle = xp.array(metricSingle)\n\twSingle = \
xp.array(wSingle)\n\t\n\tprint('Finished loading all data')\n\t\n\tdims = \
np.array([dimsSingle[0],dimsSingle[1],dimsSingle[2]*mult])\n\tsides = \
np.array([sidesSingle[0],sidesSingle[1],[sidesSingle[2,0],(sidesSingle[2,1]+2*\
np.pi/dimsSingle[2])*mult-2*np.pi/dimsSingle[2]]])\n\n\t# repetition of tips, \
seeds, metrics\n\tmultiplicitytips= np.zeros([mult,tipsSingle.shape[1]])\n\t\
multiplicitytips[:,2]=np.arange(multiplicitytips.shape[0])\n\t\
tips=np.tile(tipsSingle.T,mult).T+np.repeat(np.array(multiplicitytips)*2*np.\
pi,repeats=tipsSingle.shape[0],axis=0)\n\n\tmultiplicityseeds= \
np.zeros([mult,seedsSingle.shape[1]])\n\t\
multiplicityseeds[:,2]=np.arange(multiplicityseeds.shape[0])\n\t\
seeds=np.tile(seedsSingle.T,mult).T+np.repeat(np.array(multiplicityseeds)*2*\
np.pi,repeats=seedsSingle.shape[0],axis=0)\n\n\tmetric= \
np.tile(metricSingle,mult)\n\n\tprint('metric',metric.shape)\n\n\t\
wSingleTranspose = np.transpose(wSingle,(0,1,3,2))\n\twTranspose = \
np.tile(wSingleTranspose,mult)\n\tw = np.transpose(wTranspose,(2,0,1,3))\n\n\t\
print('w',w.shape)\n\n\tprint('Finished duplicating arrays and matrices to \
mirror angular periodicity')\n\n\thfmIn = Eikonal.dictIn({\n\t\t\
'model':'AsymmetricQuadratic3',\n\t\t'exportValues':1,\n\t\t'seeds':seeds,\n\t\
})\n\n\t# Define the domain\n\thfmIn.SetRect(sides = sides, dims = dims)\n\t\
hfmIn['tips']=tips.tolist()\n\thfmIn['eps'] = eps\n\tX,Y,Theta=hfmIn.Grid()\n\
\n\tif hfmIn.mode=='gpu': \\\\\n\t\
hfmIn.update({'model':'AsymmetricQuadratic3','periodic':(False,False,True)})\n\
\thfmIn['metric']= AsymQuad(metric,-np.sqrt(1-eps**2)*w)\n\tprint('Data \
defined in Fast-Marching code')\n\thfmOut = hfmIn.Run()\n\n\t\
print('Calculating paths and volume done')\n\n\t# select shortest path from \
tip to seed (without multiplicity)\n\t# switch from continuous angles to \
discrete angles\n\tcontinuousAngle=tips[:,2]\n\t\
discreteAngle=np.zeros(continuousAngle.shape)\n\tfor k in \
range(len(continuousAngle)):\n\t\t\
discreteAngle[k]=np.abs(Theta-continuousAngle[k]).argmin()#np.where(Theta==\
continuousAngle[k])[2][0]\n\ttipsDiscrete=np.zeros(tips.shape)\n\t\
tipsDiscrete[:,:2]=tips[:,:2]\n\ttipsDiscrete[:,2]=discreteAngle\n\n\t# \
determine length of paths\n\tvalues = hfmOut['values']\n\t\
valueslist=np.zeros(tips.shape[0])\n\tfor i in range(valueslist.shape[0]):\n\t\
\tvalueslist[i]=values[round(tipsDiscrete[i,0]),round(tipsDiscrete[i,1]),\
round(tipsDiscrete[i,2])]\n\t\n\t# find indices of tips with shortest paths\n\
\tindexShortestPath=np.reshape(valueslist,(tipsSingle.shape[0],mult),order='F'\
).argmin(axis=1)\n\t\
indexShortestPath_new=indexShortestPath*len(indexShortestPath)+np.arange(len(\
indexShortestPath))\n\t\n\t# pick correct shortest path\n\tgeos = [g.T for g \
in hfmOut['geodesics']]\n\tgeosSelection=[geos[indexShortestPath_new[0]]]\n\t\
for j in range(len(indexShortestPath)-1):\n\t\t\
geosSelection.append(geos[indexShortestPath_new[j+1]])\n\tprint('Selecting \
correct paths done')\n\n\tprint('Done.')\n\treturn values,geosSelection\n  \>\
\""}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.8237552489725246`*^9, 3.8237553006852083`*^9}, {
   3.8237558963172684`*^9, 3.823755896522479*^9}, {3.8237559473556232`*^9, 
   3.823755958245423*^9}, {3.8237560610455017`*^9, 3.823756062565624*^9}, {
   3.8237563767415247`*^9, 3.8237563976212735`*^9}, {3.823756762969249*^9, 
   3.8237567964588184`*^9}, {3.823756986937766*^9, 3.8237569882804976`*^9}, {
   3.8237648531915836`*^9, 3.8237649668717284`*^9}, {3.8237777734238358`*^9, 
   3.823777831424363*^9}, {3.82377787003465*^9, 3.823777949824373*^9}, {
   3.8237779961654563`*^9, 3.8237780639925594`*^9}, {3.8237781111468005`*^9, 
   3.823778133640845*^9}, {3.823778724926865*^9, 3.82377874993676*^9}, {
   3.8237791206450443`*^9, 3.8237791325248256`*^9}, {3.823925569226306*^9, 
   3.823925572937559*^9}, 3.8239256141478567`*^9, {3.824109366427225*^9, 
   3.8241093734142003`*^9}, {3.824110474608915*^9, 3.82411047766619*^9}, {
   3.824110538271643*^9, 3.8241105421229067`*^9}, {3.8241865918851447`*^9, 
   3.824186611677169*^9}, {3.824186702353634*^9, 3.8241867085728207`*^9}, 
   3.824186769055394*^9, {3.824188043335567*^9, 3.8241880466871595`*^9}, {
   3.8245298288837047`*^9, 3.8245298378455343`*^9}, {3.824529907854786*^9, 
   3.8245299141293983`*^9}, {3.824530106409525*^9, 3.824530128065013*^9}, {
   3.82453018960596*^9, 3.824530192720166*^9}, {3.827567365561261*^9, 
   3.8275673704050426`*^9}, 3.82757290966915*^9, {3.8275732197467394`*^9, 
   3.8275732236116657`*^9}, {3.830327230737608*^9, 3.830327246456808*^9}, {
   3.8303304408438873`*^9, 3.830330667596264*^9}, {3.8303309343981524`*^9, 
   3.8303309518081207`*^9}, {3.830330984379562*^9, 3.8303311619255085`*^9}, {
   3.8303312716572475`*^9, 3.830331308742258*^9}, {3.830332156706267*^9, 
   3.8303321672193203`*^9}, {3.830332355528077*^9, 3.8303323945606318`*^9}, {
   3.8303419090135965`*^9, 3.8303421465153875`*^9}, {3.8303422411705103`*^9, 
   3.830342244457903*^9}, {3.83034231499903*^9, 3.8303423558346667`*^9}, {
   3.8303424396599903`*^9, 3.830342456243523*^9}, {3.8303441263380632`*^9, 
   3.8303441660442424`*^9}, {3.830344227711121*^9, 3.830344247948717*^9}, {
   3.830344322476514*^9, 3.8303444798162365`*^9}, {3.8303445227019453`*^9, 
   3.8303445696338825`*^9}, {3.830344680272291*^9, 3.830344720805067*^9}, {
   3.8303449979136877`*^9, 3.8303450493979588`*^9}, {3.830345193256342*^9, 
   3.830345292493513*^9}, {3.8303454311370173`*^9, 3.8303454487992334`*^9}, {
   3.830345586327524*^9, 3.8303455871876483`*^9}, {3.830354100430665*^9, 
   3.8303543524279637`*^9}, {3.8303608493213778`*^9, 3.830360900405203*^9}, 
   3.830361835430729*^9, {3.830363344765514*^9, 3.830363366919513*^9}, {
   3.8303643568051414`*^9, 3.8303644170790353`*^9}, {3.8303649109410243`*^9, 
   3.830364913097439*^9}, {3.830397776115281*^9, 3.8303980248443527`*^9}, 
   3.8303985066956854`*^9, {3.830400600899767*^9, 3.830400656774723*^9}, {
   3.8304019714873247`*^9, 3.8304020168229384`*^9}, {3.830402505037264*^9, 
   3.830402508696271*^9}, {3.830402573160678*^9, 3.830402596233473*^9}, {
   3.8304032334685774`*^9, 3.8304032356756277`*^9}, {3.8304040551616354`*^9, 
   3.830404058072667*^9}, {3.830404262104557*^9, 3.830404313167634*^9}, {
   3.83040437373954*^9, 3.8304044183174486`*^9}, {3.83040526666393*^9, 
   3.830405269974535*^9}, {3.83040592763944*^9, 3.830405931287908*^9}, {
   3.830405970482778*^9, 3.830406074336563*^9}, {3.8304068517446723`*^9, 
   3.830406852262249*^9}, {3.830407826444729*^9, 3.830407828678835*^9}, {
   3.830408390371539*^9, 3.8304084011736803`*^9}, 3.8304084813981943`*^9, {
   3.830411064677002*^9, 3.830411070004549*^9}, {3.8304128058041663`*^9, 
   3.830412806403449*^9}, 3.830416528167105*^9, {3.83041780096748*^9, 
   3.8304179701414366`*^9}, {3.8304197015751057`*^9, 
   3.8304197395843534`*^9}, {3.8304207445018325`*^9, 
   3.8304207451186147`*^9}, {3.8304851042868576`*^9, 
   3.8304851409024053`*^9}, {3.8304851892834177`*^9, 
   3.8304852317668104`*^9}, {3.8309451347226477`*^9, 3.830945160255487*^9}, {
   3.8473455615090027`*^9, 3.847345564293126*^9}, {3.847345993803294*^9, 
   3.847345994341088*^9}, {3.8486515075466547`*^9, 3.8486515349142394`*^9}, {
   3.8492400297205887`*^9, 3.849240035348284*^9}, {3.8492400856615543`*^9, 
   3.8492400858342953`*^9}, 
   3.8718355219480047`*^9},ExpressionUUID->"4ad85d26-bceb-4ceb-82aa-\
e1b116787d89"]
}, Closed]],

Cell[CellGroupData[{

Cell["Metric Functions", "Subsection",
 CellChangeTimes->{{3.8716368185487485`*^9, 
  3.8716368208916297`*^9}},ExpressionUUID->"9dee6611-b1f2-474a-8cd6-\
f0906f5379a9"],

Cell[CellGroupData[{

Cell["General Metric Functions", "Subsubsection",
 CellChangeTimes->{{3.8491628464528065`*^9, 
  3.849162850168598*^9}},ExpressionUUID->"ef9893da-d840-4e3a-9205-\
79881e013f70"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OuterProd", "[", "v_", "]"}], " ", ":=", " ", 
   RowBox[{"TensorProduct", "[", 
    RowBox[{"v", ",", " ", "v"}], "]"}]}], ";"}]], "Input",
 CellLabel->"In[89]:=",ExpressionUUID->"272567ea-ec42-4696-81f5-ed6cde462aff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GGF", "[", 
   RowBox[{
   "g11_", ",", "g22_", ",", "g33_", ",", "GFtoLIFinv_", ",", 
    "LIFtoEuclideaninv_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"GF", ",", "G", ",", "transformMatrix"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GF", "=", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"{", 
        RowBox[{"g11", ",", "g22", ",", "g33"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"transformMatrix", "=", 
      RowBox[{"LIFtoEuclideaninv", ".", "GFtoLIFinv"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"G", "=", 
      RowBox[{"transformMatrix", ".", "GF", ".", 
       RowBox[{"Transpose", "[", "transformMatrix", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "G", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8237797814540014`*^9, 3.8237800021220217`*^9}, {
   3.823843686445279*^9, 3.8238436881721816`*^9}, {3.823861389851432*^9, 
   3.823861476167248*^9}, {3.823864032680152*^9, 3.823864038313194*^9}, 
   3.8239456404278636`*^9, {3.8239460488547487`*^9, 3.8239460913027735`*^9}, {
   3.8242079220779*^9, 3.824207933252*^9}, 3.8244657205844965`*^9, {
   3.824465875507021*^9, 3.824465876885784*^9}, {3.8244660573965406`*^9, 
   3.82446607206036*^9}, {3.824466189062105*^9, 3.824466207883562*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"ccae8fbc-3c00-4c05-86ae-c646a3490905"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GLIFtoEuclideanOld", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", 
       RowBox[{"Sin", "[", "\[Theta]", "]"}], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
       RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8238634641757145`*^9, 3.8238635586417055`*^9}, {
   3.824208088089237*^9, 3.8242080907412157`*^9}, {3.824208194678382*^9, 
   3.824208196632406*^9}, {3.828605454641837*^9, 3.8286054568906045`*^9}, {
   3.8313963409979277`*^9, 3.8313963473145933`*^9}, 3.8520900092354703`*^9},
 CellLabel->"In[91]:=",ExpressionUUID->"5ef5d6ed-983b-4110-9e78-cf2e3b23b2fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"IncludeCost", "[", 
   RowBox[{"cost_", ",", "metric_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "metricCost", ",", "metricTranspose", ",", "metricCostTranspose"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"metricTranspose", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"metric", ",", 
        RowBox[{"{", 
         RowBox[{"4", ",", "5", ",", "1", ",", "2", ",", "3"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"metricCost", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "*", 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         "&"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"metricTranspose", ",", "cost"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{
      "multiply", " ", "the", " ", "metric", " ", "at", " ", "a", " ", 
       "specific", " ", "point", " ", "with", " ", "the", " ", "value", " ", 
       "of", " ", "the", " ", "cost", " ", "function", " ", "on", " ", "that",
        " ", "specific", " ", "location"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"metricCostTranspose", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"metricCost", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"N", "[", "metricCostTranspose", "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8238785120764894`*^9, 3.823878583450979*^9}, {
   3.8238786359535503`*^9, 3.823878686533272*^9}, {3.8238799493416433`*^9, 
   3.823880048584467*^9}, {3.823880108278309*^9, 3.8238801227910447`*^9}, {
   3.82388015494582*^9, 3.8238801723558607`*^9}, 3.8238806225641785`*^9, {
   3.823946890655205*^9, 3.823946913073385*^9}, {3.823948064535144*^9, 
   3.82394806848734*^9}, {3.8242165886827917`*^9, 3.8242166161133537`*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"4c299361-67b5-4438-8b18-f160b40bc77d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Metric Functions Symmetric in LIF", "Subsubsection",
 CellChangeTimes->{{3.822110303531454*^9, 3.8221103065235343`*^9}, {
   3.8223827579517393`*^9, 3.8223827615982943`*^9}, 3.826164735597618*^9, {
   3.84916278009284*^9, 3.8491627808666334`*^9}, {3.849162975600747*^9, 
   3.8491629779073086`*^9}},ExpressionUUID->"5f049965-b1e7-4b06-9056-\
95b8fddb7a2e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReedsSheppMetricGFOld", "[", 
   RowBox[{"GF_", ",", 
    RowBox[{"{", 
     RowBox[{"nx_", ",", "ny_", ",", "nt_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "metric", ",", "metricTransposed", ",", "t0Int", ",", "t1Int", ",", 
      "GFinv", ",", "LIFtoEuclidean", ",", "LIFtoEuclideaninv"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GFinv", "=", 
      RowBox[{"N", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", "#", "]"}], "&"}], ",", "GF", ",", 
         RowBox[{"{", "3", "}"}]}], "]"}], "]"}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "LIF", " ", "basis", " ", "in", " ", "terms", " ", "of", " ", "gauge", 
        " ", "basis"}], ";", " ", 
       RowBox[{
       "GF", " ", "denotes", " ", "gauge", " ", "basis", " ", "in", " ", 
        "terms", " ", "of", " ", "LIF", " ", "basis"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"LIFtoEuclidean", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"GLIFtoEuclideanOld", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"t", "-", "1"}], ")"}], "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"2", "\[Pi]"}], ")"}], "/", "nt"}], ")"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", "1", ",", "nt"}], "}"}]}], "]"}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{
      "LIF", " ", "basis", " ", "in", " ", "terms", " ", "of", " ", "static", 
       " ", "basis"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"LIFtoEuclideaninv", "=", 
      RowBox[{"N", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", "#", "]"}], "&"}], ",", "LIFtoEuclidean", 
         ",", 
         RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{
      "static", " ", "basis", " ", "in", " ", "terms", " ", "of", " ", "LIF", 
       " ", "basis"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"metric", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"GGF", "[", 
         RowBox[{"g11", ",", "g22", ",", "g33", ",", 
          RowBox[{"GFinv", "\[LeftDoubleBracket]", 
           RowBox[{"x", ",", "y", ",", "t"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
          "LIFtoEuclideaninv", "\[LeftDoubleBracket]", "t", 
           "\[RightDoubleBracket]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"x", ",", " ", "1", ",", "nx"}], "}"}], ",", "  ", 
        RowBox[{"(*", 
         RowBox[{
         "x", " ", "takes", " ", "values", " ", "1", " ", "to", " ", "Nx"}], 
         "*)"}], "\n", "     ", 
        RowBox[{"{", 
         RowBox[{"y", ",", " ", "1", ",", " ", "ny"}], "}"}], ",", " ", 
        RowBox[{"(*", 
         RowBox[{
         "y", " ", "takes", " ", "values", " ", "1", " ", "to", " ", "Ny"}], 
         "*)"}], "\n", "     ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "1", ",", " ", "nt"}], "}"}]}], "]"}]}], ";", 
     " ", 
     RowBox[{"(*", 
      RowBox[{
      "t", " ", "takes", " ", "values", " ", "1", " ", "to", " ", "2", 
       "N\[Theta]"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"metricTransposed", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"metric", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"N", "[", "metricTransposed", "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.823863250308508*^9, 3.8238633675854063`*^9}, {
   3.8238634057882123`*^9, 3.82386349097758*^9}, {3.823863627769211*^9, 
   3.8238637019418497`*^9}, {3.823864018234191*^9, 3.8238640193405714`*^9}, {
   3.8238640573466854`*^9, 3.823864083417515*^9}, {3.82386451745893*^9, 
   3.8238645193495526`*^9}, {3.8238645528181915`*^9, 
   3.8238645927574916`*^9}, {3.823864742472515*^9, 3.8238648698602953`*^9}, {
   3.823865051736315*^9, 3.8238650621795955`*^9}, {3.823866416981224*^9, 
   3.8238666633748913`*^9}, {3.82388306215502*^9, 3.8238830640405006`*^9}, {
   3.8238831971945353`*^9, 3.8238831986085873`*^9}, {3.823945526096771*^9, 
   3.823945663237444*^9}, {3.8239458365921593`*^9, 3.823945846273732*^9}, {
   3.823945896207765*^9, 3.823945916632061*^9}, {3.8239459789038677`*^9, 
   3.823946023944131*^9}, {3.8239461983211884`*^9, 3.823946207424012*^9}, {
   3.8239466067683277`*^9, 3.8239466223031654`*^9}, {3.8239480736154613`*^9, 
   3.8239480777862988`*^9}, {3.824107391754238*^9, 3.8241073923572493`*^9}, {
   3.824207366041005*^9, 3.824207393500676*^9}, {3.8242076022825255`*^9, 
   3.824207610924247*^9}, {3.8242077333616533`*^9, 3.824207801915064*^9}, {
   3.824207877294054*^9, 3.824207895630455*^9}, {3.8275678310514183`*^9, 
   3.82756783764839*^9}, {3.831193577778721*^9, 3.8311935824425106`*^9}, {
   3.8314585853906*^9, 3.8314585948292284`*^9}, 3.8314594470892067`*^9, {
   3.849236120689776*^9, 3.849236122062422*^9}, 3.84923617530412*^9, 
   3.849237929758955*^9, {3.8492381286641717`*^9, 3.8492381301138234`*^9}, {
   3.8492381782022886`*^9, 3.8492381788307247`*^9}, {3.8520046611773167`*^9, 
   3.852004662239869*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"f5ab9ea0-94e2-4c28-afa6-5d61a19128d7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Input", " ", "of", " ", "Fast", " ", "Marching", " ", "algorithm", " ", 
    "is", " ", "dual", " ", "metric", " ", "D"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetricMLIF", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Mpart", ",", "M", ",", "MD"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Mpart", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], ",", 
              RowBox[{
               SuperscriptBox["\[Xi]", "2"], "*", 
               SuperscriptBox["\[Zeta]", 
                RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Inverse", "[", 
             RowBox[{"GLIFtoEuclideanOld", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
               RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}], 
        "*", "\[Xi]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"Mpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "M"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "M", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8552142427129602`*^9, 3.8552142672415323`*^9}, {
   3.8552143399071913`*^9, 3.8552143491230307`*^9}, {3.855228377343495*^9, 
   3.855228378653138*^9}, 3.8552900229369445`*^9, {3.855292671692083*^9, 
   3.855292672787225*^9}, {3.857014615011263*^9, 3.8570146384648027`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"cd84eed8-dd95-444e-9ee3-817de28e3351"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Input", " ", "of", " ", "Fast", " ", "Marching", " ", "algorithm", " ", 
    "is", " ", "dual", " ", "metric", " ", "D"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetricDLIF", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Mpart", ",", "MDpart", ",", "M", ",", "MD"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Mpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"MDpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{"Mpart", "[", 
           RowBox[{"[", "\[Theta]", "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"MD", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"MDpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MD", "=", 
       RowBox[{
        SuperscriptBox["cost", 
         RowBox[{"-", "2"}]], "*", "MD"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "MD", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8552142427129602`*^9, 3.8552142672415323`*^9}, {
   3.8552143399071913`*^9, 3.8552143491230307`*^9}, {3.855228377343495*^9, 
   3.855228378653138*^9}, {3.855228535240492*^9, 3.8552285629680643`*^9}, {
   3.855228612904784*^9, 3.8552286176208954`*^9}, 3.8552890989281273`*^9, 
   3.855290027659279*^9, {3.855292675182274*^9, 3.8552926781573005`*^9}},
 CellLabel->"In[95]:=",ExpressionUUID->"59450278-f75b-4c17-b218-cb0dbe73e5db"]
}, Closed]],

Cell[CellGroupData[{

Cell["Metric Functions Forward Gear in LIF", "Subsubsection",
 CellChangeTimes->{{3.822110303531454*^9, 3.8221103065235343`*^9}, {
   3.8223827579517393`*^9, 3.8223827615982943`*^9}, 3.826164735597618*^9, {
   3.84916278009284*^9, 
   3.8491627808666334`*^9}},ExpressionUUID->"34e70cd3-c388-437d-b747-\
dfb980dd34b0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"MetricDvectorwLIF", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "wPart", ",", "MDpart", ",", "M", ",", "MD", ",", "w", ",", "wD"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wPart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              SqrtBox[
               RowBox[{
                SuperscriptBox["\[Xi]", "2"], "*", 
                RowBox[{"(", 
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", 
                   RowBox[{"-", "2"}]], "-", "1"}], ")"}]}]], "}"}], ",", 
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", "0", "}"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"MDpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Inverse", "[", 
             RowBox[{"GLIFtoEuclideanOld", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
                RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
               RowBox[{"\[Pi]", "/", "2"}]}], "]"}], "]"}], ".", 
            RowBox[{"DiagonalMatrix", "[", 
             RowBox[{"{", 
              RowBox[{
               SuperscriptBox["\[Xi]", "2"], ",", 
               RowBox[{
                SuperscriptBox["\[Xi]", "2"], "*", 
                SuperscriptBox["\[Zeta]", 
                 RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
            RowBox[{"Transpose", "[", 
             RowBox[{"Inverse", "[", 
              RowBox[{"GLIFtoEuclideanOld", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
                 RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
                RowBox[{"\[Pi]", "/", "2"}]}], "]"}], "]"}], "]"}]}], "+", 
           RowBox[{"OuterProd", "[", 
            RowBox[{"wPart", "[", 
             RowBox[{"[", "\[Theta]", "]"}], "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"wPart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MD", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"MDpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        SuperscriptBox["cost", 
         RowBox[{"-", "1"}]], "*", "w"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MD", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MD"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"MD", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8484649914884624`*^9, 3.848465022485238*^9}, {
   3.8484650659960604`*^9, 3.8484650871480384`*^9}, {3.848465146553982*^9, 
   3.848465280971162*^9}, {3.8484654284411354`*^9, 3.848465551970329*^9}, {
   3.8484656130501957`*^9, 3.8484657034822383`*^9}, {3.848465736311178*^9, 
   3.8484658852704844`*^9}, {3.8484659194628825`*^9, 
   3.8484659511832657`*^9}, {3.8484659892730427`*^9, 3.848465990990182*^9}, {
   3.8484660636358027`*^9, 3.8484660676116104`*^9}, {3.8484668482894077`*^9, 
   3.84846686567196*^9}, {3.8484669246080017`*^9, 3.8484669253562975`*^9}, {
   3.848467211343684*^9, 3.848467230467314*^9}, {3.8484672616991024`*^9, 
   3.8484673089283447`*^9}, {3.8484674309688835`*^9, 
   3.8484675041964474`*^9}, {3.8484677346841946`*^9, 
   3.8484677806343107`*^9}, {3.8484678125130987`*^9, 
   3.8484678250492134`*^9}, {3.848468486909953*^9, 3.8484684913165064`*^9}, {
   3.848468679828153*^9, 3.8484686821483655`*^9}, {3.848480460739128*^9, 
   3.8484804666428385`*^9}, {3.8484871270755568`*^9, 3.848487145552842*^9}, {
   3.848487180183468*^9, 3.848487185267514*^9}, {3.8485502373005924`*^9, 
   3.8485502420711794`*^9}, {3.8485587968333483`*^9, 
   3.8485588326472063`*^9}, {3.8485657772160683`*^9, 3.848565784112958*^9}, {
   3.8485662026896057`*^9, 3.84856621483272*^9}, {3.8485664486760798`*^9, 
   3.848566457312764*^9}, {3.848573117351256*^9, 3.8485731519788637`*^9}, {
   3.8485743643352375`*^9, 3.848574377666855*^9}, 3.8485745635278473`*^9, 
   3.8485748167341332`*^9, {3.8485763511828933`*^9, 3.848576386986167*^9}, {
   3.8485767103376865`*^9, 3.848576729555835*^9}, {3.848647564820961*^9, 
   3.848647573099467*^9}, 3.8486518121769505`*^9, 3.8486536523835993`*^9, {
   3.848657624219053*^9, 3.848657626153077*^9}, 3.8486585795121984`*^9, {
   3.8486732852891245`*^9, 3.8486732861975856`*^9}, {3.848678989091471*^9, 
   3.84867905573519*^9}, {3.8487210283982735`*^9, 3.8487211251553698`*^9}, {
   3.848721592339266*^9, 3.8487216555141764`*^9}, {3.8487217692873874`*^9, 
   3.848721769752118*^9}, {3.84872190243385*^9, 3.8487219095065084`*^9}, {
   3.848722375887209*^9, 3.8487223852439938`*^9}, {3.8487224761730275`*^9, 
   3.848722478003208*^9}, 3.8491642891234994`*^9, {3.849164441726801*^9, 
   3.8491644973660393`*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"f15b068e-2dbf-49ba-94f6-32f677f3d5a8"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"(*", 
   RowBox[{
   "Input", " ", "of", " ", "Fast", " ", "Marching", " ", "algorithm", " ", 
    "is", " ", "dual", " ", "metric", " ", "D"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetricMvectorwLIF", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "wPart", ",", "Mpart", ",", "M", ",", "MD", ",", "w", ",", "wD"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wPart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              SqrtBox[
               RowBox[{
                SuperscriptBox["\[Xi]", "2"], "*", 
                RowBox[{"(", 
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", 
                   RowBox[{"-", "2"}]], "-", "1"}], ")"}]}]], "}"}], ",", 
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", "0", "}"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Mpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
             RowBox[{"\[Pi]", "/", "2"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
               RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
              RowBox[{"\[Pi]", "/", "2"}]}], "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"wPart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"Mpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        SuperscriptBox["cost", 
         RowBox[{"-", "1"}]], "*", "w"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{
        SuperscriptBox["cost", 
         RowBox[{"-", "2"}]], "*", "M"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"M", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8484649914884624`*^9, 3.848465022485238*^9}, {
   3.8484650659960604`*^9, 3.8484650871480384`*^9}, {3.848465146553982*^9, 
   3.848465280971162*^9}, {3.8484654284411354`*^9, 3.848465551970329*^9}, {
   3.8484656130501957`*^9, 3.8484657034822383`*^9}, {3.848465736311178*^9, 
   3.8484658852704844`*^9}, {3.8484659194628825`*^9, 
   3.8484659511832657`*^9}, {3.8484659892730427`*^9, 3.848465990990182*^9}, {
   3.8484660636358027`*^9, 3.8484660676116104`*^9}, {3.8484668482894077`*^9, 
   3.84846686567196*^9}, {3.8484669246080017`*^9, 3.8484669253562975`*^9}, {
   3.848467211343684*^9, 3.848467230467314*^9}, {3.8484672616991024`*^9, 
   3.8484673089283447`*^9}, {3.8484674309688835`*^9, 
   3.8484675041964474`*^9}, {3.8484677346841946`*^9, 
   3.8484677806343107`*^9}, {3.8484678125130987`*^9, 
   3.8484678250492134`*^9}, {3.848468486909953*^9, 3.8484684913165064`*^9}, {
   3.848468679828153*^9, 3.8484686821483655`*^9}, {3.848480460739128*^9, 
   3.8484804666428385`*^9}, {3.8484871270755568`*^9, 3.848487145552842*^9}, {
   3.848487180183468*^9, 3.848487185267514*^9}, {3.8485502373005924`*^9, 
   3.8485502420711794`*^9}, {3.8485587968333483`*^9, 
   3.8485588326472063`*^9}, {3.8485657772160683`*^9, 3.848565784112958*^9}, {
   3.8485662026896057`*^9, 3.84856621483272*^9}, {3.8485664486760798`*^9, 
   3.848566457312764*^9}, {3.848573117351256*^9, 3.8485731519788637`*^9}, {
   3.8485743643352375`*^9, 3.848574377666855*^9}, 3.8485745635278473`*^9, 
   3.8485748167341332`*^9, {3.8485763511828933`*^9, 3.848576386986167*^9}, {
   3.8485767103376865`*^9, 3.848576729555835*^9}, {3.848647564820961*^9, 
   3.848647573099467*^9}, 3.8486518121769505`*^9, 3.8486536523835993`*^9, {
   3.848657624219053*^9, 3.848657626153077*^9}, 3.8486585795121984`*^9, {
   3.8486732852891245`*^9, 3.8486732861975856`*^9}, {3.848678989091471*^9, 
   3.84867905573519*^9}, {3.8487210283982735`*^9, 3.8487211251553698`*^9}, {
   3.848721592339266*^9, 3.8487216555141764`*^9}, {3.8487217692873874`*^9, 
   3.848721769752118*^9}, {3.84872190243385*^9, 3.8487219095065084`*^9}, {
   3.848722375887209*^9, 3.8487223852439938`*^9}, {3.8487224761730275`*^9, 
   3.848722478003208*^9}, 3.8491642891234994`*^9, {3.849164441726801*^9, 
   3.8491644973660393`*^9}, {3.849247102256665*^9, 3.8492471536267157`*^9}, 
   3.8514172186592736`*^9},
 CellLabel->"In[97]:=",ExpressionUUID->"661a7842-0e33-439c-ad0c-ee857a717ed3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Input", " ", "of", " ", "Fast", " ", "Marching", " ", "algorithm", " ", 
    "is", " ", 
    RowBox[{"(", "symmetric", ")"}], " ", "dual", " ", "metric", " ", "D"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetricDvectorwLIF", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "wPart", ",", "wDpart", ",", "Mpart", ",", "MDpart", ",", "M", ",", 
       "MD", ",", "w", ",", "wD"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wPart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              SqrtBox[
               RowBox[{
                SuperscriptBox["\[Xi]", "2"], "*", 
                RowBox[{"(", 
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", 
                   RowBox[{"-", "2"}]], "-", "1"}], ")"}]}]], "}"}], ",", 
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", "0", "}"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Mpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"Mpart", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"MDpart", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"Mpart", "[", 
              RowBox[{"[", "\[Theta]", "]"}], "]"}], "+", 
             RowBox[{"OuterProd", "[", 
              RowBox[{"wPart", "[", 
               RowBox[{"[", "\[Theta]", "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], 
          "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"MDpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{"Mpart", "[", 
           RowBox[{"[", "\[Theta]", "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"wPart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MD", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"MDpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        SuperscriptBox["cost", "1"], "*", "w"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MD", "=", 
       RowBox[{
        SuperscriptBox["cost", 
         RowBox[{"-", "2"}]], "*", "MD"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"MD", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8551275367977304`*^9, 3.855127546646159*^9}, {
   3.8551298917433586`*^9, 3.855129913531505*^9}, {3.8551304372746134`*^9, 
   3.8551306133742466`*^9}, {3.8551328332989244`*^9, 
   3.8551328347812243`*^9}, {3.8552013979093103`*^9, 3.85520139895662*^9}, {
   3.8552234224735756`*^9, 3.855223433756027*^9}, {3.8552234712840233`*^9, 
   3.855223473266337*^9}, {3.8552251632369986`*^9, 3.8552252189384303`*^9}, {
   3.8552254129864206`*^9, 3.855225419867089*^9}, {3.855228068268854*^9, 
   3.8552280752106123`*^9}, {3.855286877562824*^9, 3.8552868798691025`*^9}, {
   3.8552870822475853`*^9, 3.8552870942280407`*^9}, {3.855291009730438*^9, 
   3.8552910269768143`*^9}, {3.855291093844078*^9, 3.855291118265044*^9}, 
   3.8552936574945755`*^9, 3.8552937057287903`*^9},
 CellLabel->"In[98]:=",ExpressionUUID->"2ec4ceab-58ed-42da-9764-5c1fe8e60f8c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Input", " ", "of", " ", "Fast", " ", "Marching", " ", "algorithm", " ", 
    "is", " ", 
    RowBox[{"(", "symmetric", ")"}], " ", "dual", " ", "metric", " ", "D"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetricMvectorwLIF", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "wPart", ",", "wDpart", ",", "Mpart", ",", "MDpart", ",", "M", ",", 
       "MD", ",", "w", ",", "wD"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wPart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              SqrtBox[
               RowBox[{
                SuperscriptBox["\[Xi]", "2"], "*", 
                RowBox[{"(", 
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", 
                   RowBox[{"-", "2"}]], "-", "1"}], ")"}]}]], "}"}], ",", 
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", "0", "}"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Mpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"wPart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"Mpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        SuperscriptBox["cost", "1"], "*", "w"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "M"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"M", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8552910396760154`*^9, 3.8552910833271227`*^9}, 
   3.8552931270454035`*^9, {3.855293165548884*^9, 3.8552931739953575`*^9}, {
   3.855293246107695*^9, 3.85529324729895*^9}, 3.855293653739072*^9, 
   3.8552937004869795`*^9},
 CellLabel->"In[99]:=",ExpressionUUID->"957237de-98f0-43d2-9600-f802bff543cf"]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions Symmetric in GF", "Subsubsection",
 CellChangeTimes->{{3.822110303531454*^9, 3.8221103065235343`*^9}, {
   3.8223827579517393`*^9, 3.8223827615982943`*^9}, {3.826164735597618*^9, 
   3.8261647594597883`*^9}, {3.849164780156644*^9, 3.8491647822681847`*^9}, {
   3.8491698497888126`*^9, 3.849169852628951*^9}, 
   3.8491745182401996`*^9},ExpressionUUID->"f12aedd6-a16f-4be7-a4dd-\
9e54227e83a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReedsSheppMetricGF", "[", 
   RowBox[{"GF_", ",", 
    RowBox[{"{", 
     RowBox[{"nx_", ",", "ny_", ",", "nt_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "MetricLIF2Eucl", ",", "MetricGF2LIF", ",", "MetricGF2Eucl", ",", 
      "MetricEucl2GF", ",", "MetricGF", ",", "DGF"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"MetricLIF2Eucl", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"GLIFtoEuclideanOld", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"t", "-", "1"}], ")"}], "*", 
            FractionBox[
             RowBox[{"2", "\[Pi]"}], "nt"]}], "+", 
           RowBox[{"\[Pi]", "/", "2"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "1", ",", "nt"}], "}"}]}], "]"}]}], ";"}], "*)"}], 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{"+", "\[Pi]"}], "/", "2"}], " ", 
      RowBox[{"correct", "?"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MetricGF2LIF", "=", "GF"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DGF", "=", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"{", 
        RowBox[{"g11", ",", "g22", ",", "g33"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"MetricGF2Eucl", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MetricGF2LIF", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "t"}], "]"}], "]"}], ".", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"t", "-", "1"}], ")"}], "*", 
              FractionBox[
               RowBox[{"2", "\[Pi]"}], "nt"]}], "+", 
             RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "1", ",", "nx"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "1", ",", "ny"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", "1", ",", "nt"}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ".", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"MetricGF2LIF", ",", "MetricLIF2Eucl"}], "}"}], ",", 
           RowBox[{"{", "3", "}"}]}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"MetricEucl2GF", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inverse", "[", "#", "]"}], "&"}], ",", "MetricGF2Eucl", 
          ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"MetricEucl2GF", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Inverse", "[", 
         RowBox[{
          RowBox[{"MetricGF2LIF", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "t"}], "]"}], "]"}], ".", 
          RowBox[{"GLIFtoEuclideanOld", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"t", "-", "1"}], ")"}], "*", 
            FractionBox[
             RowBox[{"2", "\[Pi]"}], "nt"]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", "nx"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "1", ",", "ny"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", "1", ",", "nt"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MetricGF", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", ".", "DGF", ".", 
          RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "MetricEucl2GF",
         ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"N", "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{"MetricGF", ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
        "]"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.823863250308508*^9, 3.8238633675854063`*^9}, {
   3.8238634057882123`*^9, 3.82386349097758*^9}, {3.823863627769211*^9, 
   3.8238637019418497`*^9}, {3.823864018234191*^9, 3.8238640193405714`*^9}, {
   3.8238640573466854`*^9, 3.823864083417515*^9}, {3.82386451745893*^9, 
   3.8238645193495526`*^9}, {3.8238645528181915`*^9, 
   3.8238645927574916`*^9}, {3.823864742472515*^9, 3.8238648698602953`*^9}, {
   3.823865051736315*^9, 3.8238650621795955`*^9}, {3.823866416981224*^9, 
   3.8238666633748913`*^9}, {3.82388306215502*^9, 3.8238830640405006`*^9}, {
   3.8238831971945353`*^9, 3.8238831986085873`*^9}, {3.823945526096771*^9, 
   3.823945663237444*^9}, {3.8239458365921593`*^9, 3.823945846273732*^9}, {
   3.823945896207765*^9, 3.823945916632061*^9}, {3.8239459789038677`*^9, 
   3.823946023944131*^9}, {3.8239461983211884`*^9, 3.823946207424012*^9}, {
   3.8239466067683277`*^9, 3.8239466223031654`*^9}, {3.8239480736154613`*^9, 
   3.8239480777862988`*^9}, {3.824107391754238*^9, 3.8241073923572493`*^9}, {
   3.824207366041005*^9, 3.824207393500676*^9}, {3.8242076022825255`*^9, 
   3.824207610924247*^9}, {3.8242077333616533`*^9, 3.824207801915064*^9}, {
   3.824207877294054*^9, 3.824207895630455*^9}, {3.8275678310514183`*^9, 
   3.82756783764839*^9}, {3.831193577778721*^9, 3.8311935824425106`*^9}, {
   3.8314585853906*^9, 3.8314585948292284`*^9}, 3.8314594470892067`*^9, {
   3.8491698680077424`*^9, 3.849170158374303*^9}, {3.849170200626117*^9, 
   3.849170322020307*^9}, {3.8491703776729355`*^9, 3.84917039653792*^9}, {
   3.849170599300443*^9, 3.8491706477632885`*^9}, {3.8491706978672624`*^9, 
   3.8491707163231535`*^9}, {3.8491708897396493`*^9, 
   3.8491708977068443`*^9}, {3.8491712031305523`*^9, 
   3.8491712166469126`*^9}, {3.8491712843124385`*^9, 3.849171289290298*^9}, {
   3.8491716425069284`*^9, 3.8491716430629864`*^9}, {3.8491727305721574`*^9, 
   3.849172748635029*^9}, {3.849172857476023*^9, 3.8491728604918227`*^9}, {
   3.8491729309361043`*^9, 3.8491729361197786`*^9}, {3.8491743920982647`*^9, 
   3.8491743952780514`*^9}, {3.8491744954620132`*^9, 
   3.8491744970426617`*^9}, {3.849240946297619*^9, 3.849240960210507*^9}},
 CellLabel->
  "In[100]:=",ExpressionUUID->"c1392507-27c1-4b0d-b238-fab21c9db2b9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"MetricMGF", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     "GF_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"convMatrices", ",", "Mpart", ",", "M", ",", "MD"}], "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"convMatrices", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"GF", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], ",", 
              RowBox[{
               SuperscriptBox["\[Xi]", "2"], "*", 
               SuperscriptBox["\[Zeta]", 
                RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
           RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices",
          ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "M"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "M", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8552990286297874`*^9, 3.855299194976637*^9}, {
  3.8553004503096943`*^9, 3.855300496418828*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"f4cfd9c1-4346-4a17-be93-1bb873efcb17"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MetricMGFNew", "[", 
   RowBox[{"cost_", ",", 
    RowBox[{"{", 
     RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
    "GF_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"convMatrices", ",", "Mpart", ",", "M", ",", "MD"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"convMatrices", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Inverse", "[", 
         RowBox[{
          RowBox[{"GF", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
          RowBox[{"GLIFtoEuclideanOld", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
            RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"M", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices", 
        ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"M", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "/", 
          RowBox[{
           RowBox[{"Eigenvalues", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "M", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"M", "=", 
      RowBox[{
       SuperscriptBox["cost", "2"], "*", "M"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "M", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8559979204131436`*^9, 3.8559979460591903`*^9}, {
  3.8559979776375012`*^9, 3.8559980049678135`*^9}, {3.8559980441809344`*^9, 
  3.855998046029847*^9}, {3.855998180832589*^9, 3.8559982164956703`*^9}, {
  3.8559982800103874`*^9, 3.8559982829973717`*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"c620c90d-d75b-4819-a173-e1fe70d5e8ad"]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions Forward Gear in GF", "Subsubsection",
 CellChangeTimes->{{3.822110303531454*^9, 3.8221103065235343`*^9}, {
   3.8223827579517393`*^9, 3.8223827615982943`*^9}, {3.826164735597618*^9, 
   3.8261647594597883`*^9}, {3.8491698421552258`*^9, 3.8491698465786347`*^9}, 
   3.849175758183309*^9},ExpressionUUID->"9277751a-82f8-4fe2-abf2-\
2faed25cab7c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MetricDvectorwGF", "[", 
   RowBox[{"cost_", ",", "GF_", ",", 
    RowBox[{"{", 
     RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", "\[Alpha]_", 
    ",", "\[Epsilon]_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M", ",", "MD", ",", "w", ",", "wD"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"M", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"cost", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], 
          RowBox[{"-", "2"}]], "*", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{
            RowBox[{"GF", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
               RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
              RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"1", "-", "\[Alpha]"}], ")"}], "2"], ",", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"1", "-", "\[Alpha]"}], ")"}], "2"]}], "}"}], "]"}], 
          ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"GF", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
             RowBox[{"GLIFtoEuclideanOld", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
                RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
               RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"w", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"cost", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], 
          RowBox[{"-", "1"}]], "*", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{
            RowBox[{"GF", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ".", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              SqrtBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["\[Epsilon]", 
                  RowBox[{"-", "2"}]], "-", "1"}], ")"}]], "}"}], ",", 
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", "0", "}"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"MD", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", 
           RowBox[{"OuterProd", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"M", ",", "w"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1", ",", "2", ",", "3", ",", "5"}], "}"}]}], 
         "]"}], ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"MD", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.849243244118244*^9, 3.8492432459269185`*^9}, 
   3.8492435269756794`*^9, {3.8517754659964895`*^9, 3.851775467045083*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"94438857-7bcb-48be-a856-2e59f881dba9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"(*", 
   RowBox[{
   "Input", " ", "of", " ", "Fast", " ", "Marching", " ", "algorithm", " ", 
    "is", " ", "dual", " ", "metric", " ", "D"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetricMvectorwGF", "[", 
    RowBox[{"cost_", ",", "GF_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", "\[Alpha]_",
      ",", "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"M", ",", "MD", ",", "w", ",", "w1", ",", "wD"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"M", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"cost", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], 
           RowBox[{"-", "2"}]], "*", 
          RowBox[{
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"GF", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
             RowBox[{"GLIFtoEuclideanOld", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
                RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
               RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], "]"}], ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{"1", ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "-", "\[Alpha]"}], ")"}], "2"], ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "-", "\[Alpha]"}], ")"}], "2"]}], "}"}], "]"}], 
           ".", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Inverse", "[", 
             RowBox[{
              RowBox[{"GF", "[", 
               RowBox[{"[", 
                RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
              RowBox[{"GLIFtoEuclideanOld", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
                 RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "+", 
                RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], "]"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            RowBox[{"cost", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], 
            RowBox[{"-", "1"}]], "*", 
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"GF", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
             RowBox[{"GLIFtoEuclideanOld", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
               RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}], 
        "*", 
        SqrtBox[
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox["\[Epsilon]", 
            RowBox[{"-", "2"}]], "-", "1"}], ")"}]]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"w", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"w2", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"w", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"w3", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"w", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], 
          "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"M", ",", "w1"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.849243244118244*^9, 3.8492432459269185`*^9}, 
   3.8492435269756794`*^9, {3.849247046167946*^9, 3.84924708045426*^9}, {
   3.8515757940781345`*^9, 3.851575797887997*^9}, {3.851575886961331*^9, 
   3.851575893927862*^9}, {3.851576111672484*^9, 3.851576126302498*^9}, {
   3.8515763357360535`*^9, 3.851576383445159*^9}, {3.8515764851074085`*^9, 
   3.85157650829239*^9}, {3.8515765945111017`*^9, 3.8515766103806777`*^9}, 
   3.8515794789191217`*^9, {3.8515805048840513`*^9, 3.8515805160507617`*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"af9f31a1-fbb8-484c-b2e8-af95dd864cb6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Input", " ", "of", " ", "Fast", " ", "Marching", " ", "algorithm", " ", 
    "is", " ", "dual", " ", "metric", " ", "D"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetricMvectorwGFnew", "[", 
    RowBox[{"cost_", ",", "GF_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", "\[Alpha]_",
      ",", "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"M", ",", "MD", ",", "w", ",", "w1", ",", "wD"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"M", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"cost", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], 
           RowBox[{"-", "2"}]], "*", 
          RowBox[{
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"GF", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
             RowBox[{"GLIFtoEuclideanOld", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
               RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{"1", ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "-", "\[Alpha]"}], ")"}], "2"], ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "-", "\[Alpha]"}], ")"}], "2"]}], "}"}], "]"}], 
           ".", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Inverse", "[", 
             RowBox[{
              RowBox[{"GF", "[", 
               RowBox[{"[", 
                RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
              RowBox[{"GLIFtoEuclideanOld", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
                RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], 
            "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            RowBox[{"cost", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], 
            RowBox[{"-", "1"}]], "*", 
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"GF", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
             RowBox[{"GLIFtoEuclideanOld", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
               RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}], 
        "*", 
        SqrtBox[
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox["\[Epsilon]", 
            RowBox[{"-", "2"}]], "-", "1"}], ")"}]]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"w", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"w2", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"w", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"w3", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"w", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], 
          "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"M", ",", "w1"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.849243244118244*^9, 3.8492432459269185`*^9}, 
   3.8492435269756794`*^9, {3.849247046167946*^9, 3.84924708045426*^9}, {
   3.8515757940781345`*^9, 3.851575797887997*^9}, {3.851575886961331*^9, 
   3.851575893927862*^9}, {3.851576111672484*^9, 3.851576126302498*^9}, {
   3.8515763357360535`*^9, 3.851576383445159*^9}, {3.8515764851074085`*^9, 
   3.85157650829239*^9}, {3.8515765945111017`*^9, 3.8515766103806777`*^9}, 
   3.8515794789191217`*^9, {3.8515805048840513`*^9, 3.8515805160507617`*^9}, {
   3.851775481382223*^9, 3.8517754885418406`*^9}},
 CellLabel->
  "In[105]:=",ExpressionUUID->"639f8769-acd2-4780-85d7-1594caf892a2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions Forward Gear (General)", "Subsubsection",
 CellChangeTimes->{{3.8492352286780167`*^9, 
  3.8492352350531445`*^9}},ExpressionUUID->"8d033392-e0a8-4aac-a17f-\
ac95598f62fd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MetricDvectorwForwardGear", "[", 
   RowBox[{"Min_", ",", "win_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Mout", ",", "wout"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"wout", "=", "win"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Mout", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", 
           RowBox[{"OuterProd", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Min", ",", "win"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1", ",", "2", ",", "3", ",", "5"}], "}"}]}], 
         "]"}], ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"Mout", ",", "wout"}], "}"}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 CellChangeTimes->{{3.849235308906554*^9, 3.849235440265026*^9}},
 CellLabel->
  "In[106]:=",ExpressionUUID->"a2b2efef-bb3a-4143-aa80-dd33f2a5214f"]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions Mixed Model", "Subsubsection",
 CellChangeTimes->{{3.8604715477330093`*^9, 
  3.8604715522441254`*^9}},ExpressionUUID->"3fd404ba-f33c-419e-a34c-\
2fbdf806b558"],

Cell["\<\
These functions rely on a soft transition between data-driven left-invariant \
and left-invariant at the crossings using Erf(x) to weigh between data-driven \
left-invariant and left-invariant.\
\>", "Text",
 CellChangeTimes->{{3.8716330959359903`*^9, 3.8716331378295045`*^9}, {
  3.871633313590767*^9, 
  3.8716333404101114`*^9}},ExpressionUUID->"28becbea-6fb1-482d-a5dd-\
af3055eb74a9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"metricMMixed", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}], ",", "\[Lambda]_", 
     ",", "GF_", ",", "crossings_", ",", 
     RowBox[{"ySelect_", ":", "0"}], ",", 
     RowBox[{"radiusCrossing_", ":", "5"}], ",", 
     RowBox[{"\[Sigma]_", ":", "0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "convMatrices", ",", "MGF", ",", "MLIFpart", ",", "MLIF", ",", "M", ",",
        "crossingRegion", ",", "crossingRegionM2", ",", "LocCrossing", ",", 
       "imLocCrossing", ",", "discreteGaussian"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MLIFpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"*", "\[Xi]"}], "*)"}], ";", "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"MLIFpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MLIF"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"convMatrices", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"GF", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{
              SuperscriptBox["g11", "2"], ",", 
              RowBox[{
               SuperscriptBox["g11", "2"], "*", 
               SuperscriptBox["g22", 
                RowBox[{"-", "2"}]]}], ",", "g33"}], "}"}], "]"}], ".", 
           RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices",
          ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "/", 
           RowBox[{
            RowBox[{"Eigenvalues", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "MGF", ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MGF"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"LocCrossing", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"LocCrossing", "[", 
             RowBox[{"[", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"(", "#", ")"}]}], "]"}], "]"}], ")"}], "=", "1"}], 
          ";"}], "&"}], ",", 
        RowBox[{"Round", "[", 
         RowBox[{"graphicsToImageCoordinates", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
           RowBox[{"crossings", "-", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Ny", "-", "ySelect"}]}], "}"}], ",", 
              RowBox[{"Length", "[", "crossings", "]"}]}], "]"}]}]}], "]"}], 
         "]"}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"imLocCrossing", "=", 
       RowBox[{"Image", "[", "LocCrossing", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"crossingRegion", "=", 
       RowBox[{"ImageData", "[", 
        RowBox[{"Dilation", "[", 
         RowBox[{"imLocCrossing", ",", "radiusCrossing"}], "]"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"discreteGaussian", "=", 
       RowBox[{"GaussianMatrix", "[", 
        RowBox[{"{", 
         RowBox[{"30", ",", "\[Sigma]"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"crossingRegion", "=", 
       RowBox[{
        RowBox[{"ListConvolve", "[", 
         RowBox[{"discreteGaussian", ",", "crossingRegion", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}]}], "}"}], ",", "0"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"31", ";;", 
           RowBox[{"Nx", "+", "30"}]}], ",", 
          RowBox[{"31", ";;", 
           RowBox[{"Ny", "+", "30"}]}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"crossingRegionM2", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"crossingRegion", ",", "N\[Theta]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"MLIF", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "crossingRegionM2"}], ")"}], "*", "\[Lambda]", 
         "*", "MGF"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "M", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8604719333342752`*^9, 3.860471978998026*^9}, {
  3.8604720187843413`*^9, 3.8604721525663443`*^9}, {3.8604721957421455`*^9, 
  3.8604722295446067`*^9}, {3.860472280118819*^9, 3.860472313836849*^9}, {
  3.8604728212693005`*^9, 3.860472972380406*^9}, {3.8604730202351303`*^9, 
  3.860473021298235*^9}, {3.8604789290488253`*^9, 3.86047893559626*^9}, {
  3.8604789920076303`*^9, 3.860479041376477*^9}, {3.8604794553688793`*^9, 
  3.8604794602834587`*^9}, {3.8604800008993845`*^9, 3.860480027785677*^9}, {
  3.860566378853761*^9, 3.860566380623497*^9}, {3.8668730464290857`*^9, 
  3.866873070350302*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"820db54d-64ed-4f0d-b8d6-03e3395e555c"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"metricMvectorwMixed", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}], ",", "\[Lambda]_", 
     ",", "GF_", ",", "crossings_", ",", "\[Epsilon]_", ",", 
     RowBox[{"ySelect_", ":", "0"}], ",", 
     RowBox[{"radiusCrossing_", ":", "5"}], ",", 
     RowBox[{"\[Sigma]_", ":", "0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "convMatrices", ",", "MGF", ",", "MLIFpart", ",", "MLIF", ",", "M", ",",
        "crossingRegion", ",", "crossingRegionM2", ",", "LocCrossing", ",", 
       "imLocCrossing", ",", "wPart", ",", "w", ",", "discreteGaussian"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MLIFpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"*", "\[Xi]"}], "*)"}], ";", "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"MLIFpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MLIF"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"convMatrices", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"GF", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{
              SuperscriptBox["g11", "2"], ",", 
              RowBox[{
               SuperscriptBox["g11", "2"], "*", 
               SuperscriptBox["g22", 
                RowBox[{"-", "2"}]]}], ",", "g33"}], "}"}], "]"}], ".", 
           RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices",
          ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "/", 
           RowBox[{
            RowBox[{"Eigenvalues", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "MGF", ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MGF"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"LocCrossing", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"LocCrossing", "[", 
             RowBox[{"[", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"(", "#", ")"}]}], "]"}], "]"}], ")"}], "=", "1"}], 
          ";"}], "&"}], ",", 
        RowBox[{"Round", "[", 
         RowBox[{"graphicsToImageCoordinates", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
           RowBox[{"crossings", "-", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Ny", "-", "ySelect"}]}], "}"}], ",", 
              RowBox[{"Length", "[", "crossings", "]"}]}], "]"}]}]}], "]"}], 
         "]"}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"imLocCrossing", "=", 
       RowBox[{"Image", "[", "LocCrossing", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"crossingRegion", "=", 
       RowBox[{"ImageData", "[", 
        RowBox[{"Dilation", "[", 
         RowBox[{"imLocCrossing", ",", "radiusCrossing"}], "]"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"discreteGaussian", "=", 
       RowBox[{"GaussianMatrix", "[", 
        RowBox[{"{", 
         RowBox[{"30", ",", "\[Sigma]"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"crossingRegion", "=", 
       RowBox[{
        RowBox[{"ListConvolve", "[", 
         RowBox[{"discreteGaussian", ",", "crossingRegion", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}]}], "}"}], ",", "0"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"31", ";;", 
           RowBox[{"Nx", "+", "30"}]}], ",", 
          RowBox[{"31", ";;", 
           RowBox[{"Ny", "+", "30"}]}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"crossingRegionM2", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"crossingRegion", ",", "N\[Theta]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"crossingRegion", ",", "1."}], "]"}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"MLIF", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "crossingRegionM2"}], ")"}], "*", "\[Lambda]", 
         "*", "MGF"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"wPart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              SqrtBox[
               RowBox[{
                SuperscriptBox["\[Xi]", "2"], "*", 
                RowBox[{"(", 
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", 
                   RowBox[{"-", "2"}]], "-", "1"}], ")"}]}]], "}"}], ",", 
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", "0", "}"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"wPart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        SuperscriptBox["cost", "1"], "*", "w"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"M", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8604719333342752`*^9, 3.860471978998026*^9}, {
   3.8604720187843413`*^9, 3.8604721525663443`*^9}, {3.8604721957421455`*^9, 
   3.8604722295446067`*^9}, {3.860472280118819*^9, 3.860472313836849*^9}, {
   3.8604728212693005`*^9, 3.860472972380406*^9}, {3.8604730202351303`*^9, 
   3.860473021298235*^9}, {3.8604789290488253`*^9, 3.86047893559626*^9}, {
   3.8604789920076303`*^9, 3.860479041376477*^9}, {3.8604794553688793`*^9, 
   3.8604794602834587`*^9}, {3.8604800008993845`*^9, 3.860480027785677*^9}, {
   3.8604818219969535`*^9, 3.86048182379181*^9}, {3.86048185637766*^9, 
   3.8604818789075594`*^9}, {3.860560692131889*^9, 3.8605606982984896`*^9}, {
   3.860565897672941*^9, 3.8605659018422546`*^9}, {3.860566419702878*^9, 
   3.860566427735463*^9}, {3.8605705642633567`*^9, 3.860570586422425*^9}, {
   3.860570657683031*^9, 3.8605706751215134`*^9}, 3.860570956102167*^9, 
   3.860571198824343*^9, {3.8668729070744076`*^9, 3.8668729578483195`*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"7e8065e4-e997-48ab-8282-f1b7152ceb6a"],

Cell["\<\
These functions rely on a hard transition between data-driven left-invariant \
and left-invariant at the crossings.\
\>", "Text",
 CellChangeTimes->{{3.871633143222447*^9, 
  3.8716331740545425`*^9}},ExpressionUUID->"70a4da4b-87f2-469f-b011-\
1cc7d1cc3462"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metricMMixed", "[", 
   RowBox[{"cost_", ",", 
    RowBox[{"{", 
     RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}], ",", "\[Lambda]_", 
    ",", "GF_", ",", "crossings_", ",", 
    RowBox[{"ySelect_", ":", "0"}], ",", 
    RowBox[{"radiusCrossing_", ":", "5"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "convMatrices", ",", "MGF", ",", "MLIFpart", ",", "MLIF", ",", "M", ",", 
      "crossingRegion", ",", "crossingRegionM2", ",", "LocCrossing", ",", 
      "imLocCrossing"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MLIFpart", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{"GLIFtoEuclideanOld", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
            RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"{", 
           RowBox[{
            SuperscriptBox["\[Xi]", "2"], ",", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], "*", 
             SuperscriptBox["\[Zeta]", 
              RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
         RowBox[{"Transpose", "[", 
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     RowBox[{"(*", 
      RowBox[{"*", "\[Xi]"}], "*)"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MLIF", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"MLIFpart", ",", 
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MLIF", "=", 
      RowBox[{
       SuperscriptBox["cost", "2"], "*", "MLIF"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"convMatrices", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Inverse", "[", 
         RowBox[{
          RowBox[{"GF", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
          RowBox[{"GLIFtoEuclideanOld", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
            RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"MGF", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["g11", "2"], ",", 
             RowBox[{
              SuperscriptBox["g11", "2"], "*", 
              SuperscriptBox["g22", 
               RowBox[{"-", "2"}]]}], ",", "g33"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices", 
        ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MGF", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "/", 
          RowBox[{
           RowBox[{"Eigenvalues", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "MGF", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MGF", "=", 
      RowBox[{
       SuperscriptBox["cost", "2"], "*", "MGF"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"LocCrossing", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"LocCrossing", "[", 
            RowBox[{"[", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"(", "#", ")"}]}], "]"}], "]"}], ")"}], "=", "1"}], 
         ";"}], "&"}], ",", 
       RowBox[{"Round", "[", 
        RowBox[{"graphicsToImageCoordinates", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
          RowBox[{"crossings", "-", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Ny", "-", "ySelect"}]}], "}"}], ",", 
             RowBox[{"Length", "[", "crossings", "]"}]}], "]"}]}]}], "]"}], 
        "]"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"imLocCrossing", "=", 
      RowBox[{"Image", "[", "LocCrossing", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"crossingRegion", "=", 
      RowBox[{"ImageData", "[", 
       RowBox[{"Dilation", "[", 
        RowBox[{"imLocCrossing", ",", "radiusCrossing"}], "]"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"crossingRegionM2", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"crossingRegion", ",", "N\[Theta]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"M", "=", 
      RowBox[{"MLIF", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "crossingRegionM2"}], ")"}], "*", "\[Lambda]", "*",
         "MGF"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "M", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8604719333342752`*^9, 3.860471978998026*^9}, {
  3.8604720187843413`*^9, 3.8604721525663443`*^9}, {3.8604721957421455`*^9, 
  3.8604722295446067`*^9}, {3.860472280118819*^9, 3.860472313836849*^9}, {
  3.8604728212693005`*^9, 3.860472972380406*^9}, {3.8604730202351303`*^9, 
  3.860473021298235*^9}, {3.8604789290488253`*^9, 3.86047893559626*^9}, {
  3.8604789920076303`*^9, 3.860479041376477*^9}, {3.8604794553688793`*^9, 
  3.8604794602834587`*^9}, {3.8604800008993845`*^9, 3.860480027785677*^9}, {
  3.860566378853761*^9, 3.860566380623497*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"f14c2bf8-5e1c-4916-927b-abff162f7b85"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metricMvectorwMixed", "[", 
   RowBox[{"cost_", ",", 
    RowBox[{"{", 
     RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}], ",", "\[Lambda]_", 
    ",", "GF_", ",", "crossings_", ",", "\[Epsilon]_", ",", 
    RowBox[{"ySelect_", ":", "0"}], ",", 
    RowBox[{"radiusCrossing_", ":", "5"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "convMatrices", ",", "MGF", ",", "MLIFpart", ",", "MLIF", ",", "M", ",", 
      "crossingRegion", ",", "crossingRegionM2", ",", "LocCrossing", ",", 
      "imLocCrossing", ",", "wPart", ",", "w"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MLIFpart", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{"GLIFtoEuclideanOld", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
            RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"{", 
           RowBox[{
            SuperscriptBox["\[Xi]", "2"], ",", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], "*", 
             SuperscriptBox["\[Zeta]", 
              RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
         RowBox[{"Transpose", "[", 
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     RowBox[{"(*", 
      RowBox[{"*", "\[Xi]"}], "*)"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MLIF", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"MLIFpart", ",", 
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MLIF", "=", 
      RowBox[{
       SuperscriptBox["cost", "2"], "*", "MLIF"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"convMatrices", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Inverse", "[", 
         RowBox[{
          RowBox[{"GF", "[", 
           RowBox[{"[", 
            RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
          RowBox[{"GLIFtoEuclideanOld", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
            RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"MGF", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["g11", "2"], ",", 
             RowBox[{
              SuperscriptBox["g11", "2"], "*", 
              SuperscriptBox["g22", 
               RowBox[{"-", "2"}]]}], ",", "g33"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices", 
        ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MGF", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "/", 
          RowBox[{
           RowBox[{"Eigenvalues", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "MGF", ",", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MGF", "=", 
      RowBox[{
       SuperscriptBox["cost", "2"], "*", "MGF"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"LocCrossing", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"LocCrossing", "[", 
            RowBox[{"[", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"(", "#", ")"}]}], "]"}], "]"}], ")"}], "=", "1"}], 
         ";"}], "&"}], ",", 
       RowBox[{"Round", "[", 
        RowBox[{"graphicsToImageCoordinates", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
          RowBox[{"crossings", "-", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"Ny", "-", "ySelect"}]}], "}"}], ",", 
             RowBox[{"Length", "[", "crossings", "]"}]}], "]"}]}]}], "]"}], 
        "]"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"imLocCrossing", "=", 
      RowBox[{"Image", "[", "LocCrossing", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"crossingRegion", "=", 
      RowBox[{"ImageData", "[", 
       RowBox[{"Dilation", "[", 
        RowBox[{"imLocCrossing", ",", "radiusCrossing"}], "]"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"crossingRegionM2", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"crossingRegion", ",", "N\[Theta]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"crossingRegion", ",", "1."}], "]"}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"M", "=", 
      RowBox[{"MLIF", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "crossingRegionM2"}], ")"}], "*", "\[Lambda]", "*",
         "MGF"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"wPart", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{"GLIFtoEuclideanOld", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
            RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             SqrtBox[
              RowBox[{
               SuperscriptBox["\[Xi]", "2"], "*", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["\[Epsilon]", 
                  RowBox[{"-", "2"}]], "-", "1"}], ")"}]}]], "}"}], ",", 
            RowBox[{"{", "0", "}"}], ",", 
            RowBox[{"{", "0", "}"}]}], "}"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"w", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"wPart", ",", 
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"w", "=", 
      RowBox[{
       SuperscriptBox["cost", "1"], "*", "w"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"M", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8604719333342752`*^9, 3.860471978998026*^9}, {
   3.8604720187843413`*^9, 3.8604721525663443`*^9}, {3.8604721957421455`*^9, 
   3.8604722295446067`*^9}, {3.860472280118819*^9, 3.860472313836849*^9}, {
   3.8604728212693005`*^9, 3.860472972380406*^9}, {3.8604730202351303`*^9, 
   3.860473021298235*^9}, {3.8604789290488253`*^9, 3.86047893559626*^9}, {
   3.8604789920076303`*^9, 3.860479041376477*^9}, {3.8604794553688793`*^9, 
   3.8604794602834587`*^9}, {3.8604800008993845`*^9, 3.860480027785677*^9}, {
   3.8604818219969535`*^9, 3.86048182379181*^9}, {3.86048185637766*^9, 
   3.8604818789075594`*^9}, {3.860560692131889*^9, 3.8605606982984896`*^9}, {
   3.860565897672941*^9, 3.8605659018422546`*^9}, {3.860566419702878*^9, 
   3.860566427735463*^9}, {3.8605705642633567`*^9, 3.860570586422425*^9}, {
   3.860570657683031*^9, 3.8605706751215134`*^9}, 3.860570956102167*^9, 
   3.860571198824343*^9},
 CellLabel->
  "In[110]:=",ExpressionUUID->"202aa239-16a0-4c2e-904b-5ad0face209f"],

Cell["\<\
These functions rely on a soft transition between data-driven left-invariant \
and left-invariant at the crossings using Gaussian distributions to weigh \
between data-driven left-invariant and left-invariant.\
\>", "Text",
 CellChangeTimes->{{3.8716332612765384`*^9, 
  3.871633304964526*^9}},ExpressionUUID->"fd3bc767-f9ce-4456-a43d-\
fae1836433e9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"GaussianMixingLayer", "[", 
    RowBox[{"crossings_", ",", "Nx_", ",", "Ny_", ",", 
     RowBox[{"\[Sigma]_", ":", "5"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"gaussianmatrix", ",", 
       RowBox[{"mixing", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"mixingTotal", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"r", "=", 
        RowBox[{"\[Sigma]", "*", "5"}]}], ",", "xmin", ",", "xmax", ",", 
       "ymin", ",", "ymax", ",", "xminGaussian", ",", "xmaxGaussian", ",", 
       "yminGaussian", ",", "ymaxGaussian"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gaussianmatrix", "=", 
       RowBox[{"GaussianMatrix", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"r", ",", "r"}], "}"}], ",", "\[Sigma]"}], "}"}], ",", 
         " ", 
         RowBox[{"WorkingPrecision", "->", "100"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", 
         RowBox[{"Length", "[", "crossings", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"xmin", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"1", ",", 
            RowBox[{
             RowBox[{"Round", "[", 
              RowBox[{"crossings", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "-", "r"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"xmax", "=", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Round", "[", 
              RowBox[{"crossings", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "+", "r"}], ",",
             "Nx"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ymin", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"1", ",", 
            RowBox[{
             RowBox[{"Round", "[", 
              RowBox[{"crossings", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], "-", "r"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ymax", "=", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Round", "[", 
              RowBox[{"crossings", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], "+", "r"}], ",",
             "Ny"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"mixing", "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"xminGaussian", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"1", ",", 
            RowBox[{"r", "+", "1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Round", "[", 
                RowBox[{"crossings", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "-", "1"}], 
              ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"xmaxGaussian", "=", 
          RowBox[{"r", "+", "1", "+", 
           RowBox[{"Min", "[", 
            RowBox[{"r", ",", 
             RowBox[{"Nx", "-", 
              RowBox[{"(", 
               RowBox[{"Round", "[", 
                RowBox[{"crossings", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], ")"}]}]}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"yminGaussian", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"1", ",", 
            RowBox[{"r", "+", "1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Round", "[", 
                RowBox[{"crossings", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], "-", "1"}], 
              ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ymaxGaussian", "=", 
          RowBox[{"r", "+", "1", "+", 
           RowBox[{"Min", "[", 
            RowBox[{"r", ",", 
             RowBox[{"Ny", "-", 
              RowBox[{"(", 
               RowBox[{"Round", "[", 
                RowBox[{"crossings", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], ")"}]}]}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mixing", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{
              RowBox[{"Ny", "+", "1", "-", "ymax"}], ";;", 
              RowBox[{"Ny", "+", "1", "-", "ymin"}]}], ",", 
             RowBox[{"xmin", ";;", "xmax"}]}], "]"}], "]"}], "=", 
          RowBox[{"gaussianmatrix", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"2", "r"}], "+", "2", "-", "ymaxGaussian"}], ";;", 
              RowBox[{
               RowBox[{"2", "r"}], "+", "2", "-", "yminGaussian"}]}], ",", 
             RowBox[{"xminGaussian", ";;", "xmaxGaussian"}]}], "]"}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"mixingTotal", "=", 
          RowBox[{"Map", "[", 
           RowBox[{"Max", ",", 
            RowBox[{"Transpose", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mixingTotal", ",", "mixing"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "mixingTotal", "]"}]}]}], "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQrZOqfZXl3BvH/sXub0B0h7DnHxA9aVHxXxAd1rEt
UAtIM+2YnQeiz1QYFIPoDcI1FSD608fPtSB6S+3dNhAtL8hZqwukJVTezgDR
Vfcl54Ho/wdeLgHR82RU94ForoN5B0D0sthHR0A02+LEUyA6peXgMxB9e8uM
1yB6+rxJn0D0j+j0PyCa03sxgx6QviRQxwmipZzX8ILoX7FaAiD6WbqmEYje
prXMHEQ31H1yBNFxEhJOIHp5ztFgEH2O4WU4iD6yXllAH0g/OR8pAaLjji7d
E3MD6M/4rr0g2iRy+jsQfd6x8AOIBgDRXKFz
  "],
 CellLabel->
  "In[111]:=",ExpressionUUID->"f2532eec-4528-463a-bde0-1f94265ba734"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"metricMMixed1", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}], ",", "\[Lambda]_", 
     ",", "GF_", ",", "crossings_", ",", 
     RowBox[{"ySelect_", ":", "0"}], ",", 
     RowBox[{"radiusCrossing_", ":", "5"}], ",", 
     RowBox[{"image_", ":", "im"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "convMatrices", ",", "MGF", ",", "MLIFpart", ",", "MLIF", ",", "M", ",",
        "crossingRegion", ",", "crossingRegionM2", ",", "LocCrossing", ",", 
       "imLocCrossing", ",", "mixing", ",", 
       RowBox[{"NxIm", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "image", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"NyIm", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "image", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MLIFpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"*", "\[Xi]"}], "*)"}], ";", "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"MLIFpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MLIF"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"convMatrices", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"GF", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{
              SuperscriptBox["g11", "2"], ",", 
              RowBox[{
               SuperscriptBox["g11", "2"], "*", 
               SuperscriptBox["g22", 
                RowBox[{"-", "2"}]]}], ",", "g33"}], "}"}], "]"}], ".", 
           RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices",
          ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "/", 
           RowBox[{
            RowBox[{"Eigenvalues", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "MGF", ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MGF"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mixing", "=", 
       RowBox[{"Rescale", "[", 
        RowBox[{
         RowBox[{"GaussianMixingLayer", "[", 
          RowBox[{
          "crossings", ",", "NxIm", ",", "NyIm", ",", "radiusCrossing"}], 
          "]"}], "[", 
         RowBox[{"[", 
          RowBox[{";;", "ySelect"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"MLIF", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "mixing"}], ")"}], "*", "\[Lambda]", "*", 
         "MGF"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "M", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.865914541843207*^9, 3.8659145437932525`*^9}, {
  3.8661974061737423`*^9, 3.866197568543014*^9}, {3.8661976279436197`*^9, 
  3.866197650860231*^9}, {3.8661977005989094`*^9, 3.8661977157193985`*^9}, {
  3.86619811908522*^9, 3.8661981205939927`*^9}},
 CellLabel->
  "In[112]:=",ExpressionUUID->"c021477d-a4f9-46c0-afb5-8fccabb12c75"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"metricMvectorwMixed1", "[", 
    RowBox[{"cost_", ",", 
     RowBox[{"{", 
      RowBox[{"Nx_", ",", "Ny_", ",", "N\[Theta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Xi]_", ",", "\[Zeta]_", ",", "\[Delta]_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"g11_", ",", "g22_", ",", "g33_"}], "}"}], ",", "\[Lambda]_", 
     ",", "GF_", ",", "crossings_", ",", "\[Epsilon]_", ",", 
     RowBox[{"ySelect_", ":", "0"}], ",", 
     RowBox[{"radiusCrossing_", ":", "5"}], ",", 
     RowBox[{"image_", ":", "im"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "convMatrices", ",", "MGF", ",", "MLIFpart", ",", "MLIF", ",", "M", ",",
        "crossingRegion", ",", "crossingRegionM2", ",", "LocCrossing", ",", 
       "imLocCrossing", ",", "wPart", ",", "w", ",", "mixing", ",", 
       RowBox[{"NxIm", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "image", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"NyIm", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "image", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MLIFpart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{
             SuperscriptBox["\[Xi]", "2"], ",", 
             RowBox[{
              SuperscriptBox["\[Xi]", "2"], "*", 
              SuperscriptBox["\[Zeta]", 
               RowBox[{"-", "2"}]]}], ",", "\[Delta]"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", 
            RowBox[{"GLIFtoEuclideanOld", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
              RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"*", "\[Xi]"}], "*)"}], ";", "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"MLIFpart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MLIF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MLIF"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"convMatrices", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"GF", "[", 
            RowBox[{"[", 
             RowBox[{"x", ",", "y", ",", "\[Theta]"}], "]"}], "]"}], ".", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "1", ",", "Nx"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"y", ",", "1", ",", "Ny"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ".", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{
              SuperscriptBox["g11", "2"], ",", 
              RowBox[{
               SuperscriptBox["g11", "2"], "*", 
               SuperscriptBox["g22", 
                RowBox[{"-", "2"}]]}], ",", "g33"}], "}"}], "]"}], ".", 
           RowBox[{"Transpose", "[", "#", "]"}]}], "&"}], ",", "convMatrices",
          ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "/", 
           RowBox[{
            RowBox[{"Eigenvalues", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "MGF", ",", 
         RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MGF", "=", 
       RowBox[{
        SuperscriptBox["cost", "2"], "*", "MGF"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mixing", "=", 
       RowBox[{"Rescale", "[", 
        RowBox[{
         RowBox[{"GaussianMixingLayer", "[", 
          RowBox[{
          "crossings", ",", "NxIm", ",", "NyIm", ",", "radiusCrossing"}], 
          "]"}], "[", 
         RowBox[{"[", 
          RowBox[{";;", "ySelect"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"crossingRegion", ",", "1."}], "]"}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"MLIF", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "mixing"}], ")"}], "*", "\[Lambda]", "*", 
         "MGF"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"wPart", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"GLIFtoEuclideanOld", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\[Theta]", "-", "1"}], ")"}], "*", "2", 
             RowBox[{"\[Pi]", "/", "N\[Theta]"}]}], "]"}], "]"}], ".", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              SqrtBox[
               RowBox[{
                SuperscriptBox["\[Xi]", "2"], "*", 
                RowBox[{"(", 
                 RowBox[{
                  SuperscriptBox["\[Epsilon]", 
                   RowBox[{"-", "2"}]], "-", "1"}], ")"}]}]], "}"}], ",", 
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", "0", "}"}]}], "}"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "1", ",", "N\[Theta]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"wPart", ",", 
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        SuperscriptBox["cost", "1"], "*", "w"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"M", ",", "w"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8604719333342752`*^9, 3.860471978998026*^9}, {
   3.8604720187843413`*^9, 3.8604721525663443`*^9}, {3.8604721957421455`*^9, 
   3.8604722295446067`*^9}, {3.860472280118819*^9, 3.860472313836849*^9}, {
   3.8604728212693005`*^9, 3.860472972380406*^9}, {3.8604730202351303`*^9, 
   3.860473021298235*^9}, {3.8604789290488253`*^9, 3.86047893559626*^9}, {
   3.8604789920076303`*^9, 3.860479041376477*^9}, {3.8604794553688793`*^9, 
   3.8604794602834587`*^9}, {3.8604800008993845`*^9, 3.860480027785677*^9}, {
   3.8604818219969535`*^9, 3.86048182379181*^9}, {3.86048185637766*^9, 
   3.8604818789075594`*^9}, {3.860560692131889*^9, 3.8605606982984896`*^9}, {
   3.860565897672941*^9, 3.8605659018422546`*^9}, {3.860566419702878*^9, 
   3.860566427735463*^9}, {3.8605705642633567`*^9, 3.860570586422425*^9}, {
   3.860570657683031*^9, 3.8605706751215134`*^9}, 3.860570956102167*^9, 
   3.860571198824343*^9, {3.8661980496981277`*^9, 3.8661981099615846`*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"79b9d55c-17f3-4e45-aca1-f400867272e8"]
}, Closed]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Tracking", "Section",
 CellChangeTimes->{{3.8713713269710464`*^9, 
  3.871371328074828*^9}},ExpressionUUID->"f7cf327e-b1b0-42a8-b23e-\
527f71f3fd6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AutomaticCrossingIdentification", "[", "vesselAnnotations_", "]"}],
   ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"lines", ",", "lines1", ",", "lines2", ",", 
      RowBox[{"crossings", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "vesselAnnotations", "]"}]}], "]"}]}], ",", 
      "i"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"lines", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Line", "[", "#", "]"}], "&"}], "/@", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Select", " ", "first", " ", "and", " ", "second", " ", "wall"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"trackFirstWall", "=", 
             RowBox[{"Transpose", "[", 
              RowBox[{"\"\<firstWall\>\"", "/.", "#"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"trackSecondWall", "=", 
             RowBox[{"Transpose", "[", 
              RowBox[{"\"\<secondWall\>\"", "/.", "#"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "Average", " ", "both", " ", "walls", " ", "to", " ", "obtain", 
              " ", "center", " ", "points"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "Make", " ", "a", " ", "list", " ", "of", " ", "the", " ", 
              "first", " ", "nrOfAveragePoints", " ", "center", " ", 
              RowBox[{"points", ":"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"centerPointList", "=", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Mean", "[", 
                  RowBox[{"{", 
                   RowBox[{"#", ",", 
                    RowBox[{"First", "[", 
                    RowBox[{"Nearest", "[", 
                    RowBox[{"trackSecondWall", ",", "#"}], "]"}], "]"}]}], 
                   "}"}], "]"}], "&"}], "@", 
                RowBox[{
                "trackFirstWall", "\[LeftDoubleBracket]", "pointNr", 
                 "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"pointNr", ",", "1", ",", 
                 RowBox[{"Length", "[", "trackFirstWall", "]"}], ",", "1"}], 
                "}"}]}], "]"}]}], ";", 
            RowBox[{"{", "centerPointList", "}"}]}], "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "From", " ", "this", " ", "list", " ", "compute", " ", "the", 
              " ", "average", " ", "direction", " ", "vector"}], ",", " ", 
             RowBox[{"and", " ", "corresponding", " ", "angle"}]}], "*)"}], 
           "\[IndentingNewLine]", ")"}], "&"}], ",", "vesselAnnotations"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "<=", 
        RowBox[{"Length", "[", "vesselAnnotations", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lines1", "=", 
         RowBox[{"lines", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"lines2", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"lines", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}], ",", 
           RowBox[{"lines", "[", 
            RowBox[{"[", 
             RowBox[{"i", ";;", "i"}], "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"crossings", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"RegionIntersection", "[", 
              RowBox[{"lines1", ",", "#"}], "]"}], "&"}], "/@", "lines2"}], 
           ",", 
           RowBox[{"EmptyRegion", "[", "2", "]"}]}], "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "crossings", "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8583333841289077`*^9, 3.8583333852876725`*^9}, {
  3.8583335530339766`*^9, 3.858333612459584*^9}, {3.8583339407972293`*^9, 
  3.8583340213810353`*^9}, {3.8583340562119107`*^9, 3.858334060493997*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"24da5b27-4496-4f0b-bdc0-6c2a566bc0ef"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"SelectionSeedsBifTracking", "[", 
    RowBox[{"tracks_", ",", "seeds_", ",", " ", "tips_", ",", "ySelect_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"starts", ",", "usedSeeds", ",", "seedshalf", ",", "tipshalf"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"seedshalf", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "&"}], ",", 
         "seeds", ",", 
         RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"tipshalf", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "-", 
             RowBox[{"{", 
              RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "&"}], ",", 
           "tips", ",", 
           RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"usedSeeds", "=", 
       RowBox[{"tracks", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"starts", "=", 
       RowBox[{"Intersection", "[", 
        RowBox[{"seedshalf", ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "usedSeeds", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"SameTest", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "==", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "&&", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "==", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "&"}], ")"}]}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "starts", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.847859118473482*^9, 3.847859140902731*^9}, {
   3.8478599356048365`*^9, 3.847859969627777*^9}, {3.8478623371914406`*^9, 
   3.8478623897492676`*^9}, {3.847862477310429*^9, 3.847862543699339*^9}, {
   3.8478641212724915`*^9, 3.847864135545394*^9}, {3.847864310055457*^9, 
   3.847864328445466*^9}, {3.847864545618453*^9, 3.8478645578969684`*^9}, {
   3.8647300960820174`*^9, 3.8647301384392376`*^9}, 3.8647301947163925`*^9, {
   3.8716356672537527`*^9, 3.871635669543068*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"f650cc62-ca13-4b0d-a046-3d3bb07d469f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SelectionSeedsBifTracking", "[", 
   RowBox[{"tracks_", ",", "seeds_", ",", " ", "tips_", ",", "ySelect_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"starts", ",", "usedSeeds", ",", "seedshalf", ",", "tipshalf"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"seedshalf", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "-", 
          RowBox[{"{", 
           RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "&"}], ",", 
        "seeds", ",", 
        RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"tipshalf", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"{", 
             RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "&"}], ",", 
          "tips", ",", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"usedSeeds", "=", 
      RowBox[{"tracks", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"usedSeeds", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}], "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"usedSeeds", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
        RowBox[{"2", "\[Pi]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"starts", "=", 
      RowBox[{"Intersection", "[", 
       RowBox[{"seedshalf", ",", 
        RowBox[{"Round", "[", 
         RowBox[{
          RowBox[{"DeleteDuplicates", "[", "usedSeeds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"SameTest", "\[Rule]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "==", 
             RowBox[{"#2", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "&&", 
            RowBox[{
             RowBox[{"#1", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "==", 
             RowBox[{"#2", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "&"}], ")"}]}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "starts", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8647303285703807`*^9, 3.864730347637148*^9}, {
   3.8647305071406736`*^9, 3.864730513695514*^9}, {3.8647305596701007`*^9, 
   3.8647305722947245`*^9}, {3.8647306161243844`*^9, 3.8647306239851866`*^9}, 
   3.864794612713132*^9},
 CellLabel->
  "In[116]:=",ExpressionUUID->"b98e7b76-0329-4be5-8a29-0e150529af92"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotContoursR2oneColor", "[", 
   RowBox[{
   "U_", ",", "Ncontours_", ",", "\[Lambda]_", ",", "baseImage_", ",", "g_"}],
    "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "contours", ",", "base", ",", "Nx", ",", "Ny", ",", "x", ",", "y", ",", 
      "\[Theta]", ",", "gnew"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Nx", ",", "Ny"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", 
       RowBox[{"ImageData", "[", "baseImage", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"x", "=", 
      RowBox[{"g", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"y", "=", 
      RowBox[{"g", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gnew", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"y", "-", ".5"}], ",", 
         RowBox[{"Nx", "+", "1", "-", "x", "-", ".5"}]}], "}"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"contours", "=", 
      RowBox[{"ListContourPlot", "[", 
       RowBox[{
        RowBox[{"Reverse", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"Min", ",", "U", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Contours", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"\[Lambda]", " ", "0.2", "i"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "Ncontours"}], "}"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ContourStyle", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Opacity", "[", "1.0", "]"}], ",", 
             RowBox[{"Specularity", "[", 
              RowBox[{"White", ",", "30"}], "]"}], ",", 
             RowBox[{"ColorData", "[", 
              RowBox[{"\"\<SolarColors\>\"", ",", " ", ".2"}], "]"}]}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "Ncontours"}], "}"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ContourShading", "\[Rule]", "None"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PerformanceGoal", "\[Rule]", "\"\<Quality\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"AspectRatio", "\[Rule]", 
         RowBox[{"ImageAspectRatio", "[", "baseImage", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Frame", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Epilog", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"PointSize", "[", "Large", "]"}], ",", "Green", ",", 
           RowBox[{"Point", "[", 
            RowBox[{"g", "\[LeftDoubleBracket]", 
             RowBox[{";;", "2"}], "\[RightDoubleBracket]"}], "]"}]}], "}"}]}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"SetAlphaChannel", "[", 
          RowBox[{"baseImage", ",", "0.333"}], "]"}], ",", "contours", ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"{", 
           RowBox[{"Blue", ",", 
            RowBox[{"PointSize", "[", "Large", "]"}], ",", 
            RowBox[{"Point", "[", "gnew", "]"}]}], "}"}], "]"}]}], "}"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7984378177091007`*^9, 3.798437846972333*^9}, {
   3.7984379364683695`*^9, 3.798437939487838*^9}, {3.8103613475922956`*^9, 
   3.810361357406309*^9}, {3.8127340910689335`*^9, 3.812734129916703*^9}, {
   3.8127342396258764`*^9, 3.8127342634418945`*^9}, {3.8127343206978583`*^9, 
   3.8127343234842606`*^9}, {3.812734508623558*^9, 3.81273451243145*^9}, {
   3.8127345631217256`*^9, 3.8127345664960427`*^9}, 3.8127348957144575`*^9, {
   3.8127349442134414`*^9, 3.812734970818735*^9}, {3.812735007002796*^9, 
   3.8127350305048037`*^9}, {3.8127350842907224`*^9, 
   3.8127351178570814`*^9}, {3.812735302492604*^9, 3.812735310656954*^9}, {
   3.8127354769065485`*^9, 3.812735477084334*^9}, {3.8127355147722635`*^9, 
   3.8127355213645215`*^9}, {3.8127360387014594`*^9, 3.8127360646841*^9}, {
   3.812736290613755*^9, 3.8127363104013023`*^9}, {3.8127364383000107`*^9, 
   3.8127364480985336`*^9}, {3.812736494075801*^9, 3.812736497786374*^9}, 
   3.81273655270789*^9, {3.812737002558903*^9, 3.8127370351142454`*^9}, {
   3.812737201164796*^9, 3.812737244918272*^9}, {3.812737360412074*^9, 
   3.812737382963398*^9}, {3.8127374491563115`*^9, 3.812737452379822*^9}, 
   3.812737531606521*^9, {3.812737594544076*^9, 3.8127376318152866`*^9}, 
   3.8127376926951103`*^9, {3.8128879891732388`*^9, 3.8128879910944557`*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"dfbcc53f-2354-421a-ac99-d6bf5de92ffc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotContoursR2oneColor3D", "[", 
   RowBox[{
   "U_", ",", "Ncontours_", ",", "\[Lambda]_", ",", "baseImage_", ",", "g_", 
    ",", 
    RowBox[{"ySelect_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "contours", ",", "Nx", ",", "Ny", ",", "x", ",", "y", ",", "\[Theta]", 
      ",", "gnew", ",", "base"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Nx", ",", "Ny"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", 
       RowBox[{"ImageData", "[", "baseImage", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"x", "=", 
      RowBox[{"g", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"y", "=", 
      RowBox[{"g", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Theta]", "=", 
      RowBox[{"g", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gnew", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Theta]", "/", "s\[Theta]"}], "+", "1"}], ",", 
         RowBox[{"x", "-", "ySelect"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Dimensions", "[", "U", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "-", "y"}]}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"base", "=", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Texture", "[", "baseImage", "]"}], ",", 
         RowBox[{"EdgeForm", "[", "]"}], ",", 
         RowBox[{"Polygon", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "Nx", ",", "1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "Nx", ",", "Ny"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "Ny"}], "}"}]}], "}"}], ",", 
           RowBox[{"VertexTextureCoordinates", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"contours", "=", 
      RowBox[{"ListContourPlot3D", "[", 
       RowBox[{
        RowBox[{"Reverse", "[", 
         RowBox[{"Transpose", "[", 
          RowBox[{"U", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1", ",", "3"}], "}"}]}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Contours", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"\[Lambda]", " ", "0.2", "i"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "Ncontours"}], "}"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ContourStyle", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Opacity", "[", "1.0", "]"}], ",", 
             RowBox[{"Specularity", "[", 
              RowBox[{"White", ",", "30"}], "]"}], ",", 
             RowBox[{"ColorData", "[", 
              RowBox[{"\"\<SolarColors\>\"", ",", " ", ".2"}], "]"}]}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "Ncontours"}], "}"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PerformanceGoal", "\[Rule]", "\"\<Quality\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Graphics3D", "[", 
          RowBox[{"{", 
           RowBox[{"Cyan", ",", 
            RowBox[{"Sphere", "[", 
             RowBox[{"gnew", ",", "1"}], "]"}]}], "}"}], "]"}], ",", 
         "contours", ",", "base"}], "}"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQfenfbWf71W8c15g/dQXRVySWeYJovrbdXiCaie9Q
GIjOrGiOBdE3ynvyQHTKeZZ8EP0lc3UdiP4dWtkKostytlWkAOmKJKY+EN3h
p74CRGedXAymf7SzrgPRZvstwPSbGYu2guiSS3/B9PmGLVVpQHoHz6k6EL3u
7uW1IHpNh8w6EO3FaXMCRN/6WwimHzo9+ACiL+Y2fwbRNXeWCacD6UWL/UVB
9IQWR1kQfYPrgRyIXqsTpAWiX+js0gbR3/7dMwXR8nbeZiBaSXWJM4h+FsXn
DqL5DkssB9FtJ03ANADKKaNf
  "],
 CellLabel->
  "In[118]:=",ExpressionUUID->"944f4e68-9478-4b7a-ac83-d0749bf07170"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Load Images", "Chapter",
 CellChangeTimes->{{3.8713709923185797`*^9, 
  3.8713709944375134`*^9}},ExpressionUUID->"c9c7d7c1-10e9-4145-a7f4-\
284f19659d5d"],

Cell["\<\
The annotations of the images are not always fully correct (relations between \
parent and child vessels, and directions of vessels may be incorrect for some \
images).\
\>", "Text",
 CellChangeTimes->{{3.871371837217696*^9, 
  3.8713719006621995`*^9}},ExpressionUUID->"e76e243f-fe85-4995-845d-\
d375675d8a2a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"directory", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<IO_STAR_GT\>\""}], 
     "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filesJSON", "=", 
   RowBox[{"FileNames", "[", 
    RowBox[{"\"\<*.json\>\"", ",", "directory"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filesIM", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"First", "[", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"FileNames", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FileBaseName", "[", "#", "]"}], "<>", "\"\<.*\>\""}], ",",
           "directory"}], "]"}], ",", "#"}], "]"}], "]"}], "&"}], "/@", 
    "filesJSON"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6321104764003205`*^9, 3.632110714784951*^9}, {
   3.63211959709842*^9, 3.632119600379729*^9}, {3.6321199442302475`*^9, 
   3.6321199468396807`*^9}, {3.632120363524599*^9, 3.632120367509011*^9}, 
   3.63212040377491*^9, 3.6321204502699223`*^9, {3.6321207747376804`*^9, 
   3.6321208270347404`*^9}, {3.6321268055047607`*^9, 3.63212681140135*^9}, {
   3.632139864226648*^9, 3.6321398862226477`*^9}, {3.6321401601742477`*^9, 
   3.6321401616874475`*^9}, {3.632201551756397*^9, 3.632201556538875*^9}, {
   3.634356640149673*^9, 3.6343566794155087`*^9}, {3.6363456535650477`*^9, 
   3.636345684555705*^9}, {3.6363552519235287`*^9, 3.6363552521110687`*^9}, {
   3.63644695266846*^9, 3.636446997559087*^9}, {3.637563983851345*^9, 
   3.637563985865958*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"82e63006-53b2-4b05-a2a6-f209d75dae34"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "filesIM", "]"}]], "Input",
 CellChangeTimes->{{3.6379865491602664`*^9, 3.637986554957308*^9}},
 CellLabel->
  "In[122]:=",ExpressionUUID->"2a90ec71-a212-41f2-b1b7-1f4f98314f30"]
}, Closed]],

Cell[CellGroupData[{

Cell["Select Image and Annotations", "Chapter",
 CellChangeTimes->{{3.871370998987939*^9, 3.871371001628995*^9}, {
  3.871371941307643*^9, 
  3.8713719442895346`*^9}},ExpressionUUID->"7bd0086e-ee3c-404f-ad98-\
96d9757a185b"],

Cell[CellGroupData[{

Cell["Load image and annotations", "Section",
 CellChangeTimes->{{3.631418976560703*^9, 
  3.6314189813211336`*^9}},ExpressionUUID->"43f82082-eb36-44c7-a900-\
ede8304bac18"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"VesselTrees", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "1", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", ",", "8", 
       ",", "9", ",", "10", ",", "11", ",", "12", ",", "13", ",", "14", ",", 
       "15", ",", "16", ",", "17", ",", "18", ",", "19", ",", "20", ",", "21",
        ",", "22", ",", "23", ",", "24", ",", "25", ",", "26", ",", "27", ",",
        "28", ",", "29", ",", "30", ",", "31", ",", "32", ",", "33", ",", 
       "34"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "36", ",", "37", ",", "38", ",", "39", ",", "40", ",", "41", ",", "42", 
       ",", "43", ",", "44", ",", "45", ",", "46", ",", "48", ",", "49", ",", 
       "50", ",", "51", ",", "52", ",", "53", ",", "54", ",", "55", ",", "56",
        ",", "57"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "58", ",", "59", ",", "60", ",", "61", ",", "62", ",", "63", ",", 
       "64"}], "}"}], ",", 
     RowBox[{"{", "66", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "67", ",", "68", ",", "69", ",", "70", ",", "71", ",", "74", ",", "75", 
       ",", "76", ",", "77", ",", "78", ",", "80", ",", "81", ",", "82", ",", 
       "83", ",", "84", ",", "85", ",", "86", ",", "87"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "88", ",", "93", ",", "93", ",", "94", ",", "95", ",", "96", ",", "97", 
       ",", "98", ",", "99", ",", "100", ",", "101", ",", "102", ",", "103", 
       ",", "104", ",", "105", ",", "106", ",", "107"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"89", ",", "91", ",", "92"}], "}"}], ",", 
     RowBox[{"{", "90", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"108", ",", "109", ",", "110", ",", "111", ",", "112"}], 
      "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rowSelection", "=", 
   RowBox[{"{", 
    RowBox[{"5", ",", "6", ",", "7", ",", "8", ",", "9", ",", "10"}], "}"}]}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.845713252535706*^9, 3.84571325470693*^9}, {
   3.845713415883027*^9, 3.845713424407385*^9}, {3.8457134694086046`*^9, 
   3.8457135242456703`*^9}, {3.8457135567822046`*^9, 3.845713647605741*^9}, {
   3.845713739573515*^9, 3.8457138057333145`*^9}, {3.84571383840108*^9, 
   3.8457138394341955`*^9}, {3.8457138794498816`*^9, 3.845713972650215*^9}, {
   3.845714010007695*^9, 3.8457141390829678`*^9}, {3.8457143006439443`*^9, 
   3.8457143714637685`*^9}, {3.845714401986539*^9, 3.8457144482632465`*^9}, {
   3.8457145203146095`*^9, 3.8457145730422893`*^9}, {3.8457146310075135`*^9, 
   3.8457147160388575`*^9}, {3.8457147605905237`*^9, 3.845714801536661*^9}, {
   3.8457148331879005`*^9, 3.8457148336938767`*^9}, {3.8457149108660183`*^9, 
   3.8457149157227697`*^9}, {3.8457149720345483`*^9, 
   3.8457149736494017`*^9}, {3.845715010611166*^9, 3.8457150458628216`*^9}, {
   3.8457151059266477`*^9, 3.8457151367800894`*^9}, 3.84571518793342*^9, {
   3.845715335034103*^9, 3.845715389233667*^9}, 3.8457157105679474`*^9, 
   3.845716296606063*^9, {3.8457163552781553`*^9, 3.845716359877267*^9}, {
   3.8457163972317476`*^9, 3.845716402306739*^9}, {3.845716452901424*^9, 
   3.8457167123476954`*^9}, {3.8457168915032973`*^9, 3.845716989784328*^9}, {
   3.845717024207363*^9, 3.8457172215479794`*^9}, {3.845717271136027*^9, 
   3.8457174230991573`*^9}, {3.845718272802392*^9, 3.845718327275676*^9}, {
   3.845718550522497*^9, 3.845718627848344*^9}, {3.845718751556629*^9, 
   3.8457189967721996`*^9}, {3.845719028467415*^9, 3.8457191367816577`*^9}, {
   3.845719181639222*^9, 3.845719215185083*^9}, {3.845719285524641*^9, 
   3.8457193037214975`*^9}, {3.845719342861637*^9, 3.8457193634689503`*^9}, 
   3.848928898762806*^9, {3.848929128690081*^9, 3.848929130835924*^9}, 
   3.8489292085073347`*^9},
 CellLabel->
  "In[123]:=",ExpressionUUID->"7dcedfd5-790e-4966-b94a-d932091335b0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"startVesselsNames", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "1", "}"}], ",", 
     RowBox[{"{", "2", "}"}], ",", 
     RowBox[{"{", "37", "}"}], ",", 
     RowBox[{"{", "58", "}"}], ",", 
     RowBox[{"{", "66", "}"}], ",", 
     RowBox[{"{", "67", "}"}], ",", 
     RowBox[{"{", "88", "}"}], ",", 
     RowBox[{"{", "89", "}"}], ",", 
     RowBox[{"{", "90", "}"}], ",", 
     RowBox[{"{", "108", "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endVesselsNames", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "1", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "5", ",", "7", ",", "9", ",", "12", ",", "13", ",", "16", ",",
        "18", ",", "19", ",", "23", ",", "24", ",", "26", ",", "29", ",", 
       "30", ",", "31", ",", "33", ",", "34"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "36", ",", "39", ",", "41", ",", "45", ",", "48", ",", "49", ",", "51", 
       ",", "53", ",", "54", ",", "56", ",", "57"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"59", ",", "61", ",", "63", ",", "64"}], "}"}], ",", 
     RowBox[{"{", "66", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "69", ",", "71", ",", "75", ",", "77", ",", "78", ",", "81", ",", "82", 
       ",", "84", ",", "86", ",", "87"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "93", ",", "95", ",", "97", ",", "99", ",", "101", ",", "103", ",", 
       "104", ",", "106", ",", "107"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"91", ",", "92"}], "}"}], ",", 
     RowBox[{"{", "90", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"109", ",", "110", ",", "112"}], "}"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdymkow3EAxvF/KBIlV4RhhlcWm9SKZGNkE/FCzrSIMqzmmGsSXrjJUcNC
wiQRbZIjbUoU5cwV5phC0theTGTP78XT58XzDRRVpBfZUBTFsA6OfZ2q/Gbf
4/p40wvQji7WwkoG7xamyU5eofzR1gh3jWtmGJIq/oGC7VOKZpUlSbSHyaUS
J2gw1RHvCr5dICVfcYXRiSZPWMHZ94E3jZZwqL9gsmA1R8KBbR51xC1WTwwM
zumIgyPz3QL4oQtMhaoHfTp0dLMQl/ib2fDBZa0AvmWdF8J450kprBnubSSd
bpzo3uLRCvsM+V3QzM4dgk/mPQWUjxoXId//Ug1lQWX3UJPpoIfKjOswf6vM
d24SpGlYQmjm6dPgJyMiE/JX2Tkw6flPCk3JGw2wvCqyGZbcDrVD7nx/LxT9
KojiOc0ANPgVj0HtxP0UPPj1UsMb7Rk9wKpw+pXI1SWEwmtmHvG7rSgBOh4J
UuDxjCUXLu9cSaHIPUYGX+pjibSo8iai/Xon9K1hD0JlrXIYFtMPJ8nvvaeC
/6ECHiQ=
  "],
 CellLabel->
  "In[125]:=",ExpressionUUID->"c45cd374-f715-4955-9dd1-a3f84bed4288"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"imNr", "=", "2"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"File", " ", "names"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fNameImage", "=", 
   RowBox[{
   "filesIM", "\[LeftDoubleBracket]", "imNr", "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fNameAnnotation", "=", 
    RowBox[{
    "filesJSON", "\[LeftDoubleBracket]", "imNr", "\[RightDoubleBracket]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Import", " ", "data"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"im", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"fNameImage", ",", "\"\<Data\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"Dimensions", "[", "im", "]"}], "]"}], ">", "2"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"im", "=", 
      RowBox[{"im", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "All", ",", "2"}], "\[RightDoubleBracket]"}]}], 
     ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"im", "=", "im"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"im", "=", 
    RowBox[{"Rescale", "[", "im", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Import", " ", "vessel", " ", "annotations"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allAnnotations", "=", 
   RowBox[{"Import", "[", "fNameAnnotation", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vesselAnnotations", "=", 
    RowBox[{"\"\<vessels\>\"", "/.", "allAnnotations"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{"First", "[", "vesselAnnotationsData", "]"}], "]"}], 
      "\[Equal]", "\"\<vessels\>\""}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vesselAnnotations", "=", "allAnnotations"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Show", " ", "data"}], "*)"}]}], "\n", 
 RowBox[{"Show", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image", "[", "im", "]"}], "]"}], "\[IndentingNewLine]", ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Graphics", "[", 
    RowBox[{"Flatten", "@", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{"Arrowheads", "[", "Medium", "]"}], ",", 
       RowBox[{"Arrow", "/@", 
        RowBox[{"Transpose", "/@", 
         RowBox[{"(", 
          RowBox[{"\"\<firstWall\>\"", "/.", "vesselAnnotations"}], 
          ")"}]}]}]}], "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Graphics", "[", 
    RowBox[{"Flatten", "@", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{"Arrowheads", "[", "Medium", "]"}], ",", 
       RowBox[{"Arrow", "/@", 
        RowBox[{"Transpose", "/@", 
         RowBox[{"(", 
          RowBox[{"\"\<secondWall\>\"", "/.", "vesselAnnotations"}], 
          ")"}]}]}]}], "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
   RowBox[{"ImageSize", "\[Rule]", "400"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6321107202386723`*^9, 3.6321107400492725`*^9}, {
   3.6321110363934007`*^9, 3.6321110527020636`*^9}, {3.632119697993126*^9, 
   3.632119721838453*^9}, {3.632119752464096*^9, 3.6321197531360035`*^9}, 
   3.6321199625431676`*^9, {3.632120062138629*^9, 3.632120080993882*^9}, {
   3.6321201879330893`*^9, 3.6321202088239717`*^9}, {3.6321202388557425`*^9, 
   3.632120272992379*^9}, {3.632120305883421*^9, 3.6321203101021757`*^9}, {
   3.632120346352559*^9, 3.6321203466650057`*^9}, {3.632120434332717*^9, 
   3.6321204436450577`*^9}, {3.6363579481806107`*^9, 3.6363579547361045`*^9}, 
   3.636365196435877*^9, {3.6363676748027787`*^9, 3.6363677069765224`*^9}, {
   3.63636800334501*^9, 3.63636800954123*^9}, {3.636430382291294*^9, 
   3.636430428592563*^9}, {3.637666477872963*^9, 3.6376664792986507`*^9}, 
   3.6379004059015694`*^9, {3.665125608863834*^9, 3.665125609066967*^9}, {
   3.665125662627514*^9, 3.665125682076186*^9}, {3.665125772847412*^9, 
   3.6651257965531583`*^9}, 3.8717007151548347`*^9},
 CellLabel->
  "In[127]:=",ExpressionUUID->"0be9d819-edd2-4814-b660-2e985b6ca5f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "define", " ", "the", " ", "basis", " ", "folder", " ", "from", " ", 
    "which", " ", "all", " ", "folders", " ", "can", " ", "be", " ", 
    "created", " ", "and", " ", "reached"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
    "basisfolderExport", "=", 
     "\"\<C://Users//s149687//OneDrive - TU \
Eindhoven//PhD//Presentaties//CASA Day 13 April 2022//Figures//Vessel \
Tracking in Tree//\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"define", " ", "the", " ", "export", " ", "folder"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exportfolder", "=", 
     RowBox[{"StringJoin", "[", 
      RowBox[{"basisfolderExport", ",", "\"\<Image \>\"", ",", 
       RowBox[{"ToString", "[", "imNr", "]"}], ",", "\"\<//\>\""}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "create", " ", "the", " ", "exportfolder", " ", "if", " ", "it", " ", 
     "does", " ", "not", " ", "yet", " ", "exist"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"!", 
      RowBox[{"DirectoryQ", "[", "exportfolder", "]"}]}], ",", 
     RowBox[{"CreateDirectory", "[", "exportfolder", "]"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8273848262998347`*^9, 3.827384849610895*^9}, {
  3.82738487987929*^9, 3.827384908475255*^9}, {3.827384939898744*^9, 
  3.827384966527645*^9}, {3.827385145468956*^9, 3.827385257254636*^9}, {
  3.856494185877508*^9, 3.856494196004239*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"8eeba832-573b-4199-a8b3-d0fe46ba2fee"],

Cell[CellGroupData[{

Cell["Mask", "Subsection",
 CellChangeTimes->{{3.6376471349422803`*^9, 
  3.637647136271988*^9}},ExpressionUUID->"325fbbab-ba7a-4930-920f-\
02e96d794d93"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mask", "=", 
   RowBox[{"ImageData", "[", 
    RowBox[{"Opening", "[", 
     RowBox[{
      RowBox[{"Binarize", "[", 
       RowBox[{
        RowBox[{"Image", "[", "im", "]"}], ",", 
        RowBox[{"1.", "/", "30"}]}], "]"}], ",", "10"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"HighlightImage", "[", 
     RowBox[{
      RowBox[{"ImageAdjust", "[", 
       RowBox[{"Image", "[", "im", "]"}], "]"}], ",", 
      RowBox[{"Image", "[", "mask", "]"}]}], "]"}], ",", 
    RowBox[{"Image", "[", "mask", "]"}]}], "}"}], "]"}]}], "Input",
 CellChangeTimes->{{3.637647423320098*^9, 3.6376475156815567`*^9}, {
  3.6376475619730577`*^9, 3.637647592495425*^9}, {3.6376480131571484`*^9, 
  3.6376480481817827`*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"6ba45815-0889-4f7a-bbf4-d3b02e9680c1"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Downsample image and annotated data
\t(Warning: this overwrites im and vesselAnnotations defined in previous cell)\
\>", "Section",
 CellChangeTimes->{{3.6363552990972195`*^9, 3.6363553092971845`*^9}, {
  3.6364304594823036`*^9, 
  3.6364304877818336`*^9}},ExpressionUUID->"0473a67a-013b-42a8-b83e-\
9b86be48bfd5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Downsample", " ", "by", " ", "factor", " ", "ds"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ds", "=", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"im", "=", 
     RowBox[{"ImageData", "[", 
      RowBox[{"ImageResize", "[", 
       RowBox[{
        RowBox[{"Image", "[", "im", "]"}], ",", 
        RowBox[{"Round", "[", 
         RowBox[{
          RowBox[{"Reverse", "[", 
           RowBox[{"Dimensions", "[", "im", "]"}], "]"}], "/", "ds"}], 
         "]"}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mask", "=", 
     RowBox[{"ImageData", "[", 
      RowBox[{"ImageResize", "[", 
       RowBox[{
        RowBox[{"Image", "[", "mask", "]"}], ",", 
        RowBox[{"Round", "[", 
         RowBox[{
          RowBox[{"Reverse", "[", 
           RowBox[{"Dimensions", "[", "mask", "]"}], "]"}], "/", "ds"}], 
         "]"}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vesselAnnotations", "=", 
     RowBox[{"vesselAnnotations", "/.", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"\"\<secondWall\>\"", "\[Rule]", "x_"}], ")"}], "->", 
       RowBox[{"(", 
        RowBox[{"\"\<secondWall\>\"", "\[Rule]", 
         RowBox[{"x", "/", "ds"}]}], ")"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vesselAnnotations", "=", 
     RowBox[{"vesselAnnotations", "/.", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"\"\<firstWall\>\"", "\[Rule]", "x_"}], ")"}], "->", 
       RowBox[{"(", 
        RowBox[{"\"\<firstWall\>\"", "\[Rule]", 
         RowBox[{"x", "/", "ds"}]}], ")"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vesselAnnotationsData", "=", 
     RowBox[{"vesselAnnotations", "/.", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"\"\<firstWall\>\"", "\[Rule]", "x_"}], ")"}], "->", 
       RowBox[{"(", 
        RowBox[{"\"\<firstWall\>\"", "\[Rule]", 
         RowBox[{"Hold", "[", 
          RowBox[{"Transpose", "@", 
           RowBox[{"graphicsToImageCoordinates", "[", 
            RowBox[{
             RowBox[{"Dimensions", "[", "im", "]"}], ",", 
             RowBox[{"Transpose", "@", "x"}]}], "]"}]}], "]"}]}], ")"}]}]}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vesselAnnotationsData", "=", 
     RowBox[{"vesselAnnotationsData", "/.", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"\"\<secondWall\>\"", "\[Rule]", "x_"}], ")"}], "->", 
       RowBox[{"(", 
        RowBox[{"\"\<secondWall\>\"", "\[Rule]", 
         RowBox[{"Hold", "[", 
          RowBox[{"Transpose", "@", 
           RowBox[{"graphicsToImageCoordinates", "[", 
            RowBox[{
             RowBox[{"Dimensions", "[", "im", "]"}], ",", 
             RowBox[{"Transpose", "@", "x"}]}], "]"}]}], "]"}]}], ")"}]}]}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vesselAnnotationsData", "=", 
     RowBox[{"vesselAnnotationsData", "//", "ReleaseHold"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Show", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ImageAdjust", "[", 
      RowBox[{"Image", "[", "im", "]"}], "]"}], "\[IndentingNewLine]", ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"Flatten", "@", 
       RowBox[{"{", 
        RowBox[{"Green", ",", 
         RowBox[{"Line", "/@", 
          RowBox[{"Transpose", "/@", 
           RowBox[{"(", 
            RowBox[{"\"\<firstWall\>\"", "/.", "vesselAnnotations"}], 
            ")"}]}]}]}], "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"Flatten", "@", 
       RowBox[{"{", 
        RowBox[{"Green", ",", 
         RowBox[{"Line", "/@", 
          RowBox[{"Transpose", "/@", 
           RowBox[{"(", 
            RowBox[{"\"\<secondWall\>\"", "/.", "vesselAnnotations"}], 
            ")"}]}]}]}], "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
     RowBox[{"ImageSize", "\[Rule]", "400"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.636355318406521*^9, 3.636355349164131*^9}, {
   3.6363554698248262`*^9, 3.636355491654749*^9}, {3.6363725867583313`*^9, 
   3.6363726013208914`*^9}, 3.6363774643521256`*^9, 3.6363780216915283`*^9, {
   3.6364304439847364`*^9, 3.6364304502977943`*^9}, {3.6375745760000887`*^9, 
   3.6375745860450387`*^9}, {3.637647626108798*^9, 3.637647641443409*^9}, {
   3.6376478227745934`*^9, 3.637647823036603*^9}, {3.6376478694577856`*^9, 
   3.637647870273777*^9}, {3.6376480592724824`*^9, 3.6376480767178745`*^9}, 
   3.6376664943201127`*^9, {3.637667931920068*^9, 3.6376679342667074`*^9}, {
   3.6651249892361064`*^9, 3.6651250572696037`*^9}, {3.665125103245185*^9, 
   3.6651251126906586`*^9}, {3.665125153075572*^9, 3.6651252078403435`*^9}, {
   3.6651252614910035`*^9, 3.66512528849964*^9}, {3.665125349421134*^9, 
   3.66512535355113*^9}, 3.665125460411048*^9, {3.665125723368497*^9, 
   3.6651257564741354`*^9}, {3.665127657212329*^9, 3.6651276574623733`*^9}, {
   3.665127695633624*^9, 3.6651277135252595`*^9}, 3.8281522099635496`*^9, 
   3.828156900410407*^9, 3.871700707743778*^9},
 CellLabel->
  "In[142]:=",ExpressionUUID->"b494ccde-24e9-4534-8ce2-02e46397e658"],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Determine seed points and ending points", \
"Section"]], "Subsection",
 CellChangeTimes->{{3.6376617745301933`*^9, 
  3.637661790231619*^9}},ExpressionUUID->"d72837cd-2ba7-4e2d-8716-\
5a2a1ebbc5f1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Get", " ", "all", " ", "endpoints"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"endVesselNames", "=", 
     RowBox[{"Complement", "[", 
      RowBox[{
       RowBox[{"\"\<name\>\"", "/.", "vesselAnnotationsData"}], ",", 
       RowBox[{"\"\<parentVessel\>\"", "/.", "vesselAnnotationsData"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"endVessels", "=", 
     RowBox[{"Select", "[", 
      RowBox[{"vesselAnnotationsData", ",", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{"endVesselNames", ",", 
          RowBox[{"\"\<name\>\"", "/.", "#"}]}], "]"}], "&"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ends", "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{".5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Last", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<firstWall\>\"", "/.", "#"}], ")"}], 
             "\[Transpose]"}], "]"}], "+", 
           RowBox[{"Last", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<secondWall\>\"", "/.", "#"}], ")"}], 
             "\[Transpose]"}], "]"}]}], ")"}]}], "&"}], ",", "endVessels"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Get", " ", "all", " ", "startpoints"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"startVessels", "=", 
     RowBox[{"Select", "[", 
      RowBox[{"vesselAnnotationsData", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\"\<parentVessel\>\"", "/.", "#"}], ")"}], "===", "0"}], 
        "&"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"starts", "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{".5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<firstWall\>\"", "/.", "#"}], ")"}], 
             "\[Transpose]"}], "]"}], "+", 
           RowBox[{"First", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<secondWall\>\"", "/.", "#"}], ")"}], 
             "\[Transpose]"}], "]"}]}], ")"}]}], "&"}], ",", "startVessels"}],
       "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Get", " ", "all", " ", "startpoints", " ", "and", " ", "bifurcation", 
     " ", "points"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"seeds", "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{".5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<firstWall\>\"", "/.", "#"}], ")"}], 
             "\[Transpose]"}], "]"}], "+", 
           RowBox[{"First", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<secondWall\>\"", "/.", "#"}], ")"}], 
             "\[Transpose]"}], "]"}]}], ")"}]}], "&"}], ",", 
       "vesselAnnotationsData"}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.6375629321902943`*^9, 3.637562981511407*^9}, {
  3.6375631228950205`*^9, 3.637563124136774*^9}, {3.637564421115335*^9, 
  3.637564535208557*^9}, {3.6375760355456734`*^9, 3.6375760492041087`*^9}, {
  3.6376476574069815`*^9, 3.6376476606063604`*^9}, {3.637662327983378*^9, 
  3.6376623301945167`*^9}, {3.6376623738506556`*^9, 3.6376624259843764`*^9}, {
  3.637662562875713*^9, 3.6376625735303144`*^9}, {3.6651253768565345`*^9, 
  3.6651253915338683`*^9}, {3.6651255061947412`*^9, 3.665125543353876*^9}, {
  3.665125768237873*^9, 3.665125769159793*^9}},
 CellLabel->
  "In[151]:=",ExpressionUUID->"d7a40384-4cf1-43a4-be99-e3f65a0dfa91"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Show", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ImageAdjust", "[", 
       RowBox[{"Image", "[", "im", "]"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"PointSize", "[", ".012", "]"}], ",", "Green", ",", 
         RowBox[{"PointImageCoordinates", "[", 
          RowBox[{"im", ",", "seeds"}], "]"}], ",", "Red", ",", 
         RowBox[{"PointImageCoordinates", "[", 
          RowBox[{"im", ",", "ends"}], "]"}]}], "}"}], "]"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Show", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ImageAdjust", "[", 
       RowBox[{"Image", "[", "im", "]"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"PointSize", "[", ".012", "]"}], ",", "Green", ",", 
         RowBox[{"PointImageCoordinates", "[", 
          RowBox[{"im", ",", "starts"}], "]"}], ",", "Red", ",", 
         RowBox[{"PointImageCoordinates", "[", 
          RowBox[{"im", ",", "ends"}], "]"}]}], "}"}], "]"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.6375643210909867`*^9, 3.637564372086564*^9}, {
   3.6375645399144735`*^9, 3.637564553910674*^9}, {3.6375646188390436`*^9, 
   3.6375647266739073`*^9}, 3.637662434206366*^9, {3.637662488296561*^9, 
   3.637662518494814*^9}, {3.6651254054734664`*^9, 3.665125417760874*^9}, {
   3.6651274454681606`*^9, 3.665127462490714*^9}, {3.665132246173501*^9, 
   3.6651322753192806`*^9}},
 CellLabel->
  "In[157]:=",ExpressionUUID->"df574fd1-8df7-4939-a2f6-b6331edcb6ec"]
}, Closed]],

Cell[CellGroupData[{

Cell["Determine centerline and orientation", "Subsection",
 CellChangeTimes->{{3.637662589973176*^9, 
  3.6376625969929295`*^9}},ExpressionUUID->"44590df7-90bf-4198-a60b-\
88ce06c7ed98"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nrOfAveragePoints", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"startAndBifurcationPoints", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "first", " ", "and", " ", "second", " ", "wall"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"trackFirstWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<firstWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"trackSecondWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<secondWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Average", " ", "both", " ", "walls", " ", "to", " ", "obtain", " ", 
          "center", " ", "points"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Make", " ", "a", " ", "list", " ", "of", " ", "the", " ", "first", 
          " ", "nrOfAveragePoints", " ", "center", " ", 
          RowBox[{"points", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"centerPointList", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"First", "[", 
                 RowBox[{"Nearest", "[", 
                  RowBox[{"trackSecondWall", ",", "#"}], "]"}], "]"}]}], 
               "}"}], "]"}], "&"}], "@", 
            RowBox[{
            "trackFirstWall", "\[LeftDoubleBracket]", "pointNr", 
             "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"pointNr", ",", "1", ",", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"Length", "[", "trackFirstWall", "]"}], ",", 
               "nrOfAveragePoints"}], "]"}], ",", "1"}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "From", " ", "this", " ", "list", " ", "compute", " ", "the", " ", 
           "average", " ", "direction", " ", "vector"}], ",", " ", 
          RowBox[{"and", " ", "corresponding", " ", "angle"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"averageVector", "=", 
         RowBox[{"Normalize", "@", 
          RowBox[{"Mean", "[", 
           RowBox[{
            RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "-", 
            RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", 
              RowBox[{"-", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"averageAngle", "=", 
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{
           "averageVector", "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "averageVector", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Output", " ", "start", " ", "point"}], ",", " ", 
          RowBox[{"direction", " ", "vector", " ", "and", " ", "angle"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "centerPointList", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}], ",", "averageVector", ",", 
          "averageAngle"}], "}"}]}], ")"}], "&"}], ",", 
     "vesselAnnotationsData"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637571376722161*^9, 3.6375714391064887`*^9}, {
   3.637572083999985*^9, 3.637572088769514*^9}, {3.637662151448311*^9, 
   3.637662153882971*^9}, 3.6651257693629274`*^9, {3.665133482924532*^9, 
   3.6651334839216113`*^9}},
 CellLabel->
  "In[158]:=",ExpressionUUID->"f28f80b3-0a47-45f1-9939-364788155dae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nrOfAveragePoints", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endPoints", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "first", " ", "and", " ", "second", " ", "wall"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"trackFirstWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<firstWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"trackSecondWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<secondWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Average", " ", "both", " ", "walls", " ", "to", " ", "obtain", " ", 
          "center", " ", "points"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Make", " ", "a", " ", "list", " ", "of", " ", "the", " ", "first", 
          " ", "nrOfAveragePoints", " ", "center", " ", 
          RowBox[{"points", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"centerPointList", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"First", "[", 
                 RowBox[{"Nearest", "[", 
                  RowBox[{"trackSecondWall", ",", "#"}], "]"}], "]"}]}], 
               "}"}], "]"}], "&"}], "@", 
            RowBox[{
            "trackFirstWall", "\[LeftDoubleBracket]", "pointNr", 
             "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"pointNr", ",", 
             RowBox[{"Max", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "trackFirstWall", "]"}], "-", 
                "nrOfAveragePoints", "+", "1"}], ",", "1"}], "]"}], ",", 
             RowBox[{"Length", "[", "trackFirstWall", "]"}], ",", "1"}], 
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "From", " ", "this", " ", "list", " ", "compute", " ", "the", " ", 
           "average", " ", "direction", " ", "vector"}], ",", " ", 
          RowBox[{"and", " ", "corresponding", " ", "angle"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"averageVector", "=", 
         RowBox[{"Normalize", "@", 
          RowBox[{"Mean", "[", 
           RowBox[{
            RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "-", 
            RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", 
              RowBox[{"-", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"averageAngle", "=", 
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{
           "averageVector", "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "averageVector", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Output", " ", "start", " ", "point"}], ",", " ", 
          RowBox[{"direction", " ", "vector", " ", "and", " ", "angle"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", 
          "averageVector", ",", "averageAngle"}], "}"}]}], ")"}], "&"}], ",", 
     "endVessels"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637571376722161*^9, 3.6375714391064887`*^9}, {
   3.6375714970443068`*^9, 3.637571510733118*^9}, 3.6375715541069317`*^9, 
   3.637571869331643*^9, {3.637571904850258*^9, 3.6375719098608217`*^9}, {
   3.637572073906564*^9, 3.6375720788098755`*^9}, {3.665133479661851*^9, 
   3.6651334810574455`*^9}},
 CellLabel->
  "In[160]:=",ExpressionUUID->"af00f45a-129b-44f7-9e6a-c1427ad0ee07"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nrOfAveragePoints", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"startPoints", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "first", " ", "and", " ", "second", " ", "wall"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"trackFirstWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<firstWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"trackSecondWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<secondWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Average", " ", "both", " ", "walls", " ", "to", " ", "obtain", " ", 
          "center", " ", "points"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Make", " ", "a", " ", "list", " ", "of", " ", "the", " ", "first", 
          " ", "nrOfAveragePoints", " ", "center", " ", 
          RowBox[{"points", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"centerPointList", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"First", "[", 
                 RowBox[{"Nearest", "[", 
                  RowBox[{"trackSecondWall", ",", "#"}], "]"}], "]"}]}], 
               "}"}], "]"}], "&"}], "@", 
            RowBox[{
            "trackFirstWall", "\[LeftDoubleBracket]", "pointNr", 
             "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"pointNr", ",", "1", ",", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"Length", "[", "trackFirstWall", "]"}], ",", 
               "nrOfAveragePoints"}], "]"}], ",", "1"}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "From", " ", "this", " ", "list", " ", "compute", " ", "the", " ", 
           "average", " ", "direction", " ", "vector"}], ",", " ", 
          RowBox[{"and", " ", "corresponding", " ", "angle"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"averageVector", "=", 
         RowBox[{"Normalize", "@", 
          RowBox[{"Mean", "[", 
           RowBox[{
            RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "-", 
            RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", 
              RowBox[{"-", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"averageAngle", "=", 
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{
           "averageVector", "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "averageVector", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Output", " ", "start", " ", "point"}], ",", " ", 
          RowBox[{"direction", " ", "vector", " ", "and", " ", "angle"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "centerPointList", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}], ",", "averageVector", ",", 
          "averageAngle"}], "}"}]}], ")"}], "&"}], ",", "startVessels"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637571376722161*^9, 3.6375714391064887`*^9}, {
  3.637572083999985*^9, 3.637572088769514*^9}, {3.637576301651916*^9, 
  3.637576303482267*^9}, {3.6651334758047094`*^9, 3.665133476842558*^9}},
 CellLabel->
  "In[162]:=",ExpressionUUID->"0d8d11ff-dc2f-444e-a5cf-bc4d22687ac1"],

Cell[CellGroupData[{

Cell["Show seeds", "Subsubsection",
 CellChangeTimes->{{3.6364354641650286`*^9, 
  3.636435466540027*^9}},ExpressionUUID->"ac487801-e186-4fda-8d59-\
623ac2191b93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotVessel", "[", 
   RowBox[{"im_", ",", "vessel_"}], "]"}], ":=", "\n", 
  RowBox[{"{", "\n", 
   RowBox[{
    RowBox[{"LineImageCoordinates", "[", 
     RowBox[{"im", ",", 
      RowBox[{"Transpose", "[", 
       RowBox[{"\"\<firstWall\>\"", "/.", "vessel"}], "]"}]}], "]"}], ",", 
    "\n", 
    RowBox[{"LineImageCoordinates", "[", 
     RowBox[{"im", ",", 
      RowBox[{"Transpose", "[", 
       RowBox[{"\"\<secondWall\>\"", "/.", "vessel"}], "]"}]}], "]"}]}], "\n",
    "}"}]}]], "Code",
 CellChangeTimes->{{3.665132626752398*^9, 3.665132638564038*^9}, {
  3.6651326952949867`*^9, 3.665132752191538*^9}, {3.6651328334133463`*^9, 
  3.665132843059987*^9}},
 CellLabel->
  "In[164]:=",ExpressionUUID->"14f14933-03f5-4d0a-8f65-30ad965d4be3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"seedsPointFig1", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{"im", ",", 
       RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsArrowFig1", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
     RowBox[{"ArrowImageCoordinates", "[", 
      RowBox[{"im", ",", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
           RowBox[{"10", "*", 
            RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
         "}"}]}]}], "]"}]}], "\[IndentingNewLine]", "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsPointFig2", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{"im", ",", 
       RowBox[{"startPoints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsArrowFig2", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
     RowBox[{"ArrowImageCoordinates", "[", 
      RowBox[{"im", ",", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"startPoints", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"startPoints", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
           RowBox[{"10", "*", 
            RowBox[{"startPoints", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
         "}"}]}]}], "]"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endsPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Red", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{"im", ",", 
       RowBox[{"endPoints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"endsArrowFig", "=", 
    RowBox[{"{", 
     RowBox[{"Red", ",", 
      RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
      RowBox[{"ArrowImageCoordinates", "[", 
       RowBox[{"im", ",", 
        RowBox[{"Transpose", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"endPoints", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{
            RowBox[{"endPoints", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
            RowBox[{"10", "*", 
             RowBox[{"endPoints", "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
          "}"}]}]}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endVesselsFig", "=", 
   RowBox[{"{", 
    RowBox[{"Flatten", "@", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"PlotVessel", "[", 
          RowBox[{"im", ",", "#"}], "]"}], "&"}], "/@", "endVessels"}]}], 
      "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vesselTreeFig", "=", 
   RowBox[{"{", 
    RowBox[{"Flatten", "@", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"PlotVessel", "[", 
          RowBox[{"im", ",", "#"}], "]"}], "&"}], "/@", 
        "vesselAnnotationsData"}]}], "}"}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6375733776930532`*^9, 3.6375733990538235`*^9}, {
   3.637573438748947*^9, 3.637573513384824*^9}, {3.6375739127589364`*^9, 
   3.6375739367832603`*^9}, {3.6375741156089892`*^9, 3.637574117987109*^9}, {
   3.637577757838523*^9, 3.6375777592760987`*^9}, 3.637647069102641*^9, {
   3.6376622145779233`*^9, 3.637662226233616*^9}, {3.637662688118195*^9, 
   3.6376627319202833`*^9}, {3.6376632397342668`*^9, 
   3.6376632409254665`*^9}, {3.665125769566063*^9, 3.6651257697535744`*^9}, {
   3.6651277884740453`*^9, 3.6651278594471617`*^9}, {3.665128055585786*^9, 
   3.665128059679647*^9}, {3.665128262043105*^9, 3.6651282835605736`*^9}, {
   3.665128350634693*^9, 3.6651284269356985`*^9}, {3.665128525495489*^9, 
   3.6651285713734837`*^9}, {3.6651323517010307`*^9, 3.665132508457713*^9}, {
   3.665132576212057*^9, 3.66513258850613*^9}, {3.6651326653865037`*^9, 
   3.6651326712932367`*^9}, {3.665132761758466*^9, 3.665132804195445*^9}, {
   3.6651334918823147`*^9, 3.6651335861861677`*^9}},
 CellLabel->
  "In[165]:=",ExpressionUUID->"5bf54966-1721-41e7-9a70-cdef33640754"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"Image", "@", "im"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", 
        RowBox[{
        "seedsPointFig1", ",", "seedsArrowFig1", ",", "endsPointFig", ",", 
         "endsArrowFig"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"Image", "@", "im"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", 
        RowBox[{
        "seedsPointFig2", ",", "seedsArrowFig2", ",", "endsPointFig", ",", 
         "endsArrowFig"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.637662696832557*^9, 3.6376626989471416`*^9}, {
  3.6376627426761923`*^9, 3.6376627565291605`*^9}, {3.6376632464549217`*^9, 
  3.6376632614114428`*^9}},
 CellLabel->
  "In[173]:=",ExpressionUUID->"251074d7-ebba-4236-91f7-e2143956e781"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"Image", "@", "im"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", "endVesselsFig", "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"Image", "@", "im"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", "vesselTreeFig", "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.637662696832557*^9, 3.6376626989471416`*^9}, {
  3.6376627426761923`*^9, 3.6376627565291605`*^9}, {3.6376632464549217`*^9, 
  3.637663289619564*^9}},
 CellLabel->
  "In[174]:=",ExpressionUUID->"a9613da2-1e1e-405e-8619-8fdb904747fa"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Select upper half", "Section",
 CellChangeTimes->{{3.631418976560703*^9, 3.6314189813211336`*^9}, {
  3.665124670482873*^9, 
  3.665124677875822*^9}},ExpressionUUID->"60c4a9c6-bfe8-4aa6-9656-\
aa9507475bf2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ySelect", "=", 
   RowBox[{"460", "/", "ds"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"imhalf", "=", 
   RowBox[{"im", "\[LeftDoubleBracket]", 
    RowBox[{"1", ";;", "ySelect"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"maskhalf", "=", 
    RowBox[{"mask", "\[LeftDoubleBracket]", 
     RowBox[{"1", ";;", "ySelect"}], "\[RightDoubleBracket]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image", "[", "imhalf", "]"}], "]"}], "\[IndentingNewLine]", ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Graphics", "[", 
    RowBox[{"Flatten", "@", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"PlotVessel", "[", 
          RowBox[{"imhalf", ",", "#"}], "]"}], "&"}], "/@", 
        "vesselAnnotationsData"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", ",", 
   RowBox[{"ImageSize", "\[Rule]", "400"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.636355318406521*^9, 3.636355349164131*^9}, {
   3.6363554698248262`*^9, 3.636355491654749*^9}, {3.6363725867583313`*^9, 
   3.6363726013208914`*^9}, 3.6363774643521256`*^9, 3.6363780216915283`*^9, {
   3.6364304439847364`*^9, 3.6364304502977943`*^9}, {3.6375745760000887`*^9, 
   3.6375745860450387`*^9}, {3.637647626108798*^9, 3.637647641443409*^9}, {
   3.6376478227745934`*^9, 3.637647823036603*^9}, {3.6376478694577856`*^9, 
   3.637647870273777*^9}, {3.6376480592724824`*^9, 3.6376480767178745`*^9}, 
   3.6376664943201127`*^9, {3.637667931920068*^9, 3.6376679342667074`*^9}, {
   3.6651247418473225`*^9, 3.665124864065896*^9}, {3.665125769941083*^9, 
   3.665125770112968*^9}, {3.665133034537816*^9, 3.6651330749348125`*^9}, {
   3.828152243678896*^9, 3.828152243860917*^9}, {3.828152292828909*^9, 
   3.8281522953188434`*^9}, {3.828152340859226*^9, 3.8281523836736603`*^9}, {
   3.8281569299595327`*^9, 3.828156938150872*^9}},
 CellLabel->
  "In[175]:=",ExpressionUUID->"b4e1f2a8-d52a-46d0-9fa7-4029d808d3bb"],

Cell[CellGroupData[{

Cell["Select seeds and end points", "Subsubsection",
 CellChangeTimes->{{3.6364354641650286`*^9, 3.636435466540027*^9}, {
  3.66513312005836*^9, 
  3.665133124464814*^9}},ExpressionUUID->"9047ff7c-6529-4995-939f-\
a66378c614be"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"startAndBifurcationPoints", "=", 
   RowBox[{"Select", "[", 
    RowBox[{"startAndBifurcationPoints", ",", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<", "ySelect"}], 
      "&"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"startPoints", "=", 
   RowBox[{"Select", "[", 
    RowBox[{"startPoints", ",", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<", "ySelect"}], 
      "&"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endPoints", "=", 
   RowBox[{"Select", "[", 
    RowBox[{"endPoints", ",", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "<", "ySelect"}], 
      "&"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6651331639992104`*^9, 3.6651332051617856`*^9}, {
  3.665133271614626*^9, 3.6651332727709093`*^9}, {3.6651333039379983`*^9, 
  3.6651333293099594`*^9}, {3.665133384391384*^9, 3.665133397285434*^9}, {
  3.6651334423014145`*^9, 3.6651334523676195`*^9}, {3.665133606935688*^9, 
  3.6651336143043256`*^9}},
 CellLabel->
  "In[179]:=",ExpressionUUID->"8b120139-57dd-44de-97f6-b1fd4afda71c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Show seeds", "Subsubsection",
 CellChangeTimes->{{3.6364354641650286`*^9, 
  3.636435466540027*^9}},ExpressionUUID->"83045f1d-2b2b-4fb5-9dc4-\
21c028870589"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotVessel", "[", 
   RowBox[{"im_", ",", "vessel_"}], "]"}], ":=", "\n", 
  RowBox[{"{", "\n", 
   RowBox[{
    RowBox[{"LineImageCoordinates", "[", 
     RowBox[{"im", ",", 
      RowBox[{"Transpose", "[", 
       RowBox[{"\"\<firstWall\>\"", "/.", "vessel"}], "]"}]}], "]"}], ",", 
    "\n", 
    RowBox[{"LineImageCoordinates", "[", 
     RowBox[{"im", ",", 
      RowBox[{"Transpose", "[", 
       RowBox[{"\"\<secondWall\>\"", "/.", "vessel"}], "]"}]}], "]"}]}], "\n",
    "}"}]}]], "Code",
 CellChangeTimes->{{3.665132626752398*^9, 3.665132638564038*^9}, {
  3.6651326952949867`*^9, 3.665132752191538*^9}, {3.6651328334133463`*^9, 
  3.665132843059987*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"469aee95-3b03-48f6-9de5-cbb94bf8db71"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"seedsPointFig1", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsArrowFig1", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
     RowBox[{"ArrowImageCoordinates", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
           RowBox[{"10", "*", 
            RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
         "}"}]}]}], "]"}]}], "\[IndentingNewLine]", "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsPointFig2", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"startPoints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsArrowFig2", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
     RowBox[{"ArrowImageCoordinates", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"startPoints", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"startPoints", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
           RowBox[{"10", "*", 
            RowBox[{"startPoints", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
         "}"}]}]}], "]"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endsPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Red", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"endPoints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"endsArrowFig", "=", 
    RowBox[{"{", 
     RowBox[{"Red", ",", 
      RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
      RowBox[{"ArrowImageCoordinates", "[", 
       RowBox[{"imhalf", ",", 
        RowBox[{"Transpose", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"endPoints", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{
            RowBox[{"endPoints", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
            RowBox[{"10", "*", 
             RowBox[{"endPoints", "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
          "}"}]}]}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endVesselsFig", "=", 
   RowBox[{"{", 
    RowBox[{"Flatten", "@", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"PlotVessel", "[", 
          RowBox[{"imhalf", ",", "#"}], "]"}], "&"}], "/@", "endVessels"}]}], 
      "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vesselTreeFig", "=", 
   RowBox[{"{", 
    RowBox[{"Flatten", "@", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"PlotVessel", "[", 
          RowBox[{"imhalf", ",", "#"}], "]"}], "&"}], "/@", 
        "vesselAnnotationsData"}]}], "}"}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6375733776930532`*^9, 3.6375733990538235`*^9}, {
   3.637573438748947*^9, 3.637573513384824*^9}, {3.6375739127589364`*^9, 
   3.6375739367832603`*^9}, {3.6375741156089892`*^9, 3.637574117987109*^9}, {
   3.637577757838523*^9, 3.6375777592760987`*^9}, 3.637647069102641*^9, {
   3.6376622145779233`*^9, 3.637662226233616*^9}, {3.637662688118195*^9, 
   3.6376627319202833`*^9}, {3.6376632397342668`*^9, 
   3.6376632409254665`*^9}, {3.665125769566063*^9, 3.6651257697535744`*^9}, {
   3.6651277884740453`*^9, 3.6651278594471617`*^9}, {3.665128055585786*^9, 
   3.665128059679647*^9}, {3.665128262043105*^9, 3.6651282835605736`*^9}, {
   3.665128350634693*^9, 3.6651284269356985`*^9}, {3.665128525495489*^9, 
   3.6651285713734837`*^9}, {3.6651323517010307`*^9, 3.665132508457713*^9}, {
   3.665132576212057*^9, 3.66513258850613*^9}, {3.6651326653865037`*^9, 
   3.6651326712932367`*^9}, {3.665132761758466*^9, 3.665132804195445*^9}, {
   3.665133635754176*^9, 3.665133710251813*^9}, {3.665133740869279*^9, 
   3.665133746311638*^9}},
 CellLabel->
  "In[183]:=",ExpressionUUID->"03001c07-ec29-4d42-9bb3-8fcfa123f11a"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", 
        RowBox[{
        "seedsPointFig1", ",", "seedsArrowFig1", ",", "endsPointFig", ",", 
         "endsArrowFig"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", 
        RowBox[{
        "seedsPointFig2", ",", "seedsArrowFig2", ",", "endsPointFig", ",", 
         "endsArrowFig"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.637662696832557*^9, 3.6376626989471416`*^9}, {
  3.6376627426761923`*^9, 3.6376627565291605`*^9}, {3.6376632464549217`*^9, 
  3.6376632614114428`*^9}, {3.6651337260462713`*^9, 3.665133732119521*^9}},
 CellLabel->
  "In[191]:=",ExpressionUUID->"487c7753-c77b-4096-bcf8-8ac615222c00"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{"{", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", 
       RowBox[{"seedsPointFig1", ",", "seedsArrowFig1", ",", 
        RowBox[{"{", 
         RowBox[{"Cyan", ",", 
          RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{
             "seedsArrowFig1", "\[LeftDoubleBracket]", "3", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{
             "seedsArrowFig2", "\[LeftDoubleBracket]", "3", 
              "\[RightDoubleBracket]"}]}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Cyan", ",", 
          RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
          RowBox[{"Point", "[", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{"seedsPointFig1", "\[LeftDoubleBracket]", 
              RowBox[{"3", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"seedsPointFig2", "\[LeftDoubleBracket]", 
              RowBox[{"3", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}], 
           "]"}]}], "}"}], ",", "endsPointFig", ",", "endsArrowFig"}], "}"}], 
      "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.8273953187454414`*^9, 3.8273953192966185`*^9}, {
  3.827395450367279*^9, 3.8273954505091033`*^9}, {3.827395561342625*^9, 
  3.827395569712604*^9}, {3.8273956184391727`*^9, 3.8273956844167695`*^9}, {
  3.827395725555234*^9, 3.827395794105155*^9}},
 CellLabel->
  "In[192]:=",ExpressionUUID->"3b614e74-86c4-4459-9da0-8340dfcb3f19"]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Parameters", "Chapter",
 CellChangeTimes->{{3.871371970116836*^9, 
  3.871371971297967*^9}},ExpressionUUID->"d9fd4add-45ee-4a61-8ebf-\
24a99dfcb24f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Metric", ":"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Mu]", " ", "=", " ", ".05"}], ";"}], "       ", 
   RowBox[{"(*", 
    RowBox[{"Stiffness", " ", "parameter"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"\[Epsilon]", "=", "10."}], ";"}], 
   RowBox[{"(*", 
    RowBox[{"Anisotropy", " ", "parameter", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"for", " ", "sub"}], "-", 
        RowBox[{"Riemannian", " ", "case"}]}], ",", 
       RowBox[{"epsilon", "\[Rule]", "infty"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"beta", "-"}], ")"}], "isotropic", " ", "Riemannian", " ", 
         "case", " ", "epsilon"}], "=", "1"}]}], ")"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Volume", "/", "Image"}], " ", "dimensions"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"No", " ", "=", " ", "64"}], ";"}], "         ", 
    RowBox[{"(*", 
     RowBox[{
     "Number", " ", "of", " ", "orientations", " ", "from", " ", "0", " ", 
      "to", " ", "periodicity"}], "*)"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"No", "=", "32"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"No", " ", "=", " ", "16"}], ";"}], "         ", 
    RowBox[{"(*", 
     RowBox[{
     "Number", " ", "of", " ", "orientations", " ", "from", " ", "0", " ", 
      "to", " ", "periodicity"}], "*)"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nx", ",", "Ny"}], "}"}], "=", 
     RowBox[{"Dimensions", "[", "im", "]"}]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
    "Number", " ", "of", " ", "pixels", " ", "in", " ", "x", " ", "and", " ", 
     "y", " ", "direction"}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Resolution", " ", "parameters"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"periodicity", " ", "=", " ", 
     RowBox[{"2", "Pi"}]}], ";"}], "           ", 
   RowBox[{"(*", 
    RowBox[{"Periodicity", ",", " ", 
     RowBox[{"=", 
      RowBox[{"Pi", " ", 
       RowBox[{"(", 
        RowBox[{
        "for", " ", "theta", " ", "from", " ", "0", " ", "to", " ", "1", " ", 
         "Pi"}], ")"}]}]}], ",", " ", 
     RowBox[{"or", " ", "=", 
      RowBox[{"2", "Pi", " ", 
       RowBox[{"(", 
        RowBox[{
        "for", " ", "theta", " ", "from", " ", "0", " ", "to", " ", "2", " ", 
         "Pi"}], ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s\[Theta]", " ", "=", " ", 
     RowBox[{"periodicity", "/", "No"}]}], ";"}], "  ", 
   RowBox[{"(*", 
    RowBox[{"Angular", " ", "resolution"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"sx", " ", "=", " ", "1"}], ";"}], "          ", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Spatial", " ", "resolution"}], ",", " ", 
     StyleBox[
      RowBox[{"not", " ", "used", " ", "in", " ", "this", " ", "notebook"}],
      FontColor->RGBColor[0.6, 0.4, 0.2]], 
     StyleBox[",",
      FontColor->RGBColor[0.6, 0.4, 0.2]], 
     StyleBox[" ",
      FontColor->RGBColor[0.6, 0.4, 0.2]], 
     StyleBox[
      RowBox[{
       RowBox[{"every", " ", "sx"}], "=", 
       RowBox[{"1", " ", "is", " ", "assumed"}]}],
      FontColor->RGBColor[0.6, 0.4, 0.2]]}], "*)"}], "\[IndentingNewLine]", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{"Set", " ", "Options"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetOptions", "[", 
     RowBox[{"SE2FiniteDifferences", ",", 
      RowBox[{"\"\<Periodicity\>\"", "->", " ", 
       RowBox[{"(", "periodicity", ")"}]}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"os", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"No", ",", "ySelect", ",", "Ny"}], "}"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.624945131553623*^9, 3.6249451319208727`*^9}, {
   3.624945161985224*^9, 3.6249451653214817`*^9}, 3.624949614870289*^9, 
   3.624949740445407*^9, {3.624950364090351*^9, 3.6249503898908143`*^9}, 
   3.624950448650448*^9, {3.624950495165639*^9, 3.624950495217674*^9}, 
   3.6249508409889708`*^9, 3.6249513022397013`*^9, 3.624954676615217*^9, 
   3.624954748031515*^9, 3.6249693732948637`*^9, 3.6249694658379197`*^9, {
   3.6250317012872024`*^9, 3.6250317257559805`*^9}, 3.6250318301436987`*^9, 
   3.625040271516988*^9, 3.6251176337634983`*^9, 3.6252147537220798`*^9, 
   3.6252169915145626`*^9, 3.625218649872223*^9, {3.6252195690869074`*^9, 
   3.625219569182971*^9}, 3.6252203329985323`*^9, {3.625222628031225*^9, 
   3.625222632710331*^9}, 3.625222986312934*^9, {3.6252249799362917`*^9, 
   3.625225002900473*^9}, 3.6252257342036953`*^9, 3.625228907361856*^9, 
   3.625231694897396*^9, {3.6252821840401955`*^9, 3.625282185422537*^9}, {
   3.625315802167776*^9, 3.625315802402194*^9}, {3.62531829713197*^9, 
   3.6253182972100706`*^9}, {3.62531993484264*^9, 3.6253199349363937`*^9}, 
   3.6253323826524377`*^9, {3.625366737346525*^9, 3.6253667379559355`*^9}, {
   3.6253712732587986`*^9, 3.62537128107899*^9}, 3.625372707968023*^9, 
   3.6253730341067*^9, {3.6253734033956156`*^9, 3.625373411256999*^9}, 
   3.6253741062261734`*^9, 3.625374385428779*^9, {3.625374567222395*^9, 
   3.6253745857149935`*^9}, 3.625374672888541*^9, {3.6253780802830095`*^9, 
   3.625378084841679*^9}, {3.6254039987916765`*^9, 3.625404079486368*^9}, {
   3.6254619483342047`*^9, 3.6254619804620404`*^9}, {3.6254629383582172`*^9, 
   3.625462940037594*^9}, {3.6254631896831427`*^9, 3.6254632078090363`*^9}, {
   3.625463281825509*^9, 3.625463292732304*^9}, 3.6254696802733526`*^9, {
   3.6254697138537893`*^9, 3.625469725713749*^9}, {3.625469797811081*^9, 
   3.6254697993267794`*^9}, 3.625470239100869*^9, 3.625478532675105*^9, {
   3.625478683778561*^9, 3.6254786838566647`*^9}, 3.6254788103501225`*^9, {
   3.6254789061159143`*^9, 3.625478908303775*^9}, 3.6254794202212963`*^9, 
   3.6254891519277*^9, 3.6254892740287657`*^9, {3.6255497394376564`*^9, 
   3.625549739884958*^9}, {3.6255499669171844`*^9, 3.6255499669802265`*^9}, 
   3.6255502590342693`*^9, {3.625550405024269*^9, 3.6255504080562844`*^9}, 
   3.62598559597268*^9, 3.6260713353133307`*^9, 3.6260720756429687`*^9, 
   3.626072819563247*^9, 3.62607881727878*^9, {3.6260789303922963`*^9, 
   3.6260789304704213`*^9}, {3.626079705711183*^9, 3.626079706711237*^9}, {
   3.6260803562298074`*^9, 3.626080369714921*^9}, {3.6260806031712523`*^9, 
   3.6260806037494555`*^9}, {3.6260823824095097`*^9, 3.62608238598782*^9}, {
   3.626093124928266*^9, 3.626093125615822*^9}, {3.626096489332111*^9, 
   3.626096490550897*^9}, {3.6260971478535967`*^9, 3.6260971484786463`*^9}, 
   3.626582258752741*^9, 3.6265824941337414`*^9, 3.6266116310346603`*^9, {
   3.6266658553890424`*^9, 3.6266658554610424`*^9}, 3.6266661871520424`*^9, {
   3.626666975102042*^9, 3.626666975885042*^9}, {3.628321858397415*^9, 
   3.628321891301302*^9}, {3.628326418056525*^9, 3.6283264181503043`*^9}, 
   3.6283281212149243`*^9, {3.634569243861385*^9, 3.6345692449406004`*^9}, 
   3.6352394908693237`*^9, {3.635244735846283*^9, 3.63524474114318*^9}, {
   3.6352448562852387`*^9, 3.6352449382764854`*^9}, {3.6352449755115004`*^9, 
   3.635245061105542*^9}, {3.635245331811201*^9, 3.6352453319205775`*^9}, {
   3.635246850280826*^9, 3.6352468503433237`*^9}, {3.6352468866090317`*^9, 
   3.6352468866715317`*^9}, {3.6352485344825935`*^9, 3.635248535388919*^9}, {
   3.6352511711630383`*^9, 3.635251171241164*^9}, {3.635251305310001*^9, 
   3.6352513088725133`*^9}, 3.63525353712506*^9, {3.6352543950282993`*^9, 
   3.6352543953095503`*^9}, 3.635254901968296*^9, {3.635255177782792*^9, 
   3.635255177845235*^9}, 3.635481310074271*^9, {3.636180012859438*^9, 
   3.6361800190836782`*^9}, 3.636182433469011*^9, {3.636182680495011*^9, 
   3.6361826805730104`*^9}, 3.6361829477542105`*^9, {3.63618312329648*^9, 
   3.6361831254023585`*^9}, {3.6361899350223627`*^9, 3.6361899363015547`*^9}, 
   3.636193066507264*^9, {3.6362667641064386`*^9, 3.6362667675908422`*^9}, {
   3.636266803520385*^9, 3.6362668035359435`*^9}, 3.636268192702372*^9, {
   3.636363668059152*^9, 3.636363668106043*^9}, {3.6363774501299086`*^9, 
   3.636377451009323*^9}, {3.827550779430331*^9, 3.8275507829448967`*^9}, {
   3.827640573599739*^9, 3.8276405749658613`*^9}, {3.827811047316004*^9, 
   3.8278110483047514`*^9}, {3.828152456307746*^9, 3.828152467898822*^9}, {
   3.8281569880972915`*^9, 3.8281569918671074`*^9}, {3.8286055872485504`*^9, 
   3.82860558968379*^9}, {3.8319944814955378`*^9, 3.8319944894840555`*^9}, {
   3.871374355389465*^9, 3.871374373192091*^9}, {3.8714658019157953`*^9, 
   3.871465802299467*^9}, 3.8714658378159704`*^9, {3.8714659243158965`*^9, 
   3.871465925495992*^9}, 3.8714659845191936`*^9, {3.871466177579902*^9, 
   3.8714661786383853`*^9}},
 CellLabel->
  "In[193]:=",ExpressionUUID->"3f23623f-e82b-4b0f-b937-69cb1651ca1a"]
}, Closed]],

Cell[CellGroupData[{

Cell["From end points to start points on lifted vessel trees", "Chapter",
 CellChangeTimes->{{3.8713742882773046`*^9, 
  3.8713743127096663`*^9}},ExpressionUUID->"2bcecd1c-951e-4886-a19a-\
d2aa90b31e87"],

Cell[CellGroupData[{

Cell["Coordinate conversion", "Subsection",
 CellChangeTimes->{{3.6364356019938498`*^9, 
  3.6364356064314165`*^9}},ExpressionUUID->"da9418b5-8f0a-436f-af43-\
6392d850c943"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeedPointConversionGraphicsToArray", "[", 
   RowBox[{
   "g0_", ",", "Nx_", ",", "Ny_", ",", "s\[Theta]_", ",", "periodicity_"}], 
   "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{"periodicity", "/", "s\[Theta]"}], ",", "1"}], "]"}], ",", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        ",", "Nx", ",", "1"}], "]"}], ",", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
        ",", "Ny", ",", "1"}], "]"}]}], "}"}], "&"}], "@", 
   RowBox[{"Round", "@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"g0", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
          ")"}], "/", "s\[Theta]"}], "+", "1"}], ",", 
      RowBox[{"g0", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      ",", 
      RowBox[{"g0", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
     "}"}]}]}]}]], "Code",
 CellChangeTimes->{{3.6364337668468122`*^9, 3.636433835249631*^9}, {
  3.6651356369876966`*^9, 3.6651356444869556`*^9}, {3.6651356962560973`*^9, 
  3.665135696927986*^9}},
 CellLabel->
  "In[202]:=",ExpressionUUID->"486d7847-784b-475b-81a8-588942b338ef"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "startAndBifurcationPoints", "]"}]], "Input",
 CellChangeTimes->{{3.665135443960734*^9, 3.665135445152845*^9}},
 CellLabel->
  "In[203]:=",ExpressionUUID->"021a4473-a85e-4b27-ba65-b235472d21e8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"g0ListStartAndBifurcation", "=", 
   RowBox[{"Map", "[", 
    RowBox[{"Flatten", ",", 
     RowBox[{"startAndBifurcationPoints", "\[LeftDoubleBracket]", 
      RowBox[{"All", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}]}], "\[RightDoubleBracket]"}], ",", 
     RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"g1ListEnd", "=", 
    RowBox[{"Map", "[", 
     RowBox[{"Flatten", ",", 
      RowBox[{"endPoints", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}]}], "\[RightDoubleBracket]"}], ",", 
      RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g0dListStartAndBifurcation", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SeedPointConversionGraphicsToArray", "[", 
       RowBox[{
       "#", ",", "Nx", ",", "Ny", ",", "s\[Theta]", ",", "periodicity"}], 
       "]"}], "&"}], ",", "g0ListStartAndBifurcation", ",", 
     RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g1dListEnd", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SeedPointConversionGraphicsToArray", "[", 
       RowBox[{
       "#", ",", "Nx", ",", "Ny", ",", "s\[Theta]", ",", "periodicity"}], 
       "]"}], "&"}], ",", "g1ListEnd", ",", 
     RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.636433652329668*^9, 3.636433694002096*^9}, {
  3.63643373233078*^9, 3.6364337491903777`*^9}, {3.6376618496451197`*^9, 
  3.637661885017646*^9}, {3.6376626272726645`*^9, 3.637662628227087*^9}, {
  3.6376629292713966`*^9, 3.6376629296435785`*^9}, {3.665133786113971*^9, 
  3.6651337867051764`*^9}, {3.665133824789706*^9, 3.6651338295961237`*^9}, {
  3.6651338740696697`*^9, 3.6651338996257715`*^9}, {3.6651339826886*^9, 
  3.6651339864148445`*^9}},
 CellLabel->
  "In[204]:=",ExpressionUUID->"80a56cc5-9516-421f-9e25-aeec8f0ea3b6"],

Cell[CellGroupData[{

Cell["Determine centerline and orientations of centerline", "Subsubsection",
 CellChangeTimes->{{3.6379164064157114`*^9, 
  3.6379164144033766`*^9}},ExpressionUUID->"34f82bd2-c82d-499f-942d-\
8b00ce75ad4a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"nrOfAveragePoints", "=", "8"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"should", " ", "be", " ", "even"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"centerlinesAndAngles", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Select", " ", "first", " ", "and", " ", "second", " ", "wall"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"trackFirstWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<firstWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"trackSecondWall", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"\"\<secondWall\>\"", "/.", "#"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Average", " ", "both", " ", "walls", " ", "to", " ", "obtain", " ", 
          "center", " ", "points"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Make", " ", "a", " ", "list", " ", "of", " ", "the", " ", "center", 
          " ", 
          RowBox[{"points", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"centerPointList", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"First", "[", 
                 RowBox[{"Nearest", "[", 
                  RowBox[{"trackSecondWall", ",", "#"}], "]"}], "]"}]}], 
               "}"}], "]"}], "&"}], "@", 
            RowBox[{
            "trackFirstWall", "\[LeftDoubleBracket]", "pointNr", 
             "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"pointNr", ",", "1", ",", 
             RowBox[{"Length", "[", "trackFirstWall", "]"}], ",", "1"}], 
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "From", " ", "this", " ", "list", " ", "compute", " ", "the", " ", 
           "average", " ", "direction", " ", "vector"}], ",", " ", 
          RowBox[{"and", " ", "corresponding", " ", "angle"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "centerPointList", "]"}], "<", 
           "nrOfAveragePoints"}], ",", "\[IndentingNewLine]", 
          RowBox[{"averageVectors", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"Normalize", "[", 
              RowBox[{
               RowBox[{
               "centerPointList", "\[LeftDoubleBracket]", "1", 
                "\[RightDoubleBracket]"}], "-", 
               RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
                RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], "]"}], ",", 
             RowBox[{"Length", "[", "centerPointList", "]"}]}], "]"}]}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"averageVectors", "=", 
            RowBox[{"Normalize", "/@", 
             RowBox[{"ListConvolve", "[", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"{", "1", "}"}], "nrOfAveragePoints"], ",", 
                 RowBox[{"{", "nrOfAveragePoints", "}"}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
                 RowBox[{"2", ";;", 
                  RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "-", 
                RowBox[{"centerPointList", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ";;", 
                  RowBox[{"-", "2"}]}], "\[RightDoubleBracket]"}]}]}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"averageVectors", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                "averageVectors", "\[LeftDoubleBracket]", "1", 
                 "\[RightDoubleBracket]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Floor", "[", 
                  FractionBox["nrOfAveragePoints", "2"], "]"}], "}"}]}], 
               "]"}], ",", "averageVectors", ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"averageVectors", "\[LeftDoubleBracket]", 
                 RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Floor", "[", 
                  FractionBox["nrOfAveragePoints", "2"], "]"}], "}"}]}], 
               "]"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"averageAngle", "=", 
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{"averageVectors", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"averageVectors", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Output", " ", "start", " ", "point"}], ",", " ", 
          RowBox[{"direction", " ", "vector", " ", "and", " ", "angle"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Flatten", "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"centerPointList", ",", "averageAngle"}], "}"}], "]"}]}]}],
        ")"}], "&"}], ",", "vesselAnnotationsData"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.637571376722161*^9, 3.6375714391064887`*^9}, {
   3.6375714970443068`*^9, 3.637571510733118*^9}, 3.6375715541069317`*^9, 
   3.637571869331643*^9, {3.637571904850258*^9, 3.6375719098608217`*^9}, {
   3.637572073906564*^9, 3.6375720788098755`*^9}, {3.637649949821848*^9, 
   3.6376499886374035`*^9}, {3.6376501731113033`*^9, 3.637650371667511*^9}, 
   3.6376504619003067`*^9, {3.6376505202390757`*^9, 3.6376505399124737`*^9}, {
   3.6376507972493343`*^9, 3.6376508146234455`*^9}, {3.6376508941010833`*^9, 
   3.6376508942972355`*^9}, {3.6376509250776167`*^9, 3.637650926084341*^9}, {
   3.6376510252590656`*^9, 3.6376510387065787`*^9}, {3.637651071317529*^9, 
   3.6376511324717064`*^9}, {3.637651199479637*^9, 3.6376512458124204`*^9}, {
   3.6376515352181773`*^9, 3.6376515401685133`*^9}, {3.6376516982364764`*^9, 
   3.6376517393934407`*^9}, 3.665125770316044*^9, 3.66513429040596*^9, {
   3.6651355573653545`*^9, 3.6651355584122887`*^9}, {3.66513561904144*^9, 
   3.6651356198383427`*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"41d3d6ba-d953-4961-bab0-bb45acc721f3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"centerlinesAndAngles", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SeedPointConversionGraphicsToArray", "[", 
       RowBox[{
       "#", ",", "Nx", ",", "Ny", ",", "s\[Theta]", ",", "periodicity"}], 
       "]"}], "&"}], ",", "centerlinesAndAngles", ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"seedsIndex", "=", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"SeedPointConversionGraphicsToArray", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}], ",", "Nx", ",", "Ny", ",", 
          "s\[Theta]", ",", "periodicity"}], "]"}], "&"}], ",", "seeds"}], 
      "]"}], "\[LeftDoubleBracket]", 
     RowBox[{"All", ",", 
      RowBox[{"2", ";;", "3"}]}], "\[RightDoubleBracket]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"centerlinesAndAngles", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"#", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         "<", "ySelect"}], "&"}]}], "]"}], "&"}], "/@", 
    "centerlinesAndAngles"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsIndex", "=", 
   RowBox[{"Select", "[", 
    RowBox[{"seedsIndex", ",", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       "<", "ySelect"}], "&"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637651834673237*^9, 3.6376518392465067`*^9}, {
   3.637661485392063*^9, 3.637661537733298*^9}, {3.6376615722566257`*^9, 
   3.63766157381209*^9}, {3.6651343275260973`*^9, 3.6651343378583746`*^9}, {
   3.6651343744392853`*^9, 3.6651344484344425`*^9}, 3.6651346359545555`*^9},
 CellLabel->
  "In[210]:=",ExpressionUUID->"fdc1c7bb-5981-4391-9b13-03bc1c4de34d"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Select points", "Subsection",
 CellChangeTimes->{{3.637657683292612*^9, 
  3.6376576855526075`*^9}},ExpressionUUID->"df5cf14f-8970-4689-a9b6-\
c5fc18e7a987"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"g0ListTiers", "=", 
   RowBox[{"Map", "[", 
    RowBox[{"Flatten", ",", 
     RowBox[{"startPoints", "\[LeftDoubleBracket]", 
      RowBox[{"All", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g1ListTiers", "=", 
   RowBox[{"Map", "[", 
    RowBox[{"Flatten", ",", 
     RowBox[{"endPoints", "\[LeftDoubleBracket]", 
      RowBox[{"All", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.636433652329668*^9, 3.636433694002096*^9}, {
  3.63643373233078*^9, 3.6364337491903777`*^9}, {3.6651337903040724`*^9, 
  3.6651337909447775`*^9}, {3.6651345458192797`*^9, 3.6651345622340174`*^9}},
 CellLabel->
  "In[214]:=",ExpressionUUID->"36796982-e89e-46ba-91ac-a94514aba05b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"g0dListTiers", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SeedPointConversionGraphicsToArray", "[", 
       RowBox[{
       "#", ",", "Nx", ",", "Ny", ",", "s\[Theta]", ",", "periodicity"}], 
       "]"}], "&"}], ",", "g0ListTiers"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g1dListTiers", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SeedPointConversionGraphicsToArray", "[", 
       RowBox[{
       "#", ",", "Nx", ",", "Ny", ",", "s\[Theta]", ",", "periodicity"}], 
       "]"}], "&"}], ",", "g1ListTiers"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6364338419527936`*^9, 3.636433871640727*^9}, {
  3.6651345502023077`*^9, 3.665134555374387*^9}, {3.6651357204043593`*^9, 
  3.6651357210137515`*^9}},
 CellLabel->
  "In[216]:=",ExpressionUUID->"6b86c749-24e3-496e-83b8-5fdef7cd124d"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Calculate Ground Truth Cost Function", "Chapter",
 CellChangeTimes->{{3.87137192293781*^9, 3.8713719274337025`*^9}, {
  3.8713736891815443`*^9, 
  3.8713736930868835`*^9}},ExpressionUUID->"b906e8a5-a42c-4888-9514-\
32639b7fb934"],

Cell[CellGroupData[{

Cell["\<\
Create lift by placing delta peaks at the centerline position and orientation\
\>", "Section",
 CellChangeTimes->{{3.6379164064157114`*^9, 3.637916458682798*^9}, {
  3.637987042429432*^9, 
  3.63798704457016*^9}},ExpressionUUID->"67220192-3f6d-478f-b33f-\
0fcf6bba9886"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"radiusBlurFilter", "=", "2"}], 
  RowBox[{"(*", "2", "*)"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lift", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"Dimensions", "[", "os", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"lift", "\[LeftDoubleBracket]", 
         RowBox[{"Sequence", "@@", "#"}], "\[RightDoubleBracket]"}], "=", 
        "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "<=", 
          FractionBox["No", "2"]}], " ", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"lift", "\[LeftDoubleBracket]", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"(", 
              RowBox[{"#", "+", 
               RowBox[{"{", 
                RowBox[{
                 FractionBox["No", "2"], ",", "0", ",", "0"}], "}"}]}], 
              ")"}]}], "\[RightDoubleBracket]"}], "=", "1"}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"lift", "\[LeftDoubleBracket]", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"(", 
             RowBox[{"#", "-", 
              RowBox[{"{", 
               RowBox[{
                FractionBox["No", "2"], ",", "0", ",", "0"}], "}"}]}], 
             ")"}]}], "\[RightDoubleBracket]"}], "=", "1"}]}], "]"}]}], ")"}],
      "&"}], ",", "\[IndentingNewLine]", "centerlinesAndAngles", ",", 
    RowBox[{"{", "2", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lift", "=", 
   RowBox[{"GaussianFilter", "[", 
    RowBox[{"lift", ",", "radiusBlurFilter"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6376505703874693`*^9, 3.6376505929318256`*^9}, {
   3.637650677855898*^9, 3.6376507235525694`*^9}, {3.6376513060220947`*^9, 
   3.637651347187981*^9}, 3.637651847137966*^9, {3.6376518977843504`*^9, 
   3.637651909873603*^9}, {3.637657211868204*^9, 3.637657226071316*^9}, {
   3.637657590400847*^9, 3.6376575925459037`*^9}, {3.637667637908661*^9, 
   3.6376676518378325`*^9}, {3.637916393679236*^9, 3.6379164221609726`*^9}, {
   3.637987126745903*^9, 3.6379871444498625`*^9}, 3.82781109452129*^9, {
   3.8278111317119875`*^9, 3.82781113279117*^9}, {3.827813661850422*^9, 
   3.827813662308159*^9}, 3.828152563199275*^9, 3.828605620229334*^9},
 CellLabel->
  "In[200]:=",ExpressionUUID->"c6999a2a-e8dd-4dda-bb77-ffefe987a64b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"liftElevator", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"Dimensions", "[", "os", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"liftElevator", "\[LeftDoubleBracket]", 
         RowBox[{"Sequence", "@@", "#"}], "\[RightDoubleBracket]"}], "=", 
        "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "<=", 
          RowBox[{"No", "/", "2"}]}], " ", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"liftElevator", "\[LeftDoubleBracket]", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"(", 
              RowBox[{"#", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"No", "/", "2"}], ",", "0", ",", "0"}], "}"}]}], 
              ")"}]}], "\[RightDoubleBracket]"}], "=", "1"}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"liftElevator", "\[LeftDoubleBracket]", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"(", 
             RowBox[{"#", "-", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"No", "/", "2"}], ",", "0", ",", "0"}], "}"}]}], 
             ")"}]}], "\[RightDoubleBracket]"}], "=", "1"}]}], "]"}]}], ")"}],
      "&"}], ",", "\[IndentingNewLine]", "centerlinesAndAngles", ",", 
    RowBox[{"{", "2", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"liftElevator", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", 
         RowBox[{"Sequence", "@@", "#"}]}], "\[RightDoubleBracket]"}], "=", 
       "1"}], ";"}], "&"}], ",", "seedsIndex"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"liftElevator", "=", 
   RowBox[{"GaussianFilter", "[", 
    RowBox[{"liftElevator", ",", "radiusBlurFilter"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6376505703874693`*^9, 3.6376505929318256`*^9}, {
   3.637650677855898*^9, 3.6376507235525694`*^9}, {3.6376513060220947`*^9, 
   3.637651347187981*^9}, 3.637651847137966*^9, {3.6376518977843504`*^9, 
   3.637651909873603*^9}, {3.637657211868204*^9, 3.637657226071316*^9}, {
   3.637657590400847*^9, 3.6376575925459037`*^9}, {3.637661451590773*^9, 
   3.6376614752931576`*^9}, {3.6376615440990224`*^9, 3.637661544629841*^9}, {
   3.6376615763082895`*^9, 3.637661598405514*^9}, {3.637666652553603*^9, 
   3.637666652678602*^9}, {3.6376673936491594`*^9, 3.637667493914549*^9}, {
   3.6376675560524125`*^9, 3.6376675656726313`*^9}, 3.6376676152477036`*^9, {
   3.637987123386367*^9, 3.637987147387498*^9}},
 CellLabel->
  "In[204]:=",ExpressionUUID->"03c881a9-be9c-4d9a-944d-3ec784aee92e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"liftElevatorBifurcations", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"Dimensions", "[", "os", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"liftElevatorBifurcations", "\[LeftDoubleBracket]", 
         RowBox[{"Sequence", "@@", "#"}], "\[RightDoubleBracket]"}], "=", 
        "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "<=", 
          RowBox[{"No", "/", "2"}]}], " ", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"liftElevatorBifurcations", "\[LeftDoubleBracket]", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"(", 
              RowBox[{"#", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"No", "/", "2"}], ",", "0", ",", "0"}], "}"}]}], 
              ")"}]}], "\[RightDoubleBracket]"}], "=", "1"}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"liftElevatorBifurcations", "\[LeftDoubleBracket]", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"(", 
             RowBox[{"#", "-", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"No", "/", "2"}], ",", "0", ",", "0"}], "}"}]}], 
             ")"}]}], "\[RightDoubleBracket]"}], "=", "1"}]}], "]"}]}], ")"}],
      "&"}], ",", "\[IndentingNewLine]", "centerlinesAndAngles", ",", 
    RowBox[{"{", "2", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"liftElevatorBifurcations", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", 
         RowBox[{"Sequence", "@@", "#"}]}], "\[RightDoubleBracket]"}], "=", 
       "2"}], ";"}], "&"}], ",", "seedsIndex"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"liftElevatorBifurcations", "=", 
   RowBox[{"Rescale", "[", 
    RowBox[{"GaussianFilter", "[", 
     RowBox[{"liftElevatorBifurcations", ",", "radiusBlurFilter"}], "]"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6376505703874693`*^9, 3.6376505929318256`*^9}, {
   3.637650677855898*^9, 3.6376507235525694`*^9}, {3.6376513060220947`*^9, 
   3.637651347187981*^9}, 3.637651847137966*^9, {3.6376518977843504`*^9, 
   3.637651909873603*^9}, {3.637657211868204*^9, 3.637657226071316*^9}, {
   3.637657590400847*^9, 3.6376575925459037`*^9}, {3.637661451590773*^9, 
   3.6376614752931576`*^9}, {3.6376615440990224`*^9, 3.637661544629841*^9}, {
   3.6376615763082895`*^9, 3.637661598405514*^9}, {3.637666652553603*^9, 
   3.637666652678602*^9}, {3.6376673936491594`*^9, 3.637667493914549*^9}, {
   3.6376675560524125`*^9, 3.6376675656726313`*^9}, 3.6376676152477036`*^9, {
   3.637987123386367*^9, 3.637987147387498*^9}, {3.831568414886436*^9, 
   3.83156843402491*^9}, {3.83156850196632*^9, 3.8315685177867603`*^9}, {
   3.8315685634704256`*^9, 3.8315685968756104`*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"67bff963-6af0-4cb0-b223-4e5de5a6e624"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Image3D", "[", 
      RowBox[{"lift", ",", 
       RowBox[{"BoxRatios", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0.5"}], "}"}]}]}], "]"}], ",", 
     RowBox[{"Image3D", "[", 
      RowBox[{"liftElevator", ",", 
       RowBox[{"BoxRatios", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0.5"}], "}"}]}]}], "]"}], ",", 
     RowBox[{"Image3D", "[", 
      RowBox[{"liftElevatorBifurcations", ",", 
       RowBox[{"BoxRatios", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0.5"}], "}"}]}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"All", ",", "300"}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.637657268821263*^9, {3.6376573236261787`*^9, 3.6376573522007265`*^9}, {
   3.637661613446001*^9, 3.637661616023898*^9}, {3.6379870625866203`*^9, 
   3.637987093134943*^9}, {3.637987222640225*^9, 3.637987225577823*^9}, {
   3.6379872853923063`*^9, 3.6379872880330753`*^9}, {3.6651232231491547`*^9, 
   3.6651232236803875`*^9}, {3.8315684439637895`*^9, 3.831568448536682*^9}, {
   3.8316334769349704`*^9, 3.8316334821598387`*^9}, 3.856494293040949*^9},
 CellLabel->
  "In[214]:=",ExpressionUUID->"a87752e7-2eab-48da-a35a-39f72345e2f0"]
}, Closed]],

Cell[CellGroupData[{

Cell["Construct cost", "Section",
 CellChangeTimes->{{3.637916481561216*^9, 
  3.6379164833499985`*^9}},ExpressionUUID->"b5e8cbd7-dd24-46d9-912d-\
a03128982961"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Lambda]", "=", "400"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"p", "=", "2"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"V", "=", 
   RowBox[{"Rescale", "[", "lift", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"costLift", "=", 
   FractionBox["1", 
    RowBox[{"1", "+", 
     RowBox[{"\[Lambda]", " ", 
      SuperscriptBox["V", 
       RowBox[{"p", " "}]]}]}]]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637657513369492*^9, 3.637657529720753*^9}, {
  3.6376584133584585`*^9, 3.637658413576046*^9}, {3.6376584862070875`*^9, 
  3.637658488992645*^9}, {3.8275503555082564`*^9, 3.82755035555513*^9}, {
  3.827550518073368*^9, 3.827550518113578*^9}, {3.8280657089371815`*^9, 
  3.8280657095065513`*^9}},
 CellLabel->
  "In[215]:=",ExpressionUUID->"d7c4dcb3-f198-45c7-9b49-55527931e28c"],

Cell[BoxData[
 RowBox[{"Row", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{
       RowBox[{
       "costLift", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{"Min", ",", 
         RowBox[{"Transpose", "[", 
          RowBox[{"costLift", ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"Image3D", "[", 
     RowBox[{
      RowBox[{"Rescale", "[", 
       RowBox[{"-", "costLift"}], "]"}], ",", 
      RowBox[{"BoxRatios", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "0.5"}], "}"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.637657555299677*^9, 3.6376575653436995`*^9}, {
  3.6376578507257237`*^9, 3.637657853445543*^9}, {3.665134471977529*^9, 
  3.665134472477547*^9}},
 CellLabel->
  "In[219]:=",ExpressionUUID->"5a3afddb-d040-4eec-8757-55d1212b329d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Lambda]", "=", "400"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"p", "=", "2"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"V", "=", 
   RowBox[{"Rescale", "[", "liftElevator", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"costLiftElevator", "=", 
   FractionBox["1", 
    RowBox[{"1", "+", 
     RowBox[{"\[Lambda]", " ", 
      SuperscriptBox["V", 
       RowBox[{"p", " "}]]}]}]]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637657513369492*^9, 3.637657529720753*^9}, {
   3.6376584133584585`*^9, 3.637658413576046*^9}, {3.6376584862070875`*^9, 
   3.637658488992645*^9}, {3.637661639989121*^9, 3.6376616460463066`*^9}, {
   3.8275506064411526`*^9, 3.8275506094663534`*^9}, 3.8275506953651385`*^9, {
   3.8275509202371597`*^9, 3.8275509210903344`*^9}, 3.8275831660718727`*^9},
 CellLabel->
  "In[222]:=",ExpressionUUID->"89200402-ccd3-45e6-ab9c-dd7d76daab0b"],

Cell[BoxData[
 RowBox[{"Row", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{
       RowBox[{
       "costLiftElevator", "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{"Min", ",", 
         RowBox[{"Transpose", "[", 
          RowBox[{"costLiftElevator", ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"Image3D", "[", 
     RowBox[{
      RowBox[{"Rescale", "[", 
       RowBox[{"-", "costLiftElevator"}], "]"}], ",", 
      RowBox[{"BoxRatios", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "0.2"}], "}"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.637657555299677*^9, 3.6376575653436995`*^9}, {
  3.6376578507257237`*^9, 3.637657853445543*^9}, {3.63766166225002*^9, 
  3.6376616732018642`*^9}, {3.665134479552128*^9, 3.6651344805052376`*^9}, {
  3.8281517333281717`*^9, 3.828151746690529*^9}},
 CellLabel->
  "In[226]:=",ExpressionUUID->"e3d24056-fefa-4750-b86e-2833ad49116d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Lambda]", "=", "400"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"p", "=", "2"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"V", "=", 
   RowBox[{"Rescale", "[", "liftElevatorBifurcations", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"costLiftElevatorBifurcations", "=", 
   FractionBox["1", 
    RowBox[{"1", "+", 
     RowBox[{"\[Lambda]", " ", 
      SuperscriptBox["V", 
       RowBox[{"p", " "}]]}]}]]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637657513369492*^9, 3.637657529720753*^9}, {
   3.6376584133584585`*^9, 3.637658413576046*^9}, {3.6376584862070875`*^9, 
   3.637658488992645*^9}, {3.637661639989121*^9, 3.6376616460463066`*^9}, {
   3.8275506064411526`*^9, 3.8275506094663534`*^9}, 3.8275506953651385`*^9, {
   3.8275509202371597`*^9, 3.8275509210903344`*^9}, 3.8275831660718727`*^9, {
   3.831568622625779*^9, 3.8315686279917107`*^9}},
 CellLabel->
  "In[227]:=",ExpressionUUID->"d7c8ad54-8bf0-4f1a-9a4b-150301a8d83f"],

Cell[BoxData[
 RowBox[{"Row", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{"imhalf", ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{
       RowBox[{
       "costLiftElevatorBifurcations", "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"Image", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{"Min", ",", 
         RowBox[{"Transpose", "[", 
          RowBox[{"costLiftElevatorBifurcations", ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "]"}], ",", 
    RowBox[{"Image3D", "[", 
     RowBox[{
      RowBox[{"Rescale", "[", 
       RowBox[{"-", "costLiftElevatorBifurcations"}], "]"}], ",", 
      RowBox[{"BoxRatios", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "0.2"}], "}"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.637657555299677*^9, 3.6376575653436995`*^9}, {
  3.6376578507257237`*^9, 3.637657853445543*^9}, {3.63766166225002*^9, 
  3.6376616732018642`*^9}, {3.665134479552128*^9, 3.6651344805052376`*^9}, {
  3.8281517333281717`*^9, 3.828151746690529*^9}, {3.831568636519785*^9, 
  3.8315686460385942`*^9}},
 CellLabel->
  "In[231]:=",ExpressionUUID->"6d58c506-e4f9-4e1e-8709-0d0248828700"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Calculate Data-Driven Term", "Chapter",
 CellChangeTimes->{{3.871371006951064*^9, 
  3.8713710263081164`*^9}},ExpressionUUID->"d6e06403-20f7-49a0-b8c9-\
39277323b775"],

Cell[CellGroupData[{

Cell["Parameters", "Section",
 CellChangeTimes->{{3.8275690092064934`*^9, 
  3.8275690104880905`*^9}},ExpressionUUID->"3cfb1212-a32d-4a54-8fd6-\
b2009cb2987b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Xi]", "=", 
   RowBox[{"(", 
    RowBox[{"\[Mu]", "*", "ds"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Zeta]", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]s", "=", "1.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]a", "=", "0.6"}], ";"}]}], "Input",
 CellChangeTimes->{{3.82756901318349*^9, 3.827569030401838*^9}, 
   3.8275690718194056`*^9, {3.8275694703811207`*^9, 3.8275694781257024`*^9}, {
   3.827571207890485*^9, 3.8275712242020397`*^9}, {3.827575004144817*^9, 
   3.8275750194609704`*^9}, {3.8280947252447023`*^9, 3.828094730863099*^9}, {
   3.828095279162855*^9, 3.8280952801580863`*^9}, 3.8281117126126785`*^9, {
   3.830275025589748*^9, 3.830275027373646*^9}, {3.8304887673123293`*^9, 
   3.8304887716260953`*^9}, {3.8304888690139227`*^9, 
   3.8304888758687553`*^9}, {3.8304897636875935`*^9, 3.8304897649530897`*^9}, 
   3.8304899111538277`*^9, 3.8304913029398675`*^9, {3.8304918513047175`*^9, 
   3.830491852899871*^9}, 3.83049201895064*^9, 3.8305876311569543`*^9, 
   3.8309362808179784`*^9, {3.83096010337148*^9, 3.8309601321301517`*^9}, {
   3.8309610795886717`*^9, 3.830961079745251*^9}, 3.8309611202033777`*^9, {
   3.8309617313452034`*^9, 3.8309617315228662`*^9}, {3.830963063656073*^9, 
   3.8309630660535*^9}, {3.8312014357645464`*^9, 3.8312014368313313`*^9}, {
   3.832152203870513*^9, 3.83215220704047*^9}, {3.832153595161108*^9, 
   3.832153598314642*^9}, {3.8321536534982967`*^9, 3.8321536661479254`*^9}, {
   3.8321545312376056`*^9, 3.8321545377809315`*^9}, {3.8321660980069456`*^9, 
   3.832166112452669*^9}, 3.8321675625958023`*^9, {3.8321699291301537`*^9, 
   3.8321699296731396`*^9}, {3.832170813165534*^9, 3.8321708586107144`*^9}, {
   3.8321727905091496`*^9, 3.832172793510076*^9}, {3.83217380047865*^9, 
   3.8321738424143705`*^9}, 3.8322140831387672`*^9, 3.8714662428567114`*^9},
 CellLabel->
  "In[309]:=",ExpressionUUID->"64d96476-b8e6-4468-9385-2fde57c44da1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Xi]", "=", "1"}], ";"}]], "Input",
 CellChangeTimes->{{3.8454519109952097`*^9, 3.8454519267344923`*^9}, 
   3.8454535284350915`*^9},
 CellLabel->
  "In[313]:=",ExpressionUUID->"88ad4c1f-c901-420d-8dbe-4e358c13deaa"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Calculate Gauge Frame - Note that these calculations are not very fast\
\>", "Section",
 CellChangeTimes->{{3.8275689418213744`*^9, 3.827568948960252*^9}, {
  3.8713803561575823`*^9, 
  3.8713803638708*^9}},ExpressionUUID->"f1bcc44a-84f2-4ce6-b5d4-29a2c825ff09"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"osGF", "=", 
    RowBox[{"OrientationScoreTransform", "[", 
     RowBox[{
      RowBox[{"Image", "@", "imhalf"}], ",", 
      RowBox[{"\"\<Orientations\>\"", "\[Rule]", "No"}], ",", 
      RowBox[{"\"\<WaveletSize\>\"", "\[Rule]", "75"}], ",", 
      RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "0.999"}], ",", 
      RowBox[{"\"\<OverlapFactor\>\"", "\[Rule]", "1"}]}], "]"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{",", 
      RowBox[{"\"\<WaveletSize\>\"", "\[Rule]", "5"}]}], "]"}], ";"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.7955047831757755`*^9, 3.795504905582304*^9}, 
   3.795504969953719*^9, {3.7955935739329433`*^9, 3.7955936059769173`*^9}, 
   3.7955973700621967`*^9, {3.7961216804381638`*^9, 3.796121680736288*^9}, {
   3.796121723804056*^9, 3.7961217240229483`*^9}, {3.7961217952229424`*^9, 
   3.796121795632704*^9}, {3.796121827654848*^9, 3.7961218277817755`*^9}, {
   3.79612348691343*^9, 3.7961234897277193`*^9}, {3.7967129321527433`*^9, 
   3.7967129415947294`*^9}, {3.7967144685197973`*^9, 
   3.7967144710468864`*^9}, {3.800786060701063*^9, 3.8007860633492756`*^9}, {
   3.815805755163107*^9, 3.8158057553655667`*^9}, {3.8199919385554047`*^9, 
   3.8199919397835283`*^9}, {3.8275686949145594`*^9, 3.827568746007337*^9}, 
   3.8286758637082434`*^9, 3.828677287456855*^9, 3.8286773209818006`*^9, {
   3.8286788080342283`*^9, 3.8286788099131203`*^9}, 3.828679070661134*^9, 
   3.828679869826039*^9, {3.830572550137044*^9, 3.8305725751531134`*^9}, {
   3.830602285373852*^9, 3.8306022979545236`*^9}, {3.8308349794224634`*^9, 
   3.8308350815740256`*^9}, {3.830960155460507*^9, 3.830960163771866*^9}, {
   3.8309616766851387`*^9, 3.830961722236022*^9}, 3.830964495696587*^9, {
   3.8309653839219165`*^9, 3.8309654115698433`*^9}, 3.831201439667492*^9, {
   3.8320002977461076`*^9, 3.832000309030801*^9}},
 CellLabel->
  "In[314]:=",ExpressionUUID->"b7373129-8980-4f28-8dd0-00ccf2253252"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Nx", ",", "Ny"}], "}"}], "=", 
   RowBox[{"Dimensions", "[", "imhalf", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8275688841314116`*^9, 3.827568893944194*^9}},
 CellLabel->
  "In[315]:=",ExpressionUUID->"235a03f0-5064-47cd-bf63-e209e0623cd5"],

Cell[BoxData[
 RowBox[{"os3d", "=", 
  RowBox[{"Image3D", "[", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Rescale", "[", 
       RowBox[{"Abs", "[", 
        RowBox[{"osGF", "[", "\"\<FullData\>\"", "]"}], "]"}], "]"}], "-", 
      "0.08"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7961246781939216`*^9, 3.7961247715594044`*^9}, {
  3.796124906632715*^9, 3.7961249453547397`*^9}, {3.7961250334197445`*^9, 
  3.796125109796521*^9}, {3.815805758581487*^9, 3.815805762523642*^9}, {
  3.8199919654060416`*^9, 3.8199919658974676`*^9}, {3.827568810920482*^9, 
  3.8275688124342747`*^9}},
 CellLabel->
  "In[316]:=",ExpressionUUID->"0a10c3bf-bf8a-4316-be23-d8d470414d20"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gf1", ",", "oc1"}], "}"}], "=", 
   RowBox[{"StabilizeGFandOC", "[", 
    RowBox[{
     RowBox[{"osGF", "[", "\"\<FullData\>\"", "]"}], ",", "1", ",", "\[Xi]", 
     ",", "\[Zeta]", ",", "\[Sigma]s", ",", "\[Sigma]a"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gf2", ",", "oc2"}], "}"}], "=", 
   RowBox[{"StabilizeGFandOC", "[", 
    RowBox[{
    "oc1", ",", "1", ",", "\[Xi]", ",", "\[Zeta]", ",", "\[Sigma]s", ",", 
     "\[Sigma]a"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gf3", ",", "oc3"}], "}"}], "=", 
   RowBox[{"StabilizeGFandOC", "[", 
    RowBox[{
    "oc2", ",", "1", ",", "\[Xi]", ",", "\[Zeta]", ",", "\[Sigma]s", ",", 
     "\[Sigma]a"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gf4", ",", "oc4"}], "}"}], "=", 
   RowBox[{"StabilizeGFandOC", "[", 
    RowBox[{
    "oc3", ",", "1", ",", "\[Xi]", ",", "\[Zeta]", ",", "\[Sigma]s", ",", 
     "\[Sigma]a"}], "]"}]}], ";"}], "\n", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"Prepend", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ArrayPlot", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{"Max", ",", "#", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}], ",", 
         RowBox[{"PlotRangePadding", "\[Rule]", "None"}], ",", 
         RowBox[{"Frame", "\[Rule]", "False"}]}], "]"}], "&"}], "/@", 
      RowBox[{"{", 
       RowBox[{"oc1", ",", "oc2", ",", "oc3", ",", "oc4"}], "}"}]}], ",", 
     RowBox[{"Image", "@", "imhalf"}]}], "]"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8275686472403936`*^9, 3.8275686483669786`*^9}, {
  3.8275690440597277`*^9, 3.8275690565004144`*^9}},
 CellLabel->
  "In[317]:=",ExpressionUUID->"e29d2417-922f-4238-9c5e-c27e8643398b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Hout", "=", 
   RowBox[{"CalcGaugeFrameNew2", "[", 
    RowBox[{
     RowBox[{"ObjPositionOrientationData", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Data\>\"", "\[Rule]", "oc3"}], ",", 
        RowBox[{"\"\<Symmetry\>\"", "\[Rule]", 
         RowBox[{"2", "\[Pi]"}]}], ",", " ", 
        RowBox[{"\"\<Wavelets\>\"", "\[Rule]", " ", "None"}], ",", " ", 
        RowBox[{"\"\<InputData\>\"", "\[Rule]", " ", "None"}], ",", " ", 
        RowBox[{"\"\<DcFilteredImage\>\"", "\[Rule]", "0"}]}], "}"}], "]"}], 
     ",", "1", ",", "\[Zeta]", ",", "\[Sigma]s", ",", "\[Sigma]a"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.855047439988881*^9, 3.855047460005116*^9}, {
   3.855047541726737*^9, 3.8550475645919886`*^9}, {3.8565962019634647`*^9, 
   3.8565962023145275`*^9}, 3.8565963435361323`*^9},
 CellLabel->
  "In[322]:=",ExpressionUUID->"5189ffd2-2b66-4efe-9d33-6d88e86287d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"structureTensor", "=", 
   RowBox[{"CalcGaugeFrameNewStructureTensor", "[", 
    RowBox[{
     RowBox[{"ObjPositionOrientationData", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Data\>\"", "\[Rule]", "oc3"}], ",", 
        RowBox[{"\"\<Symmetry\>\"", "\[Rule]", 
         RowBox[{"2", "\[Pi]"}]}], ",", " ", 
        RowBox[{"\"\<Wavelets\>\"", "\[Rule]", " ", "None"}], ",", " ", 
        RowBox[{"\"\<InputData\>\"", "\[Rule]", " ", "None"}], ",", " ", 
        RowBox[{"\"\<DcFilteredImage\>\"", "\[Rule]", "0"}]}], "}"}], "]"}], 
     ",", "1", ",", "\[Zeta]", ",", 
     RowBox[{"\[Sigma]s", "*", "10"}], ",", 
     RowBox[{"10", "*", "\[Sigma]a"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8618767410266323`*^9, 3.861876742179264*^9}, {
  3.861876820515786*^9, 3.8618768398669014`*^9}, {3.861936404072013*^9, 
  3.861936405808529*^9}},
 CellLabel->
  "In[323]:=",ExpressionUUID->"2ef0c741-a6cc-4cdf-8164-851343cf7aa8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"centerlinesAndAnglesAll", "=", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0"}], "}"}], "}"}]}], ";", 
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"i", "=", "1"}], ",", 
    RowBox[{"i", "<=", 
     RowBox[{
      RowBox[{"Dimensions", "[", "centerlinesAndAngles", "]"}], 
      "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
    RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{"centerlinesAndAnglesAll", "=", 
     RowBox[{"FlattenAt", "[", 
      RowBox[{
       RowBox[{"Append", "[", 
        RowBox[{"centerlinesAndAnglesAll", ",", 
         RowBox[{
         "centerlinesAndAngles", "\[LeftDoubleBracket]", "i", 
          "\[RightDoubleBracket]"}]}], "]"}], ",", 
       RowBox[{"-", "1"}]}], "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"centerlinesAndAnglesAll", "=", 
   RowBox[{"centerlinesAndAnglesAll", "\[LeftDoubleBracket]", 
    RowBox[{"2", ";;"}], "\[RightDoubleBracket]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8307682382527237`*^9, 3.8307682388418527`*^9}, {
  3.830768573099904*^9, 3.830768648343449*^9}, {3.8307686887477407`*^9, 
  3.8307687550599413`*^9}},
 CellLabel->
  "In[324]:=",ExpressionUUID->"e09e46c7-26ef-4733-815f-ed58bbb2663a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"samecenterlines", "=", 
   RowBox[{"RandomSample", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{
       RowBox[{"Dimensions", "[", "centerlinesAndAnglesAll", "]"}], 
       "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "]"}], ",", 
     RowBox[{"Round", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Dimensions", "[", "centerlinesAndAnglesAll", "]"}], 
        "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "/", "10"}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.832152763447624*^9, 3.832152832189679*^9}},
 CellLabel->
  "In[326]:=",ExpressionUUID->"9e0a11e6-52c9-49b1-b224-1bfc9998f5f5"],

Cell[BoxData[
 RowBox[{"PlotGaugeFrameFGThinLines", "[", 
  RowBox[{"oc4", ",", "gf4", ",", 
   RowBox[{
    RowBox[{
     RowBox[{"centerlinesAndAnglesAll", "\[LeftDoubleBracket]", 
      RowBox[{"#", ",", 
       RowBox[{"2", ";;", "3"}]}], "\[RightDoubleBracket]"}], "&"}], "/@", 
    "samecenterlines"}], ",", 
   RowBox[{"Round", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "centerlinesAndAnglesAll", "]"}], 
      "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "/", "10"}], 
    "]"}], ",", "1", ",", 
   RowBox[{"Image", "@", "imhalf"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.832152846058632*^9, 3.832167103973916*^9, 3.8321676117063656`*^9, {
   3.832168649731186*^9, 3.8321686500734835`*^9}, {3.8322149317985516`*^9, 
   3.8322149331215353`*^9}},
 CellLabel->
  "In[327]:=",ExpressionUUID->"db0c4b3f-3fdc-41a4-9495-4cd4ccec0c26"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Calculate Cost Function (Multiscale Vesselness)", "Chapter",
 CellChangeTimes->{{3.8713710292362432`*^9, 3.8713710331967263`*^9}, {
  3.8713804368198137`*^9, 
  3.8713804479033813`*^9}},ExpressionUUID->"d3a329e1-23fa-4d4b-b330-\
878d95faf708"],

Cell[CellGroupData[{

Cell["Calculated cost functions", "Subsection",
 CellChangeTimes->{{3.8316344872709417`*^9, 
  3.831634500602792*^9}},ExpressionUUID->"d99d482e-3c57-4732-b4f0-\
3a15b58b455c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"osGFCost", "=", 
   RowBox[{"OrientationScoreTransform", "[", 
    RowBox[{
     RowBox[{"Image", "@", "imhalf"}], ",", 
     RowBox[{"\"\<Orientations\>\"", "\[Rule]", "32"}], ",", 
     RowBox[{"\"\<WaveletSize\>\"", "\[Rule]", "75"}], ",", 
     RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "0.999"}], ",", 
     RowBox[{"\"\<OverlapFactor\>\"", "\[Rule]", "1"}]}], "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"Orientation", " ", "Score", " ", "of", " ", "image"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{
  3.8318059622419643`*^9, 3.8472528746693845`*^9, {3.8713809731385903`*^9, 
   3.871380991246049*^9}, 3.871701515240947*^9},
 CellLabel->
  "In[218]:=",ExpressionUUID->"8a30a2bf-e8d3-4878-a15d-dbf996283077"],

Cell[BoxData[
 RowBox[{
  RowBox[{"osGFBoarder", "=", 
   RowBox[{"OrientationScoreTransform", "[", 
    RowBox[{
     RowBox[{"Image", "@", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Boole", "[", 
              RowBox[{"#", ">=", "0.05"}], "]"}], "&"}], ",", "imhalf", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}], ",", "No"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ",", 
     RowBox[{"\"\<Orientations\>\"", "\[Rule]", "32"}], ",", 
     RowBox[{"\"\<WaveletSize\>\"", "\[Rule]", "75"}], ",", 
     RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "0.999"}], ",", 
     RowBox[{"\"\<OverlapFactor\>\"", "\[Rule]", "1"}]}], "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"Orientation", " ", "Score", " ", "of", " ", "boarder"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{
  3.8318059622419643`*^9, {3.83196879251034*^9, 3.831968800847994*^9}, 
   3.8472528728662386`*^9, {3.871380994807333*^9, 3.871381003133168*^9}, 
   3.871701522269094*^9},
 CellLabel->
  "In[219]:=",ExpressionUUID->"6f5dea9a-f8e4-4bb7-a6d5-2c62fcd94df2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"multiscalecostLIFExtReg", "=", 
   RowBox[{"MultiScaleVesselnessExtReg", "[", 
    RowBox[{
     RowBox[{"osGFCost", "[", "\"\<FullData\>\"", "]"}], ",", 
     RowBox[{"osGFBoarder", "[", "\"\<FullData\>\"", "]"}], ",", "\[Xi]", ",",
      "1", ",", 
     RowBox[{"{", 
      RowBox[{"0.5", ",", "1", ",", "1.5", ",", "2", ",", "3"}], "}"}], ",", 
     "\"\<LIF\>\"", ",", "2", ",", "0"}], "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"Left", "-", 
    RowBox[{
    "Invariant", " ", "Multiscale", " ", "Cost", " ", "of", " ", "image", " ",
      "without", " ", "boarder"}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.846755382089878*^9, 3.8467554121894693`*^9}, {
   3.846755626142836*^9, 3.846755658632118*^9}, {3.8467566756303134`*^9, 
   3.846756680632657*^9}, {3.8467580092612576`*^9, 3.8467580158801794`*^9}, 
   3.846758530443386*^9, {3.8467590809018526`*^9, 3.8467590830791674`*^9}, 
   3.8467596978682413`*^9, 3.8467599253196707`*^9, {3.8477935995039682`*^9, 
   3.847793603485036*^9}, {3.871381006249838*^9, 3.8713810431647425`*^9}, 
   3.871701534327339*^9},
 CellLabel->
  "In[232]:=",ExpressionUUID->"d3effd15-353b-48bd-85c6-03358d3e0b74"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testExtReg", "=", 
   RowBox[{"MultiScaleVesselnessFilter2D", "[", 
    RowBox[{"multiscalecostLIFExtReg", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;", "4"}], "]"}], "]"}], "]"}]}], ";", " ", 
  RowBox[{"(*", 
   RowBox[{
   "2", "D", " ", "visualization", " ", "of", " ", "multiscale", " ", 
    "vesselness", " ", "filter"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.8472752493809013`*^9, 3.847275262849016*^9}, {
   3.847275309785474*^9, 3.8472753110082498`*^9}, {3.8472784559745007`*^9, 
   3.8472784567763367`*^9}, {3.847278529370555*^9, 3.8472785307041936`*^9}, {
   3.8472786967096624`*^9, 3.8472787188449297`*^9}, {3.8473418223084297`*^9, 
   3.8473418559867964`*^9}, {3.847342961624383*^9, 3.847342966508152*^9}, {
   3.8473430357628117`*^9, 3.847343038102213*^9}, {3.8713810633784885`*^9, 
   3.8713810901836386`*^9}, 3.871701649587858*^9},
 CellLabel->
  "In[233]:=",ExpressionUUID->"ee1d4592-67af-4e50-90b0-62387bd16e93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testExtReg1", "=", 
   RowBox[{"Map", "[", 
    RowBox[{"Max", ",", 
     RowBox[{"MultiScaleVesselnessFilter", "[", 
      RowBox[{"multiscalecostLIFExtReg", "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;", "4"}], "]"}], "]"}], "]"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{
   "maximum", " ", "over", " ", "the", " ", "orientations", " ", "of", " ", 
    "the", " ", "multiscale", " ", "vesselness", " ", "filter"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.8472752493809013`*^9, 3.847275262849016*^9}, {
   3.847275309785474*^9, 3.8472753110082498`*^9}, {3.8472784559745007`*^9, 
   3.8472784567763367`*^9}, {3.847278529370555*^9, 3.8472785307041936`*^9}, {
   3.8472786967096624`*^9, 3.8472787188449297`*^9}, {3.8473429734085283`*^9, 
   3.847342975094215*^9}, {3.847343085421977*^9, 3.847343088983683*^9}, 
   3.84785638838393*^9, {3.871381137728956*^9, 3.8713811582892184`*^9}, 
   3.871701752479336*^9},
 CellLabel->
  "In[234]:=",ExpressionUUID->"606a78cb-c225-44a7-8a1d-60628f14110e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"testExtReg1", "=", 
    RowBox[{"UnitStep", "[", 
     RowBox[{"testExtReg1", "-", "0.03"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Create", " ", "a", " ", "step"}], "-", 
    RowBox[{
    "function", " ", "at", " ", "locations", " ", "where", " ", "vessels", 
     " ", "are", " ", "located", " ", "in", " ", "2", "D"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"ArrayPlot", "[", "testExtReg1", "]"}]}], "Input",
 CellChangeTimes->{{3.8522845007055235`*^9, 3.852284507357986*^9}, {
   3.871381184732157*^9, 3.871381207762706*^9}, 3.87170246536185*^9},
 CellLabel->
  "In[240]:=",ExpressionUUID->"453e644d-f18e-4214-8755-4b62125b5d7e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"testExtReg2", "=", 
   RowBox[{"UnitStep", "[", 
    RowBox[{"testExtReg", "-", "0.03"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ArrayPlot", "[", "testExtReg2", "]"}]}], "Input",
 CellChangeTimes->{{3.8478576066054707`*^9, 3.8478576086726904`*^9}, {
  3.8481205906399126`*^9, 3.8481205922229314`*^9}, {3.8575316021838655`*^9, 
  3.8575316173162055`*^9}, {3.871701593588165*^9, 3.8717016080206017`*^9}, {
  3.8717024362518687`*^9, 3.8717024470672045`*^9}},
 CellLabel->
  "In[238]:=",ExpressionUUID->"ed95c07f-771a-4d2c-a4f0-28923e1f3309"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"osGFtest", "=", 
    RowBox[{"OrientationScoreTransform", "[", 
     RowBox[{
      RowBox[{"Image", "@", "testExtReg1"}], ",", 
      RowBox[{"\"\<Orientations\>\"", "\[Rule]", "32"}], ",", 
      RowBox[{"\"\<WaveletSize\>\"", "\[Rule]", "75"}], ",", 
      RowBox[{"\"\<InflectionPoint\>\"", "\[Rule]", "0.9"}], ",", 
      RowBox[{"\"\<OverlapFactor\>\"", "\[Rule]", "1"}]}], "]"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
   "Orientation", " ", "score", " ", "of", " ", "new", " ", "created", " ", 
    "image"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.847278579110128*^9, 3.8472785869251533`*^9}, {
   3.8473429814461727`*^9, 3.847342983022445*^9}, {3.847357532617567*^9, 
   3.8473575415270977`*^9}, {3.8477898972719793`*^9, 3.84778989759897*^9}, 
   3.847857613896998*^9, {3.87138119323127*^9, 3.8713812161001015`*^9}},
 CellLabel->
  "In[245]:=",ExpressionUUID->"ad466866-dcdd-4b71-9a60-13b86ce013a1"],

Cell[BoxData[
 RowBox[{"os3dTestExtReg", "=", 
  RowBox[{"Image3D", "[", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Rescale", "[", 
       RowBox[{"Abs", "[", 
        RowBox[{"osGFtest", "[", "\"\<FullData\>\"", "]"}], "]"}], "]"}], "-",
       "0.08"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], "]"}], " ", 
  RowBox[{"(*", 
   RowBox[{
   "3", "D", " ", "visualization", " ", "of", " ", "cost", " ", "function"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.7961246781939216`*^9, 3.7961247715594044`*^9}, {
   3.796124906632715*^9, 3.7961249453547397`*^9}, {3.7961250334197445`*^9, 
   3.796125109796521*^9}, {3.815805758581487*^9, 3.815805762523642*^9}, {
   3.8199919654060416`*^9, 3.8199919658974676`*^9}, {3.827568810920482*^9, 
   3.8275688124342747`*^9}, {3.847278624917351*^9, 3.8472786309007215`*^9}, {
   3.84734298401431*^9, 3.8473429858151875`*^9}, {3.8473479383022485`*^9, 
   3.8473479472703876`*^9}, 3.8473575464473743`*^9, {3.8477898997261696`*^9, 
   3.8477899000203495`*^9}, {3.8713812206392274`*^9, 3.871381228334984*^9}},
 CellLabel->
  "In[246]:=",ExpressionUUID->"44e38c5c-d041-4b0b-8e8e-935364124c1f"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Tracking", "Chapter",
 CellChangeTimes->{{3.871371053101525*^9, 
  3.871371054044046*^9}},ExpressionUUID->"161c7e57-1c76-41da-878f-\
4d306c3e655c"],

Cell[CellGroupData[{

Cell["Parameters Tracking", "Section",
 CellChangeTimes->{{3.871371041907973*^9, 
  3.87137104476435*^9}},ExpressionUUID->"404aab30-5864-41ed-a9fd-\
24fdd7af220f"],

Cell[CellGroupData[{

Cell["Seeds and tips", "Subsection",
 CellChangeTimes->{{3.8221103214920444`*^9, 3.8221103476678224`*^9}, {
  3.822577917849801*^9, 
  3.822577923018709*^9}},ExpressionUUID->"17941c5f-71d4-4571-bcf0-\
aab9bc84e8ac"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"discreteToFM", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Theta]d_", ",", "x_", ",", "y_"}], "}"}], ",", "No_"}], 
     "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"\[Theta]d", "-", "1"}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"2", "\[Pi]"}], ")"}], "/", "No"}], ")"}]}]}], "}"}]}], 
   ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Formula", " ", "to", " ", "go", " ", "from", " ", "discrete", " ", 
     "angles", " ", "to", " ", "continuous", " ", 
     RowBox[{"(", 
      RowBox[{"fast", " ", "marching"}], ")"}], " ", "angles"}], ";", " ", 
    RowBox[{
    "the", " ", "order", " ", "of", " ", "the", " ", "coordinates", " ", "is",
      " ", "changed", " ", "as", " ", "well"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FMtoDiscrete", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "\[Theta]_"}], "}"}], ",", "No_"}], "]"}], 
  ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"No", "/", 
        RowBox[{"(", 
         RowBox[{"2", "\[Pi]"}], ")"}]}], ")"}], "*", "\[Theta]"}], "+", 
     "1"}], ",", "x", ",", "y"}], "}"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Formula", " ", "to", " ", "go", " ", "from", " ", "continuous", " ", 
     RowBox[{"(", 
      RowBox[{"fast", " ", "marching"}], ")"}], " ", "angles", " ", "to", " ",
      "discrete", " ", "angles"}], ";", " ", 
    RowBox[{
    "the", " ", "order", " ", "of", " ", "the", " ", "coordinates", " ", "is",
      " ", "changed", " ", "as", " ", "well"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.822114317514948*^9, 3.82211437477606*^9}, {
   3.822114426392227*^9, 3.822114503400305*^9}, {3.822139513760394*^9, 
   3.822139557343726*^9}, 3.8568687569760857`*^9, {3.8715301284474225`*^9, 
   3.871530182918798*^9}},
 CellLabel->
  "In[247]:=",ExpressionUUID->"1a44b28d-dc02-4716-8154-a52774a35392"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"g0dList", "=", "g0dListTiers"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"g1dList", "=", "g1dListTiers"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"Select", " ", "all", " ", "end", " ", "points"}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.8631497977311063`*^9, 3.86314981021002*^9}},
 CellLabel->
  "In[249]:=",ExpressionUUID->"937018a6-3f51-41c8-9783-13ddce1f9da5"],

Cell["\<\
The seeds, tips and bifurcations have to be put in the right format for the \
fast marching code.\
\>", "Text",
 CellChangeTimes->{{3.8715301994784794`*^9, 
  3.8715302388464637`*^9}},ExpressionUUID->"7f649052-29f9-4e23-9ff8-\
c47e23d77206"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"g0FM", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"discreteToFM", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", "g0dList", "]"}], ",", "No"}], "]"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g1FM", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"discreteToFM", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", "g1dList", "]"}], ",", "No"}], "]"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g005FM", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"discreteToFM", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", "g0dListStartAndBifurcation", "]"}], ",", 
      "No"}], "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8221142525618834`*^9, 3.8221143062756634`*^9}, {
   3.8221145143291054`*^9, 3.8221145770244164`*^9}, 3.8620397162844753`*^9},
 CellLabel->
  "In[251]:=",ExpressionUUID->"aee01d3c-6a9e-4840-bc6b-6eb2ad4e3a73"],

Cell["We introduce some \[OpenCurlyDoubleQuote]new\[CloseCurlyDoubleQuote] \
parameter notations - to update:", "Text",
 CellChangeTimes->{{3.871530244892332*^9, 3.871530248405013*^9}, {
  3.8715312588382993`*^9, 3.871531265254239*^9}, {3.8717014868594456`*^9, 
  3.8717014888123183`*^9}},ExpressionUUID->"f2530887-3ddc-4431-9d64-\
5ef535d5f05d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"seedsFM", "=", "g0FM"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsBifurcationsFM", "=", "g005FM"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tipsFM", "=", "g1FM"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8275674997954206`*^9, 3.827567524004422*^9}, {
   3.827567557084155*^9, 3.827567666941328*^9}, 3.8275682247736826`*^9, {
   3.8275683492981186`*^9, 3.8275684003764915`*^9}, {3.8275762889840717`*^9, 
   3.827576298731626*^9}, {3.8275763421784134`*^9, 3.827576433694724*^9}, 
   3.82757651991945*^9, 3.8304230766650004`*^9, {3.832301155445491*^9, 
   3.832301200284541*^9}, {3.832302162841693*^9, 3.8323021662082105`*^9}, {
   3.8475167438519545`*^9, 3.8475167596714296`*^9}, {3.8716363270075636`*^9, 
   3.871636344408661*^9}, {3.871636381762293*^9, 3.871636386360244*^9}},
 CellLabel->
  "In[254]:=",ExpressionUUID->"5c335492-8644-4ab0-b402-5d8728c8066a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tipsFMnew", "=", "tipsFM"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsFMnew", "=", "seedsFM"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seedsBifurcationsFMnew", "=", "seedsBifurcationsFM"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.847870094648266*^9, 3.847870123048351*^9}, {
   3.8478705702600546`*^9, 3.8478705823675976`*^9}, 3.8478727856229258`*^9, 
   3.8478772238671613`*^9, {3.8613483843901453`*^9, 3.8613483855640864`*^9}, {
   3.861680897212529*^9, 3.861680976406165*^9}, 3.861681009611807*^9, {
   3.871531205100974*^9, 3.871531226133831*^9}},
 CellLabel->
  "In[257]:=",ExpressionUUID->"1e2367d1-4490-4fa1-9836-5ed61826f74e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tipsFMnew", "=", "tipsFM"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "tipsFMnew", "\[LeftDoubleBracket]", "19", "\[RightDoubleBracket]"}], "=", 
   RowBox[{"{", 
    RowBox[{"186", ",", "258", ",", 
     RowBox[{"7", 
      RowBox[{"\[Pi]", "/", "4"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "tipsFMnew", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "=", 
   RowBox[{"{", 
    RowBox[{"169", ",", "285", ",", 
     RowBox[{"3", 
      RowBox[{"\[Pi]", "/", "2"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "tipsFMnew", "\[LeftDoubleBracket]", "15", "\[RightDoubleBracket]"}], "=", 
   RowBox[{"{", 
    RowBox[{"166", ",", "92", 
     RowBox[{"(*", 
      RowBox[{"176", ",", "85"}], "*)"}], ",", "0"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "tipsFMnew", "\[LeftDoubleBracket]", "18", "\[RightDoubleBracket]"}], "=", 
   RowBox[{"{", 
    RowBox[{"215", ",", "139", 
     RowBox[{"(*", 
      RowBox[{"214", ",", "129"}], "*)"}], ",", 
     FractionBox[
      RowBox[{"7", " ", "\[Pi]"}], "4"]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.832044053183854*^9, 3.8320440816317015`*^9}, {
   3.832044143975288*^9, 3.8320441763078785`*^9}, {3.8320479702275496`*^9, 
   3.832047975550089*^9}, {3.832048009036583*^9, 3.83204803622827*^9}, {
   3.832048111380642*^9, 3.832048146485194*^9}, 3.8320497924902287`*^9, 
   3.8320498236285105`*^9, {3.8320515761468678`*^9, 3.83205161005856*^9}, {
   3.832078546134762*^9, 3.83207856052785*^9}, {3.8320794593737564`*^9, 
   3.8320794599641714`*^9}, {3.832301278148294*^9, 3.8323012914714117`*^9}, 
   3.858054256929637*^9},
 CellLabel->
  "In[260]:=",ExpressionUUID->"f18b15c4-f04b-41cd-84c4-35efcdfb96f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"seedsFM", "[", 
    RowBox[{"[", "4", "]"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"187", ",", "451", ",", 
     FractionBox[
      RowBox[{"13", "\[Pi]"}], "16"]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.858072686666877*^9, 3.8580726889865227`*^9}, {
  3.858134422243668*^9, 3.858134450343875*^9}},
 CellLabel->
  "In[267]:=",ExpressionUUID->"1fa2477b-6ba5-4297-81ac-de3ffc2f58b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"seedsBifurcationsFM", "[", 
    RowBox[{"[", "25", "]"}], "]"}], "=", 
   RowBox[{"seedsFM", "[", 
    RowBox[{"[", "4", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8629020127620573`*^9, 3.8629020142214303`*^9}, {
  3.8629021080345592`*^9, 3.8629021140128555`*^9}},
 CellLabel->
  "In[268]:=",ExpressionUUID->"f62f4bad-671a-4ced-8ff0-5b76304df583"],

Cell[BoxData[
 RowBox[{
  RowBox[{"seedsFMnew", "=", 
   RowBox[{"seedsFM", "[", 
    RowBox[{"[", 
     RowBox[{";;", "4"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8629893624157267`*^9, 3.862989380260454*^9}},
 CellLabel->
  "In[273]:=",ExpressionUUID->"412cb217-7816-4be7-9733-65ddc7380ea4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"seedsFMnew", ",", 
    RowBox[{"{", 
     RowBox[{"169", ",", "432", ",", 
      FractionBox[
       RowBox[{"17", " ", "\[Pi]"}], "16"]}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"seedsFMnew", ",", 
    RowBox[{"{", 
     RowBox[{"181", ",", "429", ",", 
      FractionBox[
       RowBox[{"3", "\[Pi]"}], "2"]}], "}"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8629845107370386`*^9, 3.8629845323779774`*^9}, {
  3.862984581017331*^9, 3.8629845961579485`*^9}, {3.8629848367262716`*^9, 
  3.8629848612091208`*^9}, {3.8629893860160737`*^9, 3.862989386911263*^9}},
 CellLabel->
  "In[274]:=",ExpressionUUID->"cccd99c5-d3dd-41ef-bf69-c749e667cdc3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"seedsBifurcationsFMnew", "=", 
   RowBox[{"seedsBifurcationsFM", "[", 
    RowBox[{"[", 
     RowBox[{";;", "42"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"seedsBifurcationsFMnew", ",", 
    RowBox[{"{", 
     RowBox[{"169", ",", "432", ",", 
      FractionBox[
       RowBox[{"17", " ", "\[Pi]"}], "16"]}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"seedsBifurcationsFMnew", ",", 
    RowBox[{"{", 
     RowBox[{"181", ",", "429", ",", 
      FractionBox[
       RowBox[{"3", "\[Pi]"}], "2"]}], "}"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8629894354055924`*^9, 3.862989471832411*^9}},
 CellLabel->
  "In[276]:=",ExpressionUUID->"4f6b6ad6-283f-438c-8ab4-93d2449ed61a"],

Cell[BoxData["seedsBifurcationsFMnew"], "Input",
 CellLabel->
  "In[279]:=",ExpressionUUID->"f9c586cb-d5bd-496f-8811-79e175aa42ae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"seedsBifurcationsFMnew2", "=", 
   RowBox[{"Drop", "[", 
    RowBox[{"seedsBifurcationsFMnew", ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "7"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8642086086644955`*^9, 3.864208630592991*^9}, 
   3.8642086977737007`*^9},
 CellLabel->
  "In[280]:=",ExpressionUUID->"0cde684a-84b4-4db5-9fff-15ec8f50a574"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"tipsFMnew", "[", 
    RowBox[{"[", "4", "]"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"179", ",", "213", ",", "0"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.864210366607684*^9, 3.864210367481395*^9}, {
  3.8642104128499713`*^9, 3.864210415145204*^9}, {3.8642104967279186`*^9, 
  3.8642105081051817`*^9}, {3.8642118274231615`*^9, 3.864211831205619*^9}, {
  3.8642121095490007`*^9, 3.864212124555703*^9}, {3.8642124021846514`*^9, 
  3.8642124109018054`*^9}},
 CellLabel->
  "In[282]:=",ExpressionUUID->"1bc99070-e2f8-46cc-b558-0b801dfadd4c"],

Cell[BoxData[{"seedsFM", "\[IndentingNewLine]", "seedsFMnew"}], "Input",
 CellChangeTimes->{{3.871725903355651*^9, 3.871725909805397*^9}},
 CellLabel->
  "In[292]:=",ExpressionUUID->"ae63391f-fb0b-4853-8995-e6369ff80fbe"],

Cell[BoxData[{
 RowBox[{"Dimensions", "[", "seedsBifurcationsFMnew", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "seedsBifurcationsFMnew2", "]"}]}], "Input",
 CellChangeTimes->{{3.8717259542931767`*^9, 3.8717259682288947`*^9}, {
  3.8717259996214547`*^9, 3.871726005071645*^9}},
 CellLabel->
  "In[297]:=",ExpressionUUID->"8dea69d6-5dc2-4a1a-9ed9-ba7e8aeaa8cf"],

Cell[CellGroupData[{

Cell["Visualization seeds and bifurcations", "Subsubsection",
 CellChangeTimes->{{3.8717027316061716`*^9, 
  3.871702737347016*^9}},ExpressionUUID->"070450ea-d314-43f8-9d49-\
91ae0ae50516"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"seedsPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
       RowBox[{"newSeedsFM", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bifPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Magenta", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Complement", "[", 
         RowBox[{"newSeedsBifurcationsFM", ",", "newSeedsFM"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tipPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Red", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
       RowBox[{"tipsFMnew2", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8580517329520273`*^9, 3.858051752883647*^9}, 
   3.858054593912917*^9},
 CellLabel->
  "In[331]:=",ExpressionUUID->"86c60b2e-c51c-4f15-a28d-9ae4c5e56e09"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"seedsPointFig1", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
       RowBox[{"seedsFMnew", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bifPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Magenta", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Complement", "[", 
         RowBox[{"seedsBifurcationsFMnew2", ",", "seedsFMnew"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tipPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Red", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"PointImageCoordinates", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
       RowBox[{"tipsFMnew", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.8581344646241684`*^9, 3.8581346587210636`*^9, {3.871728069953766*^9, 
   3.8717280862599754`*^9}, 3.871728128254187*^9},
 CellLabel->
  "In[365]:=",ExpressionUUID->"391ee8bb-788c-4a26-84e0-b0ba35ef8b6f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"seedsPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"Point", "[", 
      RowBox[{"imageToGraphicsCoordinates", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
        RowBox[{"seedsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
  ";", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Green", ",", 
      RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
      RowBox[{"Point", "[", 
       RowBox[{"imageToGraphicsCoordinates", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
         RowBox[{"seedsFM", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"6", ";;"}], ",", 
            RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], "}"}], 
    ","}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"seedsPointFig1", "=", 
   RowBox[{"{", 
    RowBox[{"Green", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"Point", "[", 
      RowBox[{"imageToGraphicsCoordinates", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
        RowBox[{"seedsBifurcationsFMnew2", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bifPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Magenta", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"Point", "[", 
      RowBox[{"imageToGraphicsCoordinates", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"seedsBifurcationsFMnew2", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{";;", "2"}]}], "]"}], "]"}], ",", 
          RowBox[{"seedsFMnew", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "]"}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endsPointFig", "=", 
   RowBox[{"{", 
    RowBox[{"Red", ",", 
     RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
     RowBox[{"Point", "[", 
      RowBox[{"imageToGraphicsCoordinates", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
        RowBox[{"tipsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8717281543640375`*^9, 3.8717282483683314`*^9}},
 CellLabel->
  "In[378]:=",ExpressionUUID->"b6d4104f-3cc7-455c-9f35-54429c95aa1b"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Other parameters", "Subsection",
 CellChangeTimes->{{3.871636405976751*^9, 
  3.8716364089661055`*^9}},ExpressionUUID->"7ade186b-7350-4e61-be80-\
d03cf33dd614"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"NxCost", ",", "NyCost", ",", "NoCost"}], "}"}], "=", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"costLift", ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xiLIF", "=", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"\[Mu]", "*", "ds"}], ")"}], 
    RowBox[{"-", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"costFM", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"costLiftElevator", ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8716363873436337`*^9, 3.871636388910304*^9}},
 CellLabel->
  "In[328]:=",ExpressionUUID->"04b692d6-569f-4270-afac-d8dee848ee5a"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Tracking in 2 steps (with calculated cost function)", "Section",
 CellChangeTimes->{{3.871371074829458*^9, 
  3.8713710826930256`*^9}},ExpressionUUID->"80ec1585-3eb9-41b8-912e-\
bd2bf947c467"],

Cell["\<\
Cost function to track from tips to bifurcations (thin low costs at thin \
vessels)\
\>", "Text",
 CellChangeTimes->{{3.8715344221910934`*^9, 
  3.8715344297801485`*^9}},ExpressionUUID->"ae0af948-806b-49f2-b213-\
d1882863af9d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cost3", "=", 
   RowBox[{"CostFunction", "[", 
    RowBox[{
     RowBox[{"AddLifts", "[", 
      RowBox[{
       RowBox[{"MultiScaleVesselnessFilter", "[", 
        RowBox[{"multiscalecostLIFExtReg", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", "2"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{"#", 
          RowBox[{"(*", 
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"ySelect", ",", "0"}], "}"}]}], "*)"}], "&"}], ",", 
         "seedsIndex"}], "]"}]}], "]"}], ",", "1000", ",", "2"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8473590193072753`*^9, 3.847359025899187*^9}, {
   3.8473598388395348`*^9, 3.847359846511566*^9}, {3.847360168707464*^9, 
   3.8473601740242324`*^9}, 3.8473603945795765`*^9, {3.8473612527339134`*^9, 
   3.847361255231004*^9}, {3.8473645808139706`*^9, 3.847364582753239*^9}, {
   3.847790022663253*^9, 3.847790022953446*^9}, {3.847856769393502*^9, 
   3.847856781129664*^9}, {3.8480419366824017`*^9, 3.8480419402782536`*^9}, {
   3.8582284499666667`*^9, 3.858228465885295*^9}, 3.864786816664556*^9, 
   3.864786847013364*^9, {3.864787033969426*^9, 3.8647870340597367`*^9}, 
   3.87171428620455*^9},
 CellLabel->
  "In[299]:=",ExpressionUUID->"e421ab94-4852-430a-9b38-65a0087a00e4"],

Cell["Cost function to track from bifurcations to seeds", "Text",
 CellChangeTimes->{{3.8715344221910934`*^9, 3.8715344297801485`*^9}, {
  3.871534575291988*^9, 
  3.8715345947014523`*^9}},ExpressionUUID->"49cde71c-eb34-456b-869c-\
352ca6cb0642"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cost", "=", 
   RowBox[{"CostFunction", "[", 
    RowBox[{
     RowBox[{"AddLifts", "[", 
      RowBox[{
       RowBox[{"MultiScaleVesselnessFilter", "[", 
        RowBox[{"multiscalecostLIFExtReg", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", "3"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{"#", 
          RowBox[{"(*", 
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"ySelect", ",", "0"}], "}"}]}], "*)"}], "&"}], ",", 
         "seedsIndex"}], "]"}]}], "]"}], ",", "1000", ",", "2"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8468405300241914`*^9, 3.8468405426731696`*^9}, 
   3.8468405954490647`*^9, 3.84736421998925*^9, {3.8477959176459703`*^9, 
   3.847795974113347*^9}, {3.84795162034848*^9, 3.847951620455*^9}, 
   3.8522211550606956`*^9, 3.871714294231641*^9},
 CellLabel->
  "In[300]:=",ExpressionUUID->"0db9b1bb-ae54-4724-98aa-afbb20c6f730"],

Cell["Visualization of cost functions", "Text",
 CellChangeTimes->{{3.8715344349257545`*^9, 
  3.8715344403950357`*^9}},ExpressionUUID->"83098490-71f3-4482-a4dc-\
b7c78537a2c0"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Image", "@", 
      RowBox[{"Rescale", "@", 
       RowBox[{"Map", "[", 
        RowBox[{"Min", ",", "cost3", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}]}], ",", 
     RowBox[{"Image", "@", 
      RowBox[{"Rescale", "@", 
       RowBox[{"Map", "[", 
        RowBox[{"Min", ",", "cost", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}]}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8582340493544436`*^9, 3.8582341511336994`*^9}, {
  3.8582343240538487`*^9, 3.85823436544416*^9}, {3.858234436291401*^9, 
  3.858234448944004*^9}, {3.858235074244686*^9, 3.8582350844395247`*^9}, {
  3.861956422685077*^9, 3.8619564528547893`*^9}, {3.8715346580498886`*^9, 
  3.8715346608953705`*^9}, {3.871725727787843*^9, 3.8717257279379787`*^9}},
 CellLabel->
  "In[301]:=",ExpressionUUID->"6ea79d9a-de68-4ef2-a9c0-2447744e7f88"],

Cell[CellGroupData[{

Cell["\<\
Tracking 3 - From tips to bifurcation points - Forward Mixed Model Tracking\
\>", "Subsubsection",
 CellChangeTimes->{{3.8473645353135653`*^9, 3.8473645365513*^9}, {
   3.847790069486391*^9, 3.8477900779275827`*^9}, {3.847790695287031*^9, 
   3.847790699327445*^9}, {3.847854165730627*^9, 3.847854168554603*^9}, 
   3.8478546673477983`*^9, {3.8479510712180014`*^9, 3.847951092240478*^9}, {
   3.856858700515448*^9, 3.8568587076925445`*^9}, {3.8571048407631893`*^9, 
   3.8571048410094795`*^9}, 3.85822844710036*^9, {3.860555334586107*^9, 
   3.8605553449930773`*^9}, {3.8717187074205976`*^9, 3.871718708307446*^9}, {
   3.8718354096515837`*^9, 
   3.8718354126596904`*^9}},ExpressionUUID->"a17de581-4f26-4c85-ae70-\
fe51fab85f85"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"crossings", "=", 
   RowBox[{"AutomaticCrossingIdentification", "[", 
    RowBox[{"Select", "[", 
     RowBox[{"vesselAnnotations", ",", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Part", "[", 
           RowBox[{"VesselTrees", ",", "rowSelection"}], "]"}]}], ",", 
         RowBox[{"\"\<name\>\"", "/.", "#"}]}], "]"}], "&"}]}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"crossingsNew", "=", 
   RowBox[{"ArrayReshape", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"crossings", ",", 
        RowBox[{"{", "}"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"crossings", ",", 
              RowBox[{"{", "}"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], 
          "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", "2"}], ",", "2"}], "}"}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.860473067748049*^9, 3.8604730705655327`*^9}, {
   3.8604732603044567`*^9, 3.8604732656556478`*^9}, {3.8604732973366156`*^9, 
   3.8604733441281214`*^9}, 3.860473589318948*^9, 3.860473693622631*^9, {
   3.8604737720815744`*^9, 3.8604737752316227`*^9}, {3.8604790575788717`*^9, 
   3.860479057840353*^9}, 3.8604803072151027`*^9, {3.8628896419408474`*^9, 
   3.8628896500144253`*^9}},
 CellLabel->
  "In[304]:=",ExpressionUUID->"9b1de7bd-a0d9-413c-89ea-e37cc49c7a50"],

Cell["Anisotropic Mixed Metric and forward gear vector w", "Text",
 CellChangeTimes->{{3.846906809497451*^9, 3.846906825715495*^9}, {
  3.8715342953669634`*^9, 3.871534320982114*^9}, {3.871630483413827*^9, 
  3.871630485405301*^9}, {3.8716307096609464`*^9, 
  3.871630710444929*^9}},ExpressionUUID->"bc2b54bb-909a-42aa-be45-\
153538f157b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cost3new", "=", 
   RowBox[{"AddObstaclesCrossings", "[", 
    RowBox[{"cost3", ",", 
     RowBox[{"Round", "[", 
      RowBox[{"crossingsNew", "-", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"Ny", "-", "ySelect"}]}], "}"}], ",", 
         RowBox[{"Length", "[", "crossingsNew", "]"}]}], "]"}]}], "]"}], ",", 
     "14", ",", "14", ",", "Nx", ",", "10", ",", ".5"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8582348476743603`*^9, 3.8582348722145295`*^9}, {
   3.858235030954756*^9, 3.8582350373654013`*^9}, {3.8582356466376257`*^9, 
   3.858235672587278*^9}, {3.8582360378030243`*^9, 3.8582360472366424`*^9}, {
   3.858236432976471*^9, 3.8582364356190577`*^9}, 3.860483045746724*^9, 
   3.8604830967057447`*^9},
 CellLabel->
  "In[306]:=",ExpressionUUID->"7fa9e2c9-65d0-4d43-ac7d-49f810dac616"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"cost3new", "[", 
    RowBox[{"[", 
     RowBox[{
      RowBox[{"80", ";;", "150"}], ",", 
      RowBox[{"210", ";;", "220"}]}], "]"}], "]"}], "=", 
   RowBox[{"Clip", "[", 
    RowBox[{
     RowBox[{"cost3new", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"80", ";;", "150"}], ",", 
        RowBox[{"210", ";;", "220"}]}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{"cost3new", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"80", ";;", "150"}], ",", 
            RowBox[{"210", ";;", "220"}]}], "]"}], "]"}], "]"}], "*", "100"}],
        ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{"cost3new", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"80", ";;", "150"}], ",", 
            RowBox[{"210", ";;", "220"}]}], "]"}], "]"}], "]"}], "/", "10"}], 
       ",", "1"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8643793617196174`*^9, 3.8643793775800486`*^9}, {
  3.864379748192335*^9, 3.8643797596184893`*^9}},
 CellLabel->
  "In[307]:=",ExpressionUUID->"0d4a4353-854b-4049-9232-722fe92eda20"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Gamma]", "=", "15"}], ";"}]], "Input",
 CellChangeTimes->{{3.860480450283126*^9, 3.8604804526960497`*^9}, {
   3.8635981964469595`*^9, 3.8635981965046625`*^9}, 3.863599024443143*^9, {
   3.864119054568288*^9, 3.8641190546479745`*^9}},
 CellLabel->
  "In[308]:=",ExpressionUUID->"104d6e91-d855-4b6d-aba1-a5660f0e0044"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"MMixed", ",", "w"}], "}"}], "=", 
   RowBox[{"metricMvectorwMixed", "[", 
    RowBox[{"cost3new", ",", 
     RowBox[{"{", 
      RowBox[{"ySelect", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0.1", ",", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"xiLIF", "*", "2"}], ")"}], "2"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", "\[Gamma]", ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Inverse", "[", "#", "]"}], "]"}], "&"}], ",", "Hout", ",", 
       RowBox[{"{", "3", "}"}]}], "]"}], ",", "crossingsNew", ",", "0.1", ",",
      "ySelect"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.860479267861275*^9, 3.860479332236277*^9}, {
   3.860480448432621*^9, 3.860480448886552*^9}, {3.8604818026785865`*^9, 
   3.8604818100371385`*^9}, 3.86057001880132*^9, {3.860571483227079*^9, 
   3.860571488467264*^9}, {3.8605723419297624`*^9, 3.860572343920355*^9}, 
   3.862889701091107*^9, {3.864209491726104*^9, 3.864209498624976*^9}},
 CellLabel->
  "In[337]:=",ExpressionUUID->"6a331514-371a-4de1-a56a-f5f3a18065c9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height", ",", "geodesics"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ySelect", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"ySelect", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", "seedsBifurcationsFMnew2"}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", "tipsFMnew"}], "]"}], "]"}], ",", "0.1", ",", "3"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8492362731727424`*^9, 3.8492363067161417`*^9}, {
   3.8492366971201305`*^9, 3.8492367711911497`*^9}, {3.849237565245867*^9, 
   3.849237593891073*^9}, 3.84923822668323*^9, {3.8492421868919945`*^9, 
   3.849242240568558*^9}, {3.8492474588425407`*^9, 3.8492474594822702`*^9}, {
   3.852209513590969*^9, 3.8522095162367444`*^9}, {3.855036610589243*^9, 
   3.855036613889108*^9}, {3.8550467886322904`*^9, 3.8550467894981956`*^9}, {
   3.855301345204176*^9, 3.85530135864006*^9}, {3.855303649712189*^9, 
   3.8553036521769004`*^9}, {3.85582314483035*^9, 3.855823150602358*^9}, 
   3.8559923927400455`*^9, 3.8559982479266205`*^9, {3.8564992610160117`*^9, 
   3.8564992851152153`*^9}, {3.8568692550605173`*^9, 3.856869260344598*^9}, {
   3.8569387558317533`*^9, 3.856938755902177*^9}, {3.856939018633926*^9, 
   3.856939018928189*^9}, {3.8604814016760693`*^9, 3.8604814202671194`*^9}, 
   3.8605570531412153`*^9, 3.860567704747424*^9, 3.8605700477258725`*^9, {
   3.862989480650702*^9, 3.8629894819603176`*^9}, 3.864208739162526*^9, 
   3.8643771903054485`*^9},
 CellLabel->
  "In[338]:=",ExpressionUUID->"72f880d3-5b13-41b1-ac4f-cade7d55ef6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"geodesicsMMcost3", "=", "geodesics"}], ";"}]], "Input",
 CellChangeTimes->{{3.8636817777036667`*^9, 3.8636817887730985`*^9}},
 CellLabel->
  "In[340]:=",ExpressionUUID->"35a0d50d-a91a-47de-8ba7-fb1bac767217"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFGBifTip", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGBifTip"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGBifTip"}], "}"}], ",", "vesselTreeFig"}], 
         "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8478548606856165`*^9, 3.8478548631342096`*^9}, {3.847951722126075*^9, 
   3.847951735681414*^9}, 3.8568580512234607`*^9, 3.8568586736609726`*^9, 
   3.8568587116884165`*^9, 3.8570154385274324`*^9, 3.8570155066446714`*^9, {
   3.857104872019208*^9, 3.857104878612195*^9}, {3.860570056981409*^9, 
   3.860570061099735*^9}, {3.8717280916432505`*^9, 3.8717280933016567`*^9}, {
   3.871728266890213*^9, 
   3.8717282685716343`*^9}},ExpressionUUID->"47d654bf-f82d-485f-a984-\
b6afa6f5a6a5"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Graphics", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Green", ",", 
        RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"imageToGraphicsCoordinates", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
           RowBox[{"seedsFMnew", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", 
              RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], "}"}], 
      ",", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Green", ",", 
          RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
          RowBox[{"Point", "[", 
           RowBox[{"imageToGraphicsCoordinates", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
             RowBox[{"seedsFM", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"6", ";;"}], ",", 
                RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], "}"}], 
        ","}], "*)"}], 
      RowBox[{"{", 
       RowBox[{"Magenta", ",", 
        RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"imageToGraphicsCoordinates", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{"seedsBifurcationsFMnew2", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{";;", "42"}], ",", 
                RowBox[{";;", "2"}]}], "]"}], "]"}], ",", 
             RowBox[{"seedsFMnew", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", 
                RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "]"}], 
         "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"Red", ",", 
        RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"imageToGraphicsCoordinates", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
           RowBox[{"tipsFMnew", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}], 
     "}"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.871727236135085*^9, 3.8717272378574543`*^9}, 
   3.871727278604602*^9, {3.8717274060961494`*^9, 3.8717274355536213`*^9}, 
   3.871727471113752*^9},
 CellLabel->
  "In[350]:=",ExpressionUUID->"4250fe1a-7593-478e-89d5-dc7f915aa46c"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Tracking 1 - From bifurcation points to seeds - Forward Mixed Model Tracking\
\>", "Subsubsection",
 CellChangeTimes->{{3.8302746621103044`*^9, 3.830274663350077*^9}, {
  3.83199828916842*^9, 3.8319982920560136`*^9}, {3.8323017674759617`*^9, 
  3.8323017676871347`*^9}, {3.847364529233321*^9, 3.8473645294750004`*^9}, {
  3.847951076199639*^9, 3.8479510982953887`*^9}, {3.8568589381244907`*^9, 
  3.856858945900659*^9}, {3.8568596225843315`*^9, 3.856859622752245*^9}, {
  3.8571048420822535`*^9, 3.8571048423230143`*^9}, {3.860555339889804*^9, 
  3.860555341576951*^9}, {3.8717187108527756`*^9, 3.8717187120924864`*^9}, {
  3.8718354149056053`*^9, 
  3.871835416481493*^9}},ExpressionUUID->"11885b1c-9cf5-4d64-b658-\
a862ae417362"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Gamma]", "=", "15"}], ";"}]], "Input",
 CellChangeTimes->{{3.860480450283126*^9, 3.8604804526960497`*^9}, {
  3.8635986047087708`*^9, 3.86359860478881*^9}},
 CellLabel->
  "In[352]:=",ExpressionUUID->"770c7d7c-5b0d-4372-a1ad-5c598ef1927c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"MMixed", ",", "w"}], "}"}], "=", 
   RowBox[{"metricMvectorwMixed", "[", 
    RowBox[{"cost", ",", 
     RowBox[{"{", 
      RowBox[{"ySelect", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0.1", ",", 
       SuperscriptBox["xiLIF", "2"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", "\[Gamma]", ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Inverse", "[", "#", "]"}], "]"}], "&"}], ",", "Hout", ",", 
       RowBox[{"{", "3", "}"}]}], "]"}], ",", "crossingsNew", ",", "0.1", ",",
      "ySelect"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.860479267861275*^9, 3.860479332236277*^9}, {
   3.860480448432621*^9, 3.860480448886552*^9}, {3.8604818026785865`*^9, 
   3.8604818100371385`*^9}, 3.86057001880132*^9, 3.860570124839686*^9, {
   3.8605729832930593`*^9, 3.860572986846917*^9}, 3.8628904578656087`*^9},
 CellLabel->
  "In[354]:=",ExpressionUUID->"e6c1b2f6-731a-4061-8446-5e8a3f9703ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height", ",", "geodesics"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ySelect", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"ySelect", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", "seedsFMnew"}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", "&"}], ",", 
        RowBox[{"SelectionSeedsBifTracking", "[", 
         RowBox[{
          RowBox[{"Normal", "[", "geodesicsMMcost3", "]"}], ",", 
          "seedsBifurcationsFMnew2", ",", " ", "tipsFMnew", ",", "0"}], 
         "]"}]}], "]"}], "]"}], ",", "0.1", ",", "3"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8492362731727424`*^9, 3.8492363067161417`*^9}, {
   3.8492366971201305`*^9, 3.8492367711911497`*^9}, {3.849237565245867*^9, 
   3.849237593891073*^9}, 3.84923822668323*^9, {3.8492421868919945`*^9, 
   3.849242240568558*^9}, {3.8492474588425407`*^9, 3.8492474594822702`*^9}, {
   3.852209513590969*^9, 3.8522095162367444`*^9}, {3.855036610589243*^9, 
   3.855036613889108*^9}, {3.8550467886322904`*^9, 3.8550467894981956`*^9}, {
   3.855301345204176*^9, 3.85530135864006*^9}, {3.855303649712189*^9, 
   3.8553036521769004`*^9}, {3.85582314483035*^9, 3.855823150602358*^9}, 
   3.8559923927400455`*^9, 3.8559982479266205`*^9, {3.8564992610160117`*^9, 
   3.8564992851152153`*^9}, {3.8568692550605173`*^9, 3.856869260344598*^9}, {
   3.8569387558317533`*^9, 3.856938755902177*^9}, {3.856939018633926*^9, 
   3.856939018928189*^9}, {3.8571050919590764`*^9, 3.8571050962176957`*^9}, {
   3.8571052365204844`*^9, 3.85710524229815*^9}, 3.860570145065676*^9, {
   3.8629897812764697`*^9, 3.8629897821761293`*^9}, {3.8636820373483047`*^9, 
   3.8636820384851704`*^9}, 3.8717276257208385`*^9},
 CellLabel->
  "In[355]:=",ExpressionUUID->"4fad3792-158e-4671-a25d-211e12041420"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFGSeedBifnewcost", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGSeedBifnewcost"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGSeedBifnewcost"}], "}"}], ",", 
          "vesselTreeFig"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8477978257514896`*^9, 3.847797832278146*^9}, {3.8477987750483255`*^9, 
   3.8477987770854936`*^9}, {3.84779883537992*^9, 3.8477988813518295`*^9}, {
   3.847854096813062*^9, 3.8478540983948393`*^9}, {3.847871518343099*^9, 
   3.8478715212515965`*^9}, {3.847878302261077*^9, 3.847878539042691*^9}, {
   3.847951904949701*^9, 3.847951920402325*^9}, {3.8479525658260274`*^9, 
   3.847952568517905*^9}, {3.847965518740679*^9, 3.847965527622819*^9}, {
   3.8522817289400673`*^9, 3.852281754643584*^9}, 3.852282432290782*^9, 
   3.856859467502056*^9, {3.857104920601672*^9, 3.857104926478819*^9}, {
   3.860570169592435*^9, 3.860570173553372*^9}, {3.8642077444530053`*^9, 
   3.8642077501182404`*^9}, {3.8717278665856733`*^9, 3.871727867665506*^9}, {
   3.8717282781765747`*^9, 
   3.87172829797579*^9}},ExpressionUUID->"efdbb440-17d2-4281-9e66-\
9b3001d7b02a"]
}, Closed]],

Cell[CellGroupData[{

Cell["Combine results - Forward Mixed Model Tracking", "Subsubsection",
 CellChangeTimes->{{3.852221464534747*^9, 3.852221468270213*^9}, {
   3.8570288866454782`*^9, 3.857028891111806*^9}, {3.857104819433181*^9, 
   3.8571048218272448`*^9}, 3.857801604879678*^9, {3.8605551556094413`*^9, 
   3.860555155777337*^9}, {3.860555306888077*^9, 3.860555311472086*^9}, {
   3.860555347290093*^9, 3.860555352937053*^9}, {3.8605748974018526`*^9, 
   3.8605748994577017`*^9}, {3.8718354224022417`*^9, 
   3.8718354276345754`*^9}},ExpressionUUID->"fb4ab388-c8fb-4097-860d-\
fe3d80f77e4b"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGBifTip"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGBifTip"}], "}"}], ",", "vesselTreeFig"}], 
         "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.8570291610997925`*^9, {3.8571049338150167`*^9, 3.857104937525967*^9}, {
   3.8605701842478437`*^9, 3.860570187840021*^9}},
 CellLabel->
  "In[383]:=",ExpressionUUID->"c7fd4a09-7488-41f6-890f-51ac63bf8835"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGSeedBifnewcost"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{"{", 
           RowBox[{"Blue", ",", 
            RowBox[{"Circle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"290", ",", "188"}], "}"}], ",", "8"}], "]"}], ",", 
            RowBox[{"Circle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"270", ",", "70"}], "}"}], ",", "8"}], "]"}], ",", 
            RowBox[{"Circle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"395", ",", "185"}], "}"}], ",", "8"}], "]"}]}], "}"}],
           "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFGSeedBifnewcost"}], "}"}], ",", 
          "vesselTreeFig"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8522215694455166`*^9, 3.8522215705462666`*^9}, {
   3.852221632595642*^9, 3.852221633495178*^9}, 3.8570291655156755`*^9, {
   3.857104942175903*^9, 3.8571049478582478`*^9}, 3.857106694377599*^9, {
   3.8582385449171467`*^9, 3.858238545805481*^9}, {3.860570191927518*^9, 
   3.86057019650416*^9}, {3.8641197892674303`*^9, 3.864119792057932*^9}, {
   3.864383779050831*^9, 3.864383779854639*^9}},
 CellLabel->
  "In[384]:=",ExpressionUUID->"53aa7ecc-7cb3-4400-bd51-835fa0773ad2"],

Cell[BoxData[
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Green", ",", 
            RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
            RowBox[{"Point", "[", 
             RowBox[{"imageToGraphicsCoordinates", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
               RowBox[{"seedsFMnew", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{";;", "6"}], ",", 
                  RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], 
           "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Green", ",", 
              RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
              RowBox[{"Point", "[", 
               RowBox[{"imageToGraphicsCoordinates", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
                 RowBox[{"seedsFM", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"6", ";;"}], ",", 
                    RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], 
             "}"}], ","}], "*)"}], 
          RowBox[{"{", 
           RowBox[{"Magenta", ",", 
            RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
            RowBox[{"Point", "[", 
             RowBox[{"imageToGraphicsCoordinates", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
               RowBox[{"Complement", "[", 
                RowBox[{
                 RowBox[{"seedsBifurcationsFM", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{";;", "42"}], ",", 
                    RowBox[{";;", "2"}]}], "]"}], "]"}], ",", 
                 RowBox[{"seedsFM", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", 
                    RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "]"}], 
             "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Red", ",", 
            RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
            RowBox[{"Point", "[", 
             RowBox[{"imageToGraphicsCoordinates", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Nx", ",", "Ny"}], "}"}], ",", 
               RowBox[{"tipsFMnew", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", 
                  RowBox[{";;", "2"}]}], "]"}], "]"}]}], "]"}], "]"}]}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"endtracksFigMixedFGBifTip", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
            "endtracksFigMixedFGSeedBifnewcost"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Circle", "[", 
             RowBox[{"#", ",", "8"}], "]"}], "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"278.3181818181818`", ",", "167.61112687144038`"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"385.3636363636364`", ",", "133.22193249095676`"}], 
              "}"}]}], "}"}]}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Lighter", "@", 
             RowBox[{"Lighter", "@", "Blue"}]}], ",", 
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            RowBox[{"Circle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"169", ",", "75"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"30", ",", "8"}], "}"}]}], "]"}]}], "}"}], "]"}], 
         ","}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig2", ",", 
          RowBox[{"{", 
           RowBox[{"Magenta", ",", 
            RowBox[{"seedsPointFig1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"Point", "[", 
             RowBox[{"Complement", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"seedsPointFig1", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"seedsPointFig2", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], "}"}], ",", 
          "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"endtracksFigMixedFGBifTip", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
            "endtracksFigMixedFGSeedBifnewcost"}], "}"}], ",", 
          "vesselTreeFig"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.852221527931754*^9, 3.85222154346803*^9}, {
   3.852221669222227*^9, 3.8522216802232175`*^9}, {3.8522217782808833`*^9, 
   3.8522217975457325`*^9}, {3.8522218993082447`*^9, 3.852221915044633*^9}, {
   3.8522219843545914`*^9, 3.852222061022479*^9}, {3.8571045619309597`*^9, 
   3.8571045938612576`*^9}, {3.857104955559032*^9, 3.857104967185817*^9}, {
   3.857106734636407*^9, 3.8571068522813125`*^9}, {3.8571068900510073`*^9, 
   3.85710691556651*^9}, {3.8582282341541824`*^9, 3.858228253534457*^9}, {
   3.858228420575445*^9, 3.8582284217847443`*^9}, {3.860555016898756*^9, 
   3.860555054160562*^9}, {3.8605551059498034`*^9, 3.8605551084997754`*^9}, {
   3.860570202495943*^9, 3.8605702140876293`*^9}, {3.860573687133787*^9, 
   3.860573687325754*^9}, {3.8628911298547115`*^9, 3.862891137436907*^9}, 
   3.862891374013877*^9, {3.862990718958217*^9, 3.8629907191564503`*^9}, 
   3.862990758907279*^9, {3.863598992886035*^9, 3.863599005570354*^9}, {
   3.8641197984101934`*^9, 3.864119799628619*^9}, 3.864120110122916*^9, {
   3.8643837953732376`*^9, 3.8643838112437487`*^9}},
 CellLabel->
  "In[385]:=",ExpressionUUID->"81171dd7-af62-481b-a630-ef6fb687cf03"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Tracking per seed (with calculated cost function)", "Section",
 CellChangeTimes->{{3.8713710950201516`*^9, 
  3.8713711032200603`*^9}},ExpressionUUID->"599843de-865f-4014-adef-\
49f592d89035"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cost", "=", 
   RowBox[{"CostFunction", "[", 
    RowBox[{
     RowBox[{"AddLifts", "[", 
      RowBox[{
       RowBox[{"MultiScaleVesselnessFilter", "[", 
        RowBox[{"multiscalecostLIFExtReg", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", "3"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{"#", 
          RowBox[{"(*", 
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"ySelect", ",", "0"}], "}"}]}], "*)"}], "&"}], ",", 
         "seedsIndex"}], "]"}]}], "]"}], ",", "1000", ",", "2"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8468405300241914`*^9, 3.8468405426731696`*^9}, 
   3.8468405954490647`*^9, 3.84736421998925*^9, {3.8477959176459703`*^9, 
   3.847795974113347*^9}, {3.84795162034848*^9, 3.847951620455*^9}, 
   3.8522211550606956`*^9},
 CellLabel->
  "In[386]:=",ExpressionUUID->"871045dc-b138-442d-aea1-3de6abe7db05"],

Cell[BoxData[
 RowBox[{"Image", "@", 
  RowBox[{"Rescale", "@", 
   RowBox[{"Map", "[", 
    RowBox[{"Min", ",", "cost", ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}]}]], "Input",
 CellLabel->
  "In[424]:=",ExpressionUUID->"bb99fe1a-e62a-43ff-a239-6d3f272a93cf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"crossings", "=", 
   RowBox[{"AutomaticCrossingIdentification", "[", 
    RowBox[{"Select", "[", 
     RowBox[{"vesselAnnotations", ",", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Part", "[", 
           RowBox[{"VesselTrees", ",", "rowSelection"}], "]"}]}], ",", 
         RowBox[{"\"\<name\>\"", "/.", "#"}]}], "]"}], "&"}]}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"crossingsNew", "=", 
   RowBox[{"ArrayReshape", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"crossings", ",", 
        RowBox[{"{", "}"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"crossings", ",", 
              RowBox[{"{", "}"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], 
          "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", "2"}], ",", "2"}], "}"}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.860473067748049*^9, 3.8604730705655327`*^9}, {
   3.8604732603044567`*^9, 3.8604732656556478`*^9}, {3.8604732973366156`*^9, 
   3.8604733441281214`*^9}, 3.860473589318948*^9, 3.860473693622631*^9, {
   3.8604737720815744`*^9, 3.8604737752316227`*^9}, {3.8604790575788717`*^9, 
   3.860479057840353*^9}, 3.8604803072151027`*^9, {3.8628896419408474`*^9, 
   3.8628896500144253`*^9}},
 CellLabel->
  "In[392]:=",ExpressionUUID->"d2d83970-9058-4f52-9b2c-b76cb0e6fa0b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"startpoints", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "1", "}"}], ",", 
     RowBox[{"{", "2", "}"}], ",", 
     RowBox[{"{", "3", "}"}], ",", 
     RowBox[{"{", "4", "}"}], ",", 
     RowBox[{"{", "5", "}"}], ",", 
     RowBox[{"{", "6", "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"endpoints", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3", ",", "22"}], "}"}], ",", 
     RowBox[{"{", "14", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "4", ",", "5", ",", "6", ",", "7", ",", "8", ",", "9", ",", "10", ",", 
       "11"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"15", ",", "16", ",", "17", ",", "18"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"19", ",", "20", ",", "21", ",", "23", ",", "24"}], "}"}]}], 
    "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8629843866787987`*^9, 3.8629844135676575`*^9}, {
  3.8629844490282965`*^9, 3.8629844987468157`*^9}, {3.871728346141395*^9, 
  3.8717283473069224`*^9}},
 CellLabel->
  "In[389]:=",ExpressionUUID->"1e8d8e61-e473-405e-93bf-989d9f1aa634"],

Cell[CellGroupData[{

Cell["Forward Mixed Model Tracking", "Subsubsection",
 CellChangeTimes->{{3.8473645353135653`*^9, 3.8473645365513*^9}, {
   3.847790069486391*^9, 3.8477900779275827`*^9}, {3.847790695287031*^9, 
   3.847790699327445*^9}, {3.847854165730627*^9, 3.847854168554603*^9}, 
   3.8478546673477983`*^9, {3.8479510712180014`*^9, 3.847951092240478*^9}, {
   3.856858700515448*^9, 3.8568587076925445`*^9}, {3.8582333080274262`*^9, 
   3.8582333090275*^9}, {3.8619650390192275`*^9, 3.8619650392189875`*^9}, 
   3.862037067431803*^9, {3.862977922573184*^9, 3.862977923303616*^9}, {
   3.8718354436033077`*^9, 
   3.871835451932354*^9}},ExpressionUUID->"79243dbc-8b11-4c28-82e5-\
30ef212e55e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Gamma]", "=", "15"}], ";"}]], "Input",
 CellChangeTimes->{3.862999751239397*^9, 3.86300035914838*^9, 
  3.863057810818286*^9, 3.863072021021571*^9, 3.8630723316041*^9},
 CellLabel->
  "In[430]:=",ExpressionUUID->"ae195d1d-30d8-4ac4-834b-5e4392eed0ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"MMixed", ",", "w"}], "}"}], "=", 
   RowBox[{"metricMvectorwMixed", "[", 
    RowBox[{"cost", ",", 
     RowBox[{"{", 
      RowBox[{"ySelect", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0.1", ",", 
       SuperscriptBox["xiLIF", "2"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", "\[Gamma]", ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Inverse", "[", "#", "]"}], "]"}], "&"}], ",", "Hout", ",", 
       RowBox[{"{", "3", "}"}]}], "]"}], ",", "crossingsNew", ",", "0.1", ",",
      "ySelect"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.860479267861275*^9, 3.860479332236277*^9}, {
   3.860480448432621*^9, 3.860480448886552*^9}, {3.8604818026785865`*^9, 
   3.8604818100371385`*^9}, 3.86057001880132*^9, {3.860571483227079*^9, 
   3.860571488467264*^9}, {3.8605723419297624`*^9, 3.860572343920355*^9}, 
   3.862889701091107*^9, 3.862978105184578*^9},
 CellLabel->
  "In[426]:=",ExpressionUUID->"a438422e-1421-4327-9e01-a460e4c8e637"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height1", ",", "geodesics1"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Nx", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"seedsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"startpoints", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"tipsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"endpoints", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     "0.1", ",", "3"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8492390620314627`*^9, 3.8492391284171658`*^9}, {
   3.8492391953866663`*^9, 3.849239230392813*^9}, {3.855036036176547*^9, 
   3.8550360393881083`*^9}, {3.8550422517500076`*^9, 3.855042252684145*^9}, {
   3.8551329254621925`*^9, 3.8551329256338983`*^9}, {3.8552237671462536`*^9, 
   3.8552237754658623`*^9}, 3.8552245199605217`*^9, 3.8552249150941896`*^9, {
   3.8552265775144057`*^9, 3.8552265787093625`*^9}, {3.8552268262911844`*^9, 
   3.8552268692349663`*^9}, {3.8552269481686373`*^9, 3.855226948531378*^9}, 
   3.8552269785852065`*^9, {3.8552270098456354`*^9, 3.855227010061516*^9}, {
   3.8552271108648243`*^9, 3.8552271176884723`*^9}, 3.8552272349359617`*^9, {
   3.855227335733407*^9, 3.855227336526697*^9}, {3.8552276303289795`*^9, 
   3.8552276365321417`*^9}, {3.8552277787735515`*^9, 
   3.8552277812464423`*^9}, {3.8552881827286377`*^9, 3.855288185460313*^9}, 
   3.855288776588535*^9, 3.855290075132148*^9, {3.8552911904816327`*^9, 
   3.8552911906902065`*^9}, {3.855293284738257*^9, 3.8552932869533415`*^9}, 
   3.855293319867901*^9, 3.8552937215257034`*^9, {3.8552941499749064`*^9, 
   3.8552941512616005`*^9}, {3.8553032499118013`*^9, 
   3.8553032518641644`*^9}, {3.856498322190939*^9, 3.8564983376897607`*^9}, {
   3.856858193617081*^9, 3.856858222982462*^9}, {3.861963406054594*^9, 
   3.8619634113951497`*^9}, {3.861963710126935*^9, 3.8619637139053717`*^9}, {
   3.8619641737068815`*^9, 3.861964225326779*^9}, 3.861965088002602*^9, {
   3.8622845783301926`*^9, 3.862284579808982*^9}, 3.862978003973719*^9, {
   3.8635970551613197`*^9, 3.863597056015569*^9}, {3.8717284366637535`*^9, 
   3.871728437158585*^9}},
 CellLabel->
  "In[405]:=",ExpressionUUID->"ec18979d-86df-4038-bc83-7dd239058b94"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFG1", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics1", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG1"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG1"}], "}"}], ",", "vesselTreeFig"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8478548606856165`*^9, 3.8478548631342096`*^9}, {3.847951722126075*^9, 
   3.847951735681414*^9}, 3.8568580512234607`*^9, 3.8568586736609726`*^9, 
   3.8568587116884165`*^9, 3.8570154385274324`*^9, 3.8570155066446714`*^9, {
   3.8619643403773823`*^9, 3.861964358454074*^9}, {3.861965101387991*^9, 
   3.861965104771364*^9}, {3.8629781274738855`*^9, 3.862978131624136*^9}},
 CellLabel->
  "In[406]:=",ExpressionUUID->"f51ad22c-aa57-46d3-8120-7cde25379f48"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height2", ",", "geodesics2"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Nx", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"seedsFM", "[", 
         RowBox[{"[", 
          RowBox[{"startpoints", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"tipsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"endpoints", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     "0.1", ",", "3"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8492390620314627`*^9, 3.8492391284171658`*^9}, {
   3.8492391953866663`*^9, 3.849239230392813*^9}, {3.855036036176547*^9, 
   3.8550360393881083`*^9}, {3.8550422517500076`*^9, 3.855042252684145*^9}, {
   3.8551329254621925`*^9, 3.8551329256338983`*^9}, {3.8552237671462536`*^9, 
   3.8552237754658623`*^9}, 3.8552245199605217`*^9, 3.8552249150941896`*^9, {
   3.8552265775144057`*^9, 3.8552265787093625`*^9}, {3.8552268262911844`*^9, 
   3.8552268692349663`*^9}, {3.8552269481686373`*^9, 3.855226948531378*^9}, 
   3.8552269785852065`*^9, {3.8552270098456354`*^9, 3.855227010061516*^9}, {
   3.8552271108648243`*^9, 3.8552271176884723`*^9}, 3.8552272349359617`*^9, {
   3.855227335733407*^9, 3.855227336526697*^9}, {3.8552276303289795`*^9, 
   3.8552276365321417`*^9}, {3.8552277787735515`*^9, 
   3.8552277812464423`*^9}, {3.8552881827286377`*^9, 3.855288185460313*^9}, 
   3.855288776588535*^9, 3.855290075132148*^9, {3.8552911904816327`*^9, 
   3.8552911906902065`*^9}, {3.855293284738257*^9, 3.8552932869533415`*^9}, 
   3.855293319867901*^9, 3.8552937215257034`*^9, {3.8552941499749064`*^9, 
   3.8552941512616005`*^9}, {3.8553032499118013`*^9, 
   3.8553032518641644`*^9}, {3.856498322190939*^9, 3.8564983376897607`*^9}, {
   3.856858193617081*^9, 3.856858222982462*^9}, {3.861963406054594*^9, 
   3.8619634113951497`*^9}, {3.861963710126935*^9, 3.8619637139053717`*^9}, {
   3.8619641737068815`*^9, 3.861964225326779*^9}, {3.861964380053858*^9, 
   3.861964384537451*^9}, 3.861965165226014*^9, {3.862284584321797*^9, 
   3.8622845861132755`*^9}, 3.8629781950747232`*^9, {3.8635970487198453`*^9, 
   3.8635970497929873`*^9}},
 CellLabel->
  "In[408]:=",ExpressionUUID->"996fa7e8-a81c-4631-af2d-f336cc8a405d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFG2", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics2", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG2"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG2"}], "}"}], ",", "vesselTreeFig"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8478548606856165`*^9, 3.8478548631342096`*^9}, {3.847951722126075*^9, 
   3.847951735681414*^9}, 3.8568580512234607`*^9, 3.8568586736609726`*^9, 
   3.8568587116884165`*^9, 3.8570154385274324`*^9, 3.8570155066446714`*^9, {
   3.8619643403773823`*^9, 3.861964408887369*^9}, {3.8619651098270264`*^9, 
   3.8619651157142*^9}, {3.8629781355238314`*^9, 3.862978142040386*^9}},
 CellLabel->
  "In[409]:=",ExpressionUUID->"cdd644df-5325-4e7b-a10a-422e41a8cff4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height3", ",", "geodesics3"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Nx", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"seedsFM", "[", 
         RowBox[{"[", 
          RowBox[{"startpoints", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"tipsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"endpoints", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     "0.1", ",", "3"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8492390620314627`*^9, 3.8492391284171658`*^9}, {
   3.8492391953866663`*^9, 3.849239230392813*^9}, {3.855036036176547*^9, 
   3.8550360393881083`*^9}, {3.8550422517500076`*^9, 3.855042252684145*^9}, {
   3.8551329254621925`*^9, 3.8551329256338983`*^9}, {3.8552237671462536`*^9, 
   3.8552237754658623`*^9}, 3.8552245199605217`*^9, 3.8552249150941896`*^9, {
   3.8552265775144057`*^9, 3.8552265787093625`*^9}, {3.8552268262911844`*^9, 
   3.8552268692349663`*^9}, {3.8552269481686373`*^9, 3.855226948531378*^9}, 
   3.8552269785852065`*^9, {3.8552270098456354`*^9, 3.855227010061516*^9}, {
   3.8552271108648243`*^9, 3.8552271176884723`*^9}, 3.8552272349359617`*^9, {
   3.855227335733407*^9, 3.855227336526697*^9}, {3.8552276303289795`*^9, 
   3.8552276365321417`*^9}, {3.8552277787735515`*^9, 
   3.8552277812464423`*^9}, {3.8552881827286377`*^9, 3.855288185460313*^9}, 
   3.855288776588535*^9, 3.855290075132148*^9, {3.8552911904816327`*^9, 
   3.8552911906902065`*^9}, {3.855293284738257*^9, 3.8552932869533415`*^9}, 
   3.855293319867901*^9, 3.8552937215257034`*^9, {3.8552941499749064`*^9, 
   3.8552941512616005`*^9}, {3.8553032499118013`*^9, 
   3.8553032518641644`*^9}, {3.856498322190939*^9, 3.8564983376897607`*^9}, {
   3.856858193617081*^9, 3.856858222982462*^9}, {3.861963406054594*^9, 
   3.8619634113951497`*^9}, {3.861963710126935*^9, 3.8619637139053717`*^9}, {
   3.8619641737068815`*^9, 3.861964225326779*^9}, {3.861964380053858*^9, 
   3.861964417107974*^9}, 3.8619651682685375`*^9, {3.8622845888254147`*^9, 
   3.862284590097439*^9}, 3.862978200075595*^9, {3.8635970412396584`*^9, 
   3.8635970417403226`*^9}},
 CellLabel->
  "In[411]:=",ExpressionUUID->"494ebee8-1128-4b5b-8c5f-b72e5fb2e87e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFG3", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics3", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG3"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG3"}], "}"}], ",", "vesselTreeFig"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8478548606856165`*^9, 3.8478548631342096`*^9}, {3.847951722126075*^9, 
   3.847951735681414*^9}, 3.8568580512234607`*^9, 3.8568586736609726`*^9, 
   3.8568587116884165`*^9, 3.8570154385274324`*^9, 3.8570155066446714`*^9, {
   3.8619643403773823`*^9, 3.861964413780121*^9}, {3.86196512016282*^9, 
   3.861965122606924*^9}, {3.862978149936679*^9, 3.8629781540242367`*^9}},
 CellLabel->
  "In[412]:=",ExpressionUUID->"3a8c0935-4ee0-44e3-a517-3a6fc9ab0162"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height4", ",", "geodesics4"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Nx", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"seedsFM", "[", 
         RowBox[{"[", 
          RowBox[{"startpoints", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"tipsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"endpoints", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     "0.1", ",", "3"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8492390620314627`*^9, 3.8492391284171658`*^9}, {
   3.8492391953866663`*^9, 3.849239230392813*^9}, {3.855036036176547*^9, 
   3.8550360393881083`*^9}, {3.8550422517500076`*^9, 3.855042252684145*^9}, {
   3.8551329254621925`*^9, 3.8551329256338983`*^9}, {3.8552237671462536`*^9, 
   3.8552237754658623`*^9}, 3.8552245199605217`*^9, 3.8552249150941896`*^9, {
   3.8552265775144057`*^9, 3.8552265787093625`*^9}, {3.8552268262911844`*^9, 
   3.8552268692349663`*^9}, {3.8552269481686373`*^9, 3.855226948531378*^9}, 
   3.8552269785852065`*^9, {3.8552270098456354`*^9, 3.855227010061516*^9}, {
   3.8552271108648243`*^9, 3.8552271176884723`*^9}, 3.8552272349359617`*^9, {
   3.855227335733407*^9, 3.855227336526697*^9}, {3.8552276303289795`*^9, 
   3.8552276365321417`*^9}, {3.8552277787735515`*^9, 
   3.8552277812464423`*^9}, {3.8552881827286377`*^9, 3.855288185460313*^9}, 
   3.855288776588535*^9, 3.855290075132148*^9, {3.8552911904816327`*^9, 
   3.8552911906902065`*^9}, {3.855293284738257*^9, 3.8552932869533415`*^9}, 
   3.855293319867901*^9, 3.8552937215257034`*^9, {3.8552941499749064`*^9, 
   3.8552941512616005`*^9}, {3.8553032499118013`*^9, 
   3.8553032518641644`*^9}, {3.856498322190939*^9, 3.8564983376897607`*^9}, {
   3.856858193617081*^9, 3.856858222982462*^9}, {3.861963406054594*^9, 
   3.8619634113951497`*^9}, {3.861963710126935*^9, 3.8619637139053717`*^9}, {
   3.8619641737068815`*^9, 3.861964225326779*^9}, {3.861964380053858*^9, 
   3.8619644333337793`*^9}, 3.8619651707428207`*^9, {3.8620273084986773`*^9, 
   3.862027319429612*^9}, {3.862028371742771*^9, 3.862028377742944*^9}, {
   3.8622845959313087`*^9, 3.86228459742533*^9}, 3.8629782042170086`*^9, {
   3.863597033400754*^9, 3.8635970336469364`*^9}},
 CellLabel->
  "In[402]:=",ExpressionUUID->"0d10865c-28ac-472a-8b06-7b5736063b9f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFG4", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics4", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG4"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG4"}], "}"}], ",", "vesselTreeFig"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8478548606856165`*^9, 3.8478548631342096`*^9}, {3.847951722126075*^9, 
   3.847951735681414*^9}, 3.8568580512234607`*^9, 3.8568586736609726`*^9, 
   3.8568587116884165`*^9, 3.8570154385274324`*^9, 3.8570155066446714`*^9, {
   3.8619643403773823`*^9, 3.861964440907421*^9}, {3.8619651256938777`*^9, 
   3.8619651289454436`*^9}, {3.862978211076741*^9, 3.8629782162142553`*^9}},
 CellLabel->
  "In[403]:=",ExpressionUUID->"ae492b0d-1ece-40e4-9e2e-2bdcf7b5a130"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height5", ",", "geodesics5"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Nx", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"seedsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"startpoints", "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"tipsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"endpoints", "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     "0.1", ",", "3"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8492390620314627`*^9, 3.8492391284171658`*^9}, {
   3.8492391953866663`*^9, 3.849239230392813*^9}, {3.855036036176547*^9, 
   3.8550360393881083`*^9}, {3.8550422517500076`*^9, 3.855042252684145*^9}, {
   3.8551329254621925`*^9, 3.8551329256338983`*^9}, {3.8552237671462536`*^9, 
   3.8552237754658623`*^9}, 3.8552245199605217`*^9, 3.8552249150941896`*^9, {
   3.8552265775144057`*^9, 3.8552265787093625`*^9}, {3.8552268262911844`*^9, 
   3.8552268692349663`*^9}, {3.8552269481686373`*^9, 3.855226948531378*^9}, 
   3.8552269785852065`*^9, {3.8552270098456354`*^9, 3.855227010061516*^9}, {
   3.8552271108648243`*^9, 3.8552271176884723`*^9}, 3.8552272349359617`*^9, {
   3.855227335733407*^9, 3.855227336526697*^9}, {3.8552276303289795`*^9, 
   3.8552276365321417`*^9}, {3.8552277787735515`*^9, 
   3.8552277812464423`*^9}, {3.8552881827286377`*^9, 3.855288185460313*^9}, 
   3.855288776588535*^9, 3.855290075132148*^9, {3.8552911904816327`*^9, 
   3.8552911906902065`*^9}, {3.855293284738257*^9, 3.8552932869533415`*^9}, 
   3.855293319867901*^9, 3.8552937215257034`*^9, {3.8552941499749064`*^9, 
   3.8552941512616005`*^9}, {3.8553032499118013`*^9, 
   3.8553032518641644`*^9}, {3.856498322190939*^9, 3.8564983376897607`*^9}, {
   3.856858193617081*^9, 3.856858222982462*^9}, {3.861963406054594*^9, 
   3.8619634113951497`*^9}, {3.861963710126935*^9, 3.8619637139053717`*^9}, {
   3.8619641737068815`*^9, 3.861964225326779*^9}, {3.861964380053858*^9, 
   3.8619644537646008`*^9}, 3.8619651732595453`*^9, {3.862284600179001*^9, 
   3.86228460234468*^9}, {3.8622858013672748`*^9, 3.8622858015980463`*^9}, 
   3.8629782078977613`*^9, {3.8629841471674666`*^9, 3.8629841709635057`*^9}, {
   3.8629843213472505`*^9, 3.8629843414173183`*^9}, {3.8629849195425477`*^9, 
   3.8629849228921957`*^9}, {3.871795181282363*^9, 3.871795183076523*^9}, {
   3.8718336877815323`*^9, 3.8718336879926825`*^9}},
 CellLabel->
  "In[440]:=",ExpressionUUID->"32fa110d-8fe1-43a1-b1f6-f7500684bb21"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFG5", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics5", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG5"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG5"}], "}"}], ",", "vesselTreeFig"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8478548606856165`*^9, 3.8478548631342096`*^9}, {3.847951722126075*^9, 
   3.847951735681414*^9}, 3.8568580512234607`*^9, 3.8568586736609726`*^9, 
   3.8568587116884165`*^9, 3.8570154385274324`*^9, 3.8570155066446714`*^9, {
   3.8619643403773823`*^9, 3.8619644605373187`*^9}, {3.861965132922767*^9, 
   3.861965135539911*^9}, {3.862978219984888*^9, 3.8629782239923925`*^9}, {
   3.8629843272873216`*^9, 3.8629843442123184`*^9}},
 CellLabel->
  "In[441]:=",ExpressionUUID->"3f156a7c-5f3b-456f-85d6-a73d4f346f66"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Height6", ",", "geodesics6"}], "}"}], "=", 
   RowBox[{"runReedsSheppForwardGFMultipleHeightGeos", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nx", ",", "Ny", ",", "No"}], "}"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"Transpose", "[", 
       RowBox[{"MMixed", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4", ",", "5", ",", "1", ",", "2"}], "}"}]}], 
       "]"}], "]"}], ",", 
     RowBox[{"N", "[", "w", "]"}], ",", 
     RowBox[{"N", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Nx", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.5", ",", 
          RowBox[{"Ny", "+", "0.5"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}], ",", 
          RowBox[{
           RowBox[{"2", "\[Pi]"}], "-", 
           RowBox[{"s\[Theta]", "/", "2"}]}]}], "}"}]}], "}"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"seedsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"startpoints", "[", 
           RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"N", "[", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"#", 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"{", 
            RowBox[{"ySelect", ",", "0", ",", "0"}], "}"}]}], "*)"}], "&"}], 
        ",", 
        RowBox[{"tipsFMnew", "[", 
         RowBox[{"[", 
          RowBox[{"endpoints", "[", 
           RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
     "0.1", ",", "3"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8492390620314627`*^9, 3.8492391284171658`*^9}, {
   3.8492391953866663`*^9, 3.849239230392813*^9}, {3.855036036176547*^9, 
   3.8550360393881083`*^9}, {3.8550422517500076`*^9, 3.855042252684145*^9}, {
   3.8551329254621925`*^9, 3.8551329256338983`*^9}, {3.8552237671462536`*^9, 
   3.8552237754658623`*^9}, 3.8552245199605217`*^9, 3.8552249150941896`*^9, {
   3.8552265775144057`*^9, 3.8552265787093625`*^9}, {3.8552268262911844`*^9, 
   3.8552268692349663`*^9}, {3.8552269481686373`*^9, 3.855226948531378*^9}, 
   3.8552269785852065`*^9, {3.8552270098456354`*^9, 3.855227010061516*^9}, {
   3.8552271108648243`*^9, 3.8552271176884723`*^9}, 3.8552272349359617`*^9, {
   3.855227335733407*^9, 3.855227336526697*^9}, {3.8552276303289795`*^9, 
   3.8552276365321417`*^9}, {3.8552277787735515`*^9, 
   3.8552277812464423`*^9}, {3.8552881827286377`*^9, 3.855288185460313*^9}, 
   3.855288776588535*^9, 3.855290075132148*^9, {3.8552911904816327`*^9, 
   3.8552911906902065`*^9}, {3.855293284738257*^9, 3.8552932869533415`*^9}, 
   3.855293319867901*^9, 3.8552937215257034`*^9, {3.8552941499749064`*^9, 
   3.8552941512616005`*^9}, {3.8553032499118013`*^9, 
   3.8553032518641644`*^9}, {3.856498322190939*^9, 3.8564983376897607`*^9}, {
   3.856858193617081*^9, 3.856858222982462*^9}, {3.861963406054594*^9, 
   3.8619634113951497`*^9}, {3.861963710126935*^9, 3.8619637139053717`*^9}, {
   3.8619641737068815`*^9, 3.861964225326779*^9}, {3.861964380053858*^9, 
   3.8619644537646008`*^9}, 3.8619651732595453`*^9, {3.862284600179001*^9, 
   3.86228460234468*^9}, {3.8622858013672748`*^9, 3.8622858015980463`*^9}, 
   3.8629782078977613`*^9, {3.8629841471674666`*^9, 3.8629841709635057`*^9}, {
   3.8629843213472505`*^9, 3.8629843414173183`*^9}, {3.8629849195425477`*^9, 
   3.8629849441087294`*^9}, {3.8717284508947983`*^9, 3.871728451334028*^9}},
 CellLabel->
  "In[396]:=",ExpressionUUID->"4cecf510-983e-44ef-8f80-3cc4f718b928"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"endtracksFigMixedFG6", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"{", 
     RowBox[{"Cyan", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LineImageCoordinates", "[", 
         RowBox[{"imhalf", ",", 
          RowBox[{"#", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Normal", "[", "geodesics6", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG6"}], "}"}]}], 
         RowBox[{"(*", 
          RowBox[{",", "vesselTreeFig"}], "*)"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{"seedsPointFig1", ",", "endsPointFig", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", ".003", "]"}], ",", 
            "endtracksFigMixedFG6"}], "}"}], ",", "vesselTreeFig"}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8313973325816436`*^9, 3.8313973373341618`*^9}, {
   3.831397497768359*^9, 3.831397504326649*^9}, {3.8313998525997996`*^9, 
   3.8313998645040803`*^9}, {3.8320495033108625`*^9, 
   3.8320496346203175`*^9}, {3.8320496719118347`*^9, 
   3.8320496739881725`*^9}, {3.8320497170931287`*^9, 
   3.8320497383920135`*^9}, {3.8320797228679924`*^9, 3.83207977263717*^9}, 
   3.8459825215583887`*^9, {3.8459828203629904`*^9, 3.84598282635561*^9}, {
   3.8478548606856165`*^9, 3.8478548631342096`*^9}, {3.847951722126075*^9, 
   3.847951735681414*^9}, 3.8568580512234607`*^9, 3.8568586736609726`*^9, 
   3.8568587116884165`*^9, 3.8570154385274324`*^9, 3.8570155066446714`*^9, {
   3.8619643403773823`*^9, 3.8619644605373187`*^9}, {3.861965132922767*^9, 
   3.861965135539911*^9}, {3.862978219984888*^9, 3.8629782239923925`*^9}, {
   3.8629843272873216`*^9, 3.8629843442123184`*^9}, {3.862984946425763*^9, 
   3.8629849506102347`*^9}},
 CellLabel->
  "In[397]:=",ExpressionUUID->"b9ad5cce-5c48-4346-ae10-3e53c094a8d5"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"Image", "@", "imhalf"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Graphics", "[", 
    RowBox[{"{", 
     RowBox[{
     "seedsPointFig", ",", "bifPointFig", ",", "endsPointFig", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Thickness", "[", ".003", "]"}], ",", "White", ",", 
        RowBox[{"endtracksFigMixedFG1", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Thickness", "[", ".003", "]"}], ",", 
        RowBox[{"Lighter", "@", 
         RowBox[{"Lighter", "@", "Blue"}]}], ",", 
        RowBox[{"endtracksFigMixedFG2", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Thickness", "[", ".003", "]"}], ",", 
        RowBox[{"Lighter", "@", 
         RowBox[{"Lighter", "@", "Red"}]}], ",", 
        RowBox[{"endtracksFigMixedFG3", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Thickness", "[", ".003", "]"}], ",", 
        RowBox[{"Lighter", "@", 
         RowBox[{"Lighter", "@", 
          RowBox[{"Lighter", "@", "Magenta"}]}]}], ",", 
        RowBox[{"endtracksFigMixedFG4", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Thickness", "[", ".003", "]"}], ",", 
        RowBox[{"Lighter", "@", 
         RowBox[{"Lighter", "@", "Cyan"}]}], ",", 
        RowBox[{"endtracksFigMixedFG5", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Thickness", "[", ".003", "]"}], ",", 
        RowBox[{"Lighter", "@", 
         RowBox[{"Lighter", "@", "Yellow"}]}], ",", 
        RowBox[{"endtracksFigMixedFG6", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ","}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"{", 
       RowBox[{"Blue", ",", 
        RowBox[{"Thickness", "[", ".003", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Circle", "[", 
           RowBox[{"#", ",", "8"}], "]"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{"214.5`", ",", "66.20582460222067`"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{",", 
            RowBox[{"{", 
             RowBox[{"276.75`", ",", "167.45582460222067`"}], "}"}]}], "*)"}],
           "}"}]}]}], "}"}], "*)"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8619647944194884`*^9, 3.861964861353443*^9}, {
   3.8619648930193048`*^9, 3.8619649333694305`*^9}, {3.861964993285917*^9, 
   3.861965005335961*^9}, {3.861965142052187*^9, 3.8619651519878182`*^9}, {
   3.8620297694099417`*^9, 3.8620297949859557`*^9}, {3.8620298255645647`*^9, 
   3.862029841111683*^9}, 3.8620351145629816`*^9, 3.862286495205743*^9, {
   3.862978228594338*^9, 3.862978240725728*^9}, {3.8629798896816397`*^9, 
   3.8629799055022507`*^9}, {3.862979966000602*^9, 3.8629799677727256`*^9}, {
   3.8629857471051273`*^9, 3.862985751305008*^9}, {3.8629859053380785`*^9, 
   3.8629859187544827`*^9}, {3.8629871949626484`*^9, 
   3.8629871985021024`*^9}, {3.862987235642167*^9, 3.862987241632161*^9}, 
   3.8635970150235367`*^9, {3.871833908182439*^9, 3.871833943070983*^9}},
 CellLabel->
  "In[445]:=",ExpressionUUID->"ab1e16fa-6460-4d76-8b86-53a36c479348"]
}, Closed]]
}, Closed]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{574.8, 609.6},
WindowMargins->{{-4.8, Automatic}, {Automatic, 0}},
InputAliases->Join[
  Association["intt" -> RowBox[{"\[Integral]", 
      RowBox[{"\[SelectionPlaceholder]", 
        RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "dintt" -> RowBox[{
      SubsuperscriptBox[
      "\[Integral]", "\[SelectionPlaceholder]", "\[Placeholder]"], 
      RowBox[{"\[Placeholder]", 
        RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "rintt" -> RowBox[{
      UnderscriptBox["\[Integral]", 
       RowBox[{"\[SelectionPlaceholder]", "\[Element]", "\[Placeholder]"}]], 
      "\[Placeholder]"}], "sumt" -> RowBox[{
      UnderoverscriptBox["\[Sum]", 
       RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
       "\[Placeholder]"], "\[Placeholder]"}], "prodt" -> RowBox[{
      UnderoverscriptBox["\[Product]", 
       RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
       "\[Placeholder]"], "\[Placeholder]"}], "dt" -> RowBox[{
      SubscriptBox["\[PartialD]", "\[SelectionPlaceholder]"], 
      "\[Placeholder]"}], "cbrt" -> 
   RadicalBox[
    "\[SelectionPlaceholder]", "3", SurdForm -> True, MultilineFunction -> 
     None], "surd" -> 
   RadicalBox[
    "\[SelectionPlaceholder]", "\[Placeholder]", SurdForm -> True, 
     MultilineFunction -> None], "ket" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "Ket"], "bra" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "Bra"], "braket" -> 
   TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, "BraKet"], 
   "delay" -> TemplateBox[{"\[SelectionPlaceholder]"}, "SystemsModelDelay"], 
   "grad" -> RowBox[{
      SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Placeholder]"}], 
   "del." -> RowBox[{
      SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], ".", 
      "\[Placeholder]"}], "delx" -> RowBox[{
      SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Cross]", 
      "\[Placeholder]"}], "del2" -> RowBox[{
      SubsuperscriptBox["\[Del]", "\[SelectionPlaceholder]", 2], 
      "\[Placeholder]"}], "kd" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "KroneckerDeltaSeq"], "algs" -> 
   TemplateBox[{}, "Algebraics"], "bools" -> TemplateBox[{}, "Booleans"], 
   "comps" -> TemplateBox[{}, "Complexes"], "ints" -> 
   TemplateBox[{}, "Integers"], "pris" -> TemplateBox[{}, "Primes"], "rats" -> 
   TemplateBox[{}, "Rationals"], "reals" -> TemplateBox[{}, "Reals"], "pints" -> 
   TemplateBox[{}, "PositiveIntegers"], "npints" -> 
   TemplateBox[{}, "NonPositiveIntegers"], "nnints" -> 
   TemplateBox[{}, "NonNegativeIntegers"], "nints" -> 
   TemplateBox[{}, "NegativeIntegers"], "prats" -> 
   TemplateBox[{}, "PositiveRationals"], "nprats" -> 
   TemplateBox[{}, "NonPositiveRationals"], "nnrats" -> 
   TemplateBox[{}, "NonNegativeRationals"], "nrats" -> 
   TemplateBox[{}, "NegativeRationals"], "preals" -> 
   TemplateBox[{}, "PositiveReals"], "npreals" -> 
   TemplateBox[{}, "NonPositiveReals"], "nnreals" -> 
   TemplateBox[{}, "NonNegativeReals"], "nreals" -> 
   TemplateBox[{}, "NegativeReals"], "dlim" -> RowBox[{
      UnderscriptBox["\[Limit]", 
       RowBox[{"\[SelectionPlaceholder]", 
         UnderscriptBox["\[Rule]", 
          TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
   "dMlim" -> RowBox[{
      UnderscriptBox["\[MaxLimit]", 
       RowBox[{"\[SelectionPlaceholder]", 
         UnderscriptBox["\[Rule]", 
          TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
   "dmlim" -> RowBox[{
      UnderscriptBox["\[MinLimit]", 
       RowBox[{"\[SelectionPlaceholder]", 
         UnderscriptBox["\[Rule]", 
          TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
   "tue" -> OverscriptBox["\[UndirectedEdge]", "\[Placeholder]"], "tde" -> 
   OverscriptBox["\[DirectedEdge]", "\[Placeholder]"], "cB" -> 
   TemplateBox[{}, "CombinatorB"], "cC" -> TemplateBox[{}, "CombinatorC"], 
   "cI" -> TemplateBox[{}, "CombinatorI"], "cK" -> 
   TemplateBox[{}, "CombinatorK"], "cS" -> TemplateBox[{}, "CombinatorS"], 
   "cW" -> TemplateBox[{}, "CombinatorW"], "cY" -> 
   TemplateBox[{}, "CombinatorY"], "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]], {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "notation" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation>" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongRightArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "notation<" -> RowBox[{"Notation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
        "\[DoubleLongLeftArrow]", " ", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "symb" -> RowBox[{"Symbolize", "[", 
      TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
   "infixnotation" -> RowBox[{"InfixNotation", "[", 
      RowBox[{
        TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
        "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
      RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
        TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
   "pattwraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
   "madeboxeswraper" -> 
   TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"]}, {
  "=<" -> OverscriptBox["=", "\:02c2"]}, {
  ":=<" -> OverscriptBox[":=", "\:02c2"]}, {
  "=<" -> OverscriptBox["=", "\:02c2"]}, {
  ":=<" -> OverscriptBox[":=", "\:02c2"]}],
FrontEndVersion->"12.3 for Microsoft Windows (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"9d2915b8-a96b-419c-af3c-0272bc4125ad"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 268, 4, 35, "Text",ExpressionUUID->"f815ee99-a808-4bc1-bc72-ad0001787017"],
Cell[829, 26, 364, 8, 81, "Text",ExpressionUUID->"044befc1-140a-44bf-9e5f-d181e324ddf8"],
Cell[CellGroupData[{
Cell[1218, 38, 168, 3, 98, "Title",ExpressionUUID->"bf16e1cd-3294-4579-91a4-beface3ed856"],
Cell[1389, 43, 267, 5, 28, "Input",ExpressionUUID->"4cfe7640-a5d7-45e6-9453-27c7c8298885"],
Cell[CellGroupData[{
Cell[1681, 52, 156, 3, 69, "Chapter",ExpressionUUID->"c465fde3-a85b-449b-9eb6-bd112a140ca8"],
Cell[CellGroupData[{
Cell[1862, 59, 164, 3, 67, "Section",ExpressionUUID->"0a1c7059-b552-4019-9d65-ae4adbf3de2b"],
Cell[CellGroupData[{
Cell[2051, 66, 171, 3, 54, "Subsection",ExpressionUUID->"f2ea63ee-73af-4dbd-9b85-e05e736cd15a"],
Cell[2225, 71, 5220, 136, 314, "Code",ExpressionUUID->"a527a9f2-fb71-49a0-a516-f714ef4d337c"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[7494, 213, 183, 3, 53, "Section",ExpressionUUID->"50c37578-7cef-4225-9b4d-cec48d99fdf0"],
Cell[CellGroupData[{
Cell[7702, 220, 170, 3, 54, "Subsection",ExpressionUUID->"34807886-6b9d-441c-9aac-1822a882e7f6"],
Cell[7875, 225, 263, 6, 35, "Text",ExpressionUUID->"38d3033f-86dc-4a18-82e6-7bee684f6c75"],
Cell[CellGroupData[{
Cell[8163, 235, 247, 5, 45, "Subsubsection",ExpressionUUID->"c6df6f72-55d4-402e-81a8-33ca350133bb"],
Cell[8413, 242, 66360, 1584, 7107, "Input",ExpressionUUID->"55188bb1-410d-4742-ae70-aa2ae9ff3373"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[74822, 1832, 228, 4, 38, "Subsection",ExpressionUUID->"f9ac294d-59bd-49e8-8096-2b96ac94a351"],
Cell[CellGroupData[{
Cell[75075, 1840, 255, 6, 71, "Subsubsection",ExpressionUUID->"0885da6d-d0be-429c-8d66-bc5c5eb39816"],
Cell[75333, 1848, 66324, 1689, 6157, "Input",ExpressionUUID->"33e1e9a2-1e33-4ff0-a33a-844e71e457f6"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[141706, 3543, 159, 3, 38, "Subsection",ExpressionUUID->"d68546fc-53c0-40d5-ad9b-b9361948d8c1"],
Cell[141868, 3548, 135, 2, 28, "Input",ExpressionUUID->"ea4ca654-f4d8-4f0e-bc33-0dd5413e935f"],
Cell[CellGroupData[{
Cell[142028, 3554, 171, 3, 45, "Subsubsection",ExpressionUUID->"165a3bf5-0b48-4227-84af-b18187f0a5ad"],
Cell[142202, 3559, 3424, 81, 286, "Input",ExpressionUUID->"f13044c5-f86f-44c6-a07b-c31710c9803c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[145663, 3645, 168, 3, 45, "Subsubsection",ExpressionUUID->"034a39d2-c339-41a0-8076-b2e3c7856a45"],
Cell[145834, 3650, 31496, 651, 2776, "Input",ExpressionUUID->"9d68d873-e397-4e95-ad20-4c2ce10e1ebf"]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[177391, 4308, 227, 4, 53, "Section",ExpressionUUID->"877accb1-4f24-495b-b19f-d125fb0df411"],
Cell[177621, 4314, 205, 3, 35, "Text",ExpressionUUID->"593057d7-c88b-4ce0-97f8-c231bc1957be"],
Cell[CellGroupData[{
Cell[177851, 4321, 223, 4, 54, "Subsection",ExpressionUUID->"13e946b3-0a93-4e3a-b591-0bac9aff4459"],
Cell[178077, 4327, 371, 7, 64, "Input",ExpressionUUID->"3dc7f536-aa46-4f5d-bc0d-19d4e0f62854",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[178473, 4338, 172, 3, 45, "Subsubsection",ExpressionUUID->"bdef1218-72ba-4ae0-b601-6f4497dda134"],
Cell[178648, 4343, 220, 5, 35, "Text",ExpressionUUID->"72632742-c319-4b5a-b264-76345a5a714a"],
Cell[178871, 4350, 740, 18, 48, "Input",ExpressionUUID->"63262d70-c79c-437b-b659-a0a543640956"]
}, Closed]],
Cell[CellGroupData[{
Cell[179648, 4373, 213, 4, 37, "Subsubsection",ExpressionUUID->"8f9a189c-f498-498e-9688-9fe2dd5ba539"],
Cell[179864, 4379, 286, 7, 35, "Text",ExpressionUUID->"46ee4a71-018b-43cb-864d-3a1c53badeec"],
Cell[180153, 4388, 1620, 40, 110, "Text",ExpressionUUID->"2d6bc4f6-7d59-4133-8595-a907bfd5ea03"],
Cell[181776, 4430, 195, 3, 35, "Text",ExpressionUUID->"d5172bf2-f786-472e-9909-f56070acd2b7"],
Cell[181974, 4435, 14678, 357, 914, "Input",ExpressionUUID->"fa2afe95-f37e-4197-ac88-81871a0d1f19"],
Cell[196655, 4794, 192, 3, 35, "Text",ExpressionUUID->"82c2edb4-d90c-4ed5-931f-d79b1809e642"],
Cell[196850, 4799, 2855, 61, 238, "Input",ExpressionUUID->"2fae6d52-1365-4c4d-aa17-59b49f9ee672"],
Cell[199708, 4862, 251, 4, 35, "Text",ExpressionUUID->"63758721-bcd6-44c8-91b9-cc669a65c8e3"],
Cell[199962, 4868, 3002, 64, 257, "Input",ExpressionUUID->"f9dfc857-30c9-42f4-90c6-240a1c1b3624"]
}, Closed]],
Cell[CellGroupData[{
Cell[203001, 4937, 177, 3, 37, "Subsubsection",ExpressionUUID->"35188349-23bb-451b-8f9e-81fe4513a9b8"],
Cell[203181, 4942, 292, 6, 58, "Text",ExpressionUUID->"16cdcc47-0509-4ca7-a654-c7c9c87900e2"],
Cell[203476, 4950, 6835, 147, 499, "Input",ExpressionUUID->"1aff8f63-aa6c-4a5f-bee0-915e556a78b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[210348, 5102, 232, 4, 37, "Subsubsection",ExpressionUUID->"3da3c669-bd53-4fd8-8a7a-8d2e6c85bddb"],
Cell[210583, 5108, 585, 16, 58, "Text",ExpressionUUID->"c6a6b34d-9a3d-4479-a77d-6ddc3bb48625"],
Cell[211171, 5126, 3660, 98, 272, "Input",ExpressionUUID->"6d88419d-4c5d-4996-ab8f-78032fa0fea0"],
Cell[214834, 5226, 1174, 26, 28, "Input",ExpressionUUID->"b0271e31-b37c-4ad1-89d6-849720b203d1"],
Cell[216011, 5254, 206, 3, 35, "Text",ExpressionUUID->"7146d85b-e15d-4291-90f8-7c6bbccbb5a2"],
Cell[216220, 5259, 437, 9, 104, "Text",ExpressionUUID->"acf71d07-b335-4b22-998b-6a3fb951b6f2"],
Cell[216660, 5270, 7611, 172, 632, "Input",ExpressionUUID->"57bf132f-4b58-4f2e-8360-71c76e153b1a"],
Cell[224274, 5444, 524, 10, 104, "Text",ExpressionUUID->"711d5c2d-0f31-451a-9e24-dd11403e7afa"]
}, Closed]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[224859, 5461, 185, 3, 53, "Section",ExpressionUUID->"ca2dfdb5-aaaa-4c20-b003-c4fddd38f38b"],
Cell[CellGroupData[{
Cell[225069, 5468, 281, 4, 54, "Subsection",ExpressionUUID->"538fb8fb-eab6-4179-a735-488278e5e49a"],
Cell[225353, 5474, 12373, 263, 852, "Input",ExpressionUUID->"95eaf7d7-2094-4411-bcf1-504da56bafd9"],
Cell[237729, 5739, 993, 26, 93, "Input",ExpressionUUID->"ae6b4b75-aa80-44ac-87c1-03538bb2d490"],
Cell[238725, 5767, 794, 20, 93, "Input",ExpressionUUID->"6e61aee2-0da7-410e-957e-1d7e116e3ea8"]
}, Closed]],
Cell[CellGroupData[{
Cell[239556, 5792, 180, 3, 38, "Subsection",ExpressionUUID->"f48c70ef-7719-4e6a-a0bf-4521ff254613"],
Cell[239739, 5797, 10199, 232, 923, "Input",ExpressionUUID->"e7c181c2-e953-46ff-8585-1ac5b1ec300b"],
Cell[249941, 6031, 4705, 106, 490, "Input",ExpressionUUID->"028d5b49-dddc-410d-acf8-db8aa4f80a4b"],
Cell[254649, 6139, 4785, 108, 490, "Input",ExpressionUUID->"3ab7a8f3-74c7-4ef2-8d65-fce8d2b41685"]
}, Closed]],
Cell[CellGroupData[{
Cell[259471, 6252, 173, 3, 38, "Subsection",ExpressionUUID->"1cd08cf6-9592-4965-a42f-c3c192857dab"],
Cell[259647, 6257, 13828, 292, 991, "Input",ExpressionUUID->"a7deb68b-f211-490e-b8a8-82f5088fc45c"],
Cell[273478, 6551, 11220, 250, 1037, "Input",ExpressionUUID->"d23e8177-7e5e-49af-8c8b-ce7adc2ff1c6"],
Cell[284701, 6803, 10025, 234, 999, "Input",ExpressionUUID->"d664ec53-a646-4554-bd14-5a2a03452f0b"]
}, Closed]],
Cell[CellGroupData[{
Cell[294763, 7042, 235, 4, 38, "Subsection",ExpressionUUID->"f269d539-d929-4f90-a40d-42e6bccf6ba8"],
Cell[295001, 7048, 7877, 175, 695, "Input",ExpressionUUID->"6958abe9-c445-4be2-af42-5493da85f62c"]
}, Closed]],
Cell[CellGroupData[{
Cell[302915, 7228, 229, 4, 38, "Subsection",ExpressionUUID->"7fc7ff29-dad2-4615-bc07-08181efa5fbf"],
Cell[303147, 7234, 2531, 63, 257, "Input",ExpressionUUID->"0fdd28dc-e267-47f2-a7fe-0c2607c717f0"]
}, Closed]],
Cell[CellGroupData[{
Cell[305715, 7302, 175, 3, 38, "Subsection",ExpressionUUID->"2184192a-1ef0-4561-bc28-988e9ababdfe"],
Cell[305893, 7307, 1890, 50, 162, "Input",ExpressionUUID->"283cb884-27a5-4c4d-bb73-e01092093d5c"],
Cell[307786, 7359, 879, 25, 48, "Input",ExpressionUUID->"e99c8b65-6a5a-4a4e-97e7-e03cac5b3c60"],
Cell[308668, 7386, 3713, 89, 295, "Input",ExpressionUUID->"7f296da0-07d1-432a-9fea-dd417db4fbad"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[312430, 7481, 160, 3, 53, "Section",ExpressionUUID->"d91aa170-bb59-4512-ab12-5fbea15a427e"],
Cell[CellGroupData[{
Cell[312615, 7488, 350, 5, 54, "Subsection",ExpressionUUID->"fc9580d2-ebdf-404f-86e9-aa67a0d9a15e"],
Cell[312968, 7495, 1983, 39, 238, "Input",ExpressionUUID->"6e6a4f6d-6126-4aa0-a991-f3b3bcde9287"],
Cell[314954, 7536, 1313, 22, 276, "Input",ExpressionUUID->"eae8b7a0-58d5-4d0d-a1b6-a073a2bb4ef6"],
Cell[316270, 7560, 4642, 78, 600, "Input",ExpressionUUID->"f8e72336-8c3b-4ebb-821b-21b7237b423b"],
Cell[320915, 7640, 10069, 163, 2464, "Input",ExpressionUUID->"4ad85d26-bceb-4ceb-82aa-e1b116787d89"]
}, Closed]],
Cell[CellGroupData[{
Cell[331021, 7808, 168, 3, 38, "Subsection",ExpressionUUID->"9dee6611-b1f2-474a-8cd6-f0906f5379a9"],
Cell[CellGroupData[{
Cell[331214, 7815, 177, 3, 45, "Subsubsection",ExpressionUUID->"ef9893da-d840-4e3a-9205-79881e013f70"],
Cell[331394, 7820, 266, 6, 28, "Input",ExpressionUUID->"272567ea-ec42-4696-81f5-ed6cde462aff"],
Cell[331663, 7828, 1496, 33, 124, "Input",ExpressionUUID->"ccae8fbc-3c00-4c05-86ae-c646a3490905"],
Cell[333162, 7863, 939, 21, 28, "Input",ExpressionUUID->"5ef5d6ed-983b-4110-9e78-cf2e3b23b2fa"],
Cell[334104, 7886, 2423, 55, 143, "Input",ExpressionUUID->"4c299361-67b5-4438-8b18-f160b40bc77d"]
}, Closed]],
Cell[CellGroupData[{
Cell[336564, 7946, 362, 5, 37, "Subsubsection",ExpressionUUID->"5f049965-b1e7-4b06-9056-95b8fddb7a2e"],
Cell[336929, 7953, 5523, 122, 219, "Input",ExpressionUUID->"f5ab9ea0-94e2-4c28-afa6-5d61a19128d7"],
Cell[342455, 8077, 2644, 65, 151, "Input",ExpressionUUID->"cd84eed8-dd95-444e-9ee3-817de28e3351"],
Cell[345102, 8144, 3048, 75, 170, "Input",ExpressionUUID->"59450278-f75b-4c17-b218-cb0dbe73e5db"]
}, Closed]],
Cell[CellGroupData[{
Cell[348187, 8224, 317, 5, 37, "Subsubsection",ExpressionUUID->"34e70cd3-c388-437d-b747-dfb980dd34b0"],
Cell[348507, 8231, 6319, 138, 230, "Input",ExpressionUUID->"f15b068e-2dbf-49ba-94f6-32f677f3d5a8"],
Cell[354829, 8371, 6345, 139, 228, "Input",ExpressionUUID->"661a7842-0e33-439c-ad0c-ee857a717ed3"],
Cell[361177, 8512, 5754, 141, 286, "Input",ExpressionUUID->"2ec4ceab-58ed-42da-9764-5c1fe8e60f8c"],
Cell[366934, 8655, 4119, 106, 229, "Input",ExpressionUUID->"957237de-98f0-43d2-9600-f802bff543cf"]
}, Closed]],
Cell[CellGroupData[{
Cell[371090, 8766, 409, 6, 37, "Subsubsection",ExpressionUUID->"f12aedd6-a16f-4be7-a4dd-9e54227e83a5"],
Cell[371502, 8774, 6705, 154, 265, "Input",ExpressionUUID->"c1392507-27c1-4b0d-b238-fab21c9db2b9"],
Cell[378210, 8930, 2330, 60, 130, "Input",ExpressionUUID->"f4cfd9c1-4346-4a17-be93-1bb873efcb17"],
Cell[380543, 8992, 2774, 71, 150, "Input",ExpressionUUID->"c620c90d-d75b-4819-a173-e1fe70d5e8ad"]
}, Closed]],
Cell[CellGroupData[{
Cell[383354, 9068, 360, 5, 37, "Subsubsection",ExpressionUUID->"9277751a-82f8-4fe2-abf2-2faed25cab7c"],
Cell[383717, 9075, 4965, 131, 193, "Input",ExpressionUUID->"94438857-7bcb-48be-a856-2e59f881dba9"],
Cell[388685, 9208, 6611, 166, 246, "Input",ExpressionUUID->"af9f31a1-fbb8-484c-b2e8-af95dd864cb6"],
Cell[395299, 9376, 6507, 164, 250, "Input",ExpressionUUID->"639f8769-acd2-4780-85d7-1594caf892a2"]
}, Closed]],
Cell[CellGroupData[{
Cell[401843, 9545, 187, 3, 37, "Subsubsection",ExpressionUUID->"8d033392-e0a8-4aac-a17f-ac95598f62fd"],
Cell[402033, 9550, 1309, 35, 105, "Input",ExpressionUUID->"a2b2efef-bb3a-4143-aa80-dd33f2a5214f"]
}, Closed]],
Cell[CellGroupData[{
Cell[403379, 9590, 176, 3, 37, "Subsubsection",ExpressionUUID->"3fd404ba-f33c-419e-a34c-2fbdf806b558"],
Cell[403558, 9595, 398, 8, 35, "Text",ExpressionUUID->"28becbea-6fb1-482d-a5dd-af3055eb74a9"],
Cell[403959, 9605, 7886, 197, 381, "Input",ExpressionUUID->"820db54d-64ed-4f0d-b8d6-03e3395e555c"],
Cell[411848, 9804, 10043, 247, 554, "Input",ExpressionUUID->"7e8065e4-e997-48ab-8282-f1b7152ceb6a"],
Cell[421894, 10053, 267, 6, 35, "Text",ExpressionUUID->"70a4da4b-87f2-469f-b011-1cc7d1cc3462"],
Cell[422164, 10061, 6859, 174, 344, "Input",ExpressionUUID->"f14c2bf8-5e1c-4916-927b-abff162f7b85"],
Cell[429026, 10237, 8927, 226, 479, "Input",ExpressionUUID->"202aa239-16a0-4c2e-904b-5ad0face209f"],
Cell[437956, 10465, 361, 7, 35, "Text",ExpressionUUID->"fd3bc767-f9ce-4456-a43d-fae1836433e9"],
Cell[438320, 10474, 6683, 169, 333, "Input",ExpressionUUID->"f2532eec-4528-463a-bde0-1f94265ba734"],
Cell[445006, 10645, 5701, 145, 266, "Input",ExpressionUUID->"c021477d-a4f9-46c0-afb5-8fccabb12c75"],
Cell[450710, 10792, 8162, 200, 402, "Input",ExpressionUUID->"79b9d55c-17f3-4e45-aca1-f400867272e8"]
}, Closed]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[458933, 10999, 155, 3, 53, "Section",ExpressionUUID->"f7cf327e-b1b0-42a8-b23e-527f71f3fd6f"],
Cell[459091, 11004, 4731, 110, 352, "Input",ExpressionUUID->"24da5b27-4496-4f0b-bdc0-6c2a566bc0ef"],
Cell[463825, 11116, 2884, 72, 143, "Input",ExpressionUUID->"f650cc62-ca13-4b0d-a046-3d3bb07d469f"],
Cell[466712, 11190, 2903, 78, 162, "Input",ExpressionUUID->"b98e7b76-0329-4be5-8a29-0e150529af92"],
Cell[469618, 11270, 5247, 114, 333, "Input",ExpressionUUID->"dfbcc53f-2354-421a-ac99-d6bf5de92ffc"],
Cell[474868, 11386, 5115, 130, 295, "Input",ExpressionUUID->"944f4e68-9478-4b7a-ac83-d0749bf07170"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[480032, 11522, 160, 3, 69, "Chapter",ExpressionUUID->"c9c7d7c1-10e9-4145-a7f4-284f19659d5d"],
Cell[480195, 11527, 320, 7, 35, "Text",ExpressionUUID->"e76e243f-fe85-4995-845d-d375675d8a2a"],
Cell[480518, 11536, 1668, 38, 67, "Input",ExpressionUUID->"82e63006-53b2-4b05-a2a6-f209d75dae34"],
Cell[482189, 11576, 220, 4, 28, "Input",ExpressionUUID->"2a90ec71-a212-41f2-b1b7-1f4f98314f30"]
}, Closed]],
Cell[CellGroupData[{
Cell[482446, 11585, 224, 4, 58, "Chapter",ExpressionUUID->"7bd0086e-ee3c-404f-ad98-96d9757a185b"],
Cell[CellGroupData[{
Cell[482695, 11593, 173, 3, 67, "Section",ExpressionUUID->"43f82082-eb36-44c7-a900-ede8304bac18"],
Cell[482871, 11598, 3887, 72, 86, "Input",ExpressionUUID->"7dcedfd5-790e-4966-b94a-d932091335b0"],
Cell[486761, 11672, 2380, 59, 67, "Input",ExpressionUUID->"c45cd374-f715-4955-9dd1-a3f84bed4288"],
Cell[489144, 11733, 4527, 113, 600, "Input",ExpressionUUID->"0be9d819-edd2-4814-b660-2e985b6ca5f8"],
Cell[493674, 11848, 1636, 39, 124, "Input",ExpressionUUID->"8eeba832-573b-4199-a8b3-d0fe46ba2fee"],
Cell[CellGroupData[{
Cell[495335, 11891, 154, 3, 54, "Subsection",ExpressionUUID->"325fbbab-ba7a-4930-920f-02e96d794d93"],
Cell[495492, 11896, 904, 24, 48, "Input",ExpressionUUID->"6ba45815-0889-4f7a-bbf4-d3b02e9680c1"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[496445, 11926, 324, 7, 91, "Section",ExpressionUUID->"0473a67a-013b-42a8-b83e-9b86be48bfd5"],
Cell[496772, 11935, 5264, 125, 333, "Input",ExpressionUUID->"b494ccde-24e9-4534-8ce2-02e46397e658"],
Cell[CellGroupData[{
Cell[502061, 12064, 222, 4, 64, "Subsection",ExpressionUUID->"d72837cd-2ba7-4e2d-8716-5a2a1ebbc5f1"],
Cell[502286, 12070, 3889, 104, 70, "Input",ExpressionUUID->"d7a40384-4cf1-43a4-be99-e3f65a0dfa91"],
Cell[506178, 12176, 1878, 41, 70, "Input",ExpressionUUID->"df574fd1-8df7-4939-a2f6-b6331edcb6ec"]
}, Closed]],
Cell[CellGroupData[{
Cell[508093, 12222, 186, 3, 38, "Subsection",ExpressionUUID->"44590df7-90bf-4198-a60b-88ce06c7ed98"],
Cell[508282, 12227, 4164, 97, 295, "Input",ExpressionUUID->"f28f80b3-0a47-45f1-9939-364788155dae"],
Cell[512449, 12326, 4328, 99, 295, "Input",ExpressionUUID->"af00f45a-129b-44f7-9e6a-c1427ad0ee07"],
Cell[516780, 12427, 4110, 96, 295, "Input",ExpressionUUID->"0d8d11ff-dc2f-444e-a5cf-bc4d22687ac1"],
Cell[CellGroupData[{
Cell[520915, 12527, 163, 3, 45, "Subsubsection",ExpressionUUID->"ac487801-e186-4fda-8d59-623ac2191b93"],
Cell[521081, 12532, 782, 20, 121, "Code",ExpressionUUID->"14f14933-03f5-4d0a-8f65-30ad965d4be3"],
Cell[521866, 12554, 5449, 128, 219, "Input",ExpressionUUID->"5bf54966-1721-41e7-9a70-cdef33640754"],
Cell[527318, 12684, 1145, 28, 124, "Input",ExpressionUUID->"251074d7-ebba-4236-91f7-e2143956e781"],
Cell[528466, 12714, 914, 22, 124, "Input",ExpressionUUID->"a9613da2-1e1e-405e-8619-8fdb904747fa"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[529441, 12743, 213, 4, 53, "Section",ExpressionUUID->"60c4a9c6-bfe8-4aa6-9656-aa9507475bf2"],
Cell[529657, 12749, 2156, 45, 258, "Input",ExpressionUUID->"b4e1f2a8-d52a-46d0-9fa7-4029d808d3bb"],
Cell[CellGroupData[{
Cell[531838, 12798, 228, 4, 45, "Subsubsection",ExpressionUUID->"9047ff7c-6529-4995-939f-a66378c614be"],
Cell[532069, 12804, 1359, 34, 83, "Input",ExpressionUUID->"8b120139-57dd-44de-97f6-b1fd4afda71c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[533465, 12843, 163, 3, 45, "Subsubsection",ExpressionUUID->"83045f1d-2b2b-4fb5-9dc4-21c028870589"],
Cell[533631, 12848, 782, 20, 147, "Code",ExpressionUUID->"469aee95-3b03-48f6-9de5-cbb94bf8db71"],
Cell[534416, 12870, 5527, 129, 283, "Input",ExpressionUUID->"03001c07-ec29-4d42-9bb3-8fcfa123f11a"],
Cell[539946, 13001, 1201, 28, 158, "Input",ExpressionUUID->"487c7753-c77b-4096-bcf8-8ac615222c00"],
Cell[541150, 13031, 1801, 39, 108, "Input",ExpressionUUID->"3b614e74-86c4-4459-9da0-8340dfcb3f19"]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[543012, 13077, 155, 3, 58, "Chapter",ExpressionUUID->"d9fd4add-45ee-4a61-8ebf-24a99dfcb24f"],
Cell[543170, 13082, 9041, 180, 352, "Input",ExpressionUUID->"3f23623f-e82b-4b0f-b937-69cb1651ca1a"]
}, Closed]],
Cell[CellGroupData[{
Cell[552248, 13267, 203, 3, 106, "Chapter",ExpressionUUID->"2bcecd1c-951e-4886-a19a-d2aa90b31e87"],
Cell[CellGroupData[{
Cell[552476, 13274, 173, 3, 54, "Subsection",ExpressionUUID->"da9418b5-8f0a-436f-af43-6392d850c943"],
Cell[552652, 13279, 1490, 39, 50, "Code",ExpressionUUID->"486d7847-784b-475b-81a8-588942b338ef"],
Cell[554145, 13320, 236, 4, 28, "Input",ExpressionUUID->"021a4473-a85e-4b27-ba65-b235472d21e8"],
Cell[554384, 13326, 2054, 49, 105, "Input",ExpressionUUID->"80a56cc5-9516-421f-9e25-aeec8f0ea3b6"],
Cell[CellGroupData[{
Cell[556463, 13379, 206, 3, 45, "Subsubsection",ExpressionUUID->"34f82bd2-c82d-499f-942d-8b00ce75ad4a"],
Cell[556672, 13384, 6949, 151, 504, "Input",ExpressionUUID->"41d3d6ba-d953-4961-bab0-bb45acc721f3"],
Cell[563624, 13537, 1997, 52, 105, "Input",ExpressionUUID->"fdc1c7bb-5981-4391-9b13-03bc1c4de34d"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[565670, 13595, 163, 3, 38, "Subsection",ExpressionUUID->"df5cf14f-8970-4689-a9b6-c5fc18e7a987"],
Cell[565836, 13600, 923, 23, 58, "Input",ExpressionUUID->"36796982-e89e-46ba-91ac-a94514aba05b"],
Cell[566762, 13625, 909, 24, 58, "Input",ExpressionUUID->"6b86c749-24e3-496e-83b8-5fdef7cd124d"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[567720, 13655, 235, 4, 106, "Chapter",ExpressionUUID->"b906e8a5-a42c-4888-9514-32639b7fb934"],
Cell[CellGroupData[{
Cell[567980, 13663, 280, 6, 67, "Section",ExpressionUUID->"67220192-3f6d-478f-b33f-0fcf6bba9886"],
Cell[568263, 13671, 2634, 62, 245, "Input",ExpressionUUID->"c6999a2a-e8dd-4dda-bb77-ffefe987a64b"],
Cell[570900, 13735, 2977, 72, 162, "Input",ExpressionUUID->"03c881a9-be9c-4d9a-944d-3ec784aee92e"],
Cell[573880, 13809, 3250, 75, 162, "Input",ExpressionUUID->"67bff963-6af0-4cb0-b223-4e5de5a6e624"],
Cell[577133, 13886, 1365, 31, 48, "Input",ExpressionUUID->"a87752e7-2eab-48da-a35a-39f72345e2f0"]
}, Closed]],
Cell[CellGroupData[{
Cell[578535, 13922, 161, 3, 53, "Section",ExpressionUUID->"b5e8cbd7-dd24-46d9-912d-a03128982961"],
Cell[578699, 13927, 900, 23, 122, "Input",ExpressionUUID->"d7c4dcb3-f198-45c7-9b49-55527931e28c"],
Cell[579602, 13952, 1470, 39, 48, "Input",ExpressionUUID->"5a3afddb-d040-4eec-8757-55d1212b329d"],
Cell[581075, 13993, 976, 24, 122, "Input",ExpressionUUID->"89200402-ccd3-45e6-ab9c-dd7d76daab0b"],
Cell[582054, 14019, 1595, 40, 48, "Input",ExpressionUUID->"e3d24056-fefa-4750-b86e-2833ad49116d"],
Cell[583652, 14061, 1052, 25, 122, "Input",ExpressionUUID->"d7c8ad54-8bf0-4f1a-9a4b-150301a8d83f"],
Cell[584707, 14088, 1682, 41, 67, "Input",ExpressionUUID->"6d58c506-e4f9-4e1e-8709-0d0248828700"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[586438, 14135, 173, 3, 58, "Chapter",ExpressionUUID->"d6e06403-20f7-49a0-b8c9-39277323b775"],
Cell[CellGroupData[{
Cell[586636, 14142, 159, 3, 67, "Section",ExpressionUUID->"3cfb1212-a32d-4a54-8fd6-b2009cb2987b"],
Cell[586798, 14147, 2003, 33, 86, "Input",ExpressionUUID->"64d96476-b8e6-4468-9385-2fde57c44da1"],
Cell[588804, 14182, 252, 6, 28, "Input",ExpressionUUID->"88ad4c1f-c901-420d-8dbe-4e358c13deaa"]
}, Closed]],
Cell[CellGroupData[{
Cell[589093, 14193, 272, 5, 53, "Section",ExpressionUUID->"f1bcc44a-84f2-4ce6-b5d4-29a2c825ff09"],
Cell[589368, 14200, 1986, 36, 32, "Input",ExpressionUUID->"b7373129-8980-4f28-8dd0-00ccf2253252"],
Cell[591357, 14238, 312, 8, 32, "Input",ExpressionUUID->"235a03f0-5064-47cd-bf63-e209e0623cd5"],
Cell[591672, 14248, 777, 18, 32, "Input",ExpressionUUID->"0a10c3bf-bf8a-4316-be23-d8d470414d20"],
Cell[592452, 14268, 1957, 54, 133, "Input",ExpressionUUID->"e29d2417-922f-4238-9c5e-c27e8643398b"],
Cell[594412, 14324, 938, 20, 32, "Input",ExpressionUUID->"5189ffd2-2b66-4efe-9d33-6d88e86287d3"],
Cell[595353, 14346, 986, 21, 58, "Input",ExpressionUUID->"2ef0c741-a6cc-4cdf-8164-851343cf7aa8"],
Cell[596342, 14369, 1282, 31, 83, "Input",ExpressionUUID->"e09e46c7-26ef-4733-815f-ed58bbb2663a"],
Cell[597627, 14402, 689, 17, 32, "Input",ExpressionUUID->"9e0a11e6-52c9-49b1-b224-1bfc9998f5f5"],
Cell[598319, 14421, 874, 21, 58, "Input",ExpressionUUID->"db0c4b3f-3fdc-41a4-9495-4cd4ccec0c26"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[599242, 14448, 249, 4, 106, "Chapter",ExpressionUUID->"d3a329e1-23fa-4d4b-b330-878d95faf708"],
Cell[CellGroupData[{
Cell[599516, 14456, 175, 3, 54, "Subsection",ExpressionUUID->"d99d482e-3c57-4732-b4f0-3a15b58b455c"],
Cell[599694, 14461, 755, 17, 58, "Input",ExpressionUUID->"8a30a2bf-e8d3-4878-a15d-dbf996283077"],
Cell[600452, 14480, 1244, 30, 83, "Input",ExpressionUUID->"6f5dea9a-f8e4-4bb7-a6d5-2c62fcd94df2"],
Cell[601699, 14512, 1187, 24, 58, "Input",ExpressionUUID->"d3effd15-353b-48bd-85c6-03358d3e0b74"],
Cell[602889, 14538, 974, 19, 32, "Input",ExpressionUUID->"ee1d4592-67af-4e50-90b0-62387bd16e93"],
Cell[603866, 14559, 1080, 23, 58, "Input",ExpressionUUID->"606a78cb-c225-44a7-8a1d-60628f14110e"],
Cell[604949, 14584, 716, 17, 58, "Input",ExpressionUUID->"453e644d-f18e-4214-8755-4b62125b5d7e"],
Cell[605668, 14603, 588, 12, 58, "Input",ExpressionUUID->"ed95c07f-771a-4d2c-a4f0-28923e1f3309"],
Cell[606259, 14617, 959, 20, 58, "Input",ExpressionUUID->"ad466866-dcdd-4b71-9a60-13b86ce013a1"],
Cell[607221, 14639, 1199, 25, 32, "Input",ExpressionUUID->"44e38c5c-d041-4b0b-8e8e-935364124c1f"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[608469, 14670, 153, 3, 58, "Chapter",ExpressionUUID->"161c7e57-1c76-41da-878f-4d306c3e655c"],
Cell[CellGroupData[{
Cell[608647, 14677, 163, 3, 67, "Section",ExpressionUUID->"404aab30-5864-41ed-a9fd-24fdd7af220f"],
Cell[CellGroupData[{
Cell[608835, 14684, 215, 4, 54, "Subsection",ExpressionUUID->"17941c5f-71d4-4571-bcf0-aab9bc84e8ac"],
Cell[609053, 14690, 2097, 60, 58, "Input",ExpressionUUID->"1a44b28d-dc02-4716-8154-a52774a35392"],
Cell[611153, 14752, 427, 11, 58, "Input",ExpressionUUID->"937018a6-3f51-41c8-9783-13ddce1f9da5"],
Cell[611583, 14765, 251, 6, 35, "Text",ExpressionUUID->"7f649052-29f9-4e23-9ff8-c47e23d77206"],
Cell[611837, 14773, 932, 25, 83, "Input",ExpressionUUID->"aee01d3c-6a9e-4840-bc6b-6eb2ad4e3a73"],
Cell[612772, 14800, 346, 5, 35, "Text",ExpressionUUID->"f2530887-3ddc-4431-9d64-5ef535d5f05d"],
Cell[613121, 14807, 926, 17, 83, "Input",ExpressionUUID->"5c335492-8644-4ab0-b402-5d8728c8066a"],
Cell[614050, 14826, 702, 14, 83, "Input",ExpressionUUID->"1e2367d1-4490-4fa1-9836-5ed61826f74e"],
Cell[614755, 14842, 1843, 47, 152, "Input",ExpressionUUID->"f18b15c4-f04b-41cd-84c4-35efcdfb96f9"],
Cell[616601, 14891, 442, 12, 52, "Input",ExpressionUUID->"1fa2477b-6ba5-4297-81ac-de3ffc2f58b6"],
Cell[617046, 14905, 406, 10, 32, "Input",ExpressionUUID->"f62f4bad-671a-4ced-8ff0-5b76304df583"],
Cell[617455, 14917, 309, 8, 32, "Input",ExpressionUUID->"412cb217-7816-4be7-9733-65ddc7380ea4"],
Cell[617767, 14927, 776, 20, 98, "Input",ExpressionUUID->"cccd99c5-d3dd-41ef-bf69-c749e667cdc3"],
Cell[618546, 14949, 830, 23, 124, "Input",ExpressionUUID->"4f6b6ad6-283f-438c-8ab4-93d2449ed61a"],
Cell[619379, 14974, 131, 2, 32, "Input",ExpressionUUID->"f9c586cb-d5bd-496f-8811-79e175aa42ae"],
Cell[619513, 14978, 399, 10, 32, "Input",ExpressionUUID->"0cde684a-84b4-4db5-9fff-15ec8f50a574"],
Cell[619915, 14990, 597, 13, 32, "Input",ExpressionUUID->"1bc99070-e2f8-46cc-b558-0b801dfadd4c"],
Cell[620515, 15005, 221, 3, 58, "Input",ExpressionUUID->"ae63391f-fb0b-4853-8995-e6369ff80fbe"],
Cell[620739, 15010, 379, 7, 48, "Input",ExpressionUUID->"8dea69d6-5dc2-4a1a-9ed9-ba7e8aeaa8cf"],
Cell[CellGroupData[{
Cell[621143, 15021, 189, 3, 45, "Subsubsection",ExpressionUUID->"070450ea-d314-43f8-9d49-91ae0ae50516"],
Cell[621335, 15026, 1648, 48, 83, "Input",ExpressionUUID->"86c60b2e-c51c-4f15-a28d-9ae4c5e56e09"],
Cell[622986, 15076, 1700, 49, 83, "Input",ExpressionUUID->"391ee8bb-788c-4a26-84e0-b0ba35ef8b6f"],
Cell[624689, 15127, 2912, 84, 143, "Input",ExpressionUUID->"b6d4104f-3cc7-455c-9f35-54429c95aa1b"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[627650, 15217, 166, 3, 54, "Subsection",ExpressionUUID->"7ade186b-7350-4e61-be80-d03cf33dd614"],
Cell[627819, 15222, 857, 25, 67, "Input",ExpressionUUID->"04b692d6-569f-4270-afac-d8dee848ee5a"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[628725, 15253, 198, 3, 91, "Section",ExpressionUUID->"80ec1585-3eb9-41b8-912e-bd2bf947c467"],
Cell[628926, 15258, 237, 6, 35, "Text",ExpressionUUID->"ae0af948-806b-49f2-b213-d1882863af9d"],
Cell[629166, 15266, 1341, 30, 28, "Input",ExpressionUUID->"e421ab94-4852-430a-9b38-65a0087a00e4"],
Cell[630510, 15298, 246, 4, 35, "Text",ExpressionUUID->"49cde71c-eb34-456b-869c-352ca6cb0642"],
Cell[630759, 15304, 984, 25, 28, "Input",ExpressionUUID->"0db9b1bb-ae54-4724-98aa-afbb20c6f730"],
Cell[631746, 15331, 177, 3, 35, "Text",ExpressionUUID->"83098490-71f3-4482-a4dc-b7c78537a2c0"],
Cell[631926, 15336, 974, 22, 28, "Input",ExpressionUUID->"6ea79d9a-de68-4ef2-a9c0-2447744e7f88"],
Cell[CellGroupData[{
Cell[632925, 15362, 740, 12, 45, "Subsubsection",ExpressionUUID->"a17de581-4f26-4c85-ae70-fe51fab85f85"],
Cell[633668, 15376, 1796, 46, 48, "Input",ExpressionUUID->"9b1de7bd-a0d9-413c-89ea-e37cc49c7a50"],
Cell[635467, 15424, 340, 5, 35, "Text",ExpressionUUID->"bc2b54bb-909a-42aa-be45-153538f157b9"],
Cell[635810, 15431, 923, 21, 32, "Input",ExpressionUUID->"7fa9e2c9-65d0-4d43-ac7d-49f810dac616"],
Cell[636736, 15454, 1261, 38, 32, "Input",ExpressionUUID->"0d4a4353-854b-4049-9232-722fe92eda20"],
Cell[638000, 15494, 354, 7, 32, "Input",ExpressionUUID->"104d6e91-d855-4b6d-aba1-a5660f0e0044"],
Cell[638357, 15503, 1244, 29, 32, "Input",ExpressionUUID->"6a331514-371a-4de1-a56a-f5f3a18065c9"],
Cell[639604, 15534, 2848, 67, 58, "Input",ExpressionUUID->"72f880d3-5b13-41b1-ac4f-cade7d55ef6a"],
Cell[642455, 15603, 243, 5, 32, "Input",ExpressionUUID->"35a0d50d-a91a-47de-8ba7-fb1bac767217"],
Cell[642701, 15610, 2719, 61, 158, "Input",ExpressionUUID->"47d654bf-f82d-485f-a984-b6afa6f5a6a5"],
Cell[645423, 15673, 2735, 73, 105, "Input",ExpressionUUID->"4250fe1a-7593-478e-89d5-dc7f915aa46c"]
}, Closed]],
Cell[CellGroupData[{
Cell[648195, 15751, 741, 12, 37, "Subsubsection",ExpressionUUID->"11885b1c-9cf5-4d64-b658-a862ae417362"],
Cell[648939, 15765, 276, 6, 32, "Input",ExpressionUUID->"770c7d7c-5b0d-4372-a1ad-5c598ef1927c"],
Cell[649218, 15773, 1109, 26, 32, "Input",ExpressionUUID->"e6c1b2f6-731a-4061-8446-5e8a3f9703ee"],
Cell[650330, 15801, 2923, 67, 58, "Input",ExpressionUUID->"4fad3792-158e-4671-a25d-211e12041420"],
Cell[653256, 15870, 3114, 66, 158, "Input",ExpressionUUID->"efdbb440-17d2-4281-9e66-9b3001d7b02a"]
}, Closed]],
Cell[CellGroupData[{
Cell[656407, 15941, 576, 8, 37, "Subsubsection",ExpressionUUID->"fb4ab388-c8fb-4097-860d-fe3d80f77e4b"],
Cell[656986, 15951, 1482, 36, 133, "Input",ExpressionUUID->"c7fd4a09-7488-41f6-890f-51ac63bf8835"],
Cell[658471, 15989, 2437, 56, 158, "Input",ExpressionUUID->"53aa7ecc-7cb3-4400-bd51-835fa0773ad2"],
Cell[660911, 16047, 7179, 167, 283, "Input",ExpressionUUID->"81171dd7-af62-481b-a630-ef6fb687cf03"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[668139, 16220, 198, 3, 91, "Section",ExpressionUUID->"599843de-865f-4014-adef-49f592d89035"],
Cell[668340, 16225, 962, 25, 28, "Input",ExpressionUUID->"871045dc-b138-442d-aea1-3de6abe7db05"],
Cell[669305, 16252, 262, 7, 28, "Input",ExpressionUUID->"bb99fe1a-e62a-43ff-a239-6d3f272a93cf"],
Cell[669570, 16261, 1796, 46, 48, "Input",ExpressionUUID->"d2d83970-9058-4f52-9b2c-b76cb0e6fa0b"],
Cell[671369, 16309, 1202, 33, 48, "Input",ExpressionUUID->"1e8d8e61-e473-405e-93bf-989d9f1aa634"],
Cell[CellGroupData[{
Cell[672596, 16346, 680, 10, 45, "Subsubsection",ExpressionUUID->"79243dbc-8b11-4c28-82e5-30ef212e55e1"],
Cell[673279, 16358, 288, 6, 28, "Input",ExpressionUUID->"ae195d1d-30d8-4ac4-834b-5e4392eed0ca"],
Cell[673570, 16366, 1157, 27, 53, "Input",ExpressionUUID->"a438422e-1421-4327-9e01-a460e4c8e637"],
Cell[674730, 16395, 3692, 83, 67, "Input",ExpressionUUID->"ec18979d-86df-4038-bc83-7dd239058b94"],
Cell[678425, 16480, 2674, 60, 124, "Input",ExpressionUUID->"f51ad22c-aa57-46d3-8120-7cde25379f48"],
Cell[681102, 16542, 3691, 83, 83, "Input",ExpressionUUID->"996fa7e8-a81c-4631-af2d-f336cc8a405d"],
Cell[684796, 16627, 2674, 60, 158, "Input",ExpressionUUID->"cdd644df-5325-4e7b-a10a-422e41a8cff4"],
Cell[687473, 16689, 3691, 83, 83, "Input",ExpressionUUID->"494ebee8-1128-4b5b-8c5f-b72e5fb2e87e"],
Cell[691167, 16774, 2673, 60, 158, "Input",ExpressionUUID->"3a8c0935-4ee0-44e3-a517-3a6fc9ab0162"],
Cell[693843, 16836, 3790, 84, 83, "Input",ExpressionUUID->"0d10865c-28ac-472a-8b06-7b5736063b9f"],
Cell[697636, 16922, 2678, 60, 158, "Input",ExpressionUUID->"ae492b0d-1ece-40e4-9e2e-2bdcf7b5a130"],
Cell[700317, 16984, 3953, 86, 83, "Input",ExpressionUUID->"32fa110d-8fe1-43a1-b1f6-f7500684bb21"],
Cell[704273, 17072, 2730, 61, 158, "Input",ExpressionUUID->"3f156a7c-5f3b-456f-85d6-a73d4f346f66"],
Cell[707006, 17135, 3901, 85, 83, "Input",ExpressionUUID->"4cecf510-983e-44ef-8f80-3cc4f718b928"],
Cell[710910, 17222, 2782, 62, 158, "Input",ExpressionUUID->"b9ad5cce-5c48-4346-ae10-3e53c094a8d5"],
Cell[713695, 17286, 3647, 86, 233, "Input",ExpressionUUID->"ab1e16fa-6460-4d76-8b86-53a36c479348"]
}, Closed]]
}, Closed]]
}, Open  ]]
}, Open  ]]
}
]
*)

